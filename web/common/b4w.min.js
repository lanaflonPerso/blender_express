var b4w="object"===typeof b4w?b4w:function(a){var p={};a.module=p;var d={};a.cleanup=function(a,c){var q=p[a];q&&(q.pi=null);d[c||"__b4w_default"]=null};a.register=function(a,c){p[a]||(p[a]=c)};a.require=function(a,c){if(!p[a])throw Error('Module "'+a+'" not found');c=c||"__b4w_default";d[c]||(d[c]=function(a){return function(b){var c=p[b];if(!c)throw Error('Module "'+b+'" not found');c.pi||(c.pi={});c.pi[a]||(c.pi[a]={},c(c.pi[a],d[a]));return c.pi[a]}}(c));return d[c](a)};a.module_check=function(a){return p[a]?
!0:!1};a.get_namespace=function(a){for(var c in d)if(d[c]==a)return c;return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.Zp&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function p(){var a=d,b=a.getDate(),b=10>b?"0"+String(b):String(b),f=a.getMonth()+1,f=10>f?"0"+String(f):String(f),t=String(a.getFullYear()),l=a.getHours(),l=10>l?"0"+String(l):String(l),n=a.getMinutes(),n=10>n?"0"+String(n):String(n),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return b+"."+f+"."+t+" "+l+":"+n+":"+a}var d=new Date(2016,0,28,12,25,48),b=[16,1];a.version=function(){return b};a.version_str=function(){for(var a="",d=0;d<b.length;d++)a=1==d?a+(10>b[d]?
"0"+b[d]:b[d]):a+b[d],d!=b.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return d};a.date_str=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Zp&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function d(){return b4w.module_check(a.Bc.rm)}function b(){for(var b=a.Bc,d=null,l=document.getElementsByTagName("script"),n=0;n<l.length;n++){for(var g=l[n].src,q=0;q<b.tv.length;q++)if(0<=g.indexOf(b.tv[q])){d=g;break}if(null!==d)break}d||(c.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),d=document.location.href);b=d.indexOf("?");0<=b&&(d=d.substring(0,b));return d.substring(0,d.lastIndexOf("/")+1)}var c=p("__print"),
q=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.gB=q.xa(a.context);a.p={alpha_sort:!0,alpha_sort_threshold:.1,Mo:!1,Eh:[5,7],je:1E4,console_verbose:!1,do_not_load_resources:!1,po:!1,wu:1.5,DC:10,background_color:[0,0,0,0],Ah:.01,canvas_resolution_factor:1,Mj:3,allow_cors:!1,dq:!1,fm:!0,show_hud_debug_info:!1,zJ:!0,vj:!0,stereo:"NONE",no:!0,pl:!0,Dc:!0,Xc:!0,Ci:!0,Si:!0,pm:!0,Fh:!0,xi:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,
dy:!1,Hi:!0,hl:!0,$b:!0,Jn:!0,water_dynamic:!0,shore_smoothing:!0,wj:!0,Db:1024,Dh:512,Kx:!0,precision:"highp",quality:a.P_HIGH,Lo:!0,WE:!1,Pw:!1,Qp:!1,Sx:!1,wh:!1,Rp:!1,Ut:!1,Bq:!1,rp:!1,XK:!1,tl:!1,allow_hidpi:!1,gyro_use:!1,tu:!1,ar:!1,enable_selectable:!0,enable_outlining:!0,nf:!0,Hv:128,zq:!1,iv:!1,EE:!1,Uq:[0,0],Gk:!1,rw:!0,No:!1,url_params:null,Ec:!0,Ac:4,Hw:!1,Cw:!1,lk:!1,media_auto_activation:!0,Gv:4,qn:!1,gt:!1};a.$B=q.xa(a.p);a.Vg={Sm:-1,xu:!1,oh:1};a.controls={TE:1/120};a.ve={dir:"ASSETS=../../assets/",
NE:15,qr:!0,Zq:!1,Lp:!1};a.lA=q.xa(a.ve);a.Bc={shaders_dir:"",nG:"include/",TK:"postprocessing/",rm:"built_in_data",tv:"b4w.min.js b4w.full.min.js b4w.simple.min.js b4w.whitespace.min.js src/b4w.js USER_DEFINED_MODULE".split(" "),Dw:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.o={enabled:!0,je:60,Hl:"",jp:!1,ping:!1,Ll:!0};a.eF=q.xa(a.o);a.tj={Xm:1024,zk:384,$t:32,TB:128,SB:256,fw:.25,mF:.5,lF:1};a.NF=q.xa(a.tj);a.F={Hs:!0,vn:!1,pt:!1,Lt:!1,ku:!1};a.mG=q.xa(a.F);a.Jb={outlining_overview_mode:!1,
uf:[1,.4,.05],nj:.2,oj:3.8,pj:1};a.Mp={enabled:!1,OG:"DEPTH",NG:0,rG:"COLOR"};a.XB=q.xa(a.Mp);a.hA=function(){var b=a.p,c=a.o,d=a.tj;switch(b.quality){case a.P_ULTRA:b.vj=!0;b.shore_smoothing=!0;b.Xc=!0;b.Ci=!0;b.Si=!0;b.pm=!0;b.pl=!0;b.Dc=!0;b.Hi=!0;b.hl=!0;b.$b=!0;b.Jn=!0;d.Xm=2048;b.Mj=3;b.fm=!0;b.po=!1;b.precision="highp";b.water_dynamic=!0;b.wj=!0;b.antialiasing=!0;b.smaa=!1;b.xi=!0;b.Fh=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.nf=!0;b.Ac=16;c.je=120;break;case a.P_HIGH:b.vj=!0;b.shore_smoothing=
!0;b.Xc=!0;b.Ci=!0;b.Si=!0;b.pm=!0;b.pl=!0;b.Dc=!0;b.Hi=!0;b.hl=!0;b.$b=!0;b.Jn=!0;d.Xm=1024;b.Mj=3;b.fm=!0;b.po=!1;b.precision="highp";b.water_dynamic=!0;b.wj=!0;b.antialiasing=!0;b.smaa=!1;b.xi=!0;b.Fh=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.nf=!0;b.Ac=4;c.je=60;break;case a.P_LOW:b.vj=!1,b.shore_smoothing=!1,b.Xc=!1,b.Ci=!1,b.Si=!1,b.pm=!1,b.pl=!1,b.Dc=!1,b.Hi=!1,b.hl=!1,b.$b=!1,b.Jn=!1,d.Xm=512,b.Mj=2,b.fm=!1,b.po=!0,b.precision="mediump",b.water_dynamic=!1,b.wj=!1,b.antialiasing=!1,b.smaa=
!1,b.xi=!1,b.Fh=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.nf=!1,b.Ac=1,c.je=60}};a.set=function(b,d){switch(b){case "allow_cors":a.p.allow_cors=d;break;case "allow_hidpi":a.p.allow_hidpi=d;break;case "alpha":a.context.alpha=d;break;case "alpha_sort":a.p.alpha_sort=d;break;case "alpha_sort_threshold":a.p.alpha_sort_threshold=d;break;case "anaglyph_use":c.oC();a.p.stereo=d?"ANAGLYPH":a.p.stereo;break;case "animation_framerate":a.Vg.Sm=d;break;case "antialiasing":a.p.antialiasing=d;break;case "assets_dds_available":a.ve.Lp=
d;break;case "assets_min50_available":a.ve.Zq=d;break;case "audio":a.F.Hs=d;break;case "background_color":a.p.background_color=d;break;case "built_in_module_name":a.Bc.rm=d;break;case "canvas_resolution_factor":a.p.canvas_resolution_factor=d;break;case "console_verbose":a.p.console_verbose=d;break;case "do_not_load_resources":a.p.do_not_load_resources=d;break;case "gyro_use":a.p.gyro_use=d;break;case "stereo":a.p.stereo=d;break;case "use_browser_distortion_cor":a.p.no=d;case "media_auto_activation":a.p.media_auto_activation=
d;break;case "physics_enabled":a.o.enabled=d;break;case "physics_uranium_path":a.o.Hl=d;break;case "physics_calc_fps":a.o.jp=d;break;case "physics_use_workers":a.o.Ll=d;break;case "precision":a.p.precision=d;break;case "quality":a.p.quality=d;break;case "sfx_mix_mode":a.F.vn=d;break;case "shaders_dir":a.Bc.shaders_dir=d;break;case "show_hud_debug_info":a.p.show_hud_debug_info=d;break;case "smaa":a.p.smaa=d;break;case "smaa_search_texture_path":a.Bc.smaa_search_texture_path=d;break;case "smaa_area_texture_path":a.Bc.smaa_area_texture_path=
d;break;case "wireframe_debug":a.p.wireframe_debug=d;break;case "enable_selectable":a.p.enable_selectable=d;break;case "enable_outlining":a.p.enable_outlining=d;break;case "outlining_overview_mode":a.Jb.outlining_overview_mode=d;break;case "glow_materials":a.p.nf=d;break;case "url_params":a.p.url_params=d;break;default:c.error("Unknown config property: "+b)}};a.get=function(b){switch(b){case "allow_cors":return a.p.allow_cors;case "allow_hidpi":return a.p.allow_hidpi;case "alpha":return a.context.alpha;
case "alpha_sort":return a.p.alpha_sort;case "alpha_sort_threshold":return a.p.alpha_sort_threshold;case "anaglyph_use":return"ANAGLYPH"==a.p.stereo;case "animation_framerate":return a.Vg.Sm;case "antialiasing":return a.p.antialiasing;case "assets_dds_available":return a.ve.Lp;case "assets_min50_available":return a.ve.Zq;case "audio":return a.F.Hs;case "background_color":return a.p.background_color;case "built_in_module_name":return a.Bc.rm;case "canvas_resolution_factor":return a.p.canvas_resolution_factor;
case "console_verbose":return a.p.console_verbose;case "do_not_load_resources":return a.p.do_not_load_resources;case "gyro_use":return a.p.gyro_use;case "stereo":return a.p.stereo;case "use_browser_distortion_cor":return a.p.no;case "media_auto_activation":return a.p.media_auto_activation;case "physics_enabled":return a.o.enabled;case "physics_uranium_path":return a.o.Hl;case "physics_calc_fps":return a.o.jp;case "physics_use_workers":return a.o.Ll;case "precision":return a.p.precision;case "quality":return a.p.quality;
case "sfx_mix_mode":return a.F.vn;case "shaders_dir":return a.Bc.shaders_dir;case "show_hud_debug_info":return a.p.show_hud_debug_info;case "smaa":return a.p.smaa;case "smaa_search_texture_path":return a.Bc.smaa_search_texture_path;case "smaa_area_texture_path":return a.Bc.smaa_area_texture_path;case "wireframe_debug":return a.p.wireframe_debug;case "enable_selectable":return a.p.enable_selectable;case "enable_outlining":return a.p.enable_outlining;case "outlining_overview_mode":return a.Jb.outlining_overview_mode;
case "glow_materials":return a.p.nf;case "url_params":return a.p.url_params;default:c.error("Unknown config property: "+b)}};a.reset=function(){a.context=q.xa(a.gB);a.p=q.xa(a.$B);a.ve=q.xa(a.lA);a.o=q.xa(a.eF);a.tj=q.xa(a.NF);a.F=q.xa(a.mG);a.Mp=q.xa(a.XB)};a.TD=d;a.cG=function(){var c=a.Bc,t=a.o;d()||""!=c.shaders_dir||(c.shaders_dir=b()+"../shaders/");if(d())c.smaa_search_texture_path="smaa_search_texture.png",c.smaa_area_texture_path="smaa_area_texture.png";else if(""==c.smaa_search_texture_path||
""==c.smaa_area_texture_path){var l=b()+c.Dw;c.smaa_search_texture_path=c.smaa_search_texture_path||l+"smaa_search_texture.png";c.smaa_area_texture_path=c.smaa_area_texture_path||l+"smaa_area_texture.png"}t.enabled&&""==t.Hl&&(l=b()+c.Dw,t.Hl=l+"uranium.js")};a.get_std_assets_path=function(){return a.ve.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,p){function d(a,k){var m=document.createElement("div"),d=m.style;d.position="absolute";d.backgroundColor="black";d.borderRadius="20px 20px 20px 0px";d.boxShadow="0px 0px 10px rgb(180, 180, 200)";d.opacity=1;d.padding="8px 12px";d.lineHeight="15px";d.visibility="hidden";d.fontSize="12px";var h=g.get_container();h.appendChild(m);var u=z.get_meta_tags(a);if(u)var r=u.title||a.name,f=u.description;else r=a.name,f="";var y=document.createElement("span"),F=y.style;y.innerHTML=
r;F.fontWeight="bold";F.fontSize="12px";F.lineHeight="15px";F.color="#fff";F.fontFamily="Arial";q(y);m.appendChild(y);if(f){var u=document.createElement("div"),M=u.style;M.position="absolute";M.bottom="0px";M.left="0px";M.backgroundColor="#000";M.borderRadius="20px 20px 20px 0px";M.boxShadow="0px 0px 10px rgb(180, 180, 200)";M.visibility="hidden";M.padding="8px 12px";M.overflow="hidden";M.lineHeight="15px";M.fontSize="12px";M.zIndex="2";m.appendChild(u);var r=document.createElement("span"),O=r.style;
r.innerHTML=f;O.fontSize="12px";O.fontFamily="Arial";O.fontWeight="bold";O.lineHeight="15px";O.color="#fff";O.visibility="hidden";u.appendChild(r);var l=!1,x=!1;h.addEventListener("mousedown",function(a){if(!(l||x||E))if(a.target!=y&&a.target!=m||"hidden"!=M.visibility||1!=d.opacity)"visible"==M.visibility&&(d.visibility="visible",F.visibility="visible",M.visibility="hidden",O.visibility="hidden");else{d.visibility="hidden";F.visibility="hidden";M.visibility="visible";l=x=!0;a=m.offsetWidth-24;var e=
m.offsetHeight-16,h=Math.min(k,b(f)),u=c(f,h);u==e&&(M.height=u+"px");h!=a?w.animate(a,h,200,function(a){a==h&&("visible"==M.visibility&&(O.visibility="visible"),l=!1);M.width=a+"px"}):l=!1;u!=e?w.animate(e,u,200,function(a){a==u&&("visible"==M.visibility&&(O.visibility="visible"),x=!1);M.height=a+"px"}):x=!1;x||l||(O.visibility="visible")}},!1)}return m}function b(a){var b=document.createElement("div"),k=document.createElement("span"),c=b.style;k.innerHTML=a;k.style.fontSize="12px";k.style.fontFamily=
"Arial";k.style.fontWeight="bold";k.style.color="#fff";k.style.visibility="hidden";c.lineHeight="15px";b.appendChild(k);c.position="absolute";c.visibility="hidden";c.fontSize="12px";c.display="inline-block";c.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function c(a,b){var k=document.createElement("div"),c=document.createElement("span"),m=k.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";c.style.color=
"#fff";c.style.visibility="hidden";m.lineHeight="15px";k.appendChild(c);m.position="absolute";m.visibility="hidden";m.fontSize="12px";m.display="inline-block";m.width=b+"px";m.lineHeight="15px";document.body.appendChild(k);c=k.offsetHeight;document.body.removeChild(k);return c}function q(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";
a.style.cursor="default"}function f(){for(var a=0,b=0;b<G.length;b++)G[b].Ai&&a++;m=new Float32Array(3*a)}function t(a,b){return b.depth-a.depth}var l=p("__batch"),n=p("__camera"),g=p("__container"),z=p("__objects"),h=p("__print"),k=p("__renderer"),u=p("__scenes"),w=p("__time"),C=p("__tsr");p("__util");p("__config");var E=!1,G=[],m=new Float32Array(0),x=new Uint8Array(16),A=new Float32Array(2),r=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<G.length;b++)if(G[b].obj==a){b=!0;break a}b=
!1}if(!b){b=a.anchor.Ai&&Boolean(u.Z(u.Qi(),"ANCHOR_VISIBILITY"));b={type:a.anchor.type,obj:a,x:0,y:0,depth:0,Wg:"out",Ai:b,element:null,fj:null,Lz:a.anchor.OE,gm:0,Qo:0,Lm:a.anchor.Lm};switch(b.type){case "ANNOTATION":b.element=d(a,b.Lz);b.gm=b.element.offsetHeight;b.Qo=b.element.offsetWidth;break;case "ELEMENT":b.element=document.getElementById(a.anchor.Lm),b.element?(b.gm=b.element.offsetHeight,b.Qo=b.element.offsetWidth):(h.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}G.push(b);
f()}};a.remove=function(a){for(var b=0;b<G.length;b++){var k=G[b];if(k.obj==a){"ANNOTATION"==k.type&&(a=k,g.get_container().removeChild(a.element));G.splice(b,1);f();break}}};a.update=function(){for(var a=0,b=G.length;b--;){var k=G[b];if(k.Ai){var c=C.get_trans_view(k.obj.f.h);m.set(c,3*a++)}var d;d=k;var c=r,h=u.Ni(u.Qi());d=C.get_trans_view(d.obj.f.h);d=c=n.project_point(h,d,c);c=d[0];h=d[1];d=d[2];if(c!=k.x||h!=k.y||d!=k.depth){switch(k.type){case "ANNOTATION":var f=k.element;f.style.left=Math.floor(c)+
"px";f.style.top=Math.floor(h-k.gm)+"px";break;case "ELEMENT":var f=k.element,g=f.getBoundingClientRect();f.style.cssText+="left:"+Math.floor(c-g.width/2)+"px;top:"+Math.floor(h-g.height/2)+"px;"}k.x=c;k.y=h;k.depth=d;k.fj&&k.fj(c,h,k.Wg,k.obj,f)}}G.sort(t);for(b=0;b<G.length;b++)k=G[b],"GENERIC"!=k.type&&(k.element.style.zIndex=b);0<a&&(a=u.Z(u.Qi(),"ANCHOR_VISIBILITY").q[0].G,l.bH(a,m))};a.Jx=function(){for(var a=g.get_container(),b=G.length;b--;){var c=G[b],m=c.obj,d=c.x,h=c.y,r=c.depth,r=0>d||
0>h||0>r||1<r||u.is_hidden(m)||d>=a.clientWidth||h>=a.clientHeight?"out":"visible";if(c.Ai&&"out"!=r){var r=c,f=u.Z(u.Qi(),"ANCHOR_VISIBILITY").j,y=g.np(r.x,r.y,A,f);k.xw(f.ge,y[0],f.height-y[1],2,2,x);r=1020==x[0]+x[4]+x[8]+x[12]?"visible":"out"==r.Wg||0==x[0]+x[4]+x[8]+x[12]?"covered":r.Wg}if(r!=c.Wg){switch(c.type){case "ANNOTATION":case "ELEMENT":var F=c.element;if(!F)break;"out"==r?(F.style.visibility="hidden",F.children.length&&(F.children[0].style.visibility="hidden"),"ANNOTATION"==c.type&&
1<F.children.length&&(f=F.children[1],f.style.visibility="hidden",f.children.length&&(f.children[0].style.visibility="hidden"))):"visible"==r?(F.style.visibility="visible",F.children.length&&(F.children[0].style.visibility="visible"),F.style.opacity=1):(F.style.visibility="visible",F.style.opacity=.1,F.children.length&&(F.children[0].style.visibility="visible"),"ANNOTATION"==c.type&&1<F.children.length&&(f=F.children[1],f.style.visibility="hidden",f.children.length&&(f.children[0].style.visibility=
"hidden")))}c.Wg=r;c.fj&&c.fj(d,h,c.Wg,m,F)}}};a.attach_move_cb=function(a,b){for(var k=0;k<G.length;k++)G[k].obj==a&&(G[k].fj=b)};a.detach_move_cb=function(a){for(var b=0;b<G.length;b++)G[b].obj==a&&(G[b].fj=null)};a.cleanup=function(){for(var a=0;a<G.length;a++){var b=G[a];"ANNOTATION"==b.type&&g.get_container().removeChild(b.element)}G.length=0};a.is_anchor=function(a){for(var b=0;b<G.length;b++)if(G[b].obj==a)return!0;return!1};a.get_element_id=function(a){for(var b=0;b<G.length;b++)if(G[b].obj==
a)return G[b].Lm;return!1};a.pause=function(){E=!0};a.resume=function(){E=!1};a.fF=function(a,b){for(var k=-1,c=0;c<G.length;c++){var m=G[c],d=Math.round(m.Qo),h=Math.round(m.gm),u=m.x,m=m.y;if(G[c].Wg=a>=u&&a<=u+d&&b<m&&b>=m-h?!0:!1)if(0>k)var y=G[c].depth,k=c;else G[c].depth<y&&(k=c,y=G[c].depth)}return 0>k?null:G[k].obj}};b4w.module.__armature=function(a,p){function d(a){a=a.f;for(var b=a.Wn,k=a.Iv,c=0;c<b.length;c++){for(var d=b[c],m=k[c],h=0;h<m.length;h+=2)for(var f=m[h],r=m[h+1],e=0;4>e;e++)d.Qc[f+e]=a.Qc[r+e],d.wd[f+e]=a.wd[r+e],d.Yc[f+e]=a.Yc[r+e],d.Ed[f+e]=a.Ed[r+e];d.Pd=a.Pd}}function b(a,k,c,d){var h=a.us,m=a.Cg,f=a.El,l=a.kr;l?(l=l.El,k?q.multiply(l,h,f):(k=g,q.invert(l,k),q.multiply(k,f,h))):k?q.copy(h,f):q.copy(f,h);h=n;q.invert(m,h);q.multiply(f,h,h);m=a.Of;c[4*m]=h[0];c[4*m+1]=h[1];c[4*m+2]=h[2];c[4*
m+3]=h[3];d[4*m]=h[4];d[4*m+1]=h[5];d[4*m+2]=h[6];d[4*m+3]=h[7];a=a.iu;for(m=0;m<a.length;m++)f=a[m],f.gb||b(f,!0,c,d)}var c=p("__util"),q=p("__tsr"),f=p("__quat"),t=p("__mat4"),l=p("__vec3"),n=q.create(),g=q.create(),z=new Float32Array(4),h=new Float32Array(4),k=new Float32Array(4);a.bi=function(a,b){for(var k=a.data.bones,d=a.pose.bones,h={},m=0;m<d.length;m++){var f=d[m],g=f.bone,r=g.name,e=h[r]={Of:0,Tx:-1,kr:null,iu:[],um:[],gb:null,Dl:q.create(),us:q.create(),Cg:q.create(),El:q.create(),fo:q.create(),
vs:q.create(),ho:!1,rx:new Float32Array(3)},r=new Float32Array(g.matrix_local),v=new Float32Array(16);t.invert(r,v);var f=new Float32Array(f.matrix_basis),J=e.rx;l.subtract(g.tail_local,g.head_local,J);c.XH(J,v,J);q.from_mat4(r,e.Cg);q.from_mat4(f,e.fo);q.copy(e.Cg,e.El)}for(m=0;m<k.length;m++){r=k[m].name;f=c.keysearch("name",r,d);e=h[r];g=f.parent_recursive;e.um.push(e);for(v=0;v<g.length;v++)f=g[v],f=f.name,f=h[f],e.um.push(f);g.length?(f=g[0],f=f.name,f=h[f],e.kr=f,q.invert(f.Cg,n),q.multiply(n,
e.Cg,e.Dl),f.iu.push(e)):q.copy(e.Cg,e.Dl);e.Of=m;e.name=r;q.multiply(e.Dl,e.fo,e.us)}b.f.Jd=h};a.get_bone_tsr=function(a,b,c,d,l){var m=a.f,x=m.Pd;b=m.Jd[b];var t=b.Of;a=b.Cg;var r=m.Yc,e=m.Ed,v=m.Qc,m=m.wd,J=r[4*t+1],D=r[4*t+2],H=r[4*t+3],I=e[4*t+1],P=e[4*t+2],K=e[4*t+3];z[0]=(1-x)*r[4*t]+x*e[4*t];z[1]=(1-x)*J+x*I;z[2]=(1-x)*D+x*P;z[3]=(1-x)*H+x*K;h[0]=v[4*t];h[1]=v[4*t+1];h[2]=v[4*t+2];h[3]=v[4*t+3];k[0]=m[4*t];k[1]=m[4*t+1];k[2]=m[4*t+2];k[3]=m[4*t+3];f.slerp(h,k,x,h);x=n;q.set_transcale(z,x);
q.set_quat(h,x);c?(c=g,q.translate(a,b.rx,c),q.multiply(x,c,x)):q.multiply(x,a,x);if(d){if(d=b.kr)c=g,q.invert(d.El,c),q.multiply(c,x,x);d=g;q.invert(b.Dl,d);q.multiply(d,x,x)}q.copy(x,l)};a.set_bone_tsr=function(a,k,c,h){var f=a.f;k=f.Jd[k];var m=f.Yc,g=f.Qc;h?q.multiply(k.Dl,c,k.us):q.copy(c,k.El);b(k,h,m,g);f.Pd=0;d(a)};a.BH=d;a.iH=b;a.jk=function(a,b){return b in a.f.Jd}};b4w.module.__boundings=function(a,p){function d(a,b){for(var c=a[0],d=a[1],h=a[2],f=a[0],m=a[1],g=a[2],l=3;l<a.length;l+=3)var r=a[l],e=a[l+1],v=a[l+2],c=Math.max(c,r),d=Math.max(d,e),h=Math.max(h,v),f=Math.min(f,r),m=Math.min(m,e),g=Math.min(g,v);b.max_x=c;b.max_y=d;b.max_z=h;b.min_x=f;b.min_y=m;b.min_z=g;return b}function b(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,h=a.max_z,f=a.min_x,m=a.min_y,g=a.min_z;b[0]=f;b[1]=m;b[2]=g;b[3]=c;b[4]=m;b[5]=g;b[6]=c;b[7]=d;b[8]=g;b[9]=f;b[10]=
d;b[11]=g;b[12]=f;b[13]=m;b[14]=h;b[15]=c;b[16]=m;b[17]=h;b[18]=c;b[19]=d;b[20]=h;b[21]=f;b[22]=d;b[23]=h;return b}function c(){return{we:new Float32Array(3),xe:new Float32Array(3),ye:new Float32Array(3),I:new Float32Array([0,0,0])}}function q(a,b,c){l.add(b,c,a.I);l.scale(a.I,.5,a.I);a.Ma=l.distance(a.I,b);return a}var f=p("__tsr"),t=p("__util"),l=p("__vec3"),n=new Float32Array(24),g=new Float32Array(3),z=new Float32Array(3),h=new Float32Array(3);a.zm=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;
b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.fJ=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.$c=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.ou=function(a,b){var c=a.max_y,d=a.max_z,h=a.min_x,f=a.min_y,m=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,h);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,m)};
a.tA=d;a.fp=function(c,h,g){g||(g=a.$c());c=b(c,n);f.transform_vectors(c,h,c);return d(c,g)};a.uC=b;a.VK=function(b,c,d){d||(d=a.$c());var h=c.min_x,f=c.max_x,g=c.min_y,m=c.max_y,l=c.min_z;c=c.max_z;if(h>=b.max_x||f<=b.min_x||g>=b.max_y||m<=b.min_y||l>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,h);d.max_x=Math.min(b.max_x,f);d.min_y=Math.max(b.min_y,g);d.max_y=Math.min(b.max_y,m);d.min_z=Math.max(b.min_z,l);d.max_z=Math.min(b.max_z,
c);return d};a.$K=function(b,c,d){d||(d=a.$c());var h=b.max_x-b.min_x,f=b.max_y-b.min_y,g=b.max_z-b.min_z;d.min_x=b.min_x-.5*(c-1)*h;d.max_x=b.max_x+.5*(c-1)*h;d.min_y=b.min_y-.5*(c-1)*f;d.max_y=b.max_y+.5*(c-1)*f;d.min_z=b.min_z-.5*(c-1)*g;d.max_z=b.max_z+.5*(c-1)*g;return d};a.hp=function(b,c,d){d||(d=a.ni());f.transform_vec3(b.I,c,d.I);d.Ma=b.Ma*f.get_scale(c);return d};a.gp=function(a,b,d){d||(d=c());f.transform_vec3(a.I,b,d.I);l.copy(a.we,d.we);l.copy(a.xe,d.xe);l.copy(a.ye,d.ye);f.transform_dir_vec3(d.we,
b,d.we);f.transform_dir_vec3(d.xe,b,d.xe);f.transform_dir_vec3(d.ye,b,d.ye);return d};a.Cm=function(a,b){return{Ma:a,I:new Float32Array(b)}};a.ni=function(){return{I:new Float32Array([0,0,0]),Ma:0}};a.hy=c;a.Bm=function(a,b,c,d){return{we:new Float32Array(a),xe:new Float32Array(b),ye:new Float32Array(c),I:new Float32Array([d[0],d[1],d[2]])}};a.uA=function(){return{I:new Float32Array([0,0,0]),Ma:1E12}};a.qC=function(a,b){var c=l.subtract(b.I,a.I,l.create());0==l.length(c)&&l.set(1,0,0,c);var d=l.normalize(c,
l.create()),c=l.scale(d,a.Ma,l.create());l.add(c,a.I,c);var h=l.scale(d,-a.Ma,l.create());l.add(h,a.I,h);var f=l.scale(d,b.Ma,l.create());l.add(f,b.I,f);var m=l.scale(d,-b.Ma,l.create());l.add(m,b.I,m);c=[c,h,f,m];d=l.normalize(d,l.create());h=c[0];f=c[0];for(m=1;m<c.length;m++){var g=l.dot(c[m],d);g<l.dot(h,d)&&(h=c[m]);g>l.dot(f,d)&&(f=c[m])}d=[h,f];c=d[0];d=d[1];a.I=l.scale(l.add(c,d,l.create()),.5,l.create());a.Ma=l.length(l.subtract(d,c,l.create()))/2};a.Vt=function(a,b){var c=b.max_y,d=b.min_y,
h=Math.max(0,c-d-2*a);return{Ma:a,height:h,I:new Float32Array([0,(c+d)/2,0])}};a.Xt=function(a,b){var c=b.max_y,d=b.min_y,h=Math.max(0,c-d);return{Ma:a,height:h,I:new Float32Array([0,(c+d)/2,0])}};a.Wt=function(a,b){var c=b.max_y,d=b.min_y,h=Math.max(0,c-d);return{Ma:a,height:h,I:new Float32Array([0,(c+d)/2,0])}};a.kJ=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.vF=function(a){for(var b=0,c=0,d=0,h=0,f=0,m=0,
g=0,l=0,r=0;r<a.submeshes.length;r++){var e=a.submeshes[r];if(e.position.length){b=h=e.position[0];c=f=e.position[1];d=m=e.position[2];break}}for(r=0;r<a.submeshes.length;r++)for(var e=a.submeshes[r],e=e.position,v=0;v<e.length/3;v++)var t=e[3*v],D=e[3*v+1],n=e[3*v+2],b=Math.max(t,b),c=Math.max(D,c),d=Math.max(n,d),h=Math.min(t,h),f=Math.min(D,f),m=Math.min(n,m),g=Math.max(Math.sqrt(t*t+D*D+n*n),g),l=Math.max(Math.sqrt(t*t+n*n),l);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=h;a.b4w_bounding_box.max_y=
c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=m;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=h;a.b4w_bounding_box_source.max_y=c;a.b4w_bounding_box_source.min_y=f;a.b4w_bounding_box_source.max_z=d;a.b4w_bounding_box_source.min_z=m;a.b4w_bounding_sphere_radius=g;a.b4w_bounding_cylinder_radius=l};a.rD=function(b){var c=b.subarray(0,3),d=b.subarray(6,9),f=b.subarray(12,15),n=b.subarray(18,21);b=l.subtract(d,c,g);l.normalize(b,b);var G=t.wD(c,d,
f,z),G=l.cross(G,b,G);l.normalize(G,G);var m=l.create(),x=l.create();l.subtract(d,c,h);x[0]=l.dot(h,b);x[1]=l.dot(h,G);d=l.create();l.subtract(f,c,h);d[0]=l.dot(h,b);d[1]=l.dot(h,G);f=l.create();l.subtract(n,c,h);f[0]=l.dot(h,b);f[1]=l.dot(h,G);n=a.ni();f=[m,x,d,f];m=q(n,f[0],f[1]);for(n=2;n<f.length;n++)if(l.distance(m.I,f[n])>m.Ma){for(var A=m,m=f,x=f[n],d=n-1,A=q(A,x,m[0]),r=1;r<=d;r++)if(l.distance(A.I,m[r])>A.Ma){for(var e=A,A=m,v=x,J=m[r],D=r-1,e=q(e,v,J),H=0;H<=D;H++)if(l.distance(e.I,A[H])>
e.Ma){var I=v,P=J,K=A[H],y=l.subtract(P,K,h),y=l.squaredLength(y),F=l.subtract(I,K,h),M=l.squaredLength(F),F=l.subtract(I,P,h),O=l.squaredLength(F),F=y*(M+O-y),V=M*(O+y-M),y=O*(y+M-O),M=F+V+y;l.copy(I,e.I);l.scale(e.I,F/M,e.I);l.scaleAndAdd(e.I,P,V/M,e.I);l.scaleAndAdd(e.I,K,y/M,e.I);e.Ma=l.distance(e.I,I)}A=e}m=A}n=m;b=l.scale(b,n.I[0],h);l.scaleAndAdd(b,G,n.I[1],b);l.add(b,c,n.I);return n}};b4w.module.__compat=function(a,p){function d(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function c(){return!window.ActiveXObject&&"ActiveXObject"in window}var q=p("__config"),f=p("__extensions"),t=p("__print");
p("__util");var l="R600;RV610;RV630;RV620;RV635;RV670;RS780;RS880;RV770;RV730;RV710;RV740;CEDAR;REDWOOD;JUNIPER;CYPRESS;PALM (Wrestler/Ontario);SUMO (Llano);SUMO2 (Llano);ARUBA (Trinity/Richland);BARTS;TURKS;CAICOS;CAYMAN".split(";"),n=q.Vg,g=q.p,z=q.context,h=q.tj,k=q.F,u=q.o;a.dC=function(a){a.getError()==a.INVALID_ENUM&&t.warn("Possible Tegra invalid enum issue detected, ignoring")};a.WF=function(a){g.Hv=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);g.Db=a.getParameter(a.MAX_TEXTURE_SIZE);g.Dh=
a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);g.Ac=g.Ec?Math.min(g.Ac,a.getParameter(a.MAX_SAMPLES)):1;var q=Boolean(f.mD());d("Firefox/28.0")&&(d("Linux")||d("Macintosh"))&&(t.warn("Firefox 28 detected, applying depth hack"),q=!1);d("Windows Phone")||(d("iPad")||d("iPhone")?(t.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, applying ios depth hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
z.alpha||(g.background_color[3]=1),g.Sx=!0,g.smaa=!1,g.Xc=!1,g.precision="highp",g.Bq=!0,g.iv=!0,h.zk=256):d("Mac OS X")&&d("Safari")&&!d("Chrome")&&(t.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures. Applying canvas alpha hack."),g.Hw=!0,k.pt=!0,k.Lt=!0));d("Windows")&&(d("Chrome/40")||d("Firefox/33")||d("Firefox/34")||d("Firefox/35")||d("Firefox/36"))&&(t.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),
g.rp=!0);d("Mac OS X")&&(g.qn=!0,t.warn("OS X detected, applying shadows hack."));b()&&(t.warn("Mobile detected, applying various hacks for video textures."),g.wh=!0,d("iPad")||d("iPhone")||d("Windows Phone")||(t.warn("Mobile (not iOS) detected, disable playback rate for video textures."),k.ku=!0));(d("Firefox/35.0")||d("Firefox/36.0"))&&d("Windows")&&(t.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),g.tu=!0);if(d("iPhone")||c()||d("Edge"))t.warn("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),
g.tl=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(t.warn("Not enough varyings, disable shadows on blend objects"),g.Qp=!0);d("Windows Phone")&&(t.warn("Windows Phone detected. Disable wireframe mode, glow materials, ssao, smaa, shadows, reflections, refractions."),g.wireframe_debug=!1,g.precision="highp",g.nf=!1,g.Xc=!1,g.smaa=!1,g.vj=!1,g.pl=!1,g.Dc=!1,g.rw=!1);d("Firefox")&&g.wh&&(t.warn("Mobile Firefox detected, applying depth hack, disable workers."),q=u.Ll=!1);d("Firefox")&&"HMD"==g.stereo&&
(t.warn("Firefox detected, using custom distortion correction."),g.no=!1);var p=f.Qu();if(p){var G=a.getParameter(p.UNMASKED_VENDOR_WEBGL),p=a.getParameter(p.UNMASKED_RENDERER_WEBGL),m=/\b4\d{2}\b/;d("Macintosh")&&-1<p.indexOf("Intel HD Graphics 3000")&&(t.warn("OS X / Intel HD 3000 detected, applying depth hack"),q=!1);-1<G.indexOf("ARM")&&m.test(p)&&(t.warn("ARM Mali-400 series detected, applying depth and frames blending hacks"),q=!1,n.xu=!0);-1<G.indexOf("ARM")&&-1<p.indexOf("Mali-T604")&&(t.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),
g.precision="highp",g.vj=!1);-1<G.indexOf("ARM")&&-1<p.indexOf("Mali-T760")&&(t.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO. Applying clear depth hack.'),g.lk=!0,g.precision="highp",g.Xc=!1,g.No=!0);-1<G.indexOf("Qualcomm")&&-1<p.indexOf("Adreno")&&(t.warn("Qualcomm Adreno detected, applying shader constants hack."),g.Pw=!0,-1<p.indexOf("305")&&(t.warn('Qualcomm Adreno305 detected, set "highp" precision.'),g.precision="highp"),-1<p.indexOf("330")&&(t.warn('Qualcomm Adreno330 detected, set "highp" precision.'),
g.precision="highp"),-1<p.indexOf("420")&&(t.warn("Qualcomm Adreno420 detected, setting max cubemap size to 4096, setting max texture size to 4096."),g.Db=4096,g.Dh=4096));-1<G.indexOf("NVIDIA")&&-1<p.indexOf("Tegra 3")&&(t.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.dq=!0);d("Windows")&&d("Chrome")&&!d("Edge")&&(p.match(/NVIDIA GeForce 8..0/)||p.match(/NVIDIA GeForce 9..0/)||p.match(/NVIDIA GeForce( (G|GT|GTS|GTX))? 2../))&&(t.warn("Chrome / Windows / NVIDIA GeForce 8/9/200 series detected, setting max cubemap size to 256, use canvas for resizing."),
g.Dh=256,g.Cw=!0);for(var m="",x=0;x<l.length;x++)if(-1<p.indexOf(l[x])){m=l[x];break}m&&(t.warn("Architecture "+m+" detected. Blending between frames and shadows on blend objects will be disabled. Applying clear depth hack."),g.lk=!0,g.No=!0,g.Qp=!0);d("Linux")&&-1<G.indexOf("nouveau")&&(t.warn("Nouveau driver detected. Applying clear depth hack"),g.lk=!0);d("Windows")&&d("Chrome")&&(p.match(/GeForce (GT|GTX) 5.(0|5)/)||p.match(/GeForce (GT|GTX) 6.(0|5)/))&&(t.warn("Windows / Chrome / NVIDIA GeForce 500/600 series detected, applying clear depth hack"),
g.lk=!0)}0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(t.warn("Vertex textures are not allowed. Disabling vertex textures"),g.Lo=!1);q||(g.Hi=!1,g.hl=!1,g.$b=!1,g.water_dynamic=!1,g.shore_smoothing=!1,g.wj=!1,g.smaa=!1);g.Kx=Boolean(f.Ru());g.Ck=q;0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(g.precision="mediump");c()&&(t.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),h.zk=512);if(c()&&d("Touch")||d("Edge"))t.warn("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),
g.zq=!0;128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(t.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.dq=!0);d("Chrome")&&!d("Edge")&&(t.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),g.Ut=!0);if(d("Chrome")&&!d("Edge")||d("Firefox"))g.Rp=!0;if(c()||d("iPad"))t.warn("iPad or Internet Explorer detected. Applying alpha clip hack."),g.Mo=!0;b()&&d("Firefox")&&(t.log("Mobile firefox detected. Applying autoplay media hack."),
g.ar=!0);d("Edge")&&(t.warn("Microsoft Edge detected, set up new minimal texture size."),g.Gk=!0)};a.YA=d;a.detect_mobile=b;a.fA=function(){d("Firefox/35.0")&&d("Windows")&&(t.warn("Windows/Firefox 35 detected, forcing context's alpha"),q.context.alpha=!0)};a.Iq=c};b4w.module.__constraints=function(a,p){function d(a){var b={};b.type=a;return b}function b(a,b){a.gb&&a.gb.da&&c(a.gb.da,a);if(b.da){var e=b.da;if(-1==e.be.indexOf(a))e.be.push(a);else throw"Descendant object override is forbidden";}a.gb=b}function c(a,b){var c=a.be.indexOf(b);if(-1!=c)a.be.splice(c,1);else throw"No descendant object";}function q(a,b,c){switch(b.type){case 1:var y=u.get_quat_view(a.f.h),d=b.da.f.h;c=u.get_quat_view(b.da.f.h);b.uc?(k.copy(b.uc,y),k.multiply(c,y,y)):k.copy(c,y);var h=
u.transform_vec3(b.offset,d,m);u.set_trans(h,a.f.h);h=u.get_scale(b.da.f.h);u.set_scale(b.sl*h,a.f.h);break;case 9:h=u.get_trans_view(a.f.h);y=u.get_quat_view(a.f.h);d=b.da.f.h;c=u.get_quat_view(b.da.f.h);k.multiply(k.invert(b.Nh,b.Nh),y,y);k.multiply(c,y,y);u.transform_vec3(b.offset,d,h);k.copy(c,b.Nh);break;case 10:h=u.get_trans_view(a.f.h);y=u.get_quat_view(a.f.h);d=b.da.f.h;c=u.get_quat_view(b.da.f.h);k.multiply(k.invert(b.Nh,b.Nh),y,y);k.multiply(c,y,y);u.transform_vec3(b.offset,d,h);k.copy(c,
b.Nh);h=u.get_quat_view(a.f.h);y=u.get_quat_view(b.da.f.h);y=k.multiply(y,b.uc,e);y=g.Hu(y,E);h=g.Hu(h,G);g.rotate_eye_camera(a,w.Pf(h[0],y[0]+b.bB,y[0]+b.aB),w.Pf(h[1],y[1]+b.$A,y[1]+b.cB));break;case 13:var h=u.get_trans_view(a.f.h),y=u.get_quat_view(a.f.h),d=b.da.f.h,f=u.get_trans_view(d),r=b.tG,x=m,q=e;u.transform_vec3(b.offset,d,x);w.smooth_v(x,h,c,r,h);d=m;C.sub(f,h,d);C.normalize(d,d);var B=y,h=v,f=h.subarray(0,3),x=h.subarray(3,6),A=h.subarray(6,9);C.copy(d,x);C.negate(x,x);C.normalize(x,
x);Boolean(.999999<Math.abs(C.dot(d,w.AXIS_Y)))?(d=z.fromQuat(k.normalize(B,q),J),C.copy(d.subarray(0,3),f)):C.cross(w.AXIS_Y,x,f);C.normalize(f,f);C.cross(f,x,A);C.normalize(A,A);k.fromMat3(h,q);k.normalize(q,q);w.Yw(q,y,c,.16*r,y);break;case 2:y=u.get_quat_view(a.f.h);c=D;n.get_bone_tsr(b.da,b.Zg,!0,!1,c);u.multiply(b.da.f.h,c,c);y[0]=c[4];y[1]=c[5];y[2]=c[6];y[3]=c[7];b.uc&&(k.copy(b.uc,y),k.multiply(y,b.uc,y));u.set_scale(b.sl*c[3],a.f.h);h=u.get_trans_view(a.f.h);u.transform_vec3(b.offset,c,
h);break;case 3:h=u.get_trans_view(a.f.h);y=u.get_quat_view(a.f.h);c=u.get_trans_view(b.da.f.h);t(h,y,c);break;case 4:h=u.get_trans_view(a.f.h);y=u.get_quat_view(a.f.h);c=b.target;t(h,y,c);break;case 5:h=u.get_trans_view(a.f.h);y=u.get_quat_view(a.f.h);c=u.get_trans_view(b.da.f.h);t(h,y,c);y=C.dist(h,c);if(y=y>b.dist_max?y-b.dist_max:y<b.Ek?y-b.Ek:0)C.sub(c,h,m),C.normalize(m,m),C.scale(m,y,m),C.add(h,m,h);break;case 6:h=u.get_trans_view(a.f.h);y=u.get_quat_view(a.f.h);c=b.target;t(h,y,c);y=C.dist(h,
c);if(y=y>b.dist_max?y-b.dist_max:y<b.Ek?y-b.Ek:0)C.sub(c,h,m),C.normalize(m,m),C.scale(m,y,m),C.add(h,m,h);break;case 7:d=b.da.f.h;h=u.get_trans_view(a.f.h);u.transform_vec3(b.offset,d,h);break;case 8:f=u.get_trans_view(b.da.f.h);h=u.get_trans_view(a.f.h);C.add(f,b.offset,h);break;case 14:y=u.get_quat_view(a.f.h);d=b.da.f.h;c=u.get_quat_view(b.da.f.h);b.uc?(k.copy(b.uc,y),k.multiply(c,y,y)):k.copy(c,y);h=u.get_trans_view(a.f.h);u.transform_vec3(b.offset,d,h);break;case 11:u.multiply(b.da.f.h,b.io,
a.f.h);break;case 12:h=b.io;c=D;n.get_bone_tsr(b.da,b.Zg,!0,!1,c);u.multiply(b.da.f.h,c,c);u.multiply(c,h,a.f.h);break;case 15:y=b.da,c=g.pD(y),h=u.get_trans_view(a.f.h),d=g.Oi(c,"LEFT"),f=g.Oi(c,"RIGHT"),r=g.Oi(c,"TOP"),q=g.Oi(c,"BOTTOM"),x="heights"==b.hor_units?r-q:f-d,b.xv?(d=g.Oi(c,"LEFT"),h[0]=d+x*b.Oq):(f=g.Oi(c,"RIGHT"),h[0]=f-x*b.Oq),d="heights"==b.vert_units?r-q:f-d,h[2]=b.wx?-(r-d*b.rs):-(q+d*b.rs),g.aE(c)?h[1]=-b.distance:(h[1]=-1,C.normalize(h,h),C.scale(h,b.distance/Math.abs(h[1]),h)),
u.transform_dir_vec3(h,y.f.h,h),c=u.get_trans_view(y.f.h),C.add(c,h,h),h=u.get_quat_view(a.f.h),y=u.get_quat_view(y.f.h),b.uc?(k.copy(b.uc,h),k.multiply(y,h,h)):k.copy(y,h)}"CAMERA"==a.f.type&&(h=w.AXIS_Y,10==b.type&&(c=u.get_quat_view(b.da.f.h),h=C.transformQuat(h,c,H)),g.xs(a),l(a,h))}function f(a,b){switch(b.type){case 1:var c=b.target.f.h,y=D;u.invert(a.f.h,y);u.multiply(y,c,y);n.set_bone_tsr(a,b.Zg,y,!1)}a.dr=!0}function t(a,b,c){var y=m;w.quat_to_dir(b,w.AXIS_MY,y);C.normalize(y,y);var e=x;
C.subtract(c,a,e);C.normalize(e,e);a=w.Gw(y,e,r);k.multiply(a,b,b);k.normalize(b,b)}function l(a,b,c){var y=a.f,d=u.get_quat_view(y.h),h=w.quat_to_dir(d,w.AXIS_Y,m);C.normalize(h,h);if(.999999<Math.abs(C.dot(b,h)))h=k.identity(e);else{var f=C.cross(b,h,x);C.normalize(f,f);y.Qa==g.MS_TARGET_CONTROLS?y.ms&&C.negate(f,f):(y=w.quat_to_dir(d,w.AXIS_Z,A),0<C.dot(y,b)&&C.negate(f,f));y=w.quat_to_dir(d,w.AXIS_X,A);C.normalize(y,y);var v=w.clamp(C.dot(y,f),-1,1),h=-.999999>=v?k.setAxisAngle(h,Math.acos(v),
e):k.rotationTo(y,f,e);k.normalize(h,h)}k.multiply(h,d,d);c&&(c=w.quat_to_dir(d,w.AXIS_MZ,m),0>C.dot(b,c)&&k.rotateY(d,Math.PI,d));g.xs(a)}var n=p("__armature"),g=p("__camera"),z=p("__mat3"),h=p("__print"),k=p("__quat"),u=p("__tsr"),w=p("__util"),C=p("__vec3");a.yI=1;a.xI=2;a.CI=3;a.DI=4;a.sI=5;a.tI=6;a.zI=7;a.rI=8;a.wI=9;a.vI=10;a.pI=11;a.qI=12;a.uI=13;a.AI=14;a.BI=15;a.oI=1;var E=new Float32Array(2),G=new Float32Array(2),m=new Float32Array(3),x=new Float32Array(3),A=new Float32Array(3),r=new Float32Array(4),
e=new Float32Array(4),v=new Float32Array(9),J=new Float32Array(9),D=u.create(),H=new Float32Array(3);a.kt=function(a,c,e,y,h){var m=d(1);m.da=c;m.offset=new Float32Array(e);m.uc=y?new Float32Array(y):null;m.sl=h;b(a,m);q(a,m,0)};a.Xz=function(a,c,e,y,h,m){var k=d(2);k.da=c;k.Zg=e;k.offset=new Float32Array(y);k.uc=h?new Float32Array(h):null;k.sl=m;b(a,k);q(a,k,0)};a.Wz=function(a,c,e,y){var h=d(9),m=u.get_quat_view(a.f.h),f=u.get_quat_view(c.f.h);h.da=c;h.offset=new Float32Array(e);h.Nh=new Float32Array(f);
y&&(k.copy(y,m),k.multiply(f,m,m));b(a,h);q(a,h,0)};a.Vz=function(a,c,e,y,h,m,f,v){var r=d(10),g=u.get_quat_view(a.f.h),B=u.get_quat_view(c.f.h);r.da=c;r.offset=new Float32Array(e);r.Nh=new Float32Array(B);r.aB=w.angle_wrap_0_2pi(h);r.bB=w.angle_wrap_0_2pi(m);r.cB=w.angle_wrap_periodic(f,-Math.PI,Math.PI);r.$A=w.angle_wrap_periodic(v,-Math.PI,Math.PI);y?(r.uc=new Float32Array(y),k.copy(y,g),k.multiply(B,g,g)):r.uc=k.create();b(a,r);q(a,r,0)};a.Uz=function(a,c,e,y){var h=d(13);h.da=c;h.offset=new Float32Array(e);
h.tG=y;b(a,h);q(a,h,0)};a.$z=function(a,c,e,y){var h=d(14);h.da=c;h.offset=new Float32Array(e);h.sl=1;h.uc=y?new Float32Array(y):null;b(a,h);q(a,h,0)};a.MK=c;a.bA=function(a,c){var e=d(3);e.da=c;b(a,e);q(a,e,0)};a.cA=function(a,c){var e=d(4);e.target=new Float32Array(c);b(a,e);q(a,e,0)};a.Qz=function(a,c,e,y){var h=d(5);h.da=c;h.Ek=e;h.dist_max=y;b(a,h);q(a,h,0)};a.Rz=function(a,c,e,y){var h=d(6);h.target=new Float32Array(c);h.Ek=e;h.dist_max=y;b(a,h);q(a,h,0)};a.Zz=function(a,c,e){var y=d(7);y.da=
c;y.offset=new Float32Array(e);b(a,y);q(a,y,0)};a.Pz=function(a,c,e){var y=d(8);y.da=c;y.offset=new Float32Array(e);b(a,y);q(a,y,0)};a.Nz=function(a,c,e){var y=d(11);y.da=c;y.io=new Float32Array(e);b(a,y);q(a,y,0)};a.Oz=function(a,c,e,y){var h=d(12);h.da=c;h.Zg=e;h.io=new Float32Array(y);b(a,h);q(a,h,0)};a.append_stiff_viewport=function(a,c,e){var y=d(15);y.da=c;if(w.pd(e.left))y.xv=!0,y.Oq=e.left;else if(w.pd(e.right))y.xv=!1,y.Oq=e.right;else{h.error("append_stiff_viewport: Wrong positioning params");
return}if(w.pd(e.top))y.wx=!0,y.rs=e.top;else if(w.pd(e.bottom))y.wx=!1,y.rs=e.bottom;else{h.error("append_stiff_viewport: Wrong positioning params");return}w.pd(e.distance)?(y.distance=e.distance,y.uc=w.pd(e.rotation)?new Float32Array(e.rotation):null,y.hor_units=w.pd(e.hor_units)?e.hor_units:"widths",y.vert_units=w.pd(e.vert_units)?e.vert_units:"heights",b(a,y),q(a,y,0)):h.error("append_stiff_viewport: Wrong positioning params")};a.oH=function(a,b){a.gb&&q(a,a.gb,b)};a.Yz=function(a,b,c,y,e){var h=
d(1);h.Zg=c;h.target=b;h.offset=new Float32Array(y);h.uc=e?new Float32Array(e):null;h.sl=1;b=h.target;c=h.Zg;y=a.f.Jd[c];e=b.yp;for(var m=0;m<e;m++){var k=e[m];if(k[0]==a&&k[1]==c){e.splice(m,1);break}}b.yp.push([a,c]);y.gb=h;f(a,h)};a.hH=function(a,b){var c=a.f.Jd[b];c.gb&&f(a,c.gb)};a.JF=t;a.correct_up=l;a.RA=function(a){return a.gb?!0:!1};a.remove=function(a){a.gb.da&&c(a.gb.da,a);a.gb=null};a.aK=function(a){return a.gb?a.gb.type:null};a.Rd=function(a){a=a.gb;return!a||11!=a.type&&12!=a.type?!1:
!0};a.Tm=function(a){if((a=a.gb)&&11==a.type)return a.da.f.h;if(a&&12==a.type){var b=D;n.get_bone_tsr(a.da,a.Zg,!0,!1,b);u.multiply(a.da.f.h,b,b);return b}return null};a.Qd=function(a){a=a.gb;return!a||11!=a.type&&12!=a.type?null:a.io}};b4w.module.__container=function(a,p){var d,b,c,q,f;function t(a,c){d=a;b=c}function l(){var a=x.getBoundingClientRect();t(a.left,a.top)}function n(){return m.allow_hidpi&&2<=window.devicePixelRatio?!0:!1}var g=p("__anchors"),z=p("__config"),h=p("__data"),k=p("__hud");p("__objects");var u=p("__print"),w=p("__scenes"),C=p("__time"),E=p("__transform"),G=p("__util"),m=z.p,x=null,A=null,r=null,e=!1;q=c=0;f=1;d=b=0;var v=null;a.Fo=320;a.Eo=240;a.Ad=function(a){v=a};a.get_canvas=function(){return x};a.get_canvas_hud=
function(){return A};a.get_container=function(){return r};a.init=function(a,b){a&&a.parentNode?(x=a,A=b,r=a.parentNode):G.W("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":r.insertBefore(a,r.firstElementChild);break;case "JUST_BEFORE_CANVAS":r.insertBefore(a,x);break;case "JUST_AFTER_CANVAS":x.nextElementSibling?r.insertBefore(a,x.nextElementSibling):r.appendChild(a,x);break;case "LAST":r.appendChild(a,x);break;default:u.error(b+" invalid stack order")}};
a.ED=function(){return c};a.DD=function(){return q};a.set_canvas_offsets=t;a.update_canvas_offsets=l;a.lG=function(a,b,e){c=a;q=b;f=e;l()};a.force_offsets_updating=function(){e=!0};a.client_to_canvas_coords=function(a,c,h){h||(h=new Float32Array(2));var m=h;e&&(l(),e=!1);m[0]=a-d;a=h;e&&(l(),e=!1);a[1]=c-b;return h};a.np=function(a,b,e,h){e||(e=new Float32Array(2));e[0]=a*f;e[1]=b*f;h&&(a=h.width/c,e[0]*=a,e[1]*=a);return e};a.bI=function(a,b,e,h){e||(e=new Float32Array(2));e[0]=a/f;e[1]=b/f;h&&(a=
h.width/c,e[0]/=a,e[1]/=a)};a.kv=function(b){return b&&b.parentNode?b.parentNode==r?!0:a.kv(b.parentNode):!1};a.XD=n;a.BC=function(a){var b=document.getElementsByTagName("script");a=G.bl(a);for(var c=0;c<b.length;c++)if(b[c].src==a)return b[c];return null};a.resize=function(b,c,e){if(!b||!c){b=a.Fo;c=a.Eo;var d=r;d.style.width=a.Fo+"px";d.style.height=a.Eo+"px"}var d=x,f=A;!1!==e&&(d.style.width=b+"px",d.style.height=c+"px",f&&(f.style.width=b+"px",f.style.height=c+"px"));f&&(f.width=b,f.height=c,
k.Fl());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))m.canvas_resolution_factor=1;e=Math.floor(b*m.canvas_resolution_factor);c=Math.floor(c*m.canvas_resolution_factor);n()&&(e*=window.devicePixelRatio,c*=window.devicePixelRatio);h.is_primary_loaded()&&(f=w.get_active().k,e=Math.floor(e*f.Tc),c=Math.floor(c*f.Tc));d.width=e;d.height=c;if(e>v.drawingBufferWidth||c>v.drawingBufferHeight)u.warn("Canvas size exceeds platform limits, downscaling"),
f=Math.min(v.drawingBufferWidth/e,v.drawingBufferHeight/c),e*=f,c*=f,d.width=e,d.height=c;w.Ow(e,c,e/b);w.ma()&&E.n(w.get_active().Qg);h.tH(d.width,d.height);h.is_primary_loaded()&&(g.update(),w.update(C.get_timeline(),0),g.Jx())}};b4w.module.__controls=function(a,p){function d(a){return{type:a,value:0,ua:null,ee:!1,key:0,Va:"",Ae:!1,vp:null,tp:function(){},sp:null,Nt:function(){},Af:null,from:new Float32Array(3),to:new Float32Array(3),jv:!1,an:!1,ww:0,vw:function(){},axis:"",Dd:0,Nj:new Float32Array(3),Ln:new Float32Array(4),threshold:0,sw:new Float32Array(4),lm:0,km:0,Fw:0,mm:0,ud:0,repeat:!1,Vo:!1,$m:0,Zm:0,Ym:0,uq:0,tq:0,sq:0,callback:function(){}}}function b(a,b){a.value=Number(b)}function c(a){for(var b=a.tg,c=a.QF,e=
0;e<b.length;e++)c[e]=b[e].value;return a.DE(c)}function q(a,b){a=a||M;var c=a.me;if(c){var y=a.Uh;if(b){var h=c[b];if(h){for(var d=h.tg,m=0;m<d.length;m++){var k=d[m],v;v=O.indexOf(k);v=-1<v?V[v]:[];1==v.length?(f(k),k=O.indexOf(k),-1<k?(O.splice(k,1),V.splice(k,1)):I.W("Sensors cache is corrupted")):1<v.length&&v.splice(v.indexOf(h,1))}delete c[b];m=y.indexOf(h);-1<m?y.splice(m,1):I.W("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||(c=F.indexOf(a),-1<c?F.splice(c,1):e.error("Wrong object"))}}else{y=
[];for(b in c)y.push(b);for(m=0;m<y.length;m++)q(a,y[m])}X=!0}}function f(a){switch(a.type){case 80:v.remove_collision_test(a.vp,a.Va,a.tp);a.ee=!0;break;case 90:v.clear_collision_impulse_test(a.sp);a.ee=!0;break;case 100:v.remove_ray_test(a.ww);a.ee=!0;break;case 130:a.ee=!0}}function t(a){for(var c=0;c<O.length;c++){var e=O[c];20==e.type&&a.keyCode==e.key&&b(e,1)}sa&&a.preventDefault();Aa&&Aa(a)}function l(a){for(var c=0;c<O.length;c++){var e=O[c];20==e.type&&0==a.keyCode&&16==e.key&&b(e,0);20==
e.type&&a.keyCode==e.key&&b(e,0)}sa&&a.preventDefault();Aa&&Aa(a)}function n(a){var c=!1,e=null;da=!0;ha=a.clientX;ba=a.clientY;U=a.clientX;B=a.clientY;for(var y=0;y<O.length;y++){var h=O[y];50==h.type&&(b(h,1),h.ua=a.which);160==h.type&&(c||(c=A.client_to_canvas_coords(a.clientX,a.clientY,ea),e=r.pick_object(c[0],c[1]),c=!0),h.value=e==h.Af?1:0)}ca&&a.preventDefault();qa&&qa(a)}function g(a){for(var c=0;c<O.length;c++){var e=O[c];50==e.type&&b(e,0);160==e.type&&e.Vo&&(e.value=0)}da=!1;ca&&!ua&&a.preventDefault();
qa&&qa(a)}function z(a){var c=a.clientX,e=a.clientY;U=c;B=e;if(!y.zq||da)for(var h=c-ha,d=e-ba,m=Math.sqrt(h*h+d*d),k=0;k<O.length;k++){var f=O[k];if(40===f.type)switch(f.axis){case "X":b(f,h);f.ua=c;break;case "Y":b(f,d);f.ua=e;break;case "XY":b(f,m),f.ua[0]=c,f.ua[1]=e}}ca&&!ua&&a.preventDefault();qa&&qa(a)}function h(a){A.kv(a.relatedTarget)||g(a)}function k(a){var c=a.wheelDelta||-40*a.detail,c=c*K.TE;T+=c;for(c=0;c<O.length;c++){var e=O[c];30===e.type&&b(e,T)}Ea&&a.preventDefault();fa&&fa(a)}
function u(a){var b=a.targetTouches;if(1==b.length){for(var c=b[0],b=c.clientX,c=c.clientY,e=!1,y=null,h=0;h<O.length;h++){var d=O[h];160==d.type&&(e||(e=A.client_to_canvas_coords(b,c,ea),y=r.pick_object(e[0],e[1]),e=!0),d.value=y==d.Af)}Y[0]=b;Y[1]=-1;ka[0]=c;ka[1]=-1}else 1<b.length&&(la=N=G(b),Y[0]=b[0].clientX,Y[1]=b[1].clientX,ka[0]=b[0].clientY,ka[1]=b[1].clientY,aa=m(b));W.set(Y);R.set(ka);pa&&pa(a)}function w(c){var e=c.targetTouches;if(0!==e.length){if(1===e.length){W[0]=e[0].clientX;W[1]=
-1;R[0]=e[0].clientY;R[1]=-1;var e=W[0]-Y[0],y=R[0]-ka[0],h=Math.sqrt(e*e+y*y);if(-1!=Y[1]&&-1!=ka[1]){var d=W[0]-Y[1],f=R[0]-ka[1],k=Math.sqrt(d*d+f*f);k<h&&(e=d,y=f,h=k)}for(k=0;k<O.length;k++){var v=O[k];if(60===v.type)switch(v.ua=a.PL_SINGLE_TOUCH_MOVE,v.axis){case "X":b(v,e);break;case "Y":b(v,y);break;case "XY":b(v,h)}}}else if(1<e.length){W[0]=e[0].clientX;W[1]=e[1].clientX;R[0]=e[0].clientY;R[1]=e[1].clientY;la=G(e);h=la-N;d=ea;d[0]=(W[0]+W[1])/2;d[1]=(R[0]+R[1])/2;f=ma;f[0]=(Y[0]+Y[1])/2;
f[1]=(ka[0]+ka[1])/2;var F,y=d[0]-f[0],k=d[1]-f[1];F=Math.sqrt(y*y+k*k);for(var r=m(e),k=0;k<O.length;k++)switch(v=O[k],v.type){case 70:v.ua=a.PL_MULTITOUCH_MOVE_ZOOM;b(v,h);break;case 60:v.ua=a.PL_MULTITOUCH_MOVE_PAN;switch(v.axis){case "X":e=d[0]-f[0];b(v,e);break;case "Y":y=d[1]-f[1];b(v,y);break;case "XY":b(v,F)}break;case 75:v.ua=a.PL_MULTITOUCH_MOVE_ROTATE,b(v,r-aa)}}ga&&c.preventDefault();pa&&pa(c)}}function C(a){if(0==a.targetTouches.length)for(var c=0;c<O.length;c++){var e=O[c];160==e.type&&
e.Vo&&b(e,0)}pa&&pa(a)}function E(a){for(var c=0;c<O.length;c++){var e=O[c];if(170==e.type||180==e.type)e.Zm=a.beta,e.$m=a.gamma,e.Ym=a.alpha,e.value||(e.uq=a.gamma,e.tq=a.beta,e.sq=a.alpha,b(e,1))}}function G(a){var b=a[0],c=a[1];a=b.clientX-c.clientX;b=b.clientY-c.clientY;return Math.sqrt(a*a+b*b)}function m(a){var b=a[0];a=a[1];return Math.atan2(b.clientY-a.clientY,b.clientX-a.clientX)}var x=p("__config"),A=p("__container"),r=p("__objects"),e=p("__print"),v=p("__physics"),J=p("__quat"),D=p("__time"),
H=p("__tsr"),I=p("__util"),P=p("__vec3"),K=x.controls,y=x.p,F=[],M={},O=[],V=[],T=0,U=0,B=0,ha=0,ba=0,da=!1,W=new Float32Array(2),R=new Float32Array(2),Y=new Float32Array(2),ka=new Float32Array(2),ea=new Float32Array(2),ma=new Float32Array(2),la=0,N=0,aa=0,X=!1,Q=0,sa=!1,ca=!1,Ea=!1,ga=!1,ua=!1,Aa=null,qa=null,fa=null,pa=null;a.CT_POSITIVE=10;a.CT_CONTINUOUS=20;a.CT_TRIGGER=30;a.CT_SHOT=40;a.CT_LEVEL=50;a.CT_CHANGE=60;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;
a.PL_MULTITOUCH_MOVE_ROTATE=3;a.update=function(e,y){for(var h=0;h<O.length;h++){var d=O[h],m=e,f=y;if(f)switch(d.type){case 110:var k=d.Af,v=H.get_trans_view(k.f.h),k=H.get_quat_view(k.f.h),r=P.dist(d.Nj,v),g=d.sw;J.invert(d.Ln,g);J.multiply(k,g,g);J.normalize(g,g);g=Math.abs(2*Math.acos(g[3]));r/=f;d.lm=I.smooth(r,d.lm,f,.3);d.ua[0]=r;r=g/f;d.km=I.smooth(r,d.km,f,.3);d.ua[1]=r;d.lm>=d.threshold||d.km>=d.Fw?b(d,1):b(d,0);P.copy(v,d.Nj);J.copy(k,d.Ln);d.Dd=m;break;case 120:k=d.Af;v=H.get_trans_view(k.f.h);
k=Math.abs(v[1]-d.Nj[1])/f;d.mm=I.smooth(k,d.mm,f,.3);d.ua=k;d.mm>=d.threshold?b(d,1):b(d,0);P.copy(v,d.Nj);d.Dd=m;break;case 130:!d.ee&&0<=d.ud&&m-d.Dd>=d.ud&&(b(d,1),d.repeat?d.Dd=m:d.ud=-d.ud);break;case 140:d.Dd||(d.Dd=m);b(d,m-d.Dd);d.Dd=m;break;case 150:b(d,m);break;case 170:d.ua[0]=Math.PI*(d.$m-d.uq)/180;d.ua[1]=Math.PI*(d.Zm-d.tq)/180;d.ua[2]=Math.PI*(d.Ym-d.sq)/180;d.uq=d.$m;d.tq=d.Zm;d.sq=d.Ym;break;case 180:d.ua[0]=Math.PI*d.$m/180;d.ua[1]=Math.PI*d.Zm/180;d.ua[2]=Math.PI*d.Ym/180;break;
case 190:b(d,d.callback())}}for(h=0;h<F.length;h++)for(f=F[h],d=f.Uh,m=0;m<d.length;m++)if(v=d[m],v.Bx!=Q){v.Bx=Q;g=v;k=0;switch(g.type){case a.CT_POSITIVE:k=(r=c(g))?1:0;break;case a.CT_CONTINUOUS:k=g.pf;(r=c(g))?(k=1,g.pf=1):1==k?(k=-1,g.pf=-1):k=0;break;case a.CT_TRIGGER:k=g.pf;(r=c(g))&&-1==k?(k=1,g.pf=1):r||1!=k?k=0:(k=-1,g.pf=-1);break;case a.CT_SHOT:k=g.pf;(r=c(g))&&-1==k?(k=1,g.pf=1):r||1!=k?k=0:(k=0,g.pf=-1);break;case a.CT_LEVEL:r=c(g);g.uv!=r?(k=1,g.uv=r):k=0;break;case a.CT_CHANGE:for(var r=
g.tg,g=g.hE,l=0;l<r.length;l++){var u=r[l].value;k||u==g[l]||(k=1);g[l]=u}break;default:I.W("Wrong sensor manifold type: "+g.type)}if(k&&(r=f==M?null:f,X=!1,v.callback(r,v.id,k,v.GA),X)){h=-1;break}}for(h=0;h<F.length;h++)for(f=F[h],d=f.Uh,m=0;m<d.length;m++)for(v=d[m],f=v.tg,v=0;v<f.length;v++)switch(k=f[v],k.type){case 30:b(k,0);break;case 40:b(k,0);break;case 60:b(k,0);break;case 70:b(k,0);break;case 75:b(k,0);break;case 130:b(k,0)}T=0;ha=U;ba=B;Y.set(W);ka.set(R);N=la;Q++};a.create_custom_sensor=
function(a){var c=d(10);b(c,a);return c};a.create_keyboard_sensor=function(a){var b=d(20);b.key=a;return b};a.create_collision_sensor=function(a,c,y){if(!a||!v.P(a))return e.error("Wrong collision object"),null;var h=d(80);h.vp=a;h.Va=c;h.Ae=y;h.ua={coll_obj:null,coll_pos:y?new Float32Array(3):null,coll_norm:y?new Float32Array(3):null,coll_dist:0};h.tp=function(a,c,e,y,d){b(h,a);a=h.ua;a.coll_obj=c;h.Ae&&(a.coll_pos.set(e),a.coll_norm.set(y),a.coll_dist=d)};h.ee=!0;return h};a.create_collision_impulse_sensor=
function(a){if(!a||!a.o)return e.error("Wrong collision impulse object"),null;var c=d(90);c.sp=a;c.Nt=function(a){b(c,a)};c.ee=!0;return c};a.create_ray_sensor=function(a,c,e,y,h,k,m){var f=d(100);f.Af=a;f.from=c;f.to=e;f.Va=y;f.jv=h;f.Ae=k;f.an=m;f.ua={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3)};f.vw=function(a,c,e,y,d,h){f.jv?b(f,-1==c?0:1):b(f,c);f.ua.hit_fract=c;f.ua.obj_hit=e;f.ua.hit_time=y;f.Ae&&(f.ua.hit_pos.set(d),f.ua.hit_norm.set(h))};f.ee=
!0;return f};a.create_mouse_click_sensor=function(){return d(50)};a.create_mouse_wheel_sensor=function(){return d(30)};a.create_mouse_move_sensor=function(a){var b=d(40);b.axis=a||"XY";b.ua="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=function(a){var b=d(60);b.axis=a||"XY";b.ua=0;return b};a.create_touch_zoom_sensor=function(){var a=d(70);a.ua=0;return a};a.create_touch_rotate_sensor=function(){var a=d(75);a.ua=0;return a};a.create_motion_sensor=function(a,b,c){if(!a)return e.error("Wrong collision object"),
null;var y=d(110);y.Af=a;var h=H.get_trans_view(a.f.h);a=H.get_quat_view(a.f.h);y.sw=new Float32Array(4);y.Nj=new Float32Array(h);y.Ln=new Float32Array(a);y.lm=0;y.km=0;y.threshold=b||.1;y.Fw=c||.1;y.Dd=0;y.ua=new Float32Array([0,0]);return y};a.create_vertical_velocity_sensor=function(a,b){if(!a)return e.error("Wrong collision object"),null;var c=d(120);c.Af=a;var y=H.get_trans_view(a.f.h),h=H.get_quat_view(a.f.h);c.Nj=new Float32Array(y);c.Ln=new Float32Array(h);c.mm=0;c.threshold=b||1;c.Dd=0;c.ua=
0;return c};a.create_timer_sensor=function(a,b){var c=d(130);c.ud=a;c.repeat=b;c.ee=!0;return c};a.reset_timer_sensor=function(a,b,c,y){a=a||M;a=a.me;if(!a||!a[b])return e.error("reset_timer_sensor(): wrong object"),null;b=a[b].tg[c];if(!b)return e.error("reset_timer_sensor(): sensor not found"),null;b.Dd=D.get_timeline();b.ud=y};a.create_elapsed_sensor=function(){var a=d(140);a.Dd=0;return a};a.create_gyro_delta_sensor=function(){var a=d(170);a.ua=new Float32Array(3);return a};a.create_gyro_angles_sensor=
function(){var a=d(180);a.ua=new Float32Array(3);return a};a.create_timeline_sensor=function(){return d(150)};a.create_selection_sensor=function(a,b){var c=d(160);c.Af=a;c.Vo=b;return c};a.create_callback_sensor=function(a,c){var e=d(190);e.callback=a;b(e,c);return e};a.PF=b;a.get_sensor_value=function(a,b,c){a=a||M;a=a.me;if(!a||!a[b])return e.error("get_sensor_value(): wrong object"),null;b=a[b].tg[c];return b?b.value:(e.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=
function(a,b,c){a=a||M;a=a.me;if(!a||!a[b])return e.error("get_sensor_payload(): wrong object"),null;b=a[b].tg[c];return b?b.ua:(e.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){F=[];M={};O.length=0;V.length=0};a.check_sensor_manifold=function(a,b){a=a||M;if(!a.me)return!1;if(b&&a.me[b])return!0;if(!b)for(var c in a.me)return!0;return!1};a.create_sensor_manifold=function(a,b,c,e,y,d,h){a=a||M;a.Uh=a.Uh||[];a.me=a.me||{};var k=a.me,m=a.Uh;k[b]&&q(a,b);c={id:b,type:c,tg:e.slice(0),
DE:y,QF:Array(e.length),callback:d,GA:h,pf:-1,uv:0,hE:Array(e.length),Bx:-1};k[b]=c;m.push(c);-1==F.indexOf(a)&&F.push(a);e=c.tg;for(a=0;a<e.length;a++){k=b=e[a];if(k.ee){switch(k.type){case 80:v.append_collision_test(k.vp,k.Va,k.tp,k.Ae);break;case 90:v.apply_collision_impulse_test(k.sp,k.Nt);break;case 100:k.ww=v.append_ray_test(k.Af,k.from,k.to,k.Va,k.vw,!1,!1,k.Ae,k.an);break;case 130:k.Dd=D.get_timeline(),0>k.ud&&(k.ud=-k.ud)}k.ee=!1}k=O.indexOf(b);-1==k?(O.push(b),V.push([c])):V[k].push(c)}X=
!0};a.eu=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.fu=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.remove_sensor_manifold=q;a.reset=function(){for(var a=0;a<F.length;a++){var b=F[a],c=b.me,b=b.Uh,e;for(e in c)delete c[e];b.length=0}for(a=0;a<O.length;a++)f(O[a]);F.length=0;O.length=0;V.length=0};a.debug=function(){e.log(String(F.length)+" objects with manifolds",F);e.log(String(O.length)+" sensors",O);for(var a=[],b=[],
c=0;c<O.length;c++){var y=O[c];80==y.type&&a.push(y);100==y.type&&b.push(y)}e.log(String(a.length)+" collision sensors",a);e.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",t,!1);a.addEventListener("keyup",l,!1);sa=b};a.register_mouse_events=function(a,b,c){if(c)var e=window;else e=a,e.addEventListener("mouseout",h,!1);a.addEventListener("mousedown",n,!1);e.addEventListener("mousemove",z,!1);e.addEventListener("mouseup",g,!1);ca=b;ua=c};
a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",k,!1);a.addEventListener("DOMMouseScroll",k,!1);Ea=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",u,!1);a.addEventListener("touchend",C,!1);a.addEventListener("touchmove",w,!1);document.addEventListener("touchstart",function(){});ga=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&y.gyro_use&&window.addEventListener("deviceorientation",E,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",
t,!1);a.removeEventListener("keyup",l,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",n,!1);a.removeEventListener("mousemove",z,!1);a.removeEventListener("mouseout",h,!1);a.removeEventListener("mouseup",g,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",k,!1);a.removeEventListener("DOMMouseScroll",k,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",u,!1);a.removeEventListener("touchmove",w,!1);document.removeEventListener("touchstart",
function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&y.gyro_use&&window.removeEventListener("deviceorientation",E,!1)};a.XI=function(a){Aa=a};a.YI=function(a){qa=a};a.$I=function(a){fa=a};a.ZI=function(a){pa=a}};b4w.module.__curve=function(a,p){function d(a,b,c,d,g){var q=d.length;g||(g=new Float32Array(q));for(var h=q+a,k=new Float32Array(h),u=1;u<=h-1;u++)k[u-1]=b>=c[u-1]&&b<c[u+1-1]?1:0;for(var w=2;w<=a;w++)for(u=1;u<=h-w;u++)k[u-1]=(0!=k[u-1]?(b-c[u-1])*k[u-1]/(c[u+w-1-1]-c[u-1]):0)+(0!=k[u+1-1]?(c[u+w-1]-b)*k[u+1-1]/(c[u+w-1]-c[u+1-1]):0);b==c[h-1]&&(k[q-1]=1);a=0;for(u=1;u<=q;u++)a+=k[u-1]*d[u-1];for(u=1;u<=q;u++)g[u-1]=0!=a?k[u-1]*d[u-1]/a:0;return g}function b(a){a=a.kn;return a[a.length-1]}function c(a){a=
a.au;return a[a.length-1]}p("__print");var q=p("__util");a.IB=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var n=a.order_u;b.jg=n;a=a.points;var g=a.length/5,q=[],h=g+n,g=g+2;q[0]=0;for(var k=2;k<=h;k++)q[k-1]=k>n&&k<g?q[k-2]+1:q[k-2];b.kn=q;if("2D"==c.dimensions)b.cg=!1;else if("3D"==c.dimensions)b.cg=!0;else throw"Wrong curve dimensions";n=[];q=[];for(c=0;c<a.length;c+=5)n.push(a[c]),n.push(a[c+1]),n.push(a[c+2]),b.cg&&n.push(a[c+3]),q.push(a[c+
4]);b.Ap=n;b.Is=q;a=[];for(var c=b.Ap,n=b.cg?4:3,q=b.Is,h=b.kn,g=b.jg,k=c.length/n,u=k+g,w=0,p=h[u-1]/999,E=0;1E3>E;E++){5E-6>h[u-1]-w&&(w=h[u-1]);for(var G=d(g,w,h,q),m=0;m<n;m++)for(var x=a[n*E+m]=0;x<k;x++)a[n*E+m]+=G[x]*c[n*x+m];w+=p}n=b.cg?4:3;q=new Float32Array(1E3);q[0]=0;for(c=1;1E3>c;c+=1)h=a[(c-1)*n],g=a[(c-1)*n+1],k=a[(c-1)*n+2],u=a[c*n],w=a[c*n+1],p=a[c*n+2],q[c]=q[c-1]+Math.sqrt((u-h)*(u-h)+(w-g)*(w-g)+(p-k)*(p-k));b.au=q;return b};a.EG=function(a,c,l){l||(l=[]);var n=c,g=Math.max(n,
0);c=g=Math.min(n,b(a));var n=a.Ap,g=a.cg?4:3,q=a.Is,h=a.kn,k=a.jg;a=n.length/g;var u=a+k;5E-6>h[u-1]-c&&(c=h[u-1]);u=new Float32Array(a);d(k,c,h,q,u);for(c=0;c<g;c++)for(q=l[c]=0;q<a;q++)l[c]+=u[q]*n[g*q+c]};a.BG=function(a,b,c){c||(c=[]);var d=a.Ap,g=a.cg?4:3,q=a.Is,h=a.kn,k=a.jg;a=d.length/g;var u=a+k;5E-6>h[u-1]-b&&(b=h[u-1]);var u=new Float32Array(a),w=b;b=u;var p=q.length;b||(b=new Float32Array(p));var E=new Float32Array(p),G=new Float32Array(p),m=E,x=G;m||(m=new Float32Array(p));x||(x=new Float32Array(p));
for(var A=p+k,r=new Float32Array(A),e=new Float32Array(A),v=1;v<=A-1;v++)r[v-1]=w>=h[v-1]&&w<h[v+1-1]?1:0;w==h[A-1]&&(r[p-1]=1);for(var J=2;J<=k;J++)for(v=1;v<=A-J;v++){var D=0!=r[v-1]?r[v-1]/(h[v+J-1-1]-h[v-1]):0,H=0!=r[v+1-1]?-r[v+1-1]/(h[v+J-1]-h[v+1-1]):0,I=0!=e[v-1]?(w-h[v-1])*e[v-1]/(h[v+J-1-1]-h[v-1]):0,P=0!=e[v+1-1]?(h[v+J-1]-w)*e[v+1-1]/(h[v+J-1]-h[v+1-1]):0;r[v-1]=(0!=r[v-1]?(w-h[v-1])*r[v-1]/(h[v+J-1-1]-h[v-1]):0)+(0!=r[v+1-1]?(h[v+J-1]-w)*r[v+1-1]/(h[v+J-1]-h[v+1-1]):0);e[v-1]=D+H+I+P}for(v=
1;v<=p;v++)m[v-1]=r[v-1],x[v-1]=e[v-1];h=0;for(k=1;k<=p;k++)h+=E[k-1]*q[k-1];w=0;for(k=1;k<=p;k++)w+=G[k-1]*q[k-1];for(k=1;k<=p;k++)b[k-1]=0!=h?G[k-1]*q[k-1]/h+E[k-1]*q[k-1]*w/(h*h):0;for(q=0;q<g;q++)for(h=c[q]=0;h<a;h++)c[q]+=u[h]*d[g*h+q]};a.YK=b;a.DG=c;a.CG=function(a,d){if(0>=d)return 0;var l=b(a);if(d>=c(a))return l;var n=a.au,g=q.om(n,d,0,n.length-1);return l*(g+(d-n[g])/(n[g+1]-n[g]))/1E3}};b4w.module.__dds=function(a,p){function d(a,b,c,d){var f=new Uint16Array(4),g=new Uint16Array(c*d),l=0,q=0,m=0,x=q=l=0,n=0,r=0,e=0,v=c/4;d/=4;for(var t=0;t<d;t++)for(var D=0;D<v;D++)m=b+4*(t*v+D),f[0]=a[m],f[1]=a[m+1],l=f[0]&31,q=f[0]&2016,x=f[0]&63488,n=f[1]&31,r=f[1]&2016,e=f[1]&63488,f[2]=5*l+3*n>>3|5*q+3*r>>3&2016|5*x+3*e>>3&63488,f[3]=5*n+3*l>>3|5*r+3*q>>3&2016|5*e+3*x>>3&63488,l=a[m+2],q=4*t*c+4*D,g[q]=f[l&3],g[q+1]=f[l>>2&3],g[q+2]=f[l>>4&3],g[q+3]=f[l>>6&3],q+=c,g[q]=f[l>>8&3],g[q+1]=f[l>>
10&3],g[q+2]=f[l>>12&3],g[q+3]=f[l>>14],l=a[m+3],q+=c,g[q]=f[l&3],g[q+1]=f[l>>2&3],g[q+2]=f[l>>4&3],g[q+3]=f[l>>6&3],q+=c,g[q]=f[l>>8&3],g[q+1]=f[l>>10&3],g[q+2]=f[l>>12&3],g[q+3]=f[l>>14];return g}function b(a,b,c,u){var q=new Int32Array(c,0,31),p,E,G,m,x,A;if(542327876!=q[0])return t.error("Invalid magic number in DDS header"),0;if(!q[20]&4)return t.error("Unsupported format, must contain a FourCC code"),0;p=q[21];switch(p){case l:E=8;G=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case n:E=16;G=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case g:E=16;G=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return t.error("Unsupported FourCC code:",f(p)),null}A=1;q[2]&131072&&!1!==u&&(A=Math.max(1,q[7]));m=q[4];x=q[3];q=q[1]+4;if(b)for(p=0;p<A;++p)u=Math.max(4,m)/4*Math.max(4,x)/4*E,b=new Uint8Array(c,q,u),a.compressedTexImage2D(a.TEXTURE_2D,p,G,m,x,0,b),q+=u,m=Math.max(.5*m,1),x=Math.max(.5*x,1);else if(p==l)Math.max(4,m),Math.max(4,x),b=new Uint16Array(c),c=d(b,q/2,m,x),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,m,x,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),u&&a.generateMipmap(a.TEXTURE_2D);else return t.error("No manual decoder for",f(p),"and no native support"),0;return A}function c(a,c,d,f,g,l){var q=new XMLHttpRequest;q.open("GET",d,!0);q.responseType="arraybuffer";q.onload=function(){if(200==q.status){a.bindTexture(a.TEXTURE_2D,f);var d=b(a,c,q.response,g);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}l&&
l(f)};q.send(null);return f}function q(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var t=p("__print"),l=q("DXT1"),n=q("DXT3"),g=q("DXT5");a.BJ=d;a.EH=b;a.Tu=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.kD=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case l:b=6;break;case n:case g:b=4;break;default:t.error("Unsupported FourCC code:",f(a))}return b};
a.BK=c;a.AK=function(a,b,d,f){var g=a.createTexture();c(a,b,d,g,!0,f);return g}};b4w.module.__debug=function(a,p){function d(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a){for(var b=f.Um(),c=a.Fm,d=0;d<c.length;d++){var h=c[d],k=b.$C(h,b.JI),m=u.getParameter(b.GI);k&&!m&&(h=b.$C(h,b.KI)/1E6,a.Tf=a.Tf?g.smooth(h,a.Tf,1,10):h,c.splice(d,1),d--)}}function c(a,b){typeof a!=typeof b&&g.W("Structure assertion failed: incompatible types");if(null!==a&&null!==b&&"object"==typeof a){for(var c in a)c in b||g.W("Structure assertion failed: missing key in the first object: "+
c);for(c in b)c in a||g.W("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&g.W("Structure assertion failed: incompatible types for key "+c)}}var q=p("__config"),f=p("__extensions"),t=p("__print"),l=p("__textures"),n=p("__time"),g=p("__util"),z=p("__graph"),h=q.p,k={},u=null,w=!1,C={},E=[],G=-1,m=null,x=!1;a.WM_NONE=0;a.WM_OPAQUE_WIREFRAME=1;a.WM_TRANSPARENT_WIREFRAME=2;a.WM_FRONT_BACK_VIEW=3;a.WM_DEBUG_SPHERES=4;a.Ad=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),
c;for(c in b){var d=b[c];d in a&&(k[a[d]]=d)}u=a};a.pp=function(a){if(w){var b=u.getError();b!=u.NO_ERROR&&(b in k?g.W("GL Error: "+b+", gl."+k[b]+" ("+a+")"):g.W("Unknown GL error: "+b+" ("+a+")"))}};a.OA=function(){if(w)switch(u.checkFramebufferStatus(u.FRAMEBUFFER)){case u.FRAMEBUFFER_COMPLETE:break;case u.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:t.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case u.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:t.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
break;case u.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:t.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case u.FRAMEBUFFER_UNSUPPORTED:t.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:t.error("FRAMEBUFFER CHECK FAILED")}};a.SA=function(){if(-1!=G)return G;u.bindFramebuffer(u.FRAMEBUFFER,u.createFramebuffer());var a=l.wk("DEBUG",l.oi);l.resize(a,1,1);u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,a.Fb,a.Na,0);u.checkFramebufferStatus(u.FRAMEBUFFER)!=
u.FRAMEBUFFER_COMPLETE?(G=!0,t.warn("depth-only issue was found")):G=!1;u.bindFramebuffer(u.FRAMEBUFFER,null);return G};a.UA=function(a,b,c){if(w&&!u.getShaderParameter(a,u.COMPILE_STATUS)){var k=h.gt&&f.mq();k&&(c=k.getTranslatedShaderSource(a));c=d(c);t.error("shader compilation failed:\n"+c+"\n"+u.getShaderInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";}};a.VA=function(a,b,c,k,m,g){if(w&&!u.getProgramParameter(a,u.LINK_STATUS)){var l=h.gt&&f.mq();l&&(m=l.getTranslatedShaderSource(c),
g=l.getTranslatedShaderSource(k));m=d(m);g=d(g);t.error("shader linking failed:\n"+m+"\n\n\n"+g+"\n"+u.getProgramInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){w=a};a.yr=function(a){if(h.show_hud_debug_info||"PERFORMANCE"==a.type){var b=f.Um();if(b){var c=b.rJ();a.Fm.push(c);b.eJ(b.Dz,c)}else a.Fm.push(performance.now())}};a.zr=function(a){if(h.show_hud_debug_info||"PERFORMANCE"==a.type){var c=f.Um();c?(c.CJ(c.Dz),b(a)):(c=performance.now()-
a.Fm.pop(),a.Tf=a.Tf?g.smooth(c,a.Tf,1,10):c)}};a.sF=b;a.DJ=function(a){C[a]=a in C?C[a]+1:1};a.update=function(){for(var a in C)t.log(a,C[a]),C[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(g.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}E.push(a)};a.msg=function(){for(var a=1,b=0;b<E.length;b++){var c=E[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],g.is_vector(a))for(var d=
0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);E.push(c)};var A=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),h=0;h<E.length;h++){var k=E[h];a=k[0];if(!(a<d)){var m=String(k[1]);c[m]||(c[m]=A[b++%A.length]);a=["%c"+(a/1E3).toFixed(6),c[m],m];for(m=2;m<k.length;m++)a.push(k[m]);t.log.apply(this,a)}}E.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b=
{},c=Math.max(0,performance.now()-1E3*a),d=0;d<E.length;d++){var h=E[d];a=h[0];if(!(a<c))for(var k=2;k<h.length;k++){var m=String(h[1]);3<h.length&&(m+="_"+String(k-2));b[m]||(b[m]=m+"\n");b[m]+=String(a)+" "+h[k]+"\n"}}a="";for(m in b)a+=b[m]+"\n\n";t.log(a);E.splice(0)};a.lJ=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&
b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(g.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.UI=function(a,b){a.constructor!=b&&g.W("Type assertion failed: value <"+a+"> has type <"+a.constructor+">, required <"+b+">")};a.VI=c;a.WI=
function(a){x?c(a,m):x=!0;m=a};a.fake_load=function(a,b,c,d,h){(a=a||null)||g.W("Stage load callback is undefined");b=b||5E3;c=c||0;d=d||100;100<d&&g.W("Max percentage must be less than 100");0>c&&g.W("Min percentage must be greater than 0");c>d&&g.W("Max percentage must be greater than min percentage");var k=n.animate(c,d,b,function(b){b=b.toFixed();a(b);100==b&&(n.clear_animation(k),h&&h())})};a.GK=function(a){return z.WB(a,function(a,b){return b.type},function(b,c,d){b=z.Ba(a,b);c=z.Ba(a,c);return b.ya[d[0]].identifier+
"\n==>\n"+c.H[d[1]].identifier})}};b4w.module.__extensions=function(a,p){function d(a){if(a in t)return t[a];var b=f.getExtension(a)||null;t[a]=b;c.log("%cGET EXTENSION","color: #"+(b?"0a0":"a00"),a);return b}var b=p("__config"),c=p("__print"),q=b.p,f=null,t={};a.Ad=function(a){f=a};a.Ru=function(){return d("WEBGL_compressed_texture_s3tc")||d("WEBKIT_WEBGL_compressed_texture_s3tc")||d("MOZ_WEBGL_compressed_texture_s3tc")};a.mD=function(){return q.Ec?{}:d("WEBGL_depth_texture")||d("WEBKIT_WEBGL_depth_texture")||d("MOZ_WEBGL_depth_texture")};
a.dD=function(){return d("EXT_texture_filter_anisotropic")||d("WEBKIT_EXT_texture_filter_anisotropic")||d("MOZ_EXT_texture_filter_anisotropic")};a.mq=function(){return d("WEBGL_debug_shaders")};a.Qu=function(){return d("WEBGL_debug_renderer_info")};a.Ku=function(){return q.Ec?{}:d("OES_element_index_uint")};a.zD=function(){return q.Ec?null:d("OES_standard_derivatives")};a.Um=function(){return d("EXT_disjoint_timer_query")};a.cleanup=function(){t={}}};b4w.module.__graph=function(a,p){function d(a,c,d){d||(d=null);if(b(a,c))throw"Graph already has node with given ID";a.D.push(c,d)}function b(a,b){for(var c=a.D,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function c(a,c,d,e){e||(e=null);if(b(a,c)&&b(a,d))a.fa.push(c,d,e);else throw"Wrong node IDs";}function q(a,c){if(!b(a,c))throw"Node not found";for(var d=a.D,e=0;e<d.length;e+=2)d[e]==c&&(d.splice(e,2),e-=2)}function f(a,b,c,d){if(!J(a,b,c))throw"Edge not found";a=a.fa;for(var e=0,h=0;h<a.length;h+=
3)if(a[h]==b&&a[h+1]==c){if(-1==d)a.splice(h,3);else{if(d==e){a.splice(h,3);break}e++}h-=3}}function t(a){a=a.D;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}function l(a,b){for(var c=a.D,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function n(a){var b=[],c={};g(a,c);for(var d=a.D,e=0;e<d.length;e+=2)0==r(a,d[e])&&z(a,d[e],c,b);return{D:b,fa:a.fa.slice(0)}}function g(a,b){for(var c=a.D,d=0;d<c.length;d+=2)b[c[d]]=!1}function z(a,b,c,d){if(!c[b]){c[b]=!0;for(var h=0;h<A(a,
b);h++)z(a,e(a,b,h),c,d);d.unshift(b,x(a,b))}}function h(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var k=0;k<A(a,b);k++){var m=e(a,b,k);h(a,m,c,d)}if(20==d||30==d)for(k=0;k<r(a,b);k++)m=v(a,b,k),h(a,m,c,d)}}function k(a){for(var c=a.fa,d=0;d<c.length;d+=3){var e=c[d+1];b(a,c[d])&&b(a,e)||(c.splice(d,3),d-=3)}}function u(a){for(var b=[],c=a.D,d=0;d<c.length;d+=2){var e=c[d];A(a,e)||b.push(e)}return b}function w(a){var b=a.D;a=a.fa;for(var c=[],d=[],e=[],h=0;h<b.length;h++)e[b[2*h]]=h,c.push(h,
b[2*h+1]);for(h=0;h<a.length;h+=3)d.push(e[a[h]],e[a[h+1]],a[h+2]);return{D:c,fa:d}}function C(a,b,c){if(c.Be==c.hg){for(var d=0,h=0;d<c.hg;d++)-1!=c.df[d]&&(a[h]=d,b[h]=c.df[d],h++);return!0}if(c.hg>c.ij||c.yg>c.zg||c.Jj>c.Lj||c.Ij>c.Kj)return!1;for(var h=d=-1,k=!1;!k&&E(c,K,d,h);)if(d=K[0],h=K[1],G(c,d,h)){var f;f=c;k={};k.Pk=f.Pk;k.Qk=f.Qk;k.fr=f.fr;k.Km=f.Km;k.hg=f.hg;k.ij=f.ij;k.jg=f.jg;k.Be=k.zn=f.Be;k.Ij=f.Ij;k.Jj=f.Jj;k.yg=f.yg;k.Kj=f.Kj;k.Lj=f.Lj;k.zg=f.zg;k.Zj=-1;k.df=f.df;k.eh=f.eh;k.sh=
f.sh;k.th=f.th;k.Kh=f.Kh;k.Lh=f.Lh;k.Un=f.Un;f.Un[0]+=1;var k=f=k,g=d,l=h,u=k.Pk,q=k.Qk,x=k.hg,n=k.ij,t=k.df,D=k.eh,H=k.sh,w=k.th,J=k.Kh,N=k.Lh;m(g<x);m(l<n);m(k.Be<x);m(k.Be<n);x=++k.Be;k.Zj=g;H[g]||(H[g]=x,k.Ij++,J[g]&&k.yg++);J[g]||(J[g]=x,k.Jj++,H[g]&&k.yg++);w[l]||(w[l]=x,k.Kj++,N[l]&&k.zg++);N[l]||(N[l]=x,k.Lj++,w[l]&&k.zg++);t[g]=l;D[l]=g;for(t=0;t<r(u,g);t++)D=v(u,g,t),H[D]||(H[D]=x,k.Ij++,J[D]&&k.yg++);for(t=0;t<A(u,g);t++)D=e(u,g,t),J[D]||(J[D]=x,k.Jj++,H[D]&&k.yg++);for(t=0;t<r(q,l);t++)D=
v(q,l,t),w[D]||(w[D]=x,k.Kj++,N[D]&&k.zg++);for(t=0;t<A(q,l);t++)D=e(q,l,t),N[D]||(N[D]=x,k.Lj++,w[D]&&k.zg++);k=C(a,b,f);m(1>=f.Be-f.zn);m(-1!=f.Zj);D=f.Pk;g=f.Qk;l=f.Be;u=f.Zj;q=f.df;H=f.eh;x=f.sh;w=f.th;n=f.Kh;J=f.Lh;if(f.zn<l){x[u]==l&&(x[u]=0);for(N=0;N<r(D,u);N++)t=v(D,u,N),x[t]==l&&(x[t]=0);n[u]==l&&(n[u]=0);for(N=0;N<A(D,u);N++)t=e(D,u,N),n[t]==l&&(n[t]=0);D=q[u];w[D]==l&&(w[D]=0);for(N=0;N<r(g,D);N++)t=v(g,D,N),w[t]==l&&(w[t]=0);J[D]==l&&(J[D]=0);for(N=0;N<A(g,D);N++)t=e(g,D,N),J[t]==l&&
(J[t]=0);q[u]=-1;H[D]=-1;f.Be=f.zn;f.Zj=-1}}return k}function E(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.yg,h=a.zg,k=a.Jj,m=a.Lj,f=a.Ij,g=a.Kj,v=a.Be,r=a.hg,l=a.ij,u=a.df,q=a.eh,x=a.sh,n=a.th,t=a.Kh,N=a.Lh;if(e>v&&h>v)for(;c<r&&(-1!=u[c]||0==t[c]||0==x[c]);)c++,d=0;else if(k>v&&m>v)for(;c<r&&(-1!=u[c]||0==t[c]);)c++,d=0;else if(f>v&&g>v)for(;c<r&&(-1!=u[c]||0==x[c]);)c++,d=0;else if(0==c&&0!=a.jg){for(x=0;x<r&&-1!=u[c=a.jg[x]];)x++;x==r&&(c=r)}else for(;c<r&&-1!=u[c];)c++,d=0;if(e>v&&h>v)for(;d<
l&&(-1!=q[d]||0==N[d]||0==n[d]);)d++;else if(k>v&&m>v)for(;d<l&&(-1!=q[d]||0==N[d]);)d++;else if(f>v&&g>v)for(;d<l&&(-1!=q[d]||0==n[d]);)d++;else for(;d<l&&-1!=q[d];)d++;return c<r&&d<l?(b[0]=c,b[1]=d,!0):!1}function G(a,b,c){var d=a.Pk,h=a.Qk,k=a.ij,f=a.df,g=a.eh,l=a.sh,u=a.th,q=a.Kh,n=a.Lh;m(b<a.hg);m(c<k);m(-1==f[b]);m(-1==g[c]);if(!(0,a.fr)(x(d,b),x(h,c)))return!1;for(var t=k=0,H=0,w=0,I=0,K=0,p=0;p<A(d,b);p++){var N=e(d,b,p);if(-1!=f[N]){var aa=f[N];if(!J(h,c,aa)||!D(a.Km,d,b,N,h,c,aa))return!1}else l[N]&&
H++,q[N]&&k++,l[N]||q[N]||I++}for(p=0;p<r(d,b);p++)if(N=v(d,b,p),-1!=f[N]){if(aa=f[N],!J(h,aa,c)||!D(a.Km,d,N,b,h,aa,c))return!1}else l[N]&&H++,q[N]&&k++,l[N]||q[N]||I++;for(p=0;p<A(h,c);p++)if(aa=e(h,c,p),-1!=g[aa]){if(N=g[aa],!J(d,b,N))return!1}else u[aa]&&w++,n[aa]&&t++,u[aa]||n[aa]||K++;for(p=0;p<r(h,c);p++)if(aa=v(h,c,p),-1!=g[aa]){if(N=g[aa],!J(d,N,b))return!1}else u[aa]&&w++,n[aa]&&t++,u[aa]||n[aa]||K++;return H<=w&&k<=t&&I<=K}function m(a){if(!a)throw"Assertion failed";}function x(a,b){for(var c=
a.D,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function A(a,b){for(var c=a.fa,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function r(a,b){for(var c=a.fa,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function e(a,b,c){a=a.fa;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function v(a,b,c){a=a.fa;for(var d=0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(d==c)return a[e];d++}return-1}function J(a,b,c){a=a.fa;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;
return!1}function D(a,b,c,d,e,h,k){for(var m=H(b,c,d),f=H(e,h,k),v=0;v<m;v++){for(var g=!1,r=0;r<f;r++)if(a(I(b,c,d,v),I(e,h,k,r))){g=!0;break}if(!g)return!1}return!0}function H(a,b,c){var d=0;a=a.fa;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function I(a,b,c,d){a=a.fa;for(var e=0,h=0;h<a.length;h+=3)if(a[h]==b&&a[h+1]==c){if(e==d)return a[h+2];e++}return null}p("__print");var P=p("__util"),K=[-1,-1];a.Rs=-1;a.FI=10;a.Tl=20;a.MI=30;a.create=function(){for(var a=arguments,b=[],c=
[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{D:b,fa:c}};a.clone=function(a,b,c){if(b)for(var d=Array(a.D.length),e=0;e<a.D.length;e+=2)d[e]=a.D[e],d[e+1]=b(a.D[e+1]);else d=P.xa(a.D);if(c)for(b=Array(a.fa.length),e=0;e<a.fa.length;e+=3)b[e]=a.fa[e],b[e+1]=a.fa[e+1],b[e+2]=c(a.fa[e+2]);else b=P.xa(a.fa);return a={D:d,fa:b}};a.tJ=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],
a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{D:c,fa:d}};a.ri=d;a.gK=b;a.oc=c;a.Le=q;a.Sh=f;a.Nn=function(a,b,c,d){if(!J(a,b,c))throw"Edge not found";a=a.fa;for(var e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c&&a[e+2][0]==d[0]&&a[e+2][1]==d[1]){a.splice(e,3);break}};a.u=function(a,b){if(-1==l(a,b)){var c=t(a);d(a,c,b);return c}throw"Non-unique attribute";};a.DF=function(a,b,c,d,e){a=a.fa;for(var h=0;h<a.length;h+=3)a[h]==b&&a[h+1]==c&&a[h+2]==d&&(a[h+2]=e)};a.aA=function(a,b,
e){var h;e=e||[];h=h||[];for(var k={},m=0;m<a.D.length;m+=2){var f=a.D[m],v=a.D[m+1],g=t(b);d(b,g,v);k[f]=g}for(m=0;m<a.fa.length;m+=3)v=k[a.fa[m]],g=k[a.fa[m+1]],f=a.fa[m+2],c(b,v,g,f);for(m=0;m<e.length;m+=3)v=k[e[m]],a=e[m+1],f=e[m+2],c(b,v,a,f);for(m=0;m<h.length;m+=3)e=h[m],g=k[h[m+1]],f=h[m+2],c(b,e,g,f)};a.Rk=t;a.Ie=l;a.m=function(a,b,d,e){b=l(a,b);d=l(a,d);if(-1!=b&&-1!=d)c(a,b,d,e);else throw"Attributes not found";};a.aa=function(a,b){for(var c=a.D,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};
a.oe=function(a,b){for(var c=a.fa,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.pe=function(a,b,c){for(var d=a.fa,e=0;e<d.length;e+=3)if(d[e+1]==b){var h=d[e];if(c(h,x(a,h),d[e+2]))break}};a.Bg=function(a,b,c){for(var d=a.fa,e=0;e<d.length;e+=3)if(d[e]==b){var h=d[e+1];if(c(h,x(a,h),d[e+2]))break}};a.ss=n;a.SG=function(a){a=n(a).D;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.sK=function(){};a.ao=function(a,c,d){if(!b(a,c))throw"No such node";var e={};g(a,e);h(a,c,e,d);c=[];for(var m in e)e[m]&&
(m=Number(m),c.push(m,x(a,m)));a={D:c,fa:a.fa.slice(0)};k(a);return a};a.qp=k;a.yD=function(a){for(var b=[],c=a.D,d=0;d<c.length;d+=2){var e=c[d];r(a,e)||b.push(e)}return b};a.Tk=u;a.match=function(a,b,c,d){var e={};e.Pk=w(a);e.Qk=w(b);e.fr=c||function(a,b){return a==b};e.Km=d||function(a,b){return a==b};d=a.D.length/2;var h=b.D.length/2;e.hg=d;e.ij=h;e.jg=0;e.Be=e.zn=0;e.yg=e.Ij=e.Jj=0;e.zg=e.Kj=e.Lj=0;e.Zj=-1;e.df=Array(d);e.eh=Array(h);e.sh=Array(d);e.th=Array(h);e.Kh=Array(d);e.Lh=Array(h);e.Un=
[1];for(c=0;c<d;c++)e.df[c]=-1,e.sh[c]=0,e.Kh[c]=0;for(c=0;c<h;c++)e.eh[c]=-1,e.th[c]=0,e.Lh[c]=0;h=Array(d);d=Array(d);if(C(h,d,e)){for(c=0;c<h.length;c++)h[c]=a.D[2*h[c]],d[c]=b.D[2*d[c]];return[h,d]}return null};a.Ba=x;a.kg=A;a.bn=r;a.Zf=e;a.Pi=v;a.UJ=H;a.mf=I;a.replace=function(a,b,c){for(var e=a.fa,h=t(a),k=0;k<b.length;k++){var m=b[k];q(a,m);for(var f=0;f<e.length;f+=3)e[f]==m&&(e[f]=h),e[f+1]==m&&(e[f+1]=h),e[f]==e[f+1]&&(e.splice(f,3),f-=3)}d(a,h,c)};a.yw=function(a,b,c,d,e){if(!J(a,b,c))throw"Edge not found";
a=a.fa;for(var h=0;h<a.length;h+=3)a[h]==b&&a[h+1]==c&&(a[h]=d,a[h+1]=e)};a.nC=function(a,b){function c(a,b){if(-1!=m.indexOf(a)){var d=m.slice(m.indexOf(a));if(-1!=e[d[d.length-1]].indexOf(d[0])){v.push([a,d[d.length-1]]);return}}m.push(a);for(d=0;d<b.length;d++)b[d]in e&&c(b[d],e[b[d]])}b||(b=u(a)[0]);var d=a.fa;if(d.length){for(var e={},h=0,k=0;k<d.length;k+=3)d[k+1]in e?e[d[k+1]].push(d[k]):e[d[k+1]]=[d[k]],h++;var m=[],v=[];c(b,e[b]);for(k=0;k<v.length;k++)for(var g=h=0;g<d.length;g+=3)v[k][1]==
d[g+1]&&v[k][0]==d[g]&&f(a,d[g],d[g+1],h),h++}};a.WB=function(a,b,c){var d=a.D;a=a.fa;var e;e="digraph debug {\n    node [shape=box];\n";for(var h=0;h<d.length;h+=2){var k=d[h],m=d[h+1],m=b?b(k,m):String(k);e+="    ";e+=String(k)+' [label="'+m.replace(/\"/g,'\\"')+'"];\n'}for(h=0;h<a.length;h+=3)b=a[h],d=a[h+1],m=a[h+2],e+="    ",e+=String(b)+" -> "+String(d),c&&(e+=' [label="'+c(b,d,m)+'"]'),e+=";\n";return e+="}"}};b4w.module.__ipc=function(a,p){function d(a,b,c){for(var d=0;d<k.length;d+=2)k[d+1]==a&&(h[d+Number(!b)]=c)}function b(a){for(var b=0;b<a.length;b++){var c=a[b],d=0,h;for(h in c){var k=c[h];switch(k.constructor){case Float32Array:d+=k.length;break;case Number:d+=1}}--d;c.len=d}}var c=!0;a.xy=0;var q=a.py=1,f=a.ry=2;a.qy=3;a.ty=4;a.uy=5;a.vy=6;a.yy=7;var t=a.Ay=8,l=a.Qs=9,n=a.By=10;a.Cy=11;var g=a.Dy=12;a.Ey=13;a.zy=14;a.wy=15;a.sy=16;a.ez=100;a.Gy=101;a.Hy=102;a.Iy=103;a.Jy=104;a.Ly=105;a.Ky=106;
a.My=107;a.Ny=108;a.Oy=109;a.Py=110;a.Qy=111;a.Ry=112;a.Ty=113;a.Uy=114;a.hz=115;a.Vy=116;a.Wy=117;a.Xy=118;a.Zy=119;a.$y=120;a.az=121;a.cz=122;a.dz=123;a.fz=124;a.Sy=125;a.jz=126;a.Yy=127;a.Ts=128;a.iz=129;a.kz=130;a.lz=131;a.mz=132;a.nz=133;a.oz=134;a.pz=135;a.qz=136;a.rz=137;a.sz=138;a.tz=139;a.Us=140;var z=a.Wl=141;a.uz=142;a.Ss=143;a.vz=144;a.wz=145;a.gz=146;a.bz=147;a.xz=148;var h=b4w.worker_listeners,k=b4w.worker_namespaces,u={td:g,v:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),
Fe:new Float32Array(3),ue:new Float32Array(3),len:0},w={td:t,op:0,rr:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},C={td:l,id:0,ui:0,hit_fract:0,hit_time:0,len:0},E={td:n,id:0,ui:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},G={td:q,Xg:0,Yg:0,result:0,len:0},m={td:f,Xg:0,Yg:0,result:0,dh:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},x={td:z,v:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},A=[u,w,C,E,G,m,x];
a.PB=function(a,b){var m={jn:a?!0:!1,Lg:null,ze:[],Nd:""};if(b)if(m.Lg={addEventListener:function(a,b){"message"!=a&&panic("Wrong web worker event");d(m.Nd,m.jn,b)},removeEventListener:function(a){"message"!=a&&panic("Wrong web worker event");d(m.Nd,m.jn,null)},postMessage:function(a){var b;a:{for(b=0;b<k.length;b+=2)if(k[b+1]==m.Nd){b=h[b+Number(!!m.jn)];break a}b=null}b({data:a})},terminate:function(){for(var a=0;a<k.length;a+=2)if(k[a+1]==m.Nd){h.splice(a,2);k.splice(a,2);break}}},m.jn){var f=
p("__util"),g=p("__container"),l=b4w.get_namespace(p),f=f.Oj(l+"_worker");k.push(l);k.push(f);h.push(null);h.push(null);m.Nd=f;(g=g.BC(a))?c?g.addEventListener("load",function(){b4w.require("__bindings",m.Nd)},!1):(b4w.cleanup("__bindings",m.Nd),b4w.cleanup("__ipc",m.Nd),b4w.require("__bindings",m.Nd)):(g=document.createElement("script"),g.src=a,g.defer="defer",g.async="async",g.addEventListener("load",function(){c=!1;b4w.require("__bindings",m.Nd)},!1),document.head.appendChild(g))}else m.Nd=b4w.get_namespace(p);
else m.Lg=a?new Worker(a):self;return m};a.qA=function(a,c){function d(b){if(b.constructor==ArrayBuffer)b=new Float32Array(b);else if(b[0].constructor==ArrayBuffer){for(var h=0;h<b.length;h++)d(b[h]);return}h=b[0]|0;switch(h){case g:var k=u;k.v=b[1]|0;k.time=b[2];k.trans[0]=b[3];k.trans[1]=b[4];k.trans[2]=b[5];k.quat[0]=b[6];k.quat[1]=b[7];k.quat[2]=b[8];k.quat[3]=b[9];k.Fe[0]=b[10];k.Fe[1]=b[11];k.Fe[2]=b[12];k.ue[0]=b[13];k.ue[1]=b[14];k.ue[2]=b[15];break;case t:k=w;k.op=b[1]|0;k.rr=b[2]|0;k.trans[0]=
b[3];k.trans[1]=b[4];k.trans[2]=b[5];k.quat[0]=b[6];k.quat[1]=b[7];k.quat[2]=b[8];k.quat[3]=b[9];break;case l:k=C;k.id=b[1]|0;k.ui=b[2]|0;k.hit_fract=b[3];k.hit_time=b[4];break;case n:k=E;k.id=b[1]|0;k.ui=b[2]|0;k.hit_fract=b[3];k.hit_time=b[4];k.hit_pos[0]=b[5];k.hit_pos[1]=b[6];k.hit_pos[2]=b[7];k.hit_norm[0]=b[8];k.hit_norm[1]=b[9];k.hit_norm[2]=b[10];break;case q:k=G;k.Xg=b[1]|0;k.Yg=b[2]|0;k.result=!!b[3];break;case f:k=m;k.Xg=b[1]|0;k.Yg=b[2]|0;k.result=!!b[3];k.dh[0]=b[4];k.dh[1]=b[5];k.dh[2]=
b[6];k.coll_norm[0]=b[7];k.coll_norm[1]=b[8];k.coll_norm[2]=b[9];k.coll_dist=b[10];break;case z:k=x;k.v=b[1]|0;k.trans[0]=b[2];k.trans[1]=b[3];k.trans[2]=b[4];k.quat[0]=b[5];k.quat[1]=b[6];k.quat[2]=b[7];k.quat[3]=b[8];break;default:k=b}c(a,h,k)}b(A);a.Lg.addEventListener("message",function(a){d(a.data)},!1)};a.cleanup=function(){};a.A=function(a,b){if(a)switch(b){case g:var c=u,d=new Float32Array(c.len);d[0]=c.td;d[1]=c.v;d[2]=c.time;d[3]=c.trans[0];d[4]=c.trans[1];d[5]=c.trans[2];d[6]=c.quat[0];
d[7]=c.quat[1];d[8]=c.quat[2];d[9]=c.quat[3];d[10]=c.Fe[0];d[11]=c.Fe[1];d[12]=c.Fe[2];d[13]=c.ue[0];d[14]=c.ue[1];d[15]=c.ue[2];a.ze.push(d.buffer);break;case t:c=w;d=new Float32Array(c.len);d[0]=c.td;d[1]=c.op;d[2]=c.rr;d[3]=c.trans[0];d[4]=c.trans[1];d[5]=c.trans[2];d[6]=c.quat[0];d[7]=c.quat[1];d[8]=c.quat[2];d[9]=c.quat[3];a.ze.push(d.buffer);break;case l:c=C;d=new Float32Array(c.len);d[0]=c.td;d[1]=c.id;d[2]=c.ui;d[3]=c.hit_fract;d[4]=c.hit_time;a.ze.push(d.buffer);break;case n:c=E;d=new Float32Array(c.len);
d[0]=c.td;d[1]=c.id;d[2]=c.ui;d[3]=c.hit_fract;d[4]=c.hit_time;d[5]=c.hit_pos[0];d[6]=c.hit_pos[1];d[7]=c.hit_pos[2];d[8]=c.hit_norm[0];d[9]=c.hit_norm[1];d[10]=c.hit_norm[2];a.ze.push(d.buffer);break;case q:c=G;d=new Float32Array(c.len);d[0]=c.td;d[1]=c.Xg;d[2]=c.Yg;d[3]=c.result;a.ze.push(d.buffer);break;case f:c=m;d=new Float32Array(c.len);d[0]=c.td;d[1]=c.Xg;d[2]=c.Yg;d[3]=c.result;d[4]=c.dh[0];d[5]=c.dh[1];d[6]=c.dh[2];d[7]=c.coll_norm[0];d[8]=c.coll_norm[1];d[9]=c.coll_norm[2];d[10]=c.coll_dist;
a.ze.push(d.buffer);break;case z:c=x;d=new Float32Array(c.len);d[0]=c.td;d[1]=c.v;d[2]=c.trans[0];d[3]=c.trans[1];d[4]=c.trans[2];d[5]=c.quat[0];d[6]=c.quat[1];d[7]=c.quat[2];d[8]=c.quat[3];a.ze.push(d.buffer);break;default:d=[];for(c=1;c<arguments.length;c++)d.push(arguments[c]);a.Lg.postMessage(d)}};a.nF=function(a){a&&a.ze.length&&(a.Lg.postMessage(a.ze),a.ze.length=0)};a.Nu=function(a){switch(a){case g:return u;case t:return w;case l:return C;case n:return E;case q:return G;case f:return m;case z:return x;
default:return null}};a.terminate=function(a){a.Lg.terminate();a.Lg=null};a.fn=function(a){return!!a.Lg};a.mv=function(a){return!!a.Nd}};b4w.module.__hud=function(a,p){function d(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){c(' SCENE "'+a.name+'"');if(a.k){var b=0,d=0,f=0;l.aa(a.k.ib,function(a,h){if("SINK"==h.type)c(" (F)",h.type);else{var g=h.type,m=Math.round(h.j.width)+"x"+Math.round(h.j.height),l=h.q.length,q=h.Ak;"MAIN_CUBE_REFLECT"==h.type&&(l*=6);var r=h.enqueue&&h.Ib,e=r?h.Tf:0;c(r?" (A)":" (P)",g,h.yn,m,q,"of",l,"  ",e.toFixed(3));h.Ak=0;r&&(b+=l,d+=q,f+=e)}});return[b,
d,f]}c("No INFO")}function c(){for(var a=80+20*z[0],b=arguments[0],c=1;c<arguments.length;c++){for(var d="",f=0;f<n[c]-String(arguments[c]).length;f++)d+=" ";b+=d+arguments[c]}z[0]++;g.fillText(b,30,a)}function q(a,b,c){b*=a.nb;c.x=a.x+b;c.y=a.y;c.nb=a.nb-2*b;c.bb=a.bb}function f(a){return a.x+a.nb/2}function t(a){var b=g,c={x:0,y:0,nb:0,bb:0},d=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.nb=d;c.bb=b;q(c,.01,c);d=.02*c.bb;c.x=c.x;c.y+=d;c.nb=c.nb;c.bb-=2*d;d=c.nb/8;c.x+=d*a;c.y=c.y;c.nb=d;c.bb=
c.bb;q(c,.02,c);return c}var l=p("__graph");p("__print");var n=[5,19,3,10,4,3,5],g=null,z=[0,0];a.init=function(a){a=a.getContext("2d");d(a);return g=a};a.Fl=function(){g&&d(g)};a.reset=function(){var a=g;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),z[0]=0,z[1]=0)};a.qG=function(a,d){var f=g;if(f){f.textAlign="left";f.fillStyle="rgba(0,255,0,255)";c(" FPS",(1/d).toFixed(2));z[0]++;for(var l=f=0,q=0,n=0;n<a.length;n++){var t=
b(a[n]),f=f+t[0],l=l+t[1],q=q+t[2];z[0]++}c(" -----------------------------------------------");c("    ","TOTAL ACTIVE","","",l,"of",f,"  ",q.toFixed(3))}};a.print=function(){var a=g;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",c.apply(Math,arguments))};a.plot_array=function(a,b,c,d,l,q,n){var m=g;if(m){b=t(b);var x=b.bb/5;b.x=b.x;b.y+=4*x;b.nb=b.nb;b.bb=x;m.textAlign="center";m.fillStyle="#00FF00";g.fillText(a,f(b),b.y-10);m.strokeStyle="#00FF00";m.lineWidth=.5;m.beginPath();m.moveTo(b.x,
b.y);m.lineTo(b.x+b.nb,b.y);m.lineTo(b.x+b.nb,b.y+b.bb);m.lineTo(b.x,b.y+b.bb);m.closePath();m.stroke();if(!q&&!n)for(q=1E6,n=-1E6,a=0;a<c.length;a++)q=Math.min(q,c[a]),n=Math.max(n,c[a]);m.textAlign="right";g.fillText(String(q),b.x-10,b.y+b.bb);g.fillText(String(n),b.x-10,b.y);m.textAlign="center";g.fillText(String(d),b.x,b.y+b.bb+15);g.fillText(String(l),b.x+b.nb,b.y+b.bb+15);m.strokeStyle="#FF0000";m.lineWidth=1.5;m.beginPath();d=b.nb/(c.length-1);n=b.bb/(n-q);for(a=0;a<c.length;a++)l=b.x+d*a,
x=b.y+b.bb-(c[a]-q)*n,0==a?m.moveTo(l,x):m.lineTo(l,x);m.stroke()}};a.draw_mixer_strip=function(a,b,c,d,l,q,n){var m=g;if(m)for(m.textAlign="center",m.fillStyle="#00FF00",m.font="bold 12px Courier",c=t(c),g.fillText(b?"["+a+"]":a,f(c),c.y),0<=q&&g.fillText(q?"[M]":"[ ]",f(c)-15,c.y+30),0<=n&&g.fillText(n?"[S]":"[ ]",f(c)+15,c.y+30),a={x:0,y:0,nb:0,bb:0},b=0;b<d.length;b++){q=d[b];var x="VOLUME"==q[0];if(x){n=c.y+350;var A=c.nb,r=a;r.x=c.x;r.y=n;r.nb=A;r.bb=250}else{n=c.y+10+50*b;var A=c.nb,r=c.bb,
e=a;e.x=c.x;e.y=n;e.nb=A;e.bb=r}n=m;var A=a,e=b==l,v=q[0],r=q[1],p=q[2],D=q[3],H=(D-p)/q[4],H=1>H?Math.floor(1/H-1E-5).toFixed(0).length:0;q=q[5]?Math.log(r/p)/Math.log(D/p):(r-p)/(D-p);n.textAlign="center";e?n.fillText("["+v+"]",f(A),A.y):n.fillText(v,f(A),A.y);n.strokeStyle="#00FF00";n.lineWidth=x?3:1;x?(n.textAlign="right",n.fillText(D.toFixed(H),f(A)-10,A.y+15),n.textAlign="right",n.fillText(p.toFixed(H),f(A)-10,A.y+A.bb-15)):(n.textAlign="right",n.fillText(p.toFixed(H),A.x+28,A.y+15),n.textAlign=
"left",n.fillText(D.toFixed(H),A.x+A.nb-28,A.y+15));n.beginPath();if(x){var I=A.y+15+(A.bb-30)*(1-q);n.moveTo(f(A),A.y+15);n.lineTo(f(A),A.y+A.bb-15);n.moveTo(f(A)-5,A.y+15);n.lineTo(f(A)+5,A.y+15);n.moveTo(f(A)-5,A.y+A.bb-15);n.lineTo(f(A)+5,A.y+A.bb-15);n.moveTo(f(A)-5,I);n.lineTo(f(A)+5,I)}else{var z=A.x+30+(A.nb-60)*q;n.moveTo(A.x+30,A.y+15);n.lineTo(A.x+A.nb-30,A.y+15);n.moveTo(A.x+30,A.y+15-5);n.lineTo(A.x+30,A.y+15+5);n.moveTo(A.x+A.nb-30,A.y+15-5);n.lineTo(A.x+A.nb-30,A.y+15+5);n.moveTo(z,
A.y+15-5);n.lineTo(z,A.y+15+5)}n.stroke();"EQ_Q"==v?(q=Math.log(1+1/(2*r*r)+Math.sqrt((2+1/(r*r))*(2+1/(r*r))/4-1))/Math.log(2),x?(n.textAlign="left",n.fillText(r.toFixed(H),f(A)+10,I),n.textAlign="left",n.fillText("("+q.toFixed(H+1)+")",f(A)+10,I+10)):(n.textAlign="right",n.fillText(r.toFixed(H),z,A.y+30),n.textAlign="left",n.fillText("("+q.toFixed(H+1)+")",z,A.y+30))):x?(n.textAlign="left",n.fillText(r.toFixed(H),f(A)+10,I)):(n.textAlign="center",n.fillText(r.toFixed(H),z,A.y+30))}}};b4w.module.__renderer=function(a,p){function d(a){for(var b=a.j,d=a.q,h=0;h<d.length;h++){var k=d[h];if(k.Ib){var f=a,g=b,l=k.ke,y=k.G,F=y.dc;m.useProgram(F.Ph);for(var k=y.O,u=y.jm,n=F.zx,x=n.length;x--;){var t=n[x];t.hq(m,t.zh,f,l,y,g)}g=y.Ot;m.colorMask(g,g,g,g);m.depthMask(y.pa);y.mb?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE);g=y.U;for(y=0;y<g.length;y++)n=g[y],m.activeTexture(m.TEXTURE0+y),m.bindTexture(n.Fb,n.Na);if("SKY"==f.type){g=f;F=F.ai;y=g.j.Hb.Na;n=g.yk;for(x=0;6>x;x++)if(t=q(x),r.rp?
(m.bindTexture(m.TEXTURE_CUBE_MAP,y),m.texImage2D(t,0,m.RGBA,1,1,0,m.RGBA,m.UNSIGNED_BYTE,G)):(m.uniformMatrix4fv(F.u_cube_view_matrix,!1,n[x]),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,t,y,0),c(k,u,l.Ds)),g.wn&&3!=x){var t=g,w=x,B=A;r.rp?B.set(G):(m.readPixels(191,191,1,1,m.RGBA,m.UNSIGNED_BYTE,B),255!=B[0]&&255!=B[1]&&255!=B[2]||m.readPixels(191,220,1,1,m.RGBA,m.UNSIGNED_BYTE,B));var p=B[0],ba=B[1],B=B[2],p=p/255,ba=ba/255,B=B/255;2===w?(t.hd[3]=p,t.hd[7]=ba,t.hd[11]=B):2>w?(t.hd[4*
w]=p,t.hd[4*w+1]=ba,t.hd[4*w+2]=B):(t.hd[4*(w-2)]=p,t.hd[4*(w-2)+1]=ba,t.hd[4*(w-2)+2]=B)}f.Ak+=6}else c(k,u,l.Ds),f.Ak++}}}function b(a){if(a){var b=(a.Fa?m.COLOR_BUFFER_BIT:0)|(a.Ja?m.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=E;break;case "SHADOW_CAST":a=u;break;case "DEPTH":a=w;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=C;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=E;break;default:a=
r.background_color}}else b=m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT,a=r.background_color;m.colorMask(!0,!0,!0,!0);m.depthMask(!0);m.clearColor(a[0],a[1],a[2],a[3]);m.clear(b)}function c(a,b,c){m.bindBuffer(m.ARRAY_BUFFER,a.Fg);for(var d=0;d<b.length;d++){var h=b[d];m.enableVertexAttribArray(h.zh);m.vertexAttribPointer(h.zh,h.Ud,m.FLOAT,!1,0,h.rA+h.FC*c)}a.of?(m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,a.of),m.drawElements(a.mode,a.count,a.yq,0)):m.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)h=b[d],
m.disableVertexAttribArray(h.zh)}function q(a){switch(a){case 0:return m.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return m.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return m.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return m.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return m.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return m.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function f(a){var b=a.ai,c=[],d=[],k={},m;for(m in b){var f=!1;switch(m){case "u_proj_matrix":var g=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.lb)},f=!0;break;case "u_view_matrix":g=
function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.Ta)};f=!0;break;case "u_view_tsr":case "u_view_tsr_frag":g=function(a,b,c,d,e,h){a.uniformMatrix3fv(b,!1,h.$d)};f=!0;break;case "u_shadow_cast_billboard_view_tsr":g=function(a,b,c,d,e,h){a.uniformMatrix3fv(b,!1,h.Qr)};f=!0;break;case "u_view_proj_prev":g=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.rF)};f=!0;break;case "u_view_proj_matrix":g=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.re)};f=!0;break;case "u_view_proj_inverse":g=function(a,b,
c,d,e,h){a.uniformMatrix4fv(b,!1,h.Zx)};f=!0;break;case "u_sky_vp_inverse":g=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.Me)};f=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,b,c,d,e,f){a.uniform3fv(b,h.Ri(f.h,x))};f=!0;break;case "u_camera_quat":g=function(a,b,c,d,e,f){a.uniform4fv(b,h.get_quat_view(f.h))};f=!0;break;case "u_view_max_depth":g=function(a,b,c,d,e,h){a.uniform1f(b,h.Cb)};f=!0;break;case "u_camera_range":g=function(a,b,c,d,e,h){a.uniform2f(b,h.Ra,h.Cb)};break;
case "u_csm_center_dists":g=function(a,b,c,d,e,h){a.uniform4fv(b,h.Zt)};break;case "u_cam_water_depth":g=function(a,b,c){a.uniform1f(b,c.lp)};f=!0;break;case "u_waves_height":g=function(a,b,c){a.uniform1f(b,c.Kg)};break;case "u_waves_length":g=function(a,b,c){a.uniform1f(b,c.mi)};break;case "u_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.yc)};break;case "u_fog_params":g=function(a,b,c){a.uniform4fv(b,c.Rm)};break;case "u_underwater_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.se)};
break;case "u_bloom_key":g=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":g=function(a,b,c){a.uniform1f(b,c.time)};f=!0;break;case "u_wind":g=function(a,b,c){a.uniform3fv(b,c.Ff)};f=!0;break;case "u_sky_tex_dvar":g=function(a,b,c){a.uniform1f(b,c.Vw)};break;case "u_sky_tex_fac":g=function(a,b,c){a.uniform4fv(b,c.Ww)};break;case "u_sky_tex_color":g=function(a,b,c){a.uniform3fv(b,c.Uw)};break;case "u_horizon_color":g=
function(a,b,c){a.uniform3fv(b,c.ag)};break;case "u_zenith_color":g=function(a,b,c){a.uniform3fv(b,c.Mg)};break;case "u_environment_energy":g=function(a,b,c){a.uniform1f(b,c.Yf)};break;case "u_sky_color":g=function(a,b,c){a.uniform3fv(b,c.yj)};break;case "u_rayleigh_brightness":g=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;
case "u_scatter_strength":g=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":g=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":g=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c){a.uniform1f(b,
c.mie_distribution)};break;case "u_light_positions":g=function(a,b,c){a.uniform3fv(b,c.nn)};break;case "u_light_directions":g=function(a,b,c){a.uniform3fv(b,c.Qq)};break;case "u_light_color_intensities":g=function(a,b,c){a.uniform3fv(b,c.mn)};break;case "u_light_factors":g=function(a,b,c){a.uniform4fv(b,c.Rq)};break;case "u_sun_quaternion":g=function(a,b,c){a.uniform4fv(b,c.nx)};break;case "u_sun_intensity":g=function(a,b,c){a.uniform3fv(b,c.mx)};break;case "u_sun_direction":g=function(a,b,c){a.uniform3fv(b,
c.gs)};break;case "u_height":g=function(a,b,c,d,e,h){a.uniform1f(b,h.height)};f=!0;break;case "u_model_tsr":g=function(a,b,c,d){a.uniformMatrix3fv(b,!1,d.h)};f=!0;break;case "u_transb":g=function(a,b,c,d){a.uniform4fv(b,d.Yc)};f=!0;break;case "u_transa":g=function(a,b,c,d){a.uniform4fv(b,d.Ed)};f=!0;break;case "u_arm_rel_trans":g=function(a,b,c,d){a.uniform4fv(b,d.So)};f=!0;break;case "u_arm_rel_quat":g=function(a,b,c,d){a.uniform4fv(b,d.Ro)};f=!0;break;case "u_quat":g=function(a,b,c,d){c=h.get_quat_view(d.h);
a.uniform4fv(b,c)};f=!0;break;case "u_quatsb":g=function(a,b,c,d){a.uniform4fv(b,d.Qc)};f=!0;break;case "u_quatsa":g=function(a,b,c,d){a.uniform4fv(b,d.wd)};f=!0;break;case "u_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Pd)};f=!0;break;case "au_center_pos":g=function(){};f=!0;break;case "au_wind_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.Te)};f=!0;break;case "au_wind_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.Gf)};f=!0;break;case "au_detail_bending_freq":g=function(a,b,c,d){a.uniform1f(b,
d.ff)};f=!0;break;case "au_detail_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.ef)};f=!0;break;case "au_branch_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.$e)};f=!0;break;case "u_node_values":g=function(a,b,c,d){a.uniform1fv(b,d.rf)};f=!0;break;case "u_node_rgbs":g=function(a,b,c,d){a.uniform3fv(b,d.sd)};f=!0;break;case "u_diffuse_color":g=function(a,b,c,d,e){a.uniform4fv(b,e.rc)};f=!0;break;case "u_diffuse_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.Vf)};f=!0;break;case "u_diffuse_params":g=
function(a,b,c,d,e){a.uniform2fv(b,e.kd)};f=!0;break;case "u_emit":g=function(a,b,c,d,e){a.uniform1f(b,e.gf)};f=!0;break;case "u_ambient":g=function(a,b,c,d,e){a.uniform1f(b,e.We)};f=!0;break;case "u_specular_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.Ne)};f=!0;break;case "u_specular_alpha":g=function(a,b,c,d,e){a.uniform1f(b,e.Yr)};f=!0;break;case "u_specular_params":g=function(a,b,c,d,e){a.uniform3fv(b,e.Wc)};f=!0;break;case "u_reflect_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.reflect_factor)};
f=!0;break;case "u_mirror_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.$q)};f=!0;break;case "u_grass_map_dim":g=function(a,b,c,d,e){a.uniform3fv(b,e.Kc)};f=!0;break;case "u_grass_size":g=function(a,b,c,d,e){a.uniform1f(b,e.rq)};f=!0;break;case "u_scale_threshold":g=function(a,b,c,d,e){a.uniform1f(b,e.Uu)};f=!0;break;case "u_cube_fog":g=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.hd)};break;case "u_jitter_amp":g=function(a,b,c,d,e){a.uniform1f(b,e.rv)};f=!0;break;case "u_jitter_freq":g=function(a,
b,c,d,e){a.uniform1f(b,e.sv)};f=!0;break;case "u_wireframe_mode":g=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":g=function(a,b,c){a.uniform2fv(b,c.bE)};f=!0;break;case "u_subsample_indices":g=function(a,b,c){a.uniform4fv(b,c.cE)};f=!0;break;case "u_refr_bump":g=function(a,b,c,d,e){a.uniform1f(b,e.Aw)};f=!0;break;case "u_line_width":g=function(a,b,c,d,e){a.uniform1f(b,
e.on)};f=!0;break;case "u_lamp_light_positions":g=function(a,b,c,d,e){a.uniform3fv(b,e.Mq)};break;case "u_lamp_light_directions":g=function(a,b,c,d,e){a.uniform3fv(b,e.Kq)};break;case "u_lamp_light_color_intensities":g=function(a,b,c,d,e){a.uniform3fv(b,e.Jq)};break;case "u_lamp_light_factors":g=function(a,b,c,d,e){a.uniform4fv(b,e.Lq)};break;case "u_halo_size":g=function(a,b,c,d,e){a.uniform1f(b,e.$u)};f=!0;break;case "u_halo_hardness":g=function(a,b,c,d,e){a.uniform1f(b,e.Xu)};f=!0;break;case "u_halo_rings_color":g=
function(a,b,c,d,e){a.uniform3fv(b,e.Zu)};f=!0;break;case "u_halo_lines_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.Yu)};f=!0;break;case "u_halo_stars_blend":g=function(a,b,c,d,e){a.uniform1f(b,e.av)};f=!0;break;case "u_halo_stars_height":g=function(a,b,c,d,e){a.uniform1f(b,e.bv)};f=!0;break;case "u_fresnel_params":g=function(a,b,c,d,e){a.uniform4fv(b,e.he)};f=!0;break;case "u_texture_scale":g=function(a,b,c,d,e){a.uniform3fv(b,e.Ag)};f=!0;break;case "u_parallax_scale":g=function(a,b,c,d,e){a.uniform1f(b,
e.parallax_scale)};f=!0;break;case "u_color_id":g=function(a,b,c,d){a.uniform3fv(b,d.wm)};f=!0;break;case "u_line_points":g=function(a,b,c,d,e){a.uniform3fv(b,e.zK)};f=!0;break;case "u_diffuse_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Uf)};f=!0;break;case "u_alpha_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Lf)};f=!0;break;case "u_specular_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Yh)};f=!0;break;case "u_normal_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Qv)};f=!0;break;case "u_normalmap0_scale":g=
function(a,b,c,d,e){a.uniform2fv(b,e.Hh[0])};f=!0;break;case "u_normalmap1_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Hh[1])};f=!0;break;case "u_normalmap2_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Hh[2])};f=!0;break;case "u_normalmap3_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Hh[3])};f=!0;break;case "u_foam_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};f=!0;break;case "u_foam_uv_freq":g=function(a,b,c,d,e){a.uniform2fv(b,e.vu)};f=!0;break;case "u_foam_mag":g=function(a,b,
c,d,e){a.uniform2fv(b,e.uu)};f=!0;break;case "u_foam_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.cq)};f=!0;break;case "u_water_norm_uv_velocity":g=function(a,b,c,d,e){a.uniform1f(b,e.Tj)};f=!0;break;case "u_shallow_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};f=!0;break;case "u_shore_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};f=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};f=!0;break;case "u_water_shore_col_fac":g=
function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};f=!0;break;case "u_p_length":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.ux)};f=!0;break;case "u_p_cyclic":g=function(a,b,c,d,e){a.uniform1i(b,e.Da.cyclic)};f=!0;break;case "u_p_max_lifetime":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.yv)};f=!0;break;case "u_p_fade_in":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.lh)};f=!0;break;case "u_p_fade_out":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.md)};f=!0;break;case "u_p_size":g=function(a,b,c,d,e){a.uniform1f(b,
e.Da.size)};f=!0;break;case "u_p_alpha_start":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.it)};f=!0;break;case "u_p_alpha_end":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.ht)};f=!0;break;case "u_p_nfactor":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.er)};f=!0;break;case "u_p_gravity":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.Vu)};f=!0;break;case "u_p_mass":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.Ge)};f=!0;break;case "u_p_size_ramp":g=function(a,b,c,d,e){a.uniform2fv(b,e.Da.Rw)};f=!0;break;case "u_p_color_ramp":g=
function(a,b,c,d,e){a.uniform4fv(b,e.Da.Pt)};f=!0;break;case "u_p_wind_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.ey)};f=!0;break;case "u_texel_size":g=function(a,b,c){a.uniform2fv(b,c.ps)};f=!0;break;case "u_p_time":g=function(a,b,c,d,e){a.uniform1f(b,e.Da.time)};f=!0;break;case "u_position":g=function(a,b,c,d,e){a.uniform3fv(b,e.rj)};f=!0;break;case "u_va_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Nx)};f=!0;break;case "u_normal_offset":g=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};
break;case "u_pcf_blur_radii":g=function(a,b,c,d,e,h){a.uniform4fv(b,h.Fn)};break;case "u_v_light_ts":g=function(a,b,c){a.uniform4fv(b,c.vo)};f=!0;break;case "u_v_light_r":g=function(a,b,c){a.uniform4fv(b,c.uo)};f=!0;break;case "u_v_light_tsr":g=function(a,b,c){a.uniformMatrix3fv(b,!1,c.Cs)};f=!0;break;case "u_p_light_matrix0":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Mh[0])};f=!0;break;case "u_p_light_matrix1":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Mh[1])};f=!0;break;case "u_p_light_matrix2":g=
function(a,b,c){a.uniformMatrix4fv(b,!1,c.Mh[2])};f=!0;break;case "u_p_light_matrix3":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Mh[3])};f=!0;break;case "u_motion_blur_exp":g=function(a,b,c){a.uniform1f(b,c.Kv)};f=!0;break;case "u_motion_blur_decay_threshold":g=function(a,b,c){a.uniform1f(b,c.mb_decay_threshold)};f=!0;break;case "u_refl_plane":g=function(a,b,c,d){a.uniform4fv(b,d.cc)};f=!0;break;case "u_radial_blur_step":g=function(a,b,c){a.uniform1f(b,c.Mn)};break;case "u_god_rays_intensity":g=
function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=function(a,b,c){a.uniform1f(b,c.Cj)};break;case "u_ssao_blur_discard_value":g=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};f=!0;break;case "u_ssao_influence":g=function(a,b,c){a.uniform1f(b,c.Bj)};break;case "u_ssao_dist_factor":g=function(a,b,c){a.uniform1f(b,c.Aj)};break;case "u_dof_dist":g=function(a,b,c,d,e,h){h.dof_on?a.uniform1f(b,h.dof_distance):a.uniform1f(b,0)};f=!0;break;case "u_dof_front":g=
function(a,b,c,d,e,h){a.uniform1f(b,h.dof_front)};f=!0;break;case "u_dof_rear":g=function(a,b,c,d,e,h){a.uniform1f(b,h.dof_rear)};f=!0;break;case "u_outline_intensity":g=function(a,b,c,d){a.uniform1f(b,d.lg)};f=!0;break;case "u_outline_color":g=function(a,b,c){a.uniform3fv(b,c.uf)};break;case "u_draw_outline":g=function(a,b,c){a.uniform1f(b,c.Tp)};f=!0;break;case "u_glow_mask_small_coeff":g=function(a,b,c){a.uniform1f(b,c.small_glow_mask_coeff)};f=!0;break;case "u_glow_mask_large_coeff":g=function(a,
b,c){a.uniform1f(b,c.large_glow_mask_coeff)};f=!0;break;case "u_brightness":g=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":g=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c){a.uniform1f(b,c.saturation)};break;case "u_enable_hmd_stereo":g=function(a,b,c){a.uniform1i(b,c.enable_hmd_stereo)};break;case "u_distortion_params":g=function(a,b,c){a.uniform4fv(b,c.Bi)};break;case "u_chromatic_aberration_coefs":g=
function(a,b,c){a.uniform4fv(b,c.chromatic_aberration_coefs)};break;default:g=null}g&&(g={name:m,hq:g,zh:b[m]},f?c.push(g):(d.push(g),k[m]=g))}a.zx=c;a.kl=d;a.mr=k}var t=p("__batch"),l=p("__camera"),n=p("__config"),g=p("__debug"),z=p("__textures"),h=p("__tsr"),k=p("__util"),u=[1,1,1,1],w=[1,1,1,1],C=[0,0,0,1],E=[0,0,0,0],G=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var m=null,x=new Float32Array(3),
A=new Uint8Array(4);new Float32Array(9);new Float32Array(8);var r=n.p;a.Ad=function(a){var b=r.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);m=a};a.Di=function(a){if(a.Ib)if("RESOLVE"==a.type){g.yr(a);var c=a.j;m.bindFramebuffer(m.READ_FRAMEBUFFER,c.fq);m.bindFramebuffer(m.DRAW_FRAMEBUFFER,c.ge);m.blitFramebuffer(0,
0,c.width,c.height,0,0,c.width,c.height,m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT,m.NEAREST);g.zr(a);g.pp("draw resolve")}else if("COPY"==a.type)g.yr(a),c=a.j,m.bindFramebuffer(m.FRAMEBUFFER,c.fq),m.bindTexture(m.TEXTURE_2D,c.Hb.Na),m.copyTexSubImage2D(m.TEXTURE_2D,0,0,0,0,0,c.width,c.height,0),g.zr(a),g.pp("draw copy");else{g.yr(a);c=a.j;m.bindFramebuffer(m.FRAMEBUFFER,c.ge);if(a.Uo){var k=c.Hb;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,k.Fb,k.Na,0)}m.viewport(0,0,c.width,c.height);"MAIN_CUBE_REFLECT"!=
a.type&&b(a);a.Za?m.enable(m.BLEND):m.disable(m.BLEND);a.pc?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST);if(a.sa){for(var c=a.j,k=a.q,u=0;u<k.length;u++){var n=k[u],x=n.G,t=x.dc;m.useProgram(t.Ph);n=n.ke;t.kl.length||f(t);for(var t=t.kl,A=t.length;A--;){var y=t[A];y.hq(m,y.zh,a,n,x,c)}}a.sa=!1}switch(a.type){case "DEPTH":r.iv?(m.enable(m.POLYGON_OFFSET_FILL),m.polygonOffset(5,5)):m.disable(m.POLYGON_OFFSET_FILL);m.cullFace(m.BACK);break;case "SHADOW_CAST":m.enable(m.POLYGON_OFFSET_FILL);m.polygonOffset(a.self_shadow_polygon_offset,
a.self_shadow_polygon_offset);m.cullFace(m.BACK);break;case "MAIN_PLANE_REFLECT":m.disable(m.POLYGON_OFFSET_FILL);m.cullFace(m.FRONT);break;case "MAIN_GLOW":if(1<r.Ac){m.enable(m.POLYGON_OFFSET_FILL);m.polygonOffset(-2,-2);break}default:m.disable(m.POLYGON_OFFSET_FILL),m.cullFace(m.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(c=a.j,k=c.Hb.Na,u=0;6>u;u++){x=q(u);c.Ta=a.yk[u];h.from_mat4(c.Ta,c.$d);l.tm(c);m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,x,k,0);b(a);x=a.q;for(n=0;n<x.length;n++)x[n].Ib=
x[n].Sp[u];d(a)}else d(a);g.zr(a);g.pp("draw subscene: "+a.type);m.bindFramebuffer(m.FRAMEBUFFER,null)}};a.clear=function(a){m.bindFramebuffer(m.FRAMEBUFFER,a.j.ge);b(a)};a.To=function(a){var b=a.jm;b.length=0;var c=a.O;a=a.dc;c&&a||k.W("Incomplete batch");c=c.Eb;a=a.attributes;for(var d in a){var h=c[d];b.push({zh:a[d],rA:4*h.offset,FC:1<h.frames?4*h.length:0,Ud:h.Ud})}};a.pA=f;a.nt=function(a){var b=a.dc,c=a.U;a=a.ic;m.useProgram(b.Ph);for(var d=0;d<c.length;d++)m.uniform1i(b.ai[a[d]],d)};a.xw=
function(a,b,c,d,h,f){d||(d=1);h||(h=1);f||(f=new Uint8Array(4*d*h));f.length!=4*d*h&&k.W("read_pixels(): Wrong storage");m.bindFramebuffer(m.FRAMEBUFFER,a);m.readPixels(b,c,d,h,m.RGBA,m.UNSIGNED_BYTE,f);m.bindFramebuffer(m.FRAMEBUFFER,null);return f};a.gH=function(a){var b=a.dc;m.useProgram(b.Ph);b.kl.length||f(b);b=b.mr.u_cube_fog;b.hq(m,b.zh,null,null,a,null)};a.CF=function(a,b){var c=m.createFramebuffer();m.bindFramebuffer(m.FRAMEBUFFER,c);if(z.Xi(a)){var d=a.Gd;m.framebufferRenderbuffer(m.FRAMEBUFFER,
m.COLOR_ATTACHMENT0,m.RENDERBUFFER,d)}else if(z.Zi(a)){var h=a,d=h.Na,h=h.Fb==m.TEXTURE_CUBE_MAP?m.TEXTURE_CUBE_MAP_NEGATIVE_Z:h.Fb;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,h,d,0)}z.Xi(b)?(d=b.Gd,m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,d)):z.Zi(b)&&(h=b,d=h.Na,h=h.Fb,m.framebufferTexture2D(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,h,d,0));g.OA();m.bindFramebuffer(m.FRAMEBUFFER,null);return c};a.BF=function(a,b,c,d,h){null==a?(m.bindFramebuffer(m.FRAMEBUFFER,
a),m.viewport(0,0,d,h),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT)):(z.Xi(b)?m.deleteRenderbuffer(b.Gd):z.Zi(b)&&m.deleteTexture(b.Na),z.Xi(c)?m.deleteRenderbuffer(c.Gd):z.Zi(c)&&m.deleteTexture(c.Na),m.deleteFramebuffer(a))};a.jK=function(){};a.gC=function(a,b,d,h,f,k){a=a.Na;m.viewport(0,0,d,d);m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,b,a,0);b=t.Dp("FLIP_CUBEMAP_COORDS");a=b.dc;m.activeTexture(m.TEXTURE0);m.bindTexture(m.TEXTURE_2D,f);var g=f=0;d!=h&&(f=1/(6*h),g=1/(4*h));m.uniform1i(a.ai.u_tex_number,
k);m.uniform2fv(a.ai.u_delta,[f,g]);m.useProgram(a.Ph);c(b.O,b.jm,0);m.bindTexture(m.TEXTURE_2D,null)};a.hC=function(a,b,d,h,f){m.bindFramebuffer(m.FRAMEBUFFER,h);h=a.Na;a=a.Fb;m.bindTexture(a,h);m.viewport(0,0,b,d);m.texImage2D(a,0,m.RGBA,b,d,0,m.RGBA,m.UNSIGNED_BYTE,null);m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,a,h,0);b=t.Dp("NONE");d=b.dc;m.bindTexture(a,null);m.activeTexture(m.TEXTURE0);m.bindTexture(a,f);m.useProgram(d.Ph);c(b.O,b.jm,0);m.bindFramebuffer(m.FRAMEBUFFER,null);
m.bindTexture(a,null)};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function d(a,c,d){var e=a.Wf;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.Wf,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function c(a,b){var c=a+b;if(G[c])return G[c];if(m){var d=m[b];if(!d)return null;d=p("__gpp_parser").JK.parse(d)}else if(d=p("shader_texts")[b],!d)return null;return G[c]=d}function q(a,b,d){function e(b){b=b.a;for(var d=0;d<b.length;d++){var r=
b[d];switch(r.type){case "condition":a:for(var r=r.a,t=0;t<r.length;t++){var D=r[t];switch(D.type){case "if":case "elif":if(h(D.c)){e(D.group);break a}break;case "else":e(D.group);break a;case "ifdef":D.name in l&&e(D.group);break;case "ifndef":D.name in l||e(D.group)}}break;case "include":r=c(C.shaders_dir,C.nG+r.file);e(r);break;case "var":case "export":case "import":break;case "define":t=r.name;l[t]=r.b;r.R&&(q[t]=r.R);break;case "error":throw"Shader error: #error "+r.b.join(" ");case "line":break;
case "pragma":g.push("#pragma "+r.name+" "+r.b.join(" "));break;case "undef":r=r.name;delete l[r];delete q[r];break;case "warning":u.warn("Shader warning: #warning "+r.b.join(" "));break;case "extension":r=f(r.b,l,q,!1);g.push("#extension "+r.join(" "));break;case "#":break;case "node":n[r.name]=r;break;case "nodes_global":r=m;for(t=0;t<r.length;t++){var D=r[t],w=n[D.id];if(w)for(var z=0,G=0;G<w.i.length;G++){var N=w.i[G];"node_param"==N.type&&(N=N.qualifier.join(" ")+" ","vert"==a?N+=D.Hg[z]:"frag"==
a&&(N+=D.R[z],null!==D.Cn[z]&&(N+=" = "+D.Cn[z])),N+=";",g.push(N),z++)}}break;case "nodes_main":r=m;for(t=0;t<r.length;t++)if(D=r[t],w=n[D.id]){z={};G={};for(N=0;N<D.Md.length;N++)G[D.Md[N][0]]=[D.Md[N][1]];p=A=B=0;for(var N=D,aa=w.i,X=z,Q=G,M=0;M<aa.length;M++){var E=aa[M];switch(E.type){case "node_in":var J=N.H[B];if(null!==N.Dq[B]){if(("MATERIAL_BEGIN"==N.id&&3===B||!Q.MATERIAL_EXT&&("MATERIAL_BEGIN"==N.id&&4===B||"MATERIAL_END"==N.id&&3===B||"MATERIAL_END"==N.id&&4===B||"MATERIAL_END"==N.id&&
5===B)||"TEXTURE_COLOR"==N.id||"TEXTURE_NORMAL"==N.id)&&E.e){X[E.name]=N.Dq[B];B++;continue}var ga=E.qualifier.join(" ")+" ",ga=ga+J,ga=ga+(" = "+N.Dq[B]),ga=ga+";";g.push(ga)}X[E.name]=J;B++;break;case "node_out":J=N.ya[A];if(!E.e||-1<x.indexOf(J))ga=E.qualifier.join(" ")+" ",ga+=J,ga+=";",g.push(ga),X[E.name]=J;-1<x.indexOf(J)&&(Q["USE_OUT_"+E.name]=[1]);A++;break;case "node_param":"vert"==a?J=N.Hg[p]:"frag"==a&&(J=N.R[p]),X[E.name]=J,p++}}g.push("{");k(D,w.g,z,G);g.push("}")}break;case "textline":r=
f(r.b,l,q,!1);g.push(r.join(" "));break;default:throw"Unknown element type: "+r.type;}}}function h(a,b){var c;c=f(a,l,q,!0,b);for(var d=[],e=0;e<c.length;e++)if(c[e]instanceof Object)switch(c[e].type){case "conditional_expr":var k=d.pop(),m=d.pop();d.pop()?d.push(m):d.push(k);break;case "logical_or_expr":k=d.pop();for(m=0;m<c[e].d-1;m++)g=d.pop(),k=k||g;d.push(k);break;case "logical_and_expr":k=d.pop();for(m=0;m<c[e].d-1;m++)g=d.pop(),k=k&&g;d.push(k);break;case "logical_bitor_expr":k=d.pop();for(m=
0;m<c[e].d-1;m++)k|=d.pop();d.push(k);break;case "logical_bitxor_expr":k=d.pop();for(m=0;m<c[e].d-1;m++)k^=d.pop();d.push(k);break;case "logical_bitand_expr":k=d.pop();for(m=0;m<c[e].d-1;m++)k&=d.pop();d.push(k);break;case "equal_expr":k=d.pop();m=d.pop();d.push(m==k);break;case "non_equal_expr":k=d.pop();m=d.pop();d.push(m!=k);break;case "le_expr":k=d.pop();m=d.pop();d.push(m<=k);break;case "ge_expr":k=d.pop();m=d.pop();d.push(m>=k);break;case "l_expr":k=d.pop();m=d.pop();d.push(m<k);break;case "g_expr":k=
d.pop();m=d.pop();d.push(m>k);break;case "left_shift_expr":m=d.pop();k=d.pop();d.push(m<<k);break;case "right_shift_expr":m=d.pop();k=d.pop();d.push(m>>k);break;case "add_expr":m=d.pop();k=d.pop();d.push(m+k);break;case "sub_expr":m=d.pop();k=d.pop();d.push(m-k);break;case "mul_expr":m=d.pop();k=d.pop();d.push(m*k);break;case "div_expr":m=d.pop();k=d.pop();d.push(m/k);break;case "mod_expr":m=d.pop();k=d.pop();d.push(m%k);break;case "pre_inc_expr":case "post_inc_expr":g=d.pop();d.push(++g);break;case "pre_dec_expr":case "post_dec_expr":g=
d.pop();d.push(--g);break;case "positive_expr":g=d.pop();d.push(+g);break;case "negative_expr":g=d.pop();d.push(-g);break;case "one_compl_expr":g=d.pop();d.push(~g);break;case "logic_negative_expr":g=d.pop();d.push(!g);break;default:w.W("Unknown operation type: "+c[e].type)}else{var g=c[e];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(g)?d.push(0):d.push(parseFloat(c[e]))}1==d.length?c=d[0]:(w.W("Incorrect expression: "+c.join(" ")),c=void 0);return c}function k(a,b,c,d){for(var e=0;e<b.length;e++){var m=b[e];
switch(m.type){case "node_condition":a:for(var r=a,m=m.a,B=c,v=d,u=0;u<m.length;u++){var n=m[u];switch(n.type){case "node_if":case "node_elif":if(h(n.c,v)){k(r,n.g,B,v);break a}break;case "node_else":k(r,n.g,B,v);break a;case "node_ifdef":(n.name in l||n.name in v)&&k(r,n.g,B,v);break;case "node_ifndef":n.name in l||n.name in v||k(r,n.g,B,v)}}break;case "textline":r=[];for(B=0;B<m.b.length;B++)v=m.b[B],v in c?r.push(c[v]):r.push(v);r=f(r,l,q,!0,d);g.push(r.join(" "))}}}var m=d.ig;d=d.Wf||[];for(var g=
[],l={},r=0;r<d.length;r++)l[d[r][0]]=[d[r][1]];for(r=0;r<m.length;r++)l["USE_NODE_"+m[r].id]=[1];var q={},n={},x=[];for(r in m)for(var t in m[r].H)x.push(m[r].H[t]);e(b);var B=0,A=0,p=0;return g.join("\n")}function f(a,b,c,d,e){var h=[];t(a,b,c,d,h,e);return h}function t(a,b,c,d,e,h){for(var k=0;k<a.length;k++){var f=a[k];f in b||h&&f in h?(f=h&&h[f]||b[f],0==f.length&&d?e.push(0):t(f,b,c,d,e,h)):e.push(f)}}function l(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);k.UA(d,b,c);
return d}function n(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return g(a);case 2:return"vec2("+g(a[0])+","+g(a[1])+")";case 3:return"vec3("+g(a[0])+","+g(a[1])+","+g(a[2])+")";case 4:return"vec4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+")";case 9:return"mat3("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+")";case 16:return"mat4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+
","+g(a[8])+","+g(a[9])+","+g(a[10])+","+g(a[11])+","+g(a[12])+","+g(a[13])+","+g(a[14])+","+g(a[15])+")";default:throw"Wrong glsl value dimension";}}function g(a){return a%1?String(a):String(a)+".0"}var z=p("__assets"),h=p("__config"),k=p("__debug"),u=p("__print"),w=p("__util"),C=h.Bc,E={},G={},m=null,x="anchors.glslf anchors.glslv color_id.glslf color_id.glslv depth.glslf depth.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv line.glslf line.glslv main.glslf main.glslv main_stack.glslf particles_color.glslf particles_color.glslv particles_texture.glslf particles_texture.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/performance.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf postprocessing/stereo.glslf include/blending.glslf include/caustics.glslf include/color_util.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/fxaa.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
A=[],r=null,e=!1;a.Ad=function(a){r=a};a.K=d;a.nD=b;a.tK=function(a,b){for(var c=a.Wf,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.SF=function(a){a.Wf=[];for(var b="ALPHA ALPHA_CLIP ANAGLYPH BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_DISTORTION_CORRECTION DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_FOG WEBGL2 WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS NUM_CAST_LAMPS SUN_NUM MAC_OS_SHADOW_HACK".split(" "),
c=0;c<b.length;c++){var e=b[c],k;switch(e){case "ALPHA":case "ALPHA_CLIP":case "ANAGLYPH":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_DISTORTION_CORRECTION":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_FOG":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":case "NUM_CAST_LAMPS":case "SUN_NUM":case "MAC_OS_SHADOW_HACK":k=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":k=1;break;case "WEBGL2":k=h.p.Ec|0;break;case "EPSILON":k="highp"==h.p.precision?1E-6:1E-4;break;case "SHADOW_TEX_RES":k=n(2048);break;case "AA_METHOD":k="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":k="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":k="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":k=
"POST_EFFECT_NONE";break;case "SHADOW_USAGE":k="NO_SHADOWS";break;case "SSAO_QUALITY":k="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":k="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":k="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":k=h.p.precision;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":k="u_va_frame_factor";break;default:u.error("Unknown directive ("+a.Rj+", "+a.Ji+"): "+e)}d(a,e,k)}};a.cK=function(a){return a.Rj};a.WJ=function(a){return a.Ji};a.kK=function(a,c){for(var e=c.Wf,h=0;h<
e.length;h++){var k=e[h][0],f=e[h][1];b(a,k)&&d(a,k,f)}};a.jD=function(a){var b=JSON.stringify(a),d=E[b];if(d)return d;var e=a.Ji,d=c(C.shaders_dir,a.Rj),e=c(C.shaders_dir,e);if(!d||!e)return null;var h=q("vert",d,a),f=q("frag",e,a),d=r,m=l(d,b,h,d.VERTEX_SHADER),g=l(d,b,f,d.FRAGMENT_SHADER),e=d.createProgram();d.attachShader(e,m);d.attachShader(e,g);d.linkProgram(e);d.validateProgram(e);d.getProgramParameter(e,d.VALIDATE_STATUS)==d.EI&&u.error("shader program is not valid",b);k.VA(e,b,m,g,h,f);a=
{Gs:m,yu:g,Ph:e,attributes:{},ai:{},kl:[],mr:{},zx:[],wb:a};f=d.getProgramParameter(e,d.ACTIVE_ATTRIBUTES);for(h=0;h<f;h++)m=d.getActiveAttrib(e,h).name,a.attributes[m]=d.getAttribLocation(e,m);f=d.getProgramParameter(e,d.ACTIVE_UNIFORMS);for(h=0;h<f;h++)m=d.getActiveUniform(e,h).name.split("[0]").join(""),a.ai[m]=d.getUniformLocation(e,m);return E[b]=d=a};a.wE=function(){e=!1;if(b4w.module_check("shader_texts"))e=!0;else{for(var a=[],b=z.AT_TEXT,c=0;c<x.length;c++){var d=w.bl(C.shaders_dir+x[c]);
a.push({id:x[c],type:b,url:d})}b=function(a,b){m||(m={});m[b]=a};a.length?z.enqueue(a,b,function(){e=!0}):u.error("Shaders have not been found.")}};a.WA=function(){return e};a.wJ=function(){return A};a.Iu=function(){return E};a.cleanup=function(){for(var a in E){var b=E[a];r.deleteProgram(b.Ph);r.deleteShader(b.Gs);r.deleteShader(b.yu);delete E[a]}for(var c in G)delete G[c];for(var d in A)delete A[d]};a.xJ=function(a){var b=a.Wf;u.log("Shader: "+a.Rj+" "+a.Ji+", "+String(b.length)+" directives: ");
for(a=0;a<b.length;a++)u.log("  "+b[a][0],b[a][1])};a.t=n;a.Kt=function(a,b){return b in a.ai?!0:!1};a.CD=function(a){return(r.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function d(a,b){for(var c=1;c<a.na.length;c++){for(var d=a.na[c].zc,e=d.a_position,h=d.a_normal,k=b.a_position,f=b.a_normal,m=e.length,g=a.na[c].en,r=0;r<m;r++)k[r]+=g*e[r],f[r]+=g*h[r];d=d.a_tangent;e=b.a_tangent;h=d.length;for(r=0;r<h;r++)e[r]+=g*d[r]}}function b(a){return 65536<a.ea?r.Ku()?!1:!0:!1}function c(a){return 0<a.Ca.length?!0:!1}function q(a,b,d){if(!c(a))return a;d||e.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.ea*(b||
1)+", will use drawArrays","color: #aa0");b=a.Ca;d=a.ea;var h=a.X,k=a.B,m;for(m in h){var g=h[m],r=w(g,d);h[m]=f(b,g,r)}for(h=0;h<k.length;h++){var l=k[h];for(m in l)g=l[m],r=w(g,d),l[m]=f(b,g,r)}for(h=0;h<a.na.length;h++){m=a.na[h].zc;for(var q in m)g=m[q],r=w(g,d),m[q]=f(b,g,r)}a.ea=b.length;a.Ca=new Uint16Array(0);return a}function f(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var h=a[e],k=0;k<c;k++)d[c*e+k]=b[c*h+k];return d}function t(a,
b){var c=a.xc,d=a.Eb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function l(b,c){var d,e;switch(c){case a.Vj:case a.Vl:d=K.TRIANGLES;e=K.STATIC_DRAW;break;case a.Ps:d=K.POINTS;e=K.STATIC_DRAW;break;case a.Ul:d=K.TRIANGLES;e=K.DYNAMIC_DRAW;break;case a.Os:d=K.POINTS;e=K.DYNAMIC_DRAW;break;case a.my:d=K.LINES;e=K.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.Il=e}function n(a){a.bg?(a.of||(a.of=K.createBuffer()),K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,
a.of),K.bufferData(K.ELEMENT_ARRAY_BUFFER,a.bg,a.Il),a.Em=a.bg.byteLength):a.Em=0;a.Fg||(a.Fg=K.createBuffer());K.bindBuffer(K.ARRAY_BUFFER,a.Fg);K.bufferData(K.ARRAY_BUFFER,a.xc,a.Il);a.du=a.xc.byteLength}function g(a){for(var b=J.Vb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].Ca.length;b.Ca=new Uint32Array(c);var e=c=0,h=0;if(0<a[0].na.length)for(var k=0;k<a[0].na.length;k++){for(d=0;d<a.length;d++)c+=a[d].na[k].zc.a_position.length,e+=a[d].na[k].zc.a_normal.length,h+=a[d].na[k].zc.a_tangent.length;
d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(h)};b.na.push({en:a[0].na[k].en,zc:d})}for(d=c=0;d<a.length;d++)c+=a[d].ea;b.ea=c;var e=a[0],f;for(f in e.X){for(d=c=0;d<a.length;d++)c+=a[d].X[f].length;b.X[f]=new Float32Array(c)}for(f in e.B[0]){for(d=c=0;d<a.length;d++)c+=a[d].B[0][f].length;for(d=0;d<e.B.length;d++)b.B[d]=b.B[d]||{},b.B[d][f]=new Float32Array(c)}for(f=e=c=0;f<a.length;f++){for(var h=a[f],m=h.Ca,k=h.ea,g=h.X,d=0;d<m.length;d++)b.Ca[c+d]=
m[d]+e;var c=c+m.length,r;for(r in g){var m=g[r],l=e*w(m,k);b.X[r].set(m,l)}for(d=0;d<h.B.length;d++){var g=h.B[d],q=b.B[d];for(r in g)m=g[r],l=e*w(m,k),q[r].set(m,l)}e+=k}if(0<b.na.length)for(f=0;f<b.na.length;f++)for(r=b.na[f].zc,d=h=e=c=0;d<a.length;d++)k=a[d].na[f].zc,r.a_position.set(k.a_position,c),r.a_normal.set(k.a_normal,e),r.a_tangent.set(k.a_tangent,h),c+=k.a_position.length,e+=k.a_normal.length,h+=k.a_tangent.length;return b}function z(a,b,c,d,f,g){var r=J.Vb("SUBMESH_"+a.name+"_"+b),
l=a.submeshes[b],n=l.base_length,x=a.materials[b];r.ea=n;var t=!1;if(k(c,"a_texcoord")){var v=null,A=a.materials[b];b=a.submeshes[b];if(A.texture_slots.length)switch(A=A.texture_slots[0],A.texture_coords){case "UV":A=a.uv_textures.indexOf(A.uv_layer);0==A?v=new Float32Array(b.texcoord):1==A&&(v=new Float32Array(b.texcoord2));break;case "ORCO":for(var D=a.b4w_bounding_box_source,v=new Float32Array(2*b.base_length),A=(D.max_x+D.min_x)/2,w=(D.max_z+D.min_z)/2,p=D.max_x-D.min_x,D=D.max_z-D.min_z,z=0,
H=0;H<b.position.length;H+=3)v[z++]=(b.position[H]-A)/p+.5,v[z++]=(w-b.position[H+2])/D+.5}null===v&&(v=new Float32Array(2*b.base_length));b=v}else b=new Float32Array(0);if(k(c,"a_orco_tex_coord")){v=a.b4w_bounding_box_source;A=new Float32Array(3*l.base_length);w=v.max_x-v.min_x;p=v.max_y-v.min_y;D=v.max_z-v.min_z;for(H=z=0;H<l.position.length;H+=3)0==w?A[z++]=.5:A[z++]=J.clamp(parseFloat(((l.position[H]-v.min_x)/w).toFixed(5)),0,1),0==D?A[z++]=.5:A[z++]=J.clamp(parseFloat(((v.max_z-l.position[H+
2])/D).toFixed(5)),0,1),0==p?A[z++]=.5:A[z++]=J.clamp(parseFloat(((l.position[H+1]-v.min_y)/p).toFixed(5)),0,1);v=A}else v=new Float32Array(0);var N,A=l.group;if(k(c,"a_influence")&&d){w=new Float32Array(4*n);p=A.length/n;D=new Float32Array(p);for(z=0;z<p;z++)for(N in D[z]=-1,d)if(H=d[N],H.Tx===z){D[z]=H.Np;break}var aa=3<p?p:4;d=new Float32Array(aa);N=new Uint32Array(aa);for(var z=new Float32Array(4),H=new Float32Array(aa),aa=new Uint32Array(aa),X=new Float32Array(4),Q=0;Q<n;Q++)d.set(H),N.set(aa),
z.set(X),w.set(u(A,p,Q,n,D,d,N,z),4*Q)}else w=new Float32Array(0);N=w;d=f?J.xa(f):{};d.a_color={ph:!0};d.a_color.src=k(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Sd:7}]:[];f={a_texcoord:b,a_influence:N,a_orco_tex_coord:v};N=l.vertex_colors;b=l.color;v=a.name;A=[];for(w=0;w<N.length;w++)A.push(N[w].name);for(var I in d)if(w=d[I].src,w.length){for(D=p=0;D<w.length;D++)p+=J.Th(w[D].Sd);f[I]=new Float32Array(p*n);for(D=z=0;D<w.length;D++){var C=w[D].name,H=w[D].Sd,aa=J.Ew(H),G=A.indexOf(C);
-1==G&&J.W('vertex color "'+C+'" for mesh "'+v+'" not found.');X=N[G].mask;Q=J.Th(X);(H&X)!==H&&e.error("Wrong color extraction from "+C+" to "+I+".");for(var ga=C=0;ga<G;ga++)C+=J.Th(N[ga].mask);G=C*n;for(C=0;C<n;C++)for(ga=0;3>ga;ga++)aa[ga]&&(f[I][C*p+(z+J.rl(H,ga))]=b[G+C*Q+J.rl(X,ga)]);z+=Q}}else f[I]=new Float32Array(0);I=a.uv_textures;d=l.texcoord;N=l.texcoord2;if(g)for(var E in g){b=I.indexOf(E);if(0==b)var Aa=new Float32Array(d);else 1==b&&(Aa=new Float32Array(N));f[g[E]]=Aa}r.X=f;r.Ca=new Uint32Array(l.indices);
g=l.position.length/n/3;Aa=(E=k(c,"a_normal")&&l.normal.length?!0:!1)&&k(c,"a_tangent")&&l.tangent.length?!0:!1;I=x.texture_slots[0];I=E&&x.texture_slots.length&&k(c,"a_tangent")&&"ORCO"==I.texture_coords&&I.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&(t=!0);for(f=0;f<g;f++){x=h(l,c,n,E,Aa,I,f,a.name);if(t)if(d={},d.name=a.b4w_shape_keys[f].name,r.na.push(d),0!=f){d.zc=x;d.en=a.b4w_shape_keys[f].value;continue}else d.zc=h(l,c,n,E,Aa,I,f,a.name),d.en=1;r.B.push(x)}if(1<g&&!t){a=r.B[0];var x={},
K;for(K in a)x[K]=new Float32Array(a[K]);r.B.push(x)}k(c,"a_polyindex")&&(q(r,1,!0),r.X.a_polyindex=m(r));return r}function h(a,b,c,d,h,f,m,g){var r={},l=new Float32Array(3*c),n=new Float32Array(d?3*c:0),q=new Float32Array(h||f?4*c:0),u=m*c*3;l.set(a.position.subarray(u,u+3*c),0);d&&(u=m*c*3,n.set(a.normal.subarray(u,u+3*c),0));if(h)u=m*c*4,q.set(a.tangent.subarray(u,u+4*c),0);else if(f)for(a=q,e.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+
g+'". Please add a UV-map.'),g=0;g<c;g++)b=H,d=I,b[0]=n[3*g],b[1]=n[3*g+1],b[2]=n[3*g+2],D.cross(b,J.AXIS_Z,d),0==D.length(d)&&D.cross(b,J.AXIS_X,d),D.normalize(d,d),a[4*g]=d[0],a[4*g+1]=d[1],a[4*g+2]=d[2],a[4*g+3]=1;else if(d&&k(b,"a_tangent"))for(q=new Float32Array(4*c),c=0;c<q.length;c++)q[c]=1;r.a_position=l;r.a_normal=n;r.a_tangent=q;return r}function k(a,b){return-1<a.indexOf(b)?!0:!1}function u(b,c,d,e,h,k,f,m){for(var g=!0,r=0;r<c;r++){var l=b[r*e+d];if(-1!==l){var n=h[r];-1!==n&&(k[r]=l,
f[r]=n,g=!1)}}if(g)return m;C(k,f,a.Io,!1);for(r=b=0;4>r;r++)b+=k[r];if(.01>b)return m;for(r=0;4>r;r++)k[r]/=b;if(.01>Math.abs(k[0]-1))m[0]=f[0]+1;else for(r=0;4>r;r++)m[r]=f[r]+k[r];return m}function w(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function C(b,c,d,e){for(var h=b.length,k=h,f=!1,m=e?-1:1;1<k||f;){1<k&&(k=Math.floor(k/1.247330950103979));for(var f=!1,g=0;k+g<h;g++)if(d==
a.Io?0>m*(b[g]-b[g+k]):b[g]<b[g+k]&&e)f=b[g],b[g]=b[g+k],b[g+k]=f,f=c[g],c[g]=c[g+k],c[g+k]=f,f=!0}}function E(a,b,c){var d=[],e=[];D.subtract(b,a,d);D.subtract(c,a,e);D.normalize(d,d);D.normalize(e,e);return Math.acos(D.dot(d,e))}function G(a,b,d){b||(b=[]);d=d?a.B[0].a_normal:a.B[0].a_position;if(c(a)){a=a.Ca;for(var e=a.length/3,h=0;h<e;h++){var k=new Float32Array(9),f=a[3*h];k[0]=d[3*f];k[1]=d[3*f+1];k[2]=d[3*f+2];f=a[3*h+1];k[3]=d[3*f];k[4]=d[3*f+1];k[5]=d[3*f+2];f=a[3*h+2];k[6]=d[3*f];k[7]=
d[3*f+1];k[8]=d[3*f+2];b[h]=k}}else for(h=0;h<d.length;h++)k=new Float32Array(9),k[0]=d[9*h],k[1]=d[9*h+1],k[2]=d[9*h+2],k[3]=d[9*h+3],k[4]=d[9*h+4],k[5]=d[9*h+5],k[6]=d[9*h+6],k[7]=d[9*h+7],k[8]=d[9*h+8],b[h]=k;return b}function m(a){for(var b=new Float32Array(a.ea),c=0;c<a.ea;c++)b[c]=c%3;return b}function x(a,b,c){var d=D.dist(a,b);a=D.dist(a,c);b=D.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function A(a,b,c,d,e){c-=b;for(var h=0;h<c;h+=d)h%d==e&&vec3.normalize(a.subarray(h+b-e,h+b+1),a.subarray(h+
b-e,h+b+1))}var r=p("__extensions"),e=p("__print"),v=p("__tsr"),J=p("__util"),D=p("__vec3"),H=new Float32Array(3),I=new Float32Array(3),P=new Float32Array(3);a.Ve=10;a.Ys=20;a.NI=30;a.Vl=10;a.Ps=20;a.Ul=30;a.Os=40;a.my=50;a.Io=0;a.yz=1;a.Vj=a.Vl;var K=null;a.Ad=function(a){K=a};a.yJ=function(a){var b=_buffers[a];K.deleteBuffer(b.of);K.deleteBuffer(b.Fg);delete _buffers[a]};a.MG=function(e,h,k,f){b(e)&&q(e);var m=e.Ca,g=e.ea,r=e.B,u={},x;for(x in e.X)x in f&&!f[x].ph||(u[x]=e.X[x]);f={bg:null,xc:null,
yq:0,count:0,Eb:{},mode:0,Il:0,Em:0,du:0,Fg:null,of:null,cn:null,na:null};0<e.na.length&&d(e,r[0]);if(m.length)if(x=m.length,65536>=g)var v=new Uint16Array(m),t=K.UNSIGNED_SHORT;else v=new Uint32Array(m),t=K.UNSIGNED_INT;else x=g,v=null;var A=0,D=r.length,p;for(p in r[0])var z=r[0][p],A=A+z.length*D;for(p in u)z=u[p],A+=z.length;p=new Float32Array(A);var A=0,D={},H;for(H in u){var I=u[H];if(z=I.length)p.set(I,A),D[H]={aJ:H,Ud:w(I,g),offset:A,frames:1,length:z},A+=z}u=r.length;for(H in r[0])if(I=r[0][H],
z=I.length,I=w(I,g),z){D[H]={Ud:I,offset:A,frames:u,length:z};1<u&&(D[H+"_next"]={Ud:I,offset:A+z,frames:u,length:z});for(var C=0;C<u;C++)I=r[C][H],p.set(I,A),A+=z}f.count=x;f.bg=v;f.xc=p;f.yq=t;f.Eb=D;l(f,k);n(f);h!=a.Ve&&c(e)&&(f.cn={QE:new Float32Array(m.length),RE:new Float32Array(m.length),fC:new Float32Array(m.length/3),type:h});f.na=e.na;return f};a.KG=d;a.ZD=b;a.YD=c;a.bo=q;a.Ax=function(a,b,c){l(a,b);a.count=c.length;a.bg=c;a.yq=c instanceof Uint16Array?K.UNSIGNED_SHORT:K.UNSIGNED_INT};a.lo=
function(a,b,c,d){var e=a.xc,h=a.Eb,k=h[b];k?(c&&k.Ud!=c&&J.W('invalid num_comp for "'+b+'"'),e.set(d,k.offset)):(e=e.length,k=new Float32Array(e+d.length),k.set(a.xc),k.set(d,e),a.xc=k,h[b]={Ud:c,offset:e});n(a)};a.tC=t;a.EK=function(a){a.Il=K.STATIC_DRAW};a.HE=function(a){a.Il=K.DYNAMIC_DRAW};a.Ex=n;a.Mt=function(a){a.of&&K.deleteBuffer(a.of);a.Fg&&K.deleteBuffer(a.Fg)};a.cv=function(a,b){return a.submeshes[b].base_length?!1:!0};a.kx=function(a,b){for(var c=0;c<a.B.length;c++){var d=a.B[c].a_position;
v.transform_vectors(d,b,d,0);d=a.B[c].a_normal;0<d.length&&v.transform_dir_vectors(d,b,d,0);d=a.B[c].a_tangent;0<d.length&&v.transform_tangents(d,b,d,0)}(c=a.X.au_center_pos)&&c.length&&v.transform_vectors(c,b,c,0);return a};a.JG=function(a,b){var c=a.X.au_center_pos;if(c&&c.length){var d=new Float32Array(c);v.transform_vectors(d,b,d,0);for(var e=0;e<a.B.length;e++)for(var h=0;h<d.length;h++)a.B[e].a_position[h]+=d[h]-c[h];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';
};a.IG=function(a,b){var c=a.ea,d;for(d in b){var e=b[d].length;a.X[d]=new Float32Array(e*c);for(var h=0;h<c;h++)for(var k=0;k<e;k++)a.X[d][h*e+k]=b[d][k]}};a.LG=g;a.GE=function(a,b,c){if(!a.ea)return J.Vb("EMPTY");var d=c.length;65536<a.ea*d&&!r.Ku()&&q(a,d);var e=a.Ca,h=a.ea,k=a.X;a=a.B;for(var f in b){var m=b[f].length,g=m*h;k[f]=new Float32Array(g);for(var l=0;l<h;l++)for(g=0;g<m;g++)k[f][l*m+g]=b[f][g]}b=J.Vb("CLONE_"+d+"_SUBMESHES");b.ea=h*d;b.Ca=new Uint32Array(e.length*d);for(l=0;l<d;l++)for(m=
e.length*l,f=h*l,g=0;g<e.length;g++)b.Ca[m+g]=e[g]+f;for(var n in k)for(e=k[n],g=e.length*d,m=w(e,h),b.X[n]=new Float32Array(g),l=0;l<d;l++)f=h*m*l,b.X[n].set(e,f);for(n in a[0])for(l=0;l<a.length;l++)for(e=a[l][n],g=e.length*d,m=w(e,h),b.B[l]=b.B[l]||{},b.B[l][n]=new Float32Array(g),g=0;g<d;g++)switch(k=c[g],f=h*m*g,n){case "a_position":v.transform_vectors(e,k,b.B[l][n],f);break;case "a_normal":v.transform_dir_vectors(e,k,b.B[l][n],f);break;case "a_tangent":v.transform_tangents(e,k,b.B[l][n],f);
break;default:throw"Wrong attribute name: "+n;}return b};a.ru=z;a.wC=function(a){var b=a.ea,c=a.B[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint32Array(4*a.Ca.length);for(var h=0;h<b;h++)d[12*h]=c[3*h],d[12*h+1]=c[3*h+1],d[12*h+2]=c[3*h+2],d[12*h+3]=c[3*h],d[12*h+4]=c[3*h+1],d[12*h+5]=c[3*h+2],d[12*h+6]=c[3*h],d[12*h+7]=c[3*h+1],d[12*h+8]=c[3*h+2],d[12*h+9]=c[3*h],d[12*h+10]=c[3*h+1],d[12*h+11]=c[3*h+2],e[8*h]=-.5,e[8*h+1]=-.5,e[8*h+2]=-.5,e[8*h+3]=.5,e[8*h+4]=.5,e[8*h+
5]=.5,e[8*h+6]=.5,e[8*h+7]=-.5,a[6*h]=4*h+2,a[6*h+1]=4*h+1,a[6*h+2]=4*h,a[6*h+3]=4*h+2,a[6*h+4]=4*h,a[6*h+5]=4*h+3;c=J.Vb("HALO");c.B=[];c.B[0]={};c.ea=4*b;c.B[0].a_position=d;c.X.a_halo_bb_vertex=e;c.Ca=a;return c};a.JD=k;a.su=function(a,b,c){for(var d=[],e=0;e<a.submeshes.length;e++){var h=z(a,e,b,null,c,null);h.ea&&d.push(h)}return 0==d.length?J.Vb("EMPTY"):1==d.length?d[0]:g(d)};a.jH=function(a,b,c){for(var d=a.bg,e=t(a,"a_position"),h=a.cn,k=h.QE,f=h.RE,h=h.fC,m=d,g=m.length/3,r=0;r<g;r++){var l=
m[3*r],n=m[3*r+1],u=m[3*r+2],q=e[3*l+1],x=e[3*l+2],A=e[3*n+1],D=e[3*n+2],N=e[3*u+1],w=e[3*u+2];k[3*r]=(e[3*l]+e[3*n]+e[3*u])/3;k[3*r+1]=(q+A+N)/3;k[3*r+2]=(x+D+w)/3}v.transform_vectors(k,b,f);b=f.length/3;for(e=0;e<b;e++)k=f[3*e]-c[0],m=f[3*e+1]-c[1],g=f[3*e+2]-c[2],h[e]=k*k+m*m+g*g;c=d;d=h.length;if(!(2>d))for(f=d,e=!1;1<f||e;)for(1<f&&(f=Math.floor(f/1.247330950103979)),e=!1,b=0;f+b<d;b++)0>h[b]-h[b+f]&&(e=h[b],h[b]=h[b+f],h[b+f]=e,e=c,k=b,m=b+f,g=e[3*k],r=e[3*k+1],l=e[3*k+2],e[3*k]=e[3*m],e[3*
k+1]=e[3*m+1],e[3*k+2]=e[3*m+2],e[3*m]=g,e[3*m+1]=r,e[3*m+2]=l,e=!0);d=c;K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,a.of);K.bufferData(K.ELEMENT_ARRAY_BUFFER,d,K.DYNAMIC_DRAW)};a.Zw=C;a.yt=function(a,b,c){for(var d=b.length/3,e=a.length/3,h=[],k=Array(3),f=Array(3),m=Array(3),g=0;g<e;g++){for(var r=a[3*g],l=a[3*g+1],n=a[3*g+2],u=0;3>u;u++)k[u]=b[3*r+u],f[u]=b[3*l+u],m[u]=b[3*n+u];if(c)var u=E(k,f,m),q=E(f,m,k),x=Math.PI-u-q;else x=q=u=1;var v=h,t;t=k;var N=m,A=[],w=[],Q=[];D.subtract(f,t,A);D.subtract(N,
t,w);D.cross(A,w,Q);D.normalize(Q,Q);t=Q;for(N=0;3>N;N++)A=3*l+N,w=3*n+N,v[3*r+N]=u*t[N],v[A]=q*t[N],v[w]=x*t[N]}if(c)for(var p in c)for(g=c[p],a=0;3>a;a++){b=3*g[0]+a;for(e=1;e<g.length;e++)k=3*g[e]+a,h[b]+=h[k];for(e=1;e<g.length;e++)k=3*g[e]+a,h[k]=h[b]}for(g=0;g<d;g++){c=g;p=h;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=p[e];D.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,p[e]=a[b]}return h};a.zt=function(a,b,c){for(var d={},e=b.length/3,h=0;h<e;h++){var k=String(b[3*h])+String(b[3*h+1])+String(b[3*
h+2]);d[k]=[]}e=a.length;for(h=0;h<e;h++)b=a[h],k=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),k in d&&d[k].push(b);return d};a.kq=function(a,b,c,d){var e=G(a,null,!1);if(c)var h=G(a,null,!0);var k=e.length,f=new Float32Array(k),m=H,g=I;for(a=0;a<k;a++){var r=e[a];m.set(r.subarray(0,3));g.set(r.subarray(3,6));P.set(r.subarray(6));f[a]=Math.sqrt(x(m,g,P))}m=new Float32Array(k);m[0]=f[0];for(a=1;a<k;a++)m[a]=m[a-1]+f[a];k=m[f.length-1];f=[];for(a=0;a<b;a++){var g=k*J.Vd(d),g=J.om(m,g,0,m.length-
1),r=c?h[g]:e[g],g=a,l=r,n=d,r=void 0,r=new Float32Array(3),u=l[0],q=l[1],v=l[2],t=l[3],A=l[4],N=l[5],D=l[6],w=l[7],Q=l[8],l=J.Vd(n),n=J.Vd(n);1<l+n&&(l=1-l,n=1-n);var p=1-l-n,q=p*q+l*A+n*w,v=p*v+l*N+n*Q;r[0]=p*u+l*t+n*D;r[1]=q;r[2]=v;f[g]=r}return f};a.EJ=G;a.aq=m;a.eL=x;a.Iw=function(a,b,c){a=a.B[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.lt=function(a,b,c){var d=a.J[0].T;a=a.f.ug;for(var e=1;e<a.length;e++)a[e].name==
b&&(a[e].value=c);for(e=0;e<d.length;e++)if(!d[e].nh&&d[e].qe&&!d[e].gh){c=d[e].O.Eb;b=d[e].O.xc;K.bindBuffer(K.ARRAY_BUFFER,d[e].O.Fg);var h=c.a_position,k=d[e],f=b,m=a;if(h){for(var g=h.offset,h=h.length+g,r=k.O.na[0].zc.a_position,l=g;l<h;l++)f[l]=r[l-g];for(l=1;l<k.O.na.length;l++){var r=k.O.na[l].zc.a_position,n=m[l].value;if(n)for(var u=g;u<h;u++)f[u]+=n*r[u-g]}K.bufferSubData(K.ARRAY_BUFFER,4*g,f.subarray(g))}h=c.a_normal;k=d[e];f=b;m=a;if(h){g=h.offset;h=h.length+g;r=k.O.na[0].zc.a_normal;
for(l=g;l<h;l++)f[l]=r[l-g];for(l=1;l<k.O.na.length;l++)if(r=k.O.na[l].zc.a_normal,n=m[l].value)for(u=g;u<h;u++)f[u]+=n*r[u-g];A(f,g,h,3,2);K.bufferSubData(K.ARRAY_BUFFER,4*g,f.subarray(g))}m=c.a_tangent;c=d[e];k=a;if(m){f=m.offset;m=m.length+f;h=c.O.na[0].zc.a_tangent;for(g=f;g<m;g++)b[g]=h[g-f];for(g=1;g<c.O.na.length;g++)if(h=c.O.na[g].zc.a_tangent,l=k[g].value)for(r=f;r<m;r++)b[r]+=l*h[r-f];A(b,f,m,4,3);K.bufferSubData(K.ARRAY_BUFFER,4*f,b.subarray(f))}}};a.check_shape_keys=function(a){return a.f.qe};
a.get_shape_keys_names=function(a){var b=[];if(a.f)for(var c=1;c<a.f.ug.length;c++)b.push(a.f.ug[c].name);return b};a.get_shape_key_value=function(a,b){if(a.f)for(var c=1;c<a.f.ug.length;c++)if(b==a.f.ug[c].name)return a.f.ug[c].value;return 0};a.wq=function(a,b){var c=a.f.ug;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.Ti=function(a){return a&&a.f&&a.f.De?!0:!1};a.draw_line=function(b,c,d){var e=b.O;if(e){for(var h=d?c.length/3/2:c.length/3-1,k=new Float32Array(12*h),f=new Float32Array(12*
h),m=new Uint16Array(6*h),g=0;g<h;g++){if(d)var r=6*g,l=6*g+3;else r=3*g,l=3*(g+1);var u=c[r],q=c[r+1],r=c[r+2],x=c[l],v=c[l+1],l=c[l+2],t=x-u,A=v-q,D=l-r;k[12*g]=u;k[12*g+1]=q;k[12*g+2]=r;f[12*g]=t;f[12*g+1]=A;f[12*g+2]=D;k[12*g+3]=x;k[12*g+4]=v;k[12*g+5]=l;f[12*g+3]=-t;f[12*g+4]=-A;f[12*g+5]=-D;k[12*g+6]=u;k[12*g+7]=q;k[12*g+8]=r;f[12*g+6]=-t;f[12*g+7]=-A;f[12*g+8]=-D;k[12*g+9]=x;k[12*g+10]=v;k[12*g+11]=l;f[12*g+9]=t;f[12*g+10]=A;f[12*g+11]=D;m[6*g]=4*g;m[6*g+1]=4*g+1;m[6*g+2]=4*g+2;m[6*g+3]=4*
g;m[6*g+4]=4*g+3;m[6*g+5]=4*g+1}d=0;for(var N in e.Eb)c=e.Eb[N],d+=k.length/3*c.Ud;e.xc=new Float32Array(d);d=e.xc;a.Ax(e,b.Ce,m);b=0;for(N in e.Eb)switch(c=e.Eb[N],N){case "a_position":d.set(k,b);c.offset=b;c.length=k.length;b+=c.length;break;case "a_direction":d.set(f,b);c.offset=b;c.length=f.length;b+=c.length;break;default:c.offset=b,c.length=k.length/3*c.Ud,m=new Float32Array(c.length),d.set(m,b),b+=c.length}n(e)}}};b4w.module.__objects=function(a,p){function d(a){a.f.lg=0;a=ea.indexOf(a);-1!=a&&ea.splice(a,1)}function b(a){if(a.Fi)for(var b=a.J,c=0;c<b.length;c++)y.qH(b[c].Ea,a)}function c(a,b){for(var c=a.J,d=b.J,e=0;e<c.length;e++){for(var h=!1,k=0;k<d.length;k++)if(c[e].Ea==d[k].Ea){h=!0;break}h||q(b,c[e].Ea)&&J.ak(b,c[e].Ea)}}function q(a,b){return!b.at&&"SPEAKER"==a.type||!b.Gz&&("LAMP"==a.type||"CAMERA"==a.type)?!1:!0}function f(a,b){if(a.dg_parent&&a.dg_parent.Zs||a.parent&&a.parent.Zs)return!0;switch(a.type){case "MESH":var c=
a.b4w_do_not_batch,d=a.b4w_collision,e=a.b4w_vehicle,h=a.b4w_floating,k=a.b4w_character,f=D.LD(a),g=v.wt(a),m=0<a.data.b4w_shape_keys.length,r=a.b4w_dynamic_geometry;if(!(c=C.xt(a,b)||c||d||e||m||h))a:{c=a.data;for(d=0;d<c.materials.length;d++)if("LENS_FLARES"===c.materials[d].name){c=!0;break a}c=!1}return c||f||k||g||r;case "EMPTY":return k=v.wt(a),f=a.b4w_do_not_batch,g=Boolean(a.b4w_anchor),C.xt(a,b)||k||f||g;default:return!0}}function t(a,b,c,d,e,h,k,f,g){for(var m=0;m<a.nodes.length;m++){var r=
a.nodes[m];if("VALUE"==r.type){var u=n(b,r.name);d.push(r.outputs[0].default_value);e.push(u,e.length/2)}else"RGB"==r.type?(u=n(b,r.name),r=r.outputs[0].default_value.slice(0,3),k.push(r[0],r[1],r[2]),f.push(u,f.length/2)):"GROUP"==r.type&&(u=r.node_group.node_tree,t(u,n(b,r.name),u.animation_data,d,e,h,k,f,g))}if(c)for((a=c.action)&&a.k.type==C.Ns&&l(a,b,h,e,g,f),c=c.nla_tracks,d=0;d<c.length;d++)for(k=c[d].strips,m=0;m<c[d].strips.length;m++)(a=k[m].action)&&a.k.type==C.Ns&&l(a,b,h,e,g,f)}function l(a,
b,c,d,e,h){var k=a.k.R,f;for(f in k){var m=n(b,f.match(/"(.*?)"/)[1]),k=g(d,m);null!=k?(m=n(a.name,f),c.push(m,k)):(k=g(h,m),null!=k&&(m=n(a.name,f),e.push(m,k)))}}function n(a,b){return a+"%join%"+b}function g(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function z(a,b){for(var c=a.f.Ch,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function h(a,b){for(var c=a.f.Bh,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function k(a,b,c){b=W[b]||[];for(var d=[],
e=0;e<b.length;e++){var h=b[e];if(h.f.Ic==c||-1==c)for(var k=h.J,f=0;f<k.length;f++)k[f].Ea==a&&d.push(h)}return d}function u(a,b,c,d){for(var e=null,h=0;h<b.length;h++){var k=b[h];if((c?k.Jh:k.name)==a&&(k.f.Ic==d||-1==d)&&(e=k,!J.get_dg_parent(e)))break}return e}function w(a){W.ALL.push(a);W[a.type]||(W[a.type]=[]);W[a.type].push(a);var b=a.f.vd;if(null!=b)for(var c=0;c<ka.length;c++){var d=ka[c];d.f.vd==b&&d.ql.push(a)}}var C=p("__animation"),E=p("__batch"),G=p("__boundings"),m=p("__camera"),x=
p("__config"),A=p("__constraints"),r=p("__geometry"),e=p("__lights"),v=p("__nla"),J=p("__obj_util"),D=p("__particles"),H=p("__physics"),I=p("__print"),P=p("__primitives"),K=p("__quat"),y=p("__scenes"),F=p("__sfx"),M=p("__transform"),O=p("__textures"),V=p("__tsr"),T=p("__util"),U=p("__vec3"),B=p("__armature"),ha=p("__anchors"),ba=x.p,da=x.Jb,W={ALL:[]},R=0,Y=0,ka=[],ea=[],ma=new Float32Array(3),la=new Float32Array(4);a.Ho=0;a.Go=1;a.ec=2;a.DATA_ID_ALL=-1;a.update=function(a){for(var b=W.ALL,c=W.ARMATURE,
e=0;e<b.length;e++)for(var h=b[e],k=h.J,f=0;f<k.length;f++){var g=k[f],m=g.Ea,g=g.T;if(m.k.outline){if(-1!=ea.indexOf(h)){var r=h,l=a,u=0,n=r.Yv;0==n.co&&(n.co=l);l-=n.co;if(n.xr&&l/n.ud>=n.xr)d(r);else{l%=n.ud;if(l<n.ir)switch(n=l/(n.ir/5),l=Math.floor(n),l){case 0:u=(n-l)/2;break;case 1:u=(n-l)/2+.5;break;case 2:u=1;break;case 3:u=1-(n-l)/2;break;case 4:u=.5-(n-l)/2}r.f.lg=u}}h.f.lg&&y.FF(m)}D.pH(h,g)}if(c)for(e=0;e<c.length;e++)a=c[e],a.dr&&(M.n(a),a.dr=!1)};a.apply_outline_anim=function(a,b,c,
d){var e=a.Yv;e.co=0;e.ir=b;e.ud=c;e.xr=d;-1==ea.indexOf(a)&&ea.push(a)};a.clear_outline_anim=d;a.bi=function(a,b){b.fi=a.uuid;b.wi=!0;var c=a.animation_data,d=a.data.animation_data;c&&c.action&&(c=c.action,(c.k.type==C.ly||c.k.type==C.jy&&"ARMATURE"==b.type||c.k.type==C.ky&&"LAMP"==b.type)&&b.actions.push(c));d&&d.action&&("SPEAKER"==b.type||"LAMP"==b.type)&&b.actions.push(d.action);"MESH"==b.type&&b.actions.push.apply(b.actions,C.gD(a));a.Zs=b.ka=f(a,b);a.OI=!0;b.Mc=a.b4w_vehicle;b.is_character=
a.b4w_character;b.vh=a.b4w_floating;b.di=a.b4w_collision;b.Va=a.b4w_collision_id;b.Am=a.b4w_correct_bounding_offset;d=a.game;b.le={Gn:d.physics_type,Kl:d.use_ghost,Mx:d.use_sleep,Ge:d.mass,Qx:d.velocity_min,Px:d.velocity_max,Kp:d.damping,Er:d.rotation_damping,xE:d.lock_location_x,yE:d.lock_location_y,zE:d.lock_location_z,AE:d.lock_rotation_x,BE:d.lock_rotation_y,CE:d.lock_rotation_z,pk:d.collision_margin,nk:d.collision_group,qk:d.collision_mask,zs:d.use_collision_bounds,vm:d.collision_bounds_type,
Jl:d.use_collision_compound};if(d=a.b4w_vehicle_settings)b.Zc={name:d.name,Oc:d.part,PG:d.suspension_rest_length,hs:d.suspension_compression,ks:d.suspension_stiffness,js:d.suspension_damping,Js:d.wheel_friction,Cr:d.roll_influence,Yq:d.max_suspension_travel_cm,Lk:d.force_max,ek:d.brake_max,Ej:d.steering_max,dj:d.max_speed_angle,Bk:d.delta_tach_angle,yl:d.speed_ratio,Bl:d.steering_ratio,Wk:d.inverse_control,mh:d.floating_factor,ki:d.water_lin_damp,li:d.water_rot_damp,ox:d.synchronize_position};if(d=
a.b4w_floating_settings)b.Gi={name:d.name,Oc:d.part,mh:d.floating_factor,ki:d.water_lin_damp,li:d.water_rot_damp,ox:d.synchronize_position};if(d=a.b4w_character_settings)b.Gt={eI:d.walk_speed,KF:d.run_speed,HG:d.step_height,eE:d.jump_strength,gI:d.waterline};for(d=0;d<a.constraints.length;d++)c=a.constraints[d],"RIGID_BODY_JOINT"==c.type&&b.nr.push({target:c.target.oa,hF:c.pivot_type,iF:c.pivot_x,jF:c.pivot_y,kF:c.pivot_z,we:c.axis_x,xe:c.axis_y,ye:c.axis_z,KH:c.use_limit_x,LH:c.use_limit_y,MH:c.use_limit_z,
FH:c.use_angular_limit_x,GH:c.use_angular_limit_y,HH:c.use_angular_limit_z,oE:c.limit_max_x,pE:c.limit_max_y,qE:c.limit_max_z,rE:c.limit_min_x,sE:c.limit_min_y,tE:c.limit_min_z,iE:c.limit_angle_max_x,jE:c.limit_angle_max_y,kE:c.limit_angle_max_z,lE:c.limit_angle_min_x,mE:c.limit_angle_min_y,nE:c.limit_angle_min_z});d=b.f=J.zi("MESH"===b.type?b.ka?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent.oa,"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.il=a.parent_bone),a.pinverse_tsr?(b.Hn=V.create(),
V.copy(a.pinverse_tsr,b.Hn)):b.Hn=void 0):a.dg_parent&&(b.parent=a.dg_parent.oa,b.ng=!0);var c=a.location,h=a.scale[0];T.sr(a.rotation_quaternion,la);M.set_translation(b,c);M.set_rotation(b,la);M.set_scale(b,h);b.oo=a.b4w_use_default_animation;b.em=C.jt(a.b4w_anim_behavior);a.b4w_object_tags&&(b.un={title:a.b4w_object_tags.title,description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});a.b4w_viewport_alignment&&(b.zo={Iz:a.b4w_viewport_alignment.alignment,distance:a.b4w_viewport_alignment.distance});
switch(a.type){case "ARMATURE":B.bi(a,b);c=d.Jd;h=C.EA(c);a.b4w_animation_mixing?(d.Qc=new Float32Array(h.za),d.wd=new Float32Array(h.za),d.Yc=new Float32Array(h.trans),d.Ed=new Float32Array(h.trans)):(d.Qc=h.za,d.wd=h.za,d.Yc=h.trans,d.Ed=h.trans);for(var k in c){var g=c[k];1==g.um.length&&B.iH(g,!0,h.trans,h.za)}d.or=h;d.Pd=0;d.Ug=a.b4w_animation_mixing;break;case "MESH":d.Im=a.b4w_do_not_render;d.ti=E.sA(a.data.b4w_bounding_box);d.yf=da.outlining_overview_mode||a.b4w_selectable;d.Bn=a.b4w_selectable;
d.Jb=da.outlining_overview_mode||a.b4w_outlining;d.An=a.b4w_outlining;d.Zv=da.outlining_overview_mode||a.b4w_outline_on_select;d.ae=a.b4w_billboard;d.bp=a.b4w_pres_glob_orientation;d.ck="BASIC";d.bk="SPHERICAL"==a.b4w_billboard_geometry;k=d.mj;k.nj=a.b4w_outline_settings.outline_duration;k.oj=a.b4w_outline_settings.outline_period;k.pj=a.b4w_outline_settings.outline_relapses;d.yf&&(d.wm=T.zu(R),R++);for(k=0;k<a.data.b4w_vertex_anim.length;k++)c=a.data.b4w_vertex_anim[k],b.jc.push({name:c.name,N:c.frame_start,
ja:c.frame_end,cJ:c.averaging,dJ:c.averaging_interval,Jz:c.allow_nla});b.f.jc=b.jc.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;k=b.f;if(a.data.b4w_shape_keys.length)for(k.qe=!0,c=0;c<a.data.b4w_shape_keys.length;c++)h={},h.value=a.data.b4w_shape_keys[c].value,h.name=a.data.b4w_shape_keys[c].name,k.ug.push(h);else k.qe=!1;k=b.f;for(var c=a.data.materials,h=[],g=[],r=[],l=[],n=[],u=[],q=0;q<c.length;q++){var x=c[q],S=x.node_tree;S&&t(S,x.name,S.animation_data,h,g,r,l,n,u)}k.rf=
h;k.Ch=g;k.sn=r;k.sd=l;k.Bh=n;k.tn=u;d.Uc=a.b4w_shadow_cast;d.wc=a.b4w_shadow_receive;d.Vc=a.b4w_shadow_cast_only&&d.Uc;d.Cc=a.b4w_reflexible;d.tc=a.b4w_reflexible_only&&d.Cc;d.Rc=a.b4w_reflective;d.Ke=a.b4w_reflection_type;d.af=a.b4w_caustics;d.Hd=a.b4w_wind_bending;d.Ql=a.b4w_wind_bending_angle;k=E.hI(a.b4w_wind_bending_angle,d.ti,a.scale[0]);d.Te=k;d.Gf=a.b4w_wind_bending_freq;d.ff=a.b4w_detail_bending_freq;d.ef=a.b4w_detail_bending_amp;d.$e=a.b4w_branch_bending_amp;d.rh=!1;d.qf=a.b4w_main_bend_stiffness_col;
k=a.b4w_detail_bend_colors;d.qc={};d.qc.wv=k.leaves_stiffness_col;d.qc.vv=k.leaves_phase_col;d.qc.$v=k.overall_stiffness_col;d.ih=a.b4w_do_not_cull;d.Hm=a.b4w_disable_fogging;d.De=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";k=a.data.materials[0];d.Nk=k.physics.friction;d.Hk=k.physics.elasticity;d.al=0;d.fg=1E6;d.Ah=a.b4w_lod_transition;d.ln=!0;break;case "LINE":d.ih=!0;d.Zb=G.$c();d.fd=G.ni();d.Ze=G.hy();d.Ab=G.$c();d.Ub=G.ni();d.Nf=G.hy();break;case "CAMERA":m.HA(a,b);m.mA(b);break;
case "LAMP":e.fE(a,b);break;case "SPEAKER":b.F=F.FB();d=!1;for(k=0;k<b.J.length;k++)if(b.J[k].Ea.b4w_enable_audio){d=!0;break}d&&F.bi(a,b);break;case "EMPTY":d.Zb=G.$c(),k=G.ni(),d.fd=k,a.field&&(b.Fi={type:a.field.type,ix:a.field.strength}),a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,Ai:a.b4w_anchor.detect_visibility,Lm:a.b4w_anchor.element_id,OE:a.b4w_anchor.max_width})}w(b)};a.vH=function(a,b){var d=b.f;if(b.parent){!b.ng&&b.le.Jl&&b.parent.le.Jl&&(b.di=!1);var e=b.le;if(b.Mc||b.vh||H.is_character(b)||
b.di&&!e.Kl&&0<e.Ge&&("DYNAMIC"==e.Gn||"RIGID_BODY"==e.Gn))e=b.ng?V.copy(d.h,V.create()):d.h,V.multiply(b.parent.f.h,e,d.h),M.set_translation(b,V.get_trans_view(d.h)),M.set_scale(b,V.get_scale(d.h)),M.set_rotation(b,V.get_quat_view(d.h));else if(b.ng||!b.il)if(e=V.copy(d.h,V.create()),b.zo&&"CAMERA"==b.parent.type){e={distance:b.zo.distance,rotation:V.get_quat_view(e)};switch(b.zo.Iz){case "TOP_LEFT":e.top=0;e.left=0;break;case "TOP":e.top=0;e.left=.5;break;case "TOP_RIGHT":e.top=0;e.right=0;break;
case "LEFT":e.top=.5;e.left=0;break;case "CENTER":e.top=.5;e.left=.5;break;case "RIGHT":e.top=.5;e.right=0;break;case "BOTTOM_LEFT":e.bottom=0;e.left=0;break;case "BOTTOM":e.bottom=0;e.left=.5;break;case "BOTTOM_RIGHT":e.bottom=0,e.right=0}A.append_stiff_viewport(b,b.parent,e)}else A.Nz(b,b.parent,e);else e=V.copy(d.h,V.create()),A.Oz(b,b.parent,b.il,e)}if("ARMATURE"==b.type)for(var e=a.pose.bones,h=0;h<e.length;h++){var k=e[h],f=k.constraints;if(f)for(var g=0;g<f.length;g++){var m=f[g];"COPY_TRANSFORMS"!=
m.type||m.subtarget||m.mute||A.Yz(b,m.target.oa,k.name,T.Ws,T.Vs)}}if("MESH"==b.type)var r=C.Gu(a);if(r){f=r.oa;e=f.f.or;h=b.f;k=a.data;b.im=f;k=k.vertex_groups;if(k.length){var f=f.f.Jd,g=0,m={},l;for(l in f){var n=T.keysearch("name",l,k);n&&(m[l]={Tx:n.index,Of:f[l].Of,Np:g++})}h.vi=m;l=g;k=C.Mu();h.sf=l;l>2*k?(h.Yi=!1,I.error('too many bones for "'+a.name+'" / '+h.sf+" bones (max "+k+" with blending, "+2*k+" without blending). Skinning will be disabled.")):h.Yi=!0}l=C.xC(e.trans,e.za,d.vi);r.b4w_animation_mixing?
(d.Qc=new Float32Array(l.za),d.wd=new Float32Array(l.za),d.Yc=new Float32Array(l.trans),d.Ed=new Float32Array(l.trans)):(d.Qc=l.za,d.wd=l.za,d.Yc=l.trans,d.Ed=l.trans);d.So=new Float32Array(4);d.Ro=K.create();d.or=l;d.Pd=0}if(d.Rc)if(d=b.f,"CUBE"==d.Ke)d.Kd=Y++;else if("PLANE"==d.Ke){a:{r=a.constraints;for(l=0;l<r.length;l++)if(e=r[l],"LOCKED_TRACK"==e.type&&"REFLECTION PLANE"==e.name){if(e.target.oa){r=e.target.oa;break a}I.warn('Reflection plane target "'+e.target.name+'" for object: "'+b.name+
"\" is not present on the scene. Using object's Z-axis.")}r=null}r||(r=T.Oj("%reflection%"),r=J.vk(r,"EMPTY"),l=J.zi("EMPTY"),r.f=l,c(b,r),A.kt(r,b,[0,0,0],null,1),w(r));l=null;for(e=0;e<ka.length;e++)if(ka[e]==r){l=e;break}null==l&&(l=ka.length,ka.push(r));r.f.vd=l;d.vd=l;r.ql.push(b)}};a.Dx=b;a.qJ=c;a.QA=q;a.wH=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.f||"DYNAMIC"!=c.f.type&&"CAMERA"!=c.f.type||M.n(c);c.oo&&C.Xv(c)&&(C.apply_def(c),c.M.length&&C.play(c,null,C.SLOT_ALL))}};a.get_meta_tags=
function(a){return T.xa(a.un)};a.cleanup=function(){Y=R=0;ka=[];ea.length=0;W={ALL:[]}};a.copy=function(a,b,d){var e=b,h=J.get_dg_parent(a);b=h?J.Au(h.name,b):b;if(u(b,W.ALL,!1,-1)){for(var h=1,k;;){k="."+(3>String(h).length?("000"+String(h)).slice(-3):String(h));if(!u(b+k,W.ALL,!1,-1))break;h++}I.error('Object "'+b+'" already exists. Name was replaced by "'+b+k+'".');e+=k;b+=k}e=J.vk(b,a.type,e);e.wi=a.wi;e.ka=a.ka;e.Yk=a.Yk;e.oo=a.oo;e.f=J.yi(a.f);e.un=J.yi(a.un);c(a,e);e.qi=J.zp(a.qi);e.parent=
J.zp(a.parent);e.ng=a.ng;e.il=a.il;!a.o||a.Mc||a.is_character||a.vh||(e.di=a.di,e.o=null);e.Va=a.Va;e.Am=a.Am;e.le=J.yi(a.le);b=[];for(h=0;h<a.J.length;h++){var f=e.J[h];k=a.J[h].T;if(d){for(var f=f.T,g=0;g<k.length;g++)if(!k[g].nh){var m=J.yi(k[g]);f.push(m);b.push(k[g].O)}for(g=0;g<k.length;g++)if(k[g].nh){m=J.yi(k[g]);f.push(m);for(var l=0;l<b.length;l++)b[l]==k[g].O&&(m.O=f[l].O)}for(g=0;g<f.length;g++)f[g].O&&r.Ex(f[g].O),f[g].lj=e.fi,E.dH(f[g],E.FA(e.f));O.oG(f)}else f.T=J.zp(k)}J.Gr(e,!1);
w(e);e.f.lv=!0;e.f.wm=T.zu(R);R++;return e};a.bK=z;a.YJ=h;a.update_boundings=function(a){for(var b=a.f,c=a.J[0].T,d,e,h,k,f,g,m=0;m<c.length;m++)if("MAIN"==c[m].type){var l=c[m].O.xc,n=c[m].O.Eb.a_position.offset;d=k=l[n];e=f=l[n+1];h=g=l[n+2];break}for(m=0;m<c.length;m++)if(l=c[m],"MAIN"==l.type)for(var l=l.O.xc,u=c[m].O.Eb,n=u.a_position.offset,u=u.a_position.length+n,q=n;q<u;q+=3){var n=l[q],x=l[q+1],v=l[q+2];d=Math.max(n,d);e=Math.max(x,e);h=Math.max(v,h);k=Math.min(n,k);f=Math.min(x,f);g=Math.min(v,
g)}var t={max_x:parseFloat(d.toFixed(3)),max_y:parseFloat(e.toFixed(3)),max_z:parseFloat(h.toFixed(3)),min_x:parseFloat(k.toFixed(3)),min_y:parseFloat(f.toFixed(3)),min_z:parseFloat(g.toFixed(3))},B=d-k,A=e-f,D=h-g;k=.5*(d+k);var w=.5*(e+f),p=.5*(h+g),na=k,Ba=p;f=Math.max(B,Math.max(A,D))/2;g=Math.max(B,D)/2;var z=[k/(B?B:1),w/(A?A:1),p/(D?D:1)],y=.5;if(b.ae)n=Math.max(Math.abs(t.max_x),Math.abs(t.min_x)),x=Math.max(Math.abs(t.max_y),Math.abs(t.min_y)),v=Math.max(Math.abs(t.max_z),Math.abs(t.min_z)),
f=Math.sqrt(n*n+x*x+v*v),g=Math.sqrt(n*n+x*x),t.max_x=t.max_y=t.max_z=f,t.min_x=t.min_y=t.min_z=-f,k=new Float32Array([0,0,0]),D=new Float32Array([f,f,f]),A=new Float32Array([0,0,0]);else{for(m=0;m<c.length;m++)if(l=c[m],"MAIN"==l.type)for(l=l.O.xc,u=c[m].O.Eb,n=u.a_position.offset,u=u.a_position.length+n,q=n;q<u;q+=3){var n=l[q],x=l[q+1],v=l[q+2],H=Math.sqrt((k-n)*(k-n)+(w-x)*(w-x)+(p-v)*(p-v));if(H>f){var I=k-f*(n-k)/H,C=w-f*(x-w)/H,H=p-f*(v-p)/H;k=(I+n)/2;w=(C+x)/2;p=(H+v)/2;f=Math.sqrt((k-n)*
(k-n)+(w-x)*(w-x)+(p-v)*(p-v))}C=Math.sqrt((na-n)*(na-n)+(Ba-v)*(Ba-v));C>g&&(I=na-g*(n-na)/C,H=Ba-g*(v-Ba)/C,na=(I+n)/2,Ba=(H+v)/2,g=Math.sqrt((na-n)*(na-n)+(Ba-v)*(Ba-v)));n/=B?B:1;x/=A?A:1;v/=D?D:1;H=Math.sqrt((z[0]-n)*(z[0]-n)+(z[1]-x)*(z[1]-x)+(z[2]-v)*(z[2]-v));H>y&&(I=z[0]-y*(n-z[0])/H,C=z[1]-y*(x-z[1])/H,H=z[2]-y*(v-z[2])/H,z[0]=(I+n)/2,z[1]=(C+x)/2,z[2]=(H+v)/2,y=Math.sqrt((z[0]-n)*(z[0]-n)+(z[1]-x)*(z[1]-x)+(z[2]-v)*(z[2]-v)))}m=B?B*z[0]:d;e=A?A*z[1]:e;h=D?D*z[2]:h;B*=y;A*=y;D*=y;k=new Float32Array([k,
w,p]);D=new Float32Array([B,A,D]);A=new Float32Array([m,e,h]);g=parseFloat(g.toFixed(3))}b.Zb=t;E.aG(b,g,g,t);t=G.Cm(f,k);b.fd=t;t=G.Bm([D[0],0,0],[0,D[1],0],[0,0,D[2]],A);b.Ze=t;M.n(a);if(ba.wireframe_debug)for(m=0;m<c.length;m++)if("WIREFRAME"===c[m].type&&c[m].gh){a=P.jq(1,t.I);r.Iw(a,[t.we[0],t.xe[1],t.ye[2]],t.I);r.bo(a,1,!0);a.X.a_polyindex=r.aq(a);E.cH(c[m],a);break}};a.Ia=k;a.xD=function(a,b){for(var c=W.ALL||[],d=[],e=0;e<c.length;e++){var h=c[e];if((h.f.Ic==b||-1==b)&&h.wi)for(var k=h.J,
f=0;f<k.length;f++)k[f].Ea==a&&d.push(h)}return d};a.get_all_objects=function(a){var b=W.ALL;if(-1==a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.f.Ic==a&&c.push(e)}return c};a.vG=function(a){var b=k(a,"LAMP",-1);if(b.length==a.k.HK){for(var c=[],d=0;d<b.length;d++){var e=b[d],e=J.Pa(e,a);c[e.xh]=d}for(d=0;d<c.length-1;d++)for(e=d+1;e<c.length;e++){var h=b[c[d]].La,f=b[c[e]].La;if(f.Pj&&f.ei&&(!h.Pj||!h.ei)||!h.Pj&&(f.Pj||!h.ei&&f.ei))h=c[d],c[d]=c[e],c[e]=h}for(d=0;d<c.length;d++)e=b[c[d]],
J.Pa(e,a).xh=d,y.mo(b[c[d]],a)}};a.aH=function(a){for(var b=k(a,"LAMP",-1),c=k(a,"MESH",-1),d=0;d<c.length;d++)for(var e=J.Pa(c[d],a).T,h=0;h<e.length;h++){var f=e[h];"MAIN"==f.type&&(E.eH(f,b,a),E.Sb(f))}};a.get_selectable_objects=function(){for(var a=[],b=W.MESH,c=0;c<b.length;c++){var d=b[c];d.f.yf&&d.wi&&a.push(d)}return a};a.get_outlining_objects=function(){for(var a=[],b=W.MESH,c=0;c<b.length;c++){var d=b[c];d.f.Jb&&d.wi&&a.push(d)}return a};a.Qb=function(b,c,d,e){var h=null,k=W.ALL;switch(b){case a.Ho:h=
u(c,k,!0,d);break;case a.Go:a:{for(b=0;b<k.length;b++)if(h=k[b],h.Jh==d&&(h.f.Ic==e||-1==e)){var f=J.get_dg_parent(h);if(f&&f.Jh==c)break a}h=null}break;case a.ec:a:{for(e=0;e<k.length;e++){b=k[e];for(var h=c.length-1,f=b,g=!0;0<=h&&g;)g=f&&f.Jh==c[h]&&(f.f.Ic==d||-1==d),f&&(f=J.get_dg_parent(f)),h--;if(g&&!f){h=b;break a}}h=null}}return h};a.pick_object=function(b,c){var d=y.Qi();if(!d)return I.error("No active scene"),null;var e=ha.fF(b,c);if(e)return e;e=y.gF(d,b,c);if(!e)return null;for(var d=
k(d,"MESH",-1),h=0;h<d.length;h++){var f=d[h].f,g=f.wm;if(g&&3>Math.abs(255*g[0]-e[0])&&3>Math.abs(255*g[1]-e[1])&&3>Math.abs(255*g[2]-e[2]))return f.Jb&&f.Zv&&(da.outlining_overview_mode?a.apply_outline_anim(d[h],da.nj,da.oj,da.pj):(e=f.mj,a.apply_outline_anim(d[h],e.nj,e.oj,e.pj))),d[h]}return null};a.set_wind_params=function(a,c){for(var d=k(a,"EMPTY",-1),e=0;e<d.length;e++){var h=d[e];if(h.Fi&&"WIND"===h.Fi.type)var f=h}if(!f)return I.error("There is no wind on the scene"),0;"number"==typeof c.wind_dir&&
(U.set(-Math.PI/2,c.wind_dir/180*Math.PI,0,ma),T.euler_to_quat(ma,la),M.set_rotation(f,la),b(f));"number"==typeof c.wind_strength&&(f.Fi.ix=c.wind_strength,b(f));y.ys(a)};a.remove_object=function(a){A.RA(a)&&A.remove(a);var b=W.ALL,c=W[a.type],d=b.indexOf(a);a=c.indexOf(a);-1!=d&&b.splice(d,1);-1!=a&&c.splice(a,1)};a.$E=w;a.aF=function(a){return W[a.type]&&-1<W[a.type].indexOf(a)};a.set_nodemat_rgb=function(a,b,c,d,e){b=b.join("%join%");var k=h(a,b);null!=k?(a.f.sd[3*k]=c,a.f.sd[3*k+1]=d,a.f.sd[3*
k+2]=e):I.error('The RGB node "'+b+'" was not found in the object "'+a.name+'".')};a.set_nodemat_value=function(a,b,c){b=b.join("%join%");var d=z(a,b);null!=d?a.f.rf[d]=c:I.error('The Value node "'+b+'" was not found in the object "'+a.name+'".')}};b4w.module.__obj_util=function(a,p){function d(a){if(!(a instanceof Object))return a;var b=null,c=null,k=null;a.U&&(b=a.U,a.U=null);a.ic&&(c=a.ic,a.ic=null);a.na&&(k=a.na,a.na=null);var f;f=a.constructor;switch(f){case Float32Array:case Uint32Array:case Uint16Array:f=new f(a);break;case Array:f=new f(a.length);for(var l=0;l<a.length;l++)f[l]=d(a[l]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:f=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:f=null;break;case Function:f=
a;break;default:for(l in f=new f,a)f[l]=d(a[l])}b&&(f.U=b,a.U=b);c&&(f.ic=c,a.ic=c);k&&(f.na=k,a.na=k);return f}function b(a,b){for(var c=a.J,d=0;d<c.length;d++){var f=c[d];if(f.Ea==b)return f}return null}function c(a){return a.ng?a.parent:a.parent?c(a.parent):null}var q=p("__tsr"),f=p("__util"),t=p("__vec3"),l=p("__vec4"),n=p("__config").p;new Float32Array(4);new Float32Array(4);new Float32Array(4);q.create();q.create();a.zi=function(a){a={id:0,type:a,Ic:0,ID:[0,0],h:q.Bp(),Sa:new Float32Array(3),
Ka:new Float32Array(3),Vi:0,Wi:0,lv:!1,wm:null,lg:0,ms:!1,Se:t.create(),Bs:!1,Qa:0,Nl:1,Ml:1,Ol:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,ld:null,ZG:!1,ba:null,s:null,hb:null,tb:null,bc:null,Vp:!0,fv:0,L:null,Pr:null,mj:{nj:1,oj:1,pj:0},Kd:null,vd:null,cc:new Float32Array(4),Nk:0,Hk:0,al:0,Ah:0,Im:!1,Uc:!1,wc:!1,Vc:!1,Cc:!1,tc:!1,Rc:!1,Ke:"",af:!1,Hd:!1,Hm:!1,De:!1,$b:!1,ih:!1,rh:!1,ln:!1,yf:!1,Bn:!1,Jb:!1,An:!1,Zv:!1,hn:!1,is_visible:!1,eq:!1,Ql:0,Te:0,Gf:0,ff:0,ef:0,$e:0,qf:"",qc:null,
nm:!1,ae:!1,bp:!1,ck:"",bk:!1,Pd:0,time:0,Ds:0,Nx:0,sf:0,Mk:!1,jc:!1,qe:!1,ug:[],Yi:!1,Ug:!1,Mf:1,Po:0,Oo:1,jo:new Int8Array([-1,-1]),Wn:[],Iv:[],Tw:[],Qc:null,wd:null,Yc:null,Ed:null,Jd:null,vi:null,or:null,So:null,Ro:null,rf:null,Ch:null,sn:null,sd:null,Bh:null,tn:null,ti:null,Zb:null,Zo:null,Xo:null,Yo:null,Ab:null,fd:null,Ub:null,Ze:null,Nf:null,fg:1E4};t.copy(f.AXIS_Y,a.Se);return a};a.vk=function(a,b,c){c||(c=a);return{name:a,fi:f.iq(),Jh:c,type:b,wi:!1,ka:!1,Yk:!1,oo:!1,f:null,gb:null,F:null,
La:null,im:null,anchor:null,Fi:null,un:null,J:[],jc:[],be:[],yp:[],M:[],ql:[],Td:[],qi:[],me:null,Uh:[],parent:null,ng:!1,il:"",zo:null,di:!1,Va:"",Am:"AUTO",Mc:!1,is_character:!1,vh:!1,o:null,l:null,Od:null,Zc:null,Gi:null,Gt:null,nr:[],le:{Gn:"NO_COLLISION",Kl:!1,Mx:!1,Ge:0,Qx:0,Px:0,Kp:0,Er:0,xE:!1,yE:!1,zE:!1,AE:!1,BE:!1,CE:!1,pk:0,nk:0,qk:0,zs:!1,vm:"BOX",Jl:!1},Yv:{co:0,ir:0,ud:0,xr:0},em:0,actions:[],dr:!1,Jv:[]}};a.zp=function(a){return a instanceof Array?a.slice():a};a.yi=d;a.ka=function(a){return a.ka};
a.Hq=function(a){return"MESH"==a.type&&a.ka};a.ak=function(a,b){a.J.push({Ea:b,fn:!1,T:[],Je:[],Sf:null,Rr:[],xh:0,Wv:!1})};a.hm=function(a,c,d){b(a,c).T.push(d)};a.NK=function(a,b){for(var c=a.J,d=0;d<c.length;d++)if(c[d].Ea==b){c.splice(d,1);break}};a.Pa=b;a.Gx=function(a,b){for(var c=0;c<a.length;c++)l.copy(b,a[c].f.cc)};a.Gr=function(a,b,c){for(var d=0;d<a.J.length;d++){var f=a.J[d];c&&f.Ea!=c||(f.fn=b)}};a.Vm=function(a,b){for(var c=[],d=b?n.Gv-1:n.Gv,f=0;f<a.length;f++){var l=a[f];l.La.Du&&
c.length<d&&c.push(l)}return c.length?c:a[0]?[a[0]]:[]};a.It=function(a,b){if(b.b4w_enable_soft_particles&&0<b.b4w_particles_softness){var c=b.material-1,d=a.data.materials;if(0<=c&&c<d.length&&("ADD"==d[c].game_settings.alpha_blend||"ALPHA"==d[c].game_settings.alpha_blend||"ALPHA_SORT"==d[c].game_settings.alpha_blend))return!0}return!1};a.Au=function(a,b){return a+"*"+b};a.get_parent=function(a){return a.ng?null:a.parent};a.get_dg_parent=c;a.nq=function(a,b){for(var d=[],k=0;k<b.length;k++){var f=
b[k];c(f)==a&&d.push(f)}return d};a.is_mesh=function(a){return"MESH"===a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.is_speaker=function(a){return"SPEAKER"===a.type};a.is_camera=function(a){return"CAMERA"===a.type};a.is_lamp=function(a){return"LAMP"===a.type};a.is_empty=function(a){return"EMPTY"===a.type};a.is_line=function(a){return"LINE"===a.type}};b4w.module.__particles=function(a,p){function d(){throw"_rand() undefined";}function b(a,b,c,d,f,l,n){var m=a.Gm,q=a.fe,A=a.time;a=a.nw;for(var r=b?4:1,e=0;e<m.length;e+=r){var v=m[e];if(A>a&&A>=v&&v>a||A<a&&(v>a||A>=v))for(v=0;8>v;v++)q[8*e+v]=f[v],g[v]=f[v];else for(v=0;8>v;v++)g[v]=q[8*e+v];v=z;v[0]=c[3*e];v[1]=c[3*e+1];v[2]=c[3*e+2];t.transform_vec3(v,g,v);l[3*e]=v[0];l[3*e+1]=v[1];l[3*e+2]=v[2];var p=z;p[0]=d[3*e];p[1]=d[3*e+1];p[2]=d[3*e+2];t.transform_dir_vec3(p,g,p);n[3*e]=p[0];n[3*e+1]=p[1];
n[3*e+2]=p[2];if(b)for(v=1;4>v;v++)l[3*(e+v)]=l[3*e],l[3*(e+v)+1]=l[3*e+1],l[3*(e+v)+2]=l[3*e+2],n[3*(e+v)]=p[0],n[3*(e+v)+1]=p[1],n[3*(e+v)+2]=p[2]}}function c(a){a?(l.FG(a),d=function(){return l.uF()}):d=function(){return Math.random()}}p("__config");var q=p("__geometry");p("__scenes");var f=p("__time"),t=p("__tsr"),l=p("__util"),n=p("__vec3"),g=new Float32Array(8),z=new Float32Array(3);a.jj=function(a){a=a.J;for(var b=0;b<a.length;b++)for(var c=a[b].T,d=0;d<c.length;d++)if(c[d].Da)return!0;return!1};
a.Vv=function(a){a=a.J;for(var b=0;b<a.length;b++)for(var c=a[b].T,d=0;d<c.length;d++){var f=c[d].Da;if(f&&"EMITTER"==f.jr)return!0}return!1};a.BA=function(a){return 0<a.particle_systems.length};a.AA=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.LD=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.PD=function(a,b,c){var d=
a.Da={name:b.name,jr:b.settings.type,time:0,nw:-1,so:!1,N:0,ja:0,ux:0,Pq:0,yv:0,cyclic:!1,Ge:0,er:0,Vu:0,lh:0,md:0,ey:0,size:0,it:0,ht:0,Sw:0,Qt:0,Rw:new Float32Array(8),Pt:new Float32Array(16),rj:null,iw:null,Rv:null,Sv:null,Gm:null,Op:null,fe:null};d.N=b.settings.frame_start;d.ja=b.settings.frame_end;d.ux=(d.ja-d.N)/f.Wb();d.Pq=b.settings.lifetime;d.yv=d.Pq/f.Wb();d.cyclic=b.settings.b4w_cyclic?1:0;d.Ge=b.settings.mass;d.er=b.settings.normal_factor;d.Vu=9.81*b.settings.effector_weights.gravity;
d.lh=b.settings.b4w_fade_in/f.Wb();d.md=b.settings.b4w_fade_out/f.Wb();d.ey=b.settings.effector_weights.wind;d.so="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var g,l;a.qh?(a=c.halo.size,g=c.halo.hardness,30>g?(g=.5,l=.9):40>g?(g=.1,l=1):50>g?(g=0,l=.8):(g=0,l=.5)):(a=b.settings.particle_size,l=g=1);d.size=a;d.it=g;d.ht=l;a=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(a[0]&&a[0].use_map_size&&a[0].texture&&"BLEND"==a[0].texture.type&&a[0].texture.use_color_ramp){a=a[0].texture.color_ramp.elements;
g=Math.min(2*a.length,b.length);for(l=0;l<g;l+=2){var n=a[l/2];b[l]=n.position;b[l+1]=(n.color[0]+n.color[1]+n.color[2])/3}d.Sw=a.length}d.Rw.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){a=b[0].texture.color_ramp.elements;g=Math.min(4*a.length,c.length);for(l=0;l<g;l+=4)n=a[l/4],c[l]=n.position,c[l+1]=n.color[0],c[l+2]=n.color[1],c[l+3]=n.color[2];d.Qt=a.length}d.Pt.set(c)};
a.QC=function(a,k,g,t){var p=a.Da,z=g.settings.count,G=g.settings.frame_start/f.Wb(),m=g.settings.frame_end/f.Wb(),x=g.settings.lifetime/f.Wb(),A=g.settings.lifetime_random,r=g.settings.emit_from,e=g.settings.factor_random,v=g.settings.angular_velocity_mode,J=g.settings.angular_velocity_factor,D=g.settings.b4w_randomize_emission,H=g.settings.b4w_cyclic,I=!a.qh;c(g.seed);k=q.su(k,["a_position","a_normal"],null);switch(r){case "VERT":g=k.B[0].a_position;k=k.B[0].a_normal;for(var P=g.length/3,r=[],K=
0;K<z;K++){var y=Math.round((P-1)*d());r.push(y);I&&(r.push(y),r.push(y),r.push(y))}P=[];for(K=0;K<r.length;K++)P.push(g[3*r[K]]),P.push(g[3*r[K]+1]),P.push(g[3*r[K]+2]);g=new Float32Array(P);P=[];for(K=0;K<r.length;K++)P.push(k[3*r[K]]),P.push(k[3*r[K]+1]),P.push(k[3*r[K]+2]);r=new Float32Array(P);break;case "FACE":g=[];r=[];K=[];l.dn(0,K);P=q.kq(k,z,!1,K);l.dn(0,K);k=q.kq(k,z,!0,K);for(K=0;K<P.length;K++)g.push(P[K][0],P[K][1],P[K][2]),I&&(g.push(P[K][0],P[K][1],P[K][2]),g.push(P[K][0],P[K][1],
P[K][2]),g.push(P[K][0],P[K][1],P[K][2])),r.push(k[K][0],k[K][1],k[K][2]),I&&(r.push(k[K][0],k[K][1],k[K][2]),r.push(k[K][0],k[K][1],k[K][2]),r.push(k[K][0],k[K][1],k[K][2]));g=new Float32Array(g);r=new Float32Array(r);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}r=[g,r];k=r[0];r=r[1];p.rj=new Float32Array(k);p.Rv=new Float32Array(r);p.iw=new Float32Array(k.length);p.Sv=new Float32Array(r.length);g=[];m=(m-G)/z;for(P=0;P<z;P++)K=
D?m*P+10*m*(.5-d()):m*P,H||(K+=G),g.push(K),I&&(g.push(K),g.push(K),g.push(K));G=new Float32Array(g);p.Gm=new Float32Array(G);p.Op=new Float32Array(G);if(p.so){p.fe=new Float32Array(8*G.length);for(D=0;D<8*G.length;D++)for(H=0;8>H;H++)p.fe[8*D+H]=t[H];b(p,I,k,r,t,k,r)}t=l.Vb("EMITTER_PARTICLES");p=l.ce();p.a_position=k;p.a_normal=r;t.B[0]=p;if(I){a.Ce=q.Ul;a=[];for(p=0;p<z;p++)a.push(4*p,4*p+2,4*p+1,4*p,4*p+3,4*p+2);a=new Uint16Array(a);t.Ca=a;a=t.X;p=[];for(D=0;D<z;D++)p.push(-.5,-.5,-.5,.5,.5,.5,
.5,-.5);p=new Float32Array(p);a.a_p_bb_vertex=p}else a.Ce=q.Os,t.Ca=new Uint16Array(0);t.ea=k.length/3;t.X.a_p_delay=G;a=t.X;p=[];A*=x;for(G=0;G<z;G++)D=A*d(),p.push(x-D),I&&(p.push(x-D),p.push(x-D),p.push(x-D));x=new Float32Array(p);a.a_p_lifetime=x;x=t.X;A=[];for(a=0;a<z;a++){p=[d()-.5,d()-.5,d()-.5];n.normalize(p,p);A.push(e*p[0]);A.push(e*p[1]);A.push(e*p[2]);switch(v){case "NONE":A.push(0);break;case "SPIN":case "VELOCITY":A.push(J);break;case "RAND":A.push(2*J*(d()-.5));break;default:throw"Undefined velocity factor";
}if(I)for(p=A.slice(-4),G=0;12>G;G++)A.push(p[G%4])}z=new Float32Array(A);x.a_p_vels=z;return t};a.pH=function(a,c){for(var d=0;d<c.length;d++){var f=c[d],g=f.Da;if(g&&g.so){var l=f.O,n=g.iw,m=g.Sv;b(g,!f.qh,g.rj,g.Rv,a.f.h,n,m);q.HE(l);q.lo(l,"a_position",3,n);q.lo(l,"a_normal",3,m)}}};a.fG=function(a,b,c){a=a.J;for(var d=0;d<a.length;d++)for(var f=a[d].T,g=0;g<f.length;g++){var l=f[g].Da;l&&l.name==b&&(l.nw=l.time,l.time=c)}};a.oF=function(a){for(var b=a.ea,c=a.B[0].a_position,d=a.X.a_texcoord,
f=[],g=[],l=0;l<b;l++)g.push(c[3*l]),g.push(c[3*l+1]),f.push(c[3*l+2]);f=new Float32Array(f);g=new Float32Array(g);a.X.a_lf_dist=f;a.X.a_lf_bb_vertex=g;a.X.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.J;for(var d=0;d<a.length;d++)for(var f=a[d].T,g=0;g<f.length;g++){var l=f[g].Da;l&&l.name==b&&(l.size=c)}};a.set_normal_factor=function(a,b,c){a=a.J;for(var d=0;d<a.length;d++)for(var f=a[d].T,g=0;g<f.length;g++){var l=f[g].Da;l&&l.name==b&&(l.er=c)}};a.set_factor=function(a,b,c){a=a.J;for(var d=
0;d<a.length;d++)for(var f=a[d].T,g=0;g<f.length;g++){var l=f[g],m=l.Da;if(m&&m.name==b){var n=m.Gm;if(1==c)m=n;else if(0==c)for(var t=!l.qh,r=t?4:1,m=m.Op,e=0;e<m.length;e+=r)m[e]=1E4,t&&(m[e+1]=m[e],m[e+2]=m[e],m[e+3]=m[e]);else for(var v=1/c,m=m.Op,r=(t=!l.qh)?4:1,p=0,e=0;e<m.length;e+=r)e>=p?(m[e]=n[e],p+=v):m[e]=1E4,t&&(m[e+1]=m[e],m[e+2]=m[e],m[e+3]=m[e]);q.lo(l.O,"a_p_delay",1,m)}}};a.DH=function(a,b,c){a=a.J;for(var d=0;d<a.length;d++)for(var f=a[d].T,g=0;g<f.length;g++){var l=f[g].Da;if(l&&
l.so)for(var m=0;m<8*l.Gm.length;m++)l.fe[8*m]=b[0],l.fe[8*m+1]=b[1],l.fe[8*m+2]=b[2],l.fe[8*m+3]=b[3],l.fe[8*m+4]=c[0],l.fe[8*m+5]=c[1],l.fe[8*m+6]=c[2],l.fe[8*m+7]=c[3]}}};b4w.module.__primitives=function(a,p){function d(a,b,c,d){for(var f=[],n=[],q=[],t=[],p=2*c/(a-1),m=2*d/(b-1),x=0;x<a;x++)for(var A=-c+x*p,r=0;r<b;r++)if(n.push(A,0,-d+r*m),q.push(0,1,0),t.push(x/(a-1),r/(b-1)),x&&r){var e=x*b+r,v=e-1,J=(x-1)*b+r,D=J-1;f.push(e,v,J);f.push(v,D,J)}a=l.ce();a.a_position=new Float32Array(n);a.a_normal=new Float32Array(q);q=l.Vb("GRID_PLANE");q.B[0]=a;q.X.a_texcoord=new Float32Array(t);q.Ca=new Uint32Array(f);q.ea=n.length/3;return q}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=4){var n=a[f+1],t=a[f+2],p=a[f+3];q(a[f],d);q(n,d);q(t,d);q(p,d);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=l.ce();a.a_position=new Float32Array(d);b=l.Vb("FROM_QUADS");b.B[0]=a;b.Ca=new Uint32Array(c);b.ea=d.length/3;return b}function c(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function q(a,b){b.push(a[0],a[1],a[2])}var f=p("__config"),t=p("__geometry");p("__print");var l=p("__util"),n=f.p;a.UC=function(){var a=l.Vb("LINE"),b=l.ce();b.a_position=new Float32Array(3);
b.a_direction=new Float32Array(3);a.B[0]=b;a.Ca=new Uint32Array(1);a.ea=1;return a};a.RJ=function(a,b){var c=d(2,2,a,b);c.name="PLANE";return c};a.QJ=d;a.XC=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==E-1)||1==b%2&&(0==a||a==p-1)?!0:!1}var f=c/=Math.pow(2,a-1),q=c,p=b+1,E=b+1;b=[];c=[];for(var G=0,m=0,x=-1,A=[],r=0;r<a;r++){for(var e=2*f/(p-1),v=2*q/(E-1),J=[],D=[],H=0,I=0;I<p;I++){for(var P=-f+I*e,K=[],y=0;y<E;y++){var F=-q+y*v;if(P>-G&&P<G&&F>-m&&F<m)K.push(-1),H++;else{for(var M=null,
O=0;O<A.length;O+=3)if(P==A[O]&&F==A[O+1]){M=A[O+2];break}O=null!==M?M:x+1;d(I,y)?(K.push(-2),H++):(null==M&&(0==y||y==E-1||0==I||I==p-1?(M=r==a-1?e:2*e,J.push(P,F,O)):M=e,c.push(P,M,F),x++),K.push(O));if(I&&y)if(1==I)if(d(I-1,y)){if(1<y){var F=O-1,M=D[I-1][y+1],V=M-1;b.push(O,F,V)}else M=D[I-1][y+1],V=M-1;b.push(O,V,M)}else d(I,y)||(F=O-1,M=D[I-1][y],b.push(O,F,M));else if(I==p-1){if(!d(I,y))if(y==E-1)F=O-1,M=D[I-1][y-1],V=D[I-2][y],b.push(O,F,M),b.push(O,M,V);else{var F=O-1,M=D[I-1][y],V=M-1,T=
M+1;b.push(O,F,V);b.push(O,V,M);b.push(O,M,T);2==y&&(T=D[I-2][y-2],b.push(F,T,V))}}else 1==y?d(I,y-1)?(F=D[I-1][y],M=D[I-1][y-1],b.push(O,M,F)):(F=K[y-1],M=D[I-1][y],V=D[I-2][y-1],b.push(O,F,M),b.push(F,V,M)):y==E-1?d(I,y)||(F=K[y-1],M=D[I-1][y-1],V=D[I-2][y],b.push(O,F,M),b.push(O,M,V)):-1!=D[I-1][y]&&-1!=D[I-1][y-1]&&-1!=K[y-1]?(F=K[y-1],M=D[I-1][y],V=D[I-1][y-1],b.push(O,F,M),b.push(F,V,M),y==E-2&&d(I,y+1)&&(T=D[I-1][y+1],b.push(O,M,T))):y==E-2&&d(I,y+1)&&(M=D[I-1][y],T=D[I-1][y+1],b.push(O,M,
T))}}D.push(K)}A=J;G=f;m=q;f*=2;q*=2}2E4>G&&(a=-(2*G)/(p-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-G,a,-m),c.push(-G,a,m),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(G,a,-m),c.push(G,a,m),O=x+1,b.push(O+3,O+2,O+1,O+2,O+0,O+1,O+6,O+4,O+2,O+4,O+0,O+2,O+5,O+7,O+1,O+7,O+3,O+1,O+5,O+4,O+7,O+7,O+4,O+6));a=l.ce();a.a_position=new Float32Array(c);f=l.Vb("multigrid_plane");f.B[0]=a;f.Ca=new Uint32Array(b);f.ea=c.length/3;n.dy&&(t.bo(f,1,!0),a.a_polyindex=t.aq(f));return f};a.PJ=function(a){var b=a.length;
if(b%3)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=3){var n=a[f+1],t=a[f+2];q(a[f],d);q(n,d);q(t,d);c.push(f,f+1,f+2)}a=l.ce();a.a_position=new Float32Array(d);b=l.Vb("FROM_TRIANGLES");b.B[0]=a;b.Ca=new Uint32Array(c);b.ea=d.length/3;return b};a.OJ=b;a.RC=function(a){a=l.YH(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};a.Pb=function(){var a=
l.Vb("FULLSCREEN_TRI"),b=l.ce();b.a_position=new Float32Array([0,0,1,0,0,1]);a.B[0]=b;a.Ca=new Uint32Array([0,1,2]);a.ea=3;return a};a.SC=function(){var a=l.Vb("FULLSCREEN_QUAD"),b=l.ce();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.B[0]=b;a.Ca=new Uint32Array([0,2,1,1,2,3]);a.ea=4;return a};a.NC=function(){var a=l.Vb("BILLBOARD"),b=l.ce();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.B[0]=b;a.Ca=new Uint32Array([0,2,1,0,3,2]);a.ea=4;return a};a.OC=function(){var a=l.Vb("CUBEMAP_BOARD"),
b=l.ce();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.B[0]=b;a.Ca=new Uint32Array([0,2,1,0,3,2]);a.ea=4;return a};a.jq=function(a,b){var d=l.Vb("UV_SPHERE"),f,n,p=[],C=[],E=[];for(n=0;8>=n;n++)for(f=0;16>=f;f++){var G=f/16,m=n/8;C.push(-a*Math.cos(2*G*Math.PI)*Math.sin(m*Math.PI)+b[0],a*Math.cos(m*Math.PI)+b[1],a*Math.sin(2*G*Math.PI)*Math.sin(m*Math.PI)+b[2])}for(n=G=0;8>n;n++)for(f=0;16>f;f++){var m=c(C,17*n+f+1),x=c(C,17*n+f),A=c(C,17*(n+1)+f),r=c(C,17*(n+1)+f+1);Math.abs(m[1])==a+b[1]?
(q(m,p),q(A,p),q(r,p),E.push(G,G+1,G+2),G+=3):Math.abs(A[1])==a+b[1]?(q(m,p),q(x,p),q(A,p),E.push(G,G+1,G+2),G+=3):(q(m,p),q(x,p),q(A,p),q(r,p),E.push(G,G+1,G+2),E.push(G,G+2,G+3),G+=4)}f={};f.a_position=p;C=t.zt(E,C,p);f.a_normal=t.yt(E,p,C);f.a_tangent=[];d.X.a_influence=[];d.X.a_color=[];d.X.a_texcoord=[];d.B[0]=f;d.Ca=E;d.ea=p.length/3;return d};a.Cu=function(a){var b=l.Vb("INDEX"),c=l.ce();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.B[0]=c;b.Ca=new Uint16Array(0);b.ea=
a;return b}};b4w.module.__prerender=function(a,p){function d(a,b){var d=a.ke;d.is_visible=!1;var f=b.j,g="SHADOW_CAST"==b.type?f.Cv:t.Ri(f.h,h),n;if(!(n=!d||d.rh)){var m=d.Ub.I;n=d.fg;g=Math.sqrt((m[0]-g[0])*(m[0]-g[0])+(m[1]-g[1])*(m[1]-g[1])+(m[2]-g[2])*(m[2]-g[2]));m=d.Ah*d.Ub.Ma;n=!(g>=d.al&&g<n+m)}if(n)return!1;d.is_visible=!0;(n="OUTLINE_MASK"==b.type&&!Boolean(d.lg))||(f=f.Ok,d.ih?n=!1:("STATIC"===d.type?(n=d.Ub,d=n.I,d=l.AG(d,f,n.Ma)):(n=d.Nf,d=n.I,d=l.mC(d,f,n.we,n.xe,n.ye)),n=d));return n?!1:"WIREFRAME"==
b.type?a.G.wireframe_mode==c.WM_DEBUG_SPHERES?a.G.gh:!a.G.gh:!0}var b=p("__config"),c=p("__debug"),q=p("__geometry"),f=p("__renderer"),t=p("__tsr"),l=p("__util"),n=p("__vec3"),g=b.p,z="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" "),h=new Float32Array(3);a.pr=function(a){if(-1<z.indexOf(a.type)){for(var b=!1,c=a.q,l=0;l<c.length;l++){var p=c[l];if("MAIN_CUBE_REFLECT"==a.type)for(var G=
0;6>G;G++)a.j.Ok=a.Gp[G],p.Sp[G]=d(p,a),p.Sp[G]&&(b=!0);else p.Ib=d(p,a),p.Ib&&(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||"MAIN_GLOW"===a.type||b?a.Ib=!0:(a.Ib&&f.clear(a),a.Ib=!1)}}if("MAIN_BLEND"==a.type&&g.alpha_sort&&a.q){b=t.Ri(a.j.h,h);c=n.dist(b,a.iy)>g.alpha_sort_threshold;for(l=0;l<a.q.length;l++)if(G=a.q[l],p=G.ke,p.eq||c){var m=G.G;if(m&&m.Za&&m.Jf!=q.Ve){m=m.O;if(!m||!G.Ib)continue;(G=m.cn)&&G.type==q.Ys&&q.jH(m,p.h,b)}p.eq=!1}c&&n.copy(b,
a.iy)}}};b4w.module.__print=function(a){function p(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}function d(){f++;var a=p(arguments,"B4W ERROR");console.error.apply(console,a)}function b(a){a in l||(l[a]=a,d([a]))}function c(a,c){b(a+"() is deprecated, use "+c+"() instead.")}var q=!1,f=0,t=0,l={};a.gG=function(a){q=a};a.Vq=function(){console.log.apply(console,arguments)};a.log=function(){if(q){var a=p(arguments,
"B4W LOG");console.log.apply(console,a)}};a.error=d;a.Nm=b;a.Ga=c;a.jf=function(a,d){switch(1<d.length){case !0:b(a+"() is deprecated, use "+d.slice(0,-1).join("(), ")+"() or "+d[d.length-1]+"() instead.");break;case !1:c(a,d[0])}};a.oC=function(){b('Config option "anaglyph_use" is deprecated, use "stereo" instead.')};a.warn=function(){t++;var a=p(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=p(arguments,"B4W INFO");console.info.apply(console,a)};a.rC=function(){f++;
var a=p(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.sC=function(){t++;var a=p(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){q&&console.time.apply(console,arguments)};a.timeEnd=function(){q&&console.timeEnd.apply(console,arguments)};a.group=function(){q&&console.group.apply(console,arguments)};a.groupCollapsed=function(){q&&console.groupCollapsed.apply(console,arguments)};a.groupEnd=function(){q&&console.groupEnd.apply(console,arguments)};a.clear=
function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.FD=function(){return t};a.oD=function(){return f};a.clear_errors_warnings=function(){f=t=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function d(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",c("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,c("node material",a,"alpha"));"darkness"in a||(a.darkness=1,c("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,c("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,c("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in
a||(a.diffuse_intensity=1,c("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",c("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,c("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,c("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,c("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,c("node material",a,"specular_toon_size"));
"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,c("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,c("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",c("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,c("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,c("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,c("node material",
a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,c("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}}}
function b(a){if(a=a.nla_tracks)for(var b=0;b<a.length;b++)for(var d=a[b],f=0;f<d.strips.length;f++){var h=d.strips[f];"action"in h||(h.action=null,c("strip",h,"action"));"action_frame_start"in h||(h.action_frame_start=0,c("strip",h,"action_frame_start"));"action_frame_end"in h||(h.action_frame_end=h.frame_end-h.frame_start,c("strip",h,"action_frame_end"));"repeat"in h||(h.repeat=1,c("strip",h,"repeat"));"use_reverse"in h||(h.use_reverse=!1,c("strip",h,"use_reverse"));"scale"in h||(h.scale=1,c("strip",
h,"scale"))}}function c(a,b,c){c=c+">>"+a;c in E||(E[c]={ds:[],Bw:"undefined",type:a});E[c].ds.push(b.name)}function q(a,b,c){c=c+">>"+a;c in E||(E[c]={ds:[],Bw:"deprecated",type:a});E[c].ds.push(b.name)}function f(a){z.warn(a)}function t(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var f=k.ah(a);a.materials=c;a.submeshes=d;f.name=b;f.materials=a.materials.slice(0);f.submeshes=[];for(c=0;c<d.length;c++){var e=k.mk(d[c]);f.submeshes.push(e)}return f}
var l=p("__boundings"),n=p("__curve"),g=p("__mat4"),z=p("__print"),h=p("__quat"),k=p("__util"),u=p("__vec3"),w=p("__vec4"),C=[5,4],E={};a.Jt=function(a){return-1!=k.Rx(a,C)};a.PA=function(a){E={};var h=a.worlds;if(0==h.length){z.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var g={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},
fog_settings:{use_fog:!1,intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};h.push(g)}for(var h=a.worlds,l=0;l<h.length;l++){g=h[l];"use_sky_blend"in g||(c("world",g,"use_sky_blend"),g.use_sky_blend=!1);"use_sky_paper"in g||(c("world",g,"use_sky_paper"),g.use_sky_paper=!1);"use_sky_real"in g||(c("world",g,"use_sky_real"),g.use_sky_real=!1);"b4w_sky_settings"in g&&"rayleigh_brightness"in
g.b4w_sky_settings||(c("world",g,"rayleigh_brightness"),g.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in g||(c("world",g,"fog_settings"),g.fog_settings={use_fog:!1,intensity:0,depth:25,start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,
color:[.5,.5,.5]},"b4w_fog_color"in g&&(g.fog_settings.use_custom_color=!0,g.fog_settings.color=g.b4w_fog_color),"b4w_fog_density"in g&&0<g.b4w_fog_density&&(g.fog_settings.depth=1/g.b4w_fog_density));"render_sky"in g.b4w_sky_settings||(c("world",g,"render_sky"),g.b4w_sky_settings.render_sky=!1);for(var r=g.texture_slots,g=0;g<r.length;g++){var e=r[g];"blend_type"in e||(e.blend_type="MIX",c("world_texture_slot",e,"blend_type"));"use_map_blend"in e||(e.use_map_blend=!1,c("world_texture_slot",e,"use_map_blend"));
"use_map_horizon"in e||(e.use_map_horizon=!0,c("world_texture_slot",e,"use_map_horizon"));"use_map_zenith_up"in e||(e.use_map_zenith_up=!1,c("world_texture_slot",e,"use_map_zenith_up"));"use_rgb_to_intensity"in e||(e.use_rgb_to_intensity=!1,c("world_texture_slot",e,"use_rgb_to_intensity"));"invert"in e||(e.invert=!1,c("world_texture_slot",e,"invert"));"color"in e||(e.color=[1,0,1],c("world_texture_slot",e,"color"));"blend_factor"in e||(e.blend_factor=0,c("world_texture_slot",e,"blend_factor"));"horizon_factor"in
e||(e.horizon_factor=1,c("world_texture_slot",e,"horizon_factor"));"zenith_up_factor"in e||(e.zenith_up_factor=0,c("world_texture_slot",e,"zenith_up_factor"));"zenith_down_factor"in e||(e.zenith_down_factor=0,c("world_texture_slot",e,"zenith_down_factor"));"default_value"in e||(e.default_value=1,c("world_texture_slot",e,"default_value"))}}g=a.scenes;for(l=0;l<g.length;l++)r=g[l],e=r.world,"timeline_markers"in r||(r.timeline_markers=null,c("scene",r,"timeline_markers")),"b4w_reflection_quality"in r||
(r.b4w_reflection_quality="MEDIUM",c("scene",r,"b4w_reflection_quality")),"b4w_use_nla"in r||(r.b4w_use_nla=!1,c("scene",r,"b4w_use_nla")),"fps"in r||(r.fps=24,c("scene",r,"fps")),"b4w_nla_cyclic"in r||(r.b4w_nla_cyclic=!1,c("scene",r,"b4w_nla_cyclic")),"b4w_logic_nodes"in r||(r.b4w_logic_nodes=[],c("scene",r,"b4w_logic_nodes")),"b4w_detect_collisions"in r&&(q("scene",r,"b4w_detect_collisions"),delete r.b4w_detect_collisions),"audio_doppler_speed"in r||(r.audio_doppler_speed=343.3),"audio_doppler_factor"in
r||(r.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in r||(r.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},c("scene",r,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in r||(r.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in r||(r.b4w_enable_bloom=!1,c("scene",r,"b4w_enable_bloom")),"b4w_enable_motion_blur"in r||(r.b4w_enable_motion_blur=!1,c("scene",r,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in r||(r.b4w_enable_color_correction=
!1,c("scene",r,"b4w_enable_color_correction")),"b4w_antialiasing_quality"in r||(r.b4w_antialiasing_quality="MEDIUM",c("scene",r,"b4w_antialiasing_quality")),"b4w_tags"in r||(r.b4w_tags={title:"",description:""},c("scene",r,"b4w_tags")),"b4w_enable_object_selection"in r||(r.b4w_enable_object_selection="AUTO",c("scene",r,"b4w_enable_object_selection")),"b4w_enable_outlining"in r||(r.b4w_enable_outlining="AUTO",c("scene",r,"b4w_enable_outlining")),"b4w_enable_glow_materials"in r||(r.b4w_enable_glow_materials=
"AUTO",c("scene",r,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in r||(r.b4w_enable_anchors_visibility="AUTO",c("scene",r,"b4w_enable_anchors_visibility")),"b4w_outline_color"in r||(r.b4w_outline_color=[1,1,1],c("scene",r,"b4w_outline_color")),"b4w_outline_factor"in r||(r.b4w_outline_factor="b4w_glow_factor"in r?r.b4w_glow_factor:1,c("scene",r,"b4w_outline_factor")),"b4w_shadow_settings"in r||(c("scene",r,"b4w_shadow_settings"),h=e.b4w_shadow_settings,r.b4w_shadow_settings=h?h:{csm_resolution:2048,
self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),h=r.b4w_shadow_settings,"csm_resolution"in h||(c("scene",r,"b4w_shadow_settings.csm_resolution"),h.csm_resolution=2048),"self_shadow_polygon_offset"in h||(c("scene",r,"b4w_shadow_settings.self_shadow_polygon_offset"),h.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in h||
(c("scene",r,"b4w_shadow_settings.self_shadow_normal_offset"),h.self_shadow_normal_offset=.01),"b4w_enable_csm"in h||(c("scene",r,"b4w_shadow_settings.b4w_enable_csm"),h.b4w_enable_csm=!1),"csm_num"in h||(c("scene",r,"b4w_shadow_settings.csm_num"),h.csm_num=1),"csm_first_cascade_border"in h||(c("scene",r,"b4w_shadow_settings.csm_first_cascade_border"),h.csm_first_cascade_border=10),"first_cascade_blur_radius"in h||(c("scene",r,"b4w_shadow_settings.first_cascade_blur_radius"),h.first_cascade_blur_radius=
3),"csm_last_cascade_border"in h||(c("scene",r,"b4w_shadow_settings.csm_last_cascade_border"),h.csm_last_cascade_border=100),"last_cascade_blur_radius"in h||(c("scene",r,"b4w_shadow_settings.last_cascade_blur_radius"),h.last_cascade_blur_radius=1.5),"fade_last_cascade"in h||(c("scene",r,"b4w_shadow_settings.fade_last_cascade"),h.fade_last_cascade=!0),"blend_between_cascades"in h||(c("scene",r,"b4w_shadow_settings.blend_between_cascades"),h.blend_between_cascades=!0),"b4w_ssao_settings"in r||(c("scene",
r,"b4w_ssao_settings"),h=e.b4w_ssao_settings,r.b4w_ssao_settings=h?h:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),h=r.b4w_ssao_settings,"dist_factor"in h||(c("scene",r,"b4w_ssao_settings.dist_factor"),h.dist_factor=0),"samples"in h||(c("scene",r,"b4w_ssao_settings.samples"),h.samples=16),"hemisphere"in h||(c("scene",r,"b4w_ssao_settings.hemisphere"),h.hemisphere=!1),"blur_depth"in h||(c("scene",r,"b4w_ssao_settings.blur_depth"),h.blur_depth=!1),"blur_discard_value"in
h||(c("scene",r,"b4w_ssao_settings.blur_discard_value"),h.blur_discard_value=1),"b4w_bloom_settings"in r||(c("scene",r,"b4w_bloom_settings"),h=e.b4w_bloom_settings,r.b4w_bloom_settings=h?h:{key:.2,blur:4,edge_lum:1}),"key"in r.b4w_bloom_settings||(c("scene",r,"b4w_bloom_settings.key"),r.b4w_bloom_settings.key=.2),"blur"in r.b4w_bloom_settings||(c("scene",r,"b4w_bloom_settings.blur"),r.b4w_bloom_settings.blur=4),"edge_lum"in r.b4w_bloom_settings||(c("scene",r,"b4w_bloom_settings.edge_lum"),r.b4w_bloom_settings.edge_lum=
1),"b4w_motion_blur_settings"in r||(c("scene",r,"b4w_motion_blur_settings"),h=e.b4w_motion_blur_settings,r.b4w_motion_blur_settings=h?h:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in r.b4w_motion_blur_settings||(c("scene",r,"b4w_motion_blur_settings.motion_blur_factor"),r.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in r.b4w_motion_blur_settings||(c("scene",r,"b4w_motion_blur_settings.motion_blur_decay_threshold"),r.b4w_motion_blur_settings.motion_blur_decay_threshold=
.01),"b4w_color_correction_settings"in r||(c("scene",r,"b4w_color_correction_settings"),h=e.b4w_color_correction_settings,r.b4w_color_correction_settings=h?h:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in r||(c("scene",r,"b4w_god_rays_settings"),h=e.b4w_god_rays_settings,r.b4w_god_rays_settings=h?h:{intensity:.7,max_ray_length:1,steps_per_pass:10}),"steps_per_pass"in r.b4w_god_rays_settings||(c("scene",r,"b4w_god_rays_settings.steps_per_pass"),r.b4w_god_rays_settings.steps_per_pass=
10),"b4w_glow_settings"in r||(c("scene",r,"b4w_glow_settings"),r.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},h=r.b4w_glow_settings,"b4w_render_glow_over_blend"in e&&(h.render_glow_over_blend=e.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in e&&(h.small_glow_mask_coeff=e.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in e&&(h.large_glow_mask_coeff=e.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in
e&&(h.small_glow_mask_width=e.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in e&&(h.large_glow_mask_width=e.b4w_large_glow_mask_width)),e=r.b4w_render_shadows,"AUTO"!=e&&"OFF"!=e&&"ON"!=e&&(r.b4w_render_shadows=e?"ON":"OFF"),e=r.b4w_render_reflections,"OFF"!=e&&"ON"!=e&&(r.b4w_render_reflections=e?"ON":"OFF"),e=r.b4w_render_refractions,"AUTO"!=e&&"OFF"!=e&&"ON"!=e&&(r.b4w_render_refractions=e?"ON":"OFF"),r.b4w_nla_script&&q("scene",r,"b4w_nla_script");r=a.meshes;for(l=0;l<r.length;l++){e=
r[l];e.b4w_bounding_box||(c("mesh",e,"b4w_bounding_box"),e.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});e.b4w_bounding_box_source||(c("mesh",e,"b4w_bounding_box_source"),e.b4w_bounding_box_source=e.b4w_bounding_box);e.uv_textures||(c("mesh",e,"uv_textures"),e.uv_textures=[]);e.b4w_bounding_sphere_center||(e.b4w_bounding_sphere_center=[0,0,0]);e.b4w_bounding_cylinder_center||(e.b4w_bounding_cylinder_center=[0,0,0]);e.b4w_bounding_ellipsoid_center||(e.b4w_bounding_ellipsoid_center=
[0,0,0]);e.b4w_bounding_ellipsoid_axes||(g=e.b4w_bounding_box,e.b4w_bounding_ellipsoid_axes=[(g.max_x-g.min_x)/2,(g.max_y-g.min_y)/2,(g.max_z-g.min_z)/2]);"b4w_shape_keys"in e||(e.b4w_shape_keys=[],c("mesh",e,"b4w_shape_keys"));for(var g=e,h=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],n=null,t=0;t<h.length;t++)g[h[t]]&&(n?(g[h[t]]=!1,z.warn('WARNING property "'+h[t]+'" of object "'+g.name+'" has been set to "false". Foreground property "'+
n+'" already exists.')):n=h[t]);for(g=0;g<e.b4w_vertex_anim.length;g++)h=e.b4w_vertex_anim[g],"allow_nla"in h||(c('mesh["b4w_vertex_anim"]',e,"allow_nla"),h.allow_nla=!0)}g=a.cameras;for(l=0;l<g.length;l++)r=g[l],r.type||(r.type="PERSP",c("camera",r,"type")),"b4w_eye_target_dist"in r&&(delete r.b4w_eye_target_dist,q("camera",r,"b4w_eye_target_dist")),"b4w_hover_zero_level"in r||(r.b4w_hover_zero_level=0,c("camera",r,"b4w_hover_zero_level")),"b4w_trans_velocity"in r||(r.b4w_trans_velocity=1,c("camera",
r,"b4w_trans_velocity")),"b4w_rot_velocity"in r||(r.b4w_rot_velocity=1,c("camera",r,"b4w_rot_velocity")),"b4w_zoom_velocity"in r||(r.b4w_zoom_velocity=.1,c("camera",r,"b4w_zoom_velocity")),"b4w_use_target_distance_limits"in r||(r.b4w_use_target_distance_limits=r.b4w_use_distance_limits||!1,c("camera",r,"b4w_use_target_distance_limits")),"b4w_use_zooming"in r||(r.b4w_use_zooming=r.b4w_use_distance_limits||!1,c("camera",r,"b4w_use_zooming")),"b4w_distance_min"in r||(r.b4w_distance_min=1,c("camera",
r,"b4w_distance_min")),"b4w_distance_max"in r||(r.b4w_distance_max=100,c("camera",r,"b4w_distance_max")),"b4w_horizontal_translation_min"in r||(r.b4w_horizontal_translation_min=-100,c("camera",r,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in r||(r.b4w_horizontal_translation_max=100,c("camera",r,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in r||(r.b4w_vertical_translation_min=-100,c("camera",r,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in
r||(r.b4w_vertical_translation_max=100,c("camera",r,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in r||(r.b4w_use_horizontal_clamping=!1,c("camera",r,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in r||(r.b4w_rotation_left_limit=-Math.PI,c("camera",r,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in r||(r.b4w_rotation_right_limit=Math.PI,c("camera",r,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in r||(r.b4w_horizontal_clamping_type="LOCAL",c("camera",
r,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in r||(r.b4w_use_vertical_clamping=!1,c("camera",r,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in r||(r.b4w_rotation_down_limit=-Math.PI/2,c("camera",r,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in r||(r.b4w_rotation_up_limit=Math.PI/2,c("camera",r,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in r||(r.b4w_vertical_clamping_type="LOCAL",c("camera",r,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in r||(r.b4w_hover_angle_min=
Math.PI/6,c("camera",r,"b4w_hover_angle_min")),"b4w_hover_angle_max"in r||(r.b4w_hover_angle_max=Math.PI/6,c("camera",r,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in r||(r.b4w_enable_hover_hor_rotation=!0,c("camera",r,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in r||(r.b4w_use_panning=!0,c("camera",r,"b4w_use_panning"));g=a.lamps;for(l=0;l<g.length;l++)r=g[l],"b4w_generate_shadows"in r||(r.b4w_generate_shadows=!1,c("lamp",r,"b4w_generate_shadows")),"b4w_dynamic_intensity"in r||
(r.b4w_dynamic_intensity=!1,c("lamp",r,"b4w_dynamic_intensity")),"use_diffuse"in r||(r.use_diffuse=!0,c("lamp",r,"use_diffuse")),"use_specular"in r||(r.use_specular=!0,c("lamp",r,"use_specular"));g=a.speakers;for(l=0;l<g.length;l++)r=g[l],"b4w_behavior"in r||(r.b4w_behavior=r.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in r||(r.b4w_disable_doppler=!1),"b4w_delay"in r||(r.b4w_delay=0),"b4w_delay_random"in r||(r.b4w_delay_random=0),"b4w_volume_random"in r||(r.b4w_volume_random=
0),"b4w_pitch_random"in r||(r.b4w_pitch_random=0),"b4w_fade_in"in r||(r.b4w_fade_in=0),"b4w_fade_out"in r||(r.b4w_fade_out=0),"b4w_loop"in r||(r.b4w_loop=!1),"b4w_loop_count"in r||(r.b4w_loop_count=0),"b4w_loop_count_random"in r||(r.b4w_loop_count_random=0),"b4w_playlist_id"in r||(r.b4w_playlist_id=""),r.animation_data&&b(r.animation_data);g=a.textures;for(l=0;l<g.length;l++)r=g[l],"b4w_anisotropic_filtering"in r||(r.b4w_anisotropic_filtering="OFF",c("texture",r,"b4w_anisotropic_filtering")),"b4w_water_foam"in
r||(r.b4w_water_foam=!1,c("texture",r,"b4w_water_foam")),"b4w_foam_uv_freq"in r||(r.b4w_foam_uv_freq=[1,1],c("texture",r,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in r||(r.b4w_foam_uv_magnitude=[1,1],c("texture",r,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in r||(r.b4w_parallax_steps=5,c("material",r,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in r||(r.b4w_parallax_lod_dist=10,c("material",r,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in r||(r.b4w_shore_dist_map=!1,c("texture",r,"b4w_shore_dist_map")),
"b4w_shore_boundings"in r||(r.b4w_shore_boundings=new Float32Array(4),r.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],c("texture",r,"b4w_shore_boundings")),"b4w_max_shore_dist"in r||(r.b4w_max_shore_dist=100,c("texture",r,"b4w_max_shore_dist")),"b4w_disable_compression"in r||(r.b4w_disable_compression=!1,c("texture",r,"b4w_disable_compression")),"b4w_source_type"in r||(r.b4w_source_type="",c("texture",r,"b4w_source_type")),"b4w_source_id"in r||(r.b4w_source_id="",c("texture",r,"b4w_source_id")),"b4w_source_size"in
r||(r.b4w_source_size=1024,c("texture",r,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in r||(r.b4w_enable_canvas_mipmapping=!0,c("texture",r,"b4w_enable_canvas_mipmapping")),"b4w_nla_video"in r||(r.b4w_nla_video=!1,c("texture",r,"b4w_nla_video"));h=a.materials;for(l=0;l<h.length;l++){n=h[l];"ALPHA_ANTIALIASING"==n.game_settings.alpha_blend&&(n.game_settings.alpha_blend="CLIP");"b4w_node_mat_type"in n&&q("material",n,"b4w_node_mat_type");"b4w_skydome"in n&&q("material",n,"b4w_skydome");"b4w_procedural_skydome"in
n&&q("material",n,"b4w_procedural_skydome");n.b4w_water&&("b4w_water_shore_smoothing"in n||(n.b4w_water_shore_smoothing=!1,c("material",n,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in n||(n.b4w_water_dynamic=!1,c("material",n,"b4w_water_dynamic")),"b4w_waves_height"in n||(n.b4w_waves_height=1,c("material",n,"b4w_waves_height")),"b4w_waves_length"in n||(n.b4w_waves_length=1,c("material",n,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in n||(n.b4w_water_dst_noise_scale0=.05,c("material",n,
"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in n||(n.b4w_water_dst_noise_scale1=.03,c("material",n,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in n||(n.b4w_water_dst_noise_freq0=1.3,c("material",n,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in n||(n.b4w_water_dst_noise_freq1=1,c("material",n,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in n||(n.b4w_water_dir_min_shore_fac=.4,c("material",n,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
n||(n.b4w_water_dir_freq=.5,c("material",n,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in n||(n.b4w_water_dir_noise_scale=.05,c("material",n,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in n||(n.b4w_water_dir_noise_freq=.07,c("material",n,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in n||(n.b4w_water_dir_min_noise_fac=.5,c("material",n,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in n||(n.b4w_water_dst_min_fac=.2,c("material",n,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
n||(n.b4w_water_waves_hor_fac=5,c("material",n,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in n||(n.b4w_water_absorb_factor=6,c("material",n,"b4w_water_absorb_factor")),"b4w_water_fog_color"in n||(n.b4w_water_fog_color=new Float32Array(3),n.b4w_water_fog_color=[.5,.7,.7],c("material",n,"b4w_water_fog_color")),"b4w_foam_factor"in n||(n.b4w_foam_factor=5,c("material",n,"b4w_foam_factor")),"b4w_generated_mesh"in n||(n.b4w_generated_mesh=!1,c("material",n,"b4w_generated_mesh")),"b4w_water_num_cascads"in
n||(n.b4w_water_num_cascads=5,c("material",n,"b4w_water_num_cascads")),"b4w_water_subdivs"in n||(n.b4w_water_subdivs=64,c("material",n,"b4w_water_subdivs")),"b4w_water_detailed_dist"in n||(n.b4w_water_detailed_dist=1E3,c("material",n,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in n||(n.b4w_water_enable_caust=!1,c("material",n,"b4w_water_enable_caust")),"b4w_water_caust_scale"in n||(n.b4w_water_caust_scale=.25,c("material",n,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in n||(n.b4w_water_caust_brightness=
.5,c("material",n,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in n||(n.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in n||(n.b4w_dynamic_grass_color="");"diffuse_intensity"in n||(n.diffuse_intensity=1,c("material",n,"diffuse_intensity"));"b4w_use_ghost"in n||(n.b4w_use_ghost=!1);"b4w_collision_margin"in n||(n.b4w_collision_margin=.04,c("material",n,"b4w_collision_margin"));"b4w_collision_group"in n||(n.b4w_collision_group=128,c("material",n,"b4w_collision_group"));"b4w_collision_mask"in
n||(n.b4w_collision_mask=127,c("material",n,"b4w_collision_mask"));"b4w_do_not_render"in n||(n.b4w_do_not_render=!1,c("material",n,"b4w_do_not_render"));"HALO"!=n.type||"b4w_halo_sky_stars"in n||(n.b4w_halo_sky_stars=!1,c("material",n,"b4w_halo_sky_stars"));"HALO"!=n.type||"b4w_halo_stars_blend_height"in n||(n.b4w_halo_stars_blend_height=10,c("material",n,"b4w_halo_stars_blend_height"));"HALO"!=n.type||"b4w_halo_stars_min_height"in n||(n.b4w_halo_stars_min_height=0,c("material",n,"b4w_halo_stars_min_height"));
"specular_shader"in n||(n.specular_shader="COOKTORR",c("material",n,"specular_shader"));"diffuse_shader"in n||(n.diffuse_shader="LAMBERT",c("material",n,"diffuse_shader"));"roughness"in n||(n.roughness=.5,c("material",n,"roughness"));"diffuse_fresnel"in n||(n.diffuse_fresnel=.1,c("material",n,"diffuse_fresnel"));"diffuse_fresnel_factor"in n||(n.diffuse_fresnel_factor=.5,c("material",n,"diffuse_fresnel_factor"));"specular_slope"in n||(n.specular_slope=.2,c("material",n,"specular_slope"));"specular_toon_size"in
n||(n.specular_toon_size=.5,c("material",n,"specular_toon_size"));"specular_toon_smooth"in n||(n.specular_toon_smooth=.1,c("material",n,"specular_toon_smooth"));"specular_alpha"in n||(n.specular_alpha=1,c("material",n,"specular_alpha"));"b4w_wettable"in n||(n.b4w_wettable=!1,c("material",n,"b4w_wettable"));"b4w_refractive"in n||(n.b4w_refractive=!1,c("material",n,"b4w_refractive"));"b4w_refr_bump"in n||(n.b4w_refr_bump=0,c("material",n,"b4w_refr_bump"));"b4w_shallow_water_col"in n||(n.b4w_shallow_water_col=
[0,.8,.3],c("material",n,"b4w_shallow_water_col"));"b4w_shore_water_col"in n||(n.b4w_shore_water_col=[0,.9,.2],c("material",n,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in n||(n.b4w_shallow_water_col_fac=1,c("material",n,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in n||(n.b4w_shore_water_col_fac=.5,c("material",n,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in n||(n.b4w_water_sss_strength=5.9,c("material",n,"b4w_water_sss_strength"));"b4w_water_sss_width"in n||(n.b4w_water_sss_width=
.45,c("material",n,"b4w_water_sss_width"));"b4w_render_above_all"in n||(n.b4w_render_above_all=!1,c("material",n,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in n||(n.b4w_water_norm_uv_velocity=.05,c("material",n,"b4w_water_norm_uv_velocity"));"specular_ior"in n||(n.specular_ior=1,c("material",n,"specular_ior"));"darkness"in n||(n.darkness=0,c("material",n,"darkness"));"diffuse_toon_size"in n||(n.diffuse_toon_size=0,c("material",n,"diffuse_toon_size"));"diffuse_toon_smooth"in n||(n.diffuse_toon_smooth=
0,c("material",n,"diffuse_toon_smooth"));r=n.texture_slots;for(g=0;g<r.length;g++)e=r[g],"blend_type"in e||(e.blend_type="MIX",c("texture_slot",e,"blend_type"));if(n.node_tree){r=n.node_tree.nodes;for(g=0;g<r.length;g++)d(r[g]);n.node_tree.animation_data&&b(n.node_tree.animation_data)}}e=a.node_groups;for(l=0;l<e.length;l++)for(r=e[l].node_tree.nodes,g=0;g<r.length;g++)d(r[g]);r=a.objects;for(l=0;l<r.length;l++){e=r[l];switch(e.type){case "MESH":"b4w_dynamic_geometry"in e||(e.b4w_dynamic_geometry=
!1);"b4w_reflexible"in e||(e.b4w_reflexible=!1);"b4w_reflexible_only"in e||(e.b4w_reflexible_only=!1);"b4w_reflective"in e||(e.b4w_reflective=!1);"b4w_reflection_type"in e||(e.b4w_reflection_type="PLANE",c("object",e,"b4w_reflection_type"));"b4w_wind_bending"in e||(e.b4w_wind_bending=!1,c("object",e,"b4w_wind_bending"));"b4w_wind_bending_angle"in e||(e.b4w_wind_bending_angle=10,e.b4w_wind_bending_freq=.25,c("object",e,"wind bending params"));"b4w_detail_bending_amp"in e||(e.b4w_detail_bending_amp=
.1,e.b4w_branch_bending_amp=.3,c("object",e,"detail bending params"));"b4w_detail_bending_freq"in e||(e.b4w_detail_bending_freq=1,c("object",e,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in e||(e.b4w_main_bend_stiffness_col="",c("object",e,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in e||(e.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},c("object",e,"b4w_detail_bend_colors"));"b4w_caustics"in e||(e.b4w_caustics=!1);"vertex_groups"in
e&&e.vertex_groups.length&&e.data&&0==e.data.vertex_groups.length&&(e.data.vertex_groups=e.vertex_groups,delete e.vertex_groups,c("object",e,"vertex_groups"));"b4w_vertex_anim"in e&&e.b4w_vertex_anim.length&&e.data&&0==e.data.b4w_vertex_anim.length&&(e.data.b4w_vertex_anim=e.b4w_vertex_anim,delete e.b4w_vertex_anim,c("object",e,"b4w_vertex_anim"));"b4w_do_not_render"in e||(e.b4w_do_not_render=!1);"use_ghost"in e.game||(e.game.use_ghost=!1);"use_sleep"in e.game||(e.game.use_sleep=!1);"velocity_min"in
e.game||(e.game.velocity_min=0);"velocity_max"in e.game||(e.game.velocity_max=0);"collision_group"in e.game||(e.game.collision_group=1);"collision_mask"in e.game||(e.game.collision_mask=255);"b4w_vehicle_settings"in e?e.b4w_vehicle_settings&&("steering_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_ratio=10),"steering_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_max=1),"inverse_control"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.inverse_control=!1),"force_max"in
e.b4w_vehicle_settings||(e.b4w_vehicle_settings.force_max=1500),"brake_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.brake_max=100),"speed_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_compression=
4.4),"suspension_stiffness"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in e.b4w_vehicle_settings||
(e.b4w_vehicle_settings.floating_factor=3),"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_rot_damp=.9)):(e.b4w_vehicle_settings=null,c("object",e,"b4w_vehicle_settings"));"b4w_floating_settings"in e?e.b4w_floating_settings&&("floating_factor"in e.b4w_floating_settings||(e.b4w_floating_settings.floating_factor=
3),"water_lin_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_rot_damp=.8)):(e.b4w_floating_settings=null,c("object",e,"b4w_floating_settings"));"b4w_character_settings"in e?e.b4w_character_settings&&("walk_speed"in e.b4w_character_settings||(e.b4w_character_settings.walk_speed=4),"run_speed"in e.b4w_character_settings||(e.b4w_character_settings.run_speed=8),"step_height"in e.b4w_character_settings||
(e.b4w_character_settings.step_height=.25),"jump_strength"in e.b4w_character_settings||(e.b4w_character_settings.jump_strength=5),"waterline"in e.b4w_character_settings||(e.b4w_character_settings.waterline=0)):(e.b4w_character_settings=null,c("object",e,"b4w_character_settings"));"b4w_selectable"in e||(e.b4w_selectable=!1,c("object",e,"b4w_selectable"));"b4w_outlining"in e||(e.b4w_outlining=!1,c("object",e,"b4w_outlining"));"b4w_outline_on_select"in e||(e.b4w_outline_on_select=!1,c("object",e,"b4w_outline_on_select"));
"b4w_billboard"in e||(e.b4w_billboard=!1,c("object",e,"b4w_billboard"));"b4w_billboard_geometry"in e||(e.b4w_billboard_geometry="SPHERICAL",c("object",e,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in e||(e.b4w_pres_glob_orientation=!1,c("object",e,"b4w_pres_glob_orientation"));"b4w_outline_settings"in e||("b4w_glow_settings"in e?e.b4w_outline_settings=e.b4w_glow_settings:(e.b4w_outline_settings={},e.b4w_outline_settings.outline_duration=1,e.b4w_outline_settings.outline_period=1,e.b4w_outline_settings.outline_relapses=
0),c("object",e,"b4w_outline_settings"));"b4w_lod_transition"in e||(e.b4w_lod_transition=.01,c("object",e,"b4w_lod_transition"));"lod_levels"in e||(e.lod_levels=[],c("object",e,"lod_levels"));"b4w_animation_mixing"in e||(e.b4w_animation_mixing=!1,c("object",e,"b4w_animation_mixing"));break;case "EMPTY":"b4w_anchor"in e||(e.b4w_anchor=null,c("object",e,"b4w_anchor")),!e.b4w_anchor||"max_width"in e.b4w_anchor||(e.b4w_anchor.max_width=250)}"collision_margin"in e.game||(e.game.collision_margin=.04,c("object",
e,"collision_margin"));"b4w_anim_behavior"in e||(e.b4w_anim_behavior=e.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",c("object",e,"b4w_anim_behavior"));if(!("rotation_quaternion"in e)){g=[0,0,0,1];k.euler_to_quat(e.rotation_euler,g);var h=g,n=g[0],t=g[1],u=g[2];h[0]=g[3];h[1]=n;h[2]=t;h[3]=u;e.rotation_quaternion=g;c("object",e,"rotation_quaternion")}"webgl_do_not_batch"in e&&(e.b4w_do_not_batch=e.webgl_do_not_batch)&&q("object",e,"webgl_do_not_batch");"b4w_shadow_cast_only"in e||(e.b4w_shadow_cast_only=
!1,c("object",e,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in e||(e.b4w_correct_bounding_offset="AUTO",c("object",e,"b4w_correct_bounding_offset"));h=e.particle_systems;for(g=0;g<h.length;g++)n=h[g],t=n.settings,"use_rotation_dupli"in t||(t.use_rotation_dupli=!1,c("object",t,"use_rotation_dupli")),"use_whole_group"in t||(t.use_whole_group=!1,c("object",t,"use_whole_group")),n.transforms||(n.transforms=new Float32Array,c("particle_system",n,"transforms")),"b4w_billboard_align"in t||(t.b4w_billboard_align=
"VIEW",c("particle_settings",t,"b4w_billboard_align")),"b4w_dynamic_grass"in t||(t.b4w_dynamic_grass=!1,c("object",t,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in t||(t.b4w_dynamic_grass_scale_threshold=.01,c("object",t,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in t||(t.b4w_initial_rand_rotation=!1,c("particle_settings",t,"b4w_initial_rand_rotation")),"b4w_rotation_type"in t||(t.b4w_rotation_type="Z",c("particle_settings",t,"b4w_rotation_type")),"b4w_rand_rotation_strength"in
t||(t.b4w_rand_rotation_strength=1,c("particle_settings",t,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in t||(t.b4w_hair_billboard=!1,c("particle_settings",t,"b4w_hair_billboard")),"b4w_hair_billboard_type"in t||(t.b4w_hair_billboard_type="BASIC",c("particle_settings",t,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in t||(t.b4w_hair_billboard_jitter_amp=0,c("particle_settings",t,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in t||(t.b4w_hair_billboard_jitter_freq=
0,c("particle_settings",t,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in t||(t.b4w_hair_billboard_geometry="SPHERICAL",c("particle_settings",t,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in t||(t.b4w_wind_bend_inheritance="PARENT",c("particle_settings",t,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in t||(t.b4w_shadow_inheritance="PARENT",c("particle_settings",t,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in t||(t.b4w_reflection_inheritance="PARENT",
c("particle_settings",t,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in t||(t.b4w_vcol_from_name="",c("particle_settings",t,"b4w_vcol_from_name")),"b4w_vcol_to_name"in t||(t.b4w_vcol_to_name="",c("particle_settings",t,"b4w_vcol_to_name")),"b4w_coordinate_system"in t||(t.b4w_coordinate_system="LOCAL",c("particle_settings",t,"b4w_coordinate_system")),"b4w_allow_nla"in t||(t.b4w_allow_nla=!0,c("particle_settings",t,"b4w_allow_nla")),"b4w_enable_soft_particles"in t||(t.b4w_enable_soft_particles=
!1,c("particle_settings",t,"b4w_enable_soft_particles")),"b4w_particles_softness"in t||(t.b4w_particles_softness=1,c("particle_settings",t,"b4w_particles_softness"));"constraints"in e||(e.constraints=[],c("object",e,"constraints"));h=e.modifiers;for(g=0;g<h.length;g++){a:{n=h[g];switch(n.type){case "ARRAY":if(!("fit_type"in n)){z.error("WARNING Incomplete modifier "+String(n.type)+' for "'+e.name+'", reexport "'+a.b4w_filepath_blend+'" scene');n=!1;break a}}n=!0}n||(h.splice(g,1),g--)}"animation_data"in
e||(e.animation_data={action:null,nla_tracks:[]},c("object",e,"animation_data"));e.animation_data&&("action"in e.animation_data||(e.animation_data.action=null,f("no action in animation data "+e.name)),"nla_tracks"in e.animation_data||(e.animation_data.nla_tracks=[],f("no NLA in animation data "+e.name)),b(e.animation_data));"b4w_collision_id"in e||(e.b4w_collision_id="",c("object",e,"b4w_collision_id"));"b4w_viewport_alignment"in e||(e.b4w_viewport_alignment=null,c("object",e,"b4w_viewport_alignment"));
(0>e.scale[0]||0>e.scale[1]||0>e.scale[2])&&f('negative scale for object "'+e.name+'", can lead to some errors');g=e.scale;0==g[0]&&0==g[1]&&0==g[2]?g=!0:(h=Math.abs((g[1]-g[2])/g[1]),g=.005>Math.abs((g[0]-g[1])/g[0])&&.005>h);g||f("non-uniform scale for object "+e.name)}for(var p in E)l=E[p],g=p.match(/.*?(?=>>|$)/i)[0],z.warn('Property "'+String(g)+'" is '+l.Bw+' for "'+l.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.MA=function(a,b){"num_channels"in a||(a.num_channels=1,f('B4W Warning: no channels number in animation fcurve for "'+
b.name+'" action, reexport scene'))};a.gA=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=t(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var f=a[c];switch(f.type){case "ARRAY":for(var d=b,e=f,q=0,p=0,D=0,H=new Float32Array(16),f=[],I=1;I<e.count;I++){e.use_constant_offset&&(q+=e.constant_offset_displace[0],p+=e.constant_offset_displace[1],D+=e.constant_offset_displace[2]);if(e.use_relative_offset)var z=
d.b4w_bounding_box,q=q+(z.max_x-z.min_x)*e.relative_offset_displace[0],p=p+(z.max_y-z.min_y)*e.relative_offset_displace[1],D=D+(z.max_z-z.min_z)*e.relative_offset_displace[2];k.TG(q,p,D,H);for(var K=z=t(d),y=H,F=0;F<K.submeshes.length;F++){var C=K.submeshes[F];k.sj(C.position,y,C.position,0);k.ZH(C.normal,y,C.normal);k.QG(C.tangent,y,C.tangent)}f.push(z)}for(I=0;I<f.length;I++)for(e=d,q=f[I],p=0;p<e.submeshes.length;p++){D=e.submeshes[p];H=q.submeshes[p];z=D.base_length;K=D.indices.length;D.base_length+=
H.base_length;for(var O in D)if("base_length"!=O)if("indices"==O)for(D[O]=k.YG(D[O],H[O]),y=K;y<D.indices.length;y++)D.indices[y]+=z;else"vertex_colors"!=O&&(D[O]=k.CC(D[O],H[O]))}break;case "CURVE":for(var d=b,I=n.IB(f.object),e=new Float32Array(16),p=I.cg?4:3,q=new Float32Array(p),p=new Float32Array(p),D=new Float32Array(3),H=new Float32Array(4),z=new Float32Array(4),K=new Float32Array(3),y=new Float32Array(3),F=new Float32Array(3),C=new Float32Array(4),E=new Float32Array(4),T=0;T<d.submeshes.length;T++){var U=
d.submeshes[T],B=U.position,ha=U.normal,U=U.tangent,ba;a:switch(ba=f.deform_axis,ba){case "POS_X":case "NEG_X":ba=0;break a;case "POS_Y":case "NEG_Y":ba=1;break a;case "POS_Z":case "NEG_Z":ba=2;break a;default:throw"Wrong deform axis value "+ba;}K[0]=0;K[1]=0;K[2]=0;K[ba]=1;for(var da=n.DG(I),W=0;W<B.length/3;W++){F[0]=B[3*W];F[1]=B[3*W+1];F[2]=B[3*W+2];var R=F[ba],Y=n.CG(I,R);n.EG(I,Y,q);D[0]=q[0];D[1]=q[1];D[2]=q[2];n.BG(I,Y,p);y[0]=p[0];y[1]=0;y[2]=p[2];u.normalize(y,y);h.rotationTo(K,y,H);0>R?
(q[0]=y[0],q[1]=y[1],q[2]=y[2],u.scale(q,R,q),u.add(D,q,D)):R>da&&(q[0]=y[0],q[1]=y[1],q[2]=y[2],u.scale(q,R-da,q),u.add(D,q,D));g.fromRotationTranslation(H,D,e);I.cg&&(h.setAxisAngle(K,q[3],z),u.transformQuat(F,z,F));F[ba]=0;u.transformMat4(F,e,F);B[3*W]=F[0];B[3*W+1]=F[1];B[3*W+2]=F[2];ha.length&&(C[0]=ha[3*W],C[1]=ha[3*W+1],C[2]=ha[3*W+2],C[3]=0,w.transformMat4(C,e,C),ha[3*W]=C[0],ha[3*W+1]=C[1],ha[3*W+2]=C[2]);U.length&&(E[0]=U[3*W],E[1]=U[3*W+1],E[2]=U[3*W+2],E[3]=0,w.transformMat4(E,e,E),U[3*
W]=E[0],U[3*W+1]=E[1],U[3*W+2]=E[2])}}}l.vF(b)}return b};a.wB=function(){return{name:"DEFAULT",uuid:k.iq(),use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,
b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",
use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.nA=function(a,b){for(var c=b.b4w_logic_nodes,d=0;d<c.length;d++)for(var h=c[d],e=0;e<h.length;e++){var k=h[e],g={register1:"variable1",register2:"variable2",registerd:"variabled"},l;for(l in g)l in k&&(k[g[l]]=k[l]);switch(k.type){case "SELECT":for(var n=0;n<a.length;n++){var q=a[n];q.name==k.object&&
(q.b4w_selectable=!0)}k.bools||(k.bools={});k.bools.not_wait||(k.bools.not_wait=!1);f('Logic nodes type "SELECT" is deprecated');break;case "SWITCH_SELECT":for(var t in k.objects_paths){q=k.objects_paths[t];g=q[0];if(1<q.length)for(n=1;n<q.length;n++)g+="*"+q[n];for(n=0;n<a.length;n++)q=a[n],q.name==g&&(q.b4w_selectable=!0)}if(k.links instanceof Array){f('Format of a "SWITCH_SELECT" node is outdated. It is recommended to reexport the scene "'+b.name+'"');g={};q=0;for(n in k.objects_paths)g[n]=k.links[q],
q++;k.links=g}break;case "SELECT_PLAY":f('Logic nodes type "SELECT_PLAY" is deprecated, node will be muted. To fix this, reexport the scene "'+b.name+'"');k.mute=!0;break;case "SELECT_PLAY_ANIM":f('Logic nodes type "SELECT_PLAY_ANIM" is deprecated');break;case "SHOW":case "HIDE":case "PLAY_ANIM":case "SET_SHADER_NODE_PARAM":case "INHERIT_MAT":for(t in k.objects_paths){q=k.objects_paths[t];g=q[0];if(1<q.length)for(n=1;n<q.length;n++)g+="*"+q[n];for(n=0;n<a.length;n++)q=a[n],q.name==g&&(q.b4w_do_not_batch=
!0)}break;case "PLAY":b.b4w_use_nla=!0;break;case "MOVE_TO":for(t in k.objects_paths){q=k.objects_paths[t];g=q[0];if(1<q.length)for(n=1;n<q.length;n++)g+="*"+q[n];for(n=0;n<a.length;n++)q=a[n],q.name==g&&(q.b4w_do_not_batch=!0)}break;case "TRANSFORM_OBJECT":for(t in k.objects_paths){q=k.objects_paths[t];g=q[0];if(1<q.length)for(n=1;n<q.length;n++)g+="*"+q[n];for(n=0;n<a.length;n++)q=a[n],q.name==g&&(q.b4w_do_not_batch=!0)}break;case "CONDJUMP":if(k.condition)switch(k.floats||(k.floats={}),k.condition){case "GEQUAL":k.floats.cnd=
0;break;case "LEQUAL":k.floats.cnd=1;break;case "GREATER":k.floats.cnd=2;break;case "LESS":k.floats.cnd=3;break;case "NOTEQUAL":k.floats.cnd=4;break;case "EQUAL":k.floats.cnd=5}void 0!=k.number1&&(k.input1=k.number1);void 0!=k.number2&&(k.input2=k.number2);break;case "SEND_REQ":k.bools||(k.bools={});void 0===k.bools.prs&&(k.bools.prs=!0);void 0===k.bools.enc&&(k.bools.enc=!0);break;case "MATH":void 0!=k.number1&&(k.input1=k.number1);void 0!=k.number2&&(k.input2=k.number2);break;case "REGSTORE":void 0!=
k.number1&&(k.input1=k.number1);void 0!=k.number2&&(k.input2=k.number2);break;case "REGSTORE":void 0!=k.number1&&(k.input1=k.number1)}}}};b4w.module.__scenegraph=function(a,p){function d(a){var b=a.ld;a.ld=null;var c=ya.xa(a);c.ld=b;a.ld=b;c.ge=null;c.Hb=null;c.Ld=null;return c}function b(a,b){var d=[];L.oe(a,function(b,c,e){-1<d.indexOf(e)?L.DF(a,b,c,e,r(e)):d.push(e)});L.aa(a,function(c,e){for(var f=0;f<e.la.length;f++){var h=e.la[f];b||"MAIN_PLANE_REFLECT"!=e.type&&"MAIN_CUBE_REFLECT"!=e.type&&"MAIN_XRAY"!=e.type||(h.Zd=!0);-1<d.indexOf(h)?e.la[f]=r(h):d.push(h)}"ANTIALIASING"==e.type&&L.pe(a,c,function(a,b){if("MOTION_BLUR"==b.type)for(var c=
0;c<b.la.length;c++){var d=b.la[c];d.ra=Z.r;d.qa=Z.r}});b||L.pe(a,c,function(a,b,c){"DEPTH"==c.from&&(c.Zd=!0)})});L.aa(a,function(b){var d={};c(a,b,d);for(var e in d){b=d[e];for(var f=b[0],h=0;h<b.length;h++)if(b[h].ra==Z.r){f=b[h];break}for(var k=b[0],h=0;h<b.length;h++)if(b[h].qa==Z.r){k=b[h];break}for(var g=b[0],h=0;h<b.length;h++)if(!b[h].Zd){g=b[h];break}for(h=0;h<b.length;h++)b[h].ra=f.ra,b[h].qa=k.qa,b[h].Zd=g.Zd}})}function c(a,b,d){L.pe(a,b,function(b,e,f){f.zb&&f.from==f.to&&(d[f.from]=
d[f.from]||[],-1==d[f.from].indexOf(f)&&d[f.from].push(f),c(a,b,d))});L.Bg(a,b,function(a,b,c){c.zb&&(d[c.from]=d[c.from]||[],-1==d[c.from].indexOf(c)&&d[c.from].push(c))});b=L.Ba(a,b);if("MOTION_BLUR"==b.type)for(var e=0;e<b.la.length;e++){var f=b.la[e];d[f.from].push(f)}}function q(a){var b=["MOTION_BLUR","SMAA_RESOLVE","SMAA_NEIGHBORHOOD_BLENDING","MAIN_PLANE_REFLECT","MAIN_QUBE_REFLECT"],c=L.ss(a),d=[];L.aa(c,function(a,e){for(var h=0;h<e.la.length;h++){var k=e.la[h];-1<b.indexOf(e.type)&&(k.ko=
!0);var m=g(d,k,f(k));k.va=m;e.Pe[h]=m}for(h=0;h<e.Pe.length;h++)m=e.Pe[h],n(d,m);L.Bg(c,a,function(h,k,m){-1<b.indexOf(e.type)&&(m.ko=!0);m.va||((h=t(c,a,m.from))&&m.zb&&!m.va?l(d,h):h=g(d,m,f(m)),m.va=h)});L.pe(c,a,function(a,b,c){n(d,c.va)});L.Bg(c,a,function(a,b,c){c.va&&"NONE"==c.to&&n(d,c.va)})})}function f(a){a=ya.ah(a);delete a.to;delete a.zb;delete a.va;return JSON.stringify(a)}function t(a,b,c){var d=null;L.pe(a,b,function(a,b,e){if(e.zb&&e.from==e.to&&e.from==c&&e.va)return d=e.va,!0});
L.Bg(a,b,function(a,b,e){if(e.zb&&e.from==c&&e.va)return d=e.va,!0});return d}function l(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.os===b&&d.ol++}}function n(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.os===b&&d.ol&&d.ol--}}function g(a,b,c){if(b.jl)return l(a,b.jl.va),b.jl.va;if(b.ko)return z(b);for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.ol){d=f;break}}if(d&&!Ja.EE)return d.ol++,d.os;b=z(b);a.push({id:c,ol:1,os:b});return b}function z(a){var b=a.Wh*a.size,c=a.vl*a.size;
switch(a.from){case "COLOR":if(a.Zd){var d=Z.wk("COLOR_RB",a.hj?Z.$l:Z.Zl);Z.resize(d,b,c)}else d=Z.wk("COLOR",Z.Og),Z.resize(d,b,c),Z.ul(d,a.ra,a.qa);return d;case "DEPTH":return a.Zd?(d=Z.wk("DEPTH_RB",a.hj?Z.Yl:Z.Xl),Z.resize(d,b,c)):(d=Z.wk("DEPTH_TEX",Z.oi),Z.resize(d,b,c),Z.ul(d,a.ra,a.qa)),d;case "CUBEMAP":return d=Z.nB(b);case "SCREEN":case "NONE":return null;default:throw"Wrong slink param: "+a.from;}}function h(a,b){var c=!1;L.oe(a,function(d,e,f){if(f&&(d=L.Ba(a,d),e=L.Ba(a,e),b(f,!1,d,
e)))return c=!0});c||L.aa(a,function(a,c){for(var d=0;d<c.la.length;d++)if(b(c.la[d],!0,c,null))return!0})}function k(a){L.aa(a,function(b,c){if("SINK"!=c.type){var d=c.j;L.Bg(a,b,function(a,b,c){c.zb&&c.va&&(fa.Sn(d,c.from,c.va),c.from==c.to&&b.j&&fa.Sn(b.j,c.from,c.va))});for(var e=0;e<c.la.length;e++){var f=c.la[e];f.zb&&f.from==f.to&&fa.Sn(d,f.from,c.Pe[e])}!d.Hb&&!d.Ld||d.ge||(d.ge=Ia.CF(d.Hb,d.Ld))}});L.aa(a,function(b,c){if("RESOLVE"==c.type||"COPY"==c.type){var d=ga(a,c);c.j.fq=d[0].j.ge}})}
function u(a){var b=null,c=0;L.aa(a,function(a,d){if(d.type==ra.OG){if(c==ra.NG)return b=d,!0;c++}});return b}function w(a,b){var c=L.Ie(a,b),d=v("NONE"),e=L.u(a,d),f=L.Tk(a)[0];L.oe(a,function(b,c){c==f&&L.yw(a,b,f,b,e)});L.oe(a,function(e,f,h){if(e==c)return L.m(a,b,d,A(ra.rG,"u_color",h.size,h.Wh,h.vl,h.Fl)),!0});L.oc(a,e,f,A("SCREEN","NONE",.5,.5,.5,!0))}function C(a,b,c){var d=["GRASS_MAP","SHADOW_CAST","MAIN_CUBE_REFLECT"],e=c.L,f=b.antialiasing,h=b.ev,k,g,m;h&&f?L.aa(a,function(b,c){if("ANTIALIASING"==
c.type){var d=Ea(a,c,"COMPOSITING");k=d?L.Ba(a,d):b}else"COMPOSITING"==c.type&&(k=b)}):k=L.Tk(a)[0];L.pe(a,k,function(b,c){if(ca(a,c,"MAIN_OPAQUE"))return g=b,m=c,!0});for(var l=L.ao(a,g,L.Tl),n=[],q=[],t=[],l=L.clone(l,function(f){var k;if(-1<d.indexOf(f.type))q.push(f),k=f;else{k=x(f);if("MAIN_PLANE_REFLECT"==k.type)for(var g=b.rg.Je,m=0;m<g.length;m++)if(g[m][0]==f){b.rg.Je[m]=[f,k];k.j.cc=f.j.cc;c.L.push(k.j);break}-1<e.indexOf(f.j)&&(h?(fa.rn(f.j,fa.kc),fa.rn(k.j,fa.lc)):(fa.rn(f.j,fa.xb),fa.rn(k.j,
fa.Gb)),e.push(k.j));g=L.Ie(a,f);L.pe(a,g,function(a,b,c){-1<d.indexOf(b.type)&&n.push([b,k,c])});for(m=0;m<f.la.length;m++)k.la[m].jl=f.la[m];f=!0;for(m=0;m<L.bn(a,g);m++){var l=L.Pi(a,g,m),l=L.Ba(a,l);-1==d.indexOf(l.type)&&(f=!1)}f&&t.push(k)}return k},function(a){var b=r(a,!0);b.jl=a;return b}),S=0;S<q.length;S++)L.Le(l,L.Ie(l,q[S]));L.qp(l);var B=ma(h),S=L.u(a,B);L.yw(a,g,k,S,k);f=ea();L.u(a,f);var u=A("COLOR","COPY",1,1,1,!0);L.m(a,m,f,u);var p=A("COLOR","u_sampler_left",1,1,1,!0);p.ko=!0;p.ra=
Z.r;p.qa=Z.r;L.m(a,f,B,p);B=A("COLOR","u_sampler_right",1,1,1,!0);B.ra=Z.r;B.qa=Z.r;B.jl=u;L.aA(l,a,[L.Tk(l)[0],S,B]);for(S=0;S<n.length;S++)L.m(a,n[S][0],n[S][1],n[S][2]);l=A("SCREEN","NONE",0,0,0,!1);for(S=0;S<t.length;S++)L.m(a,f,t[S],l);if(h){var ra=[];L.aa(a,function(b,c){if(-1==d.indexOf(c.type)&&c.la.length&&sa(a,c,"STEREO"))for(var e=0;e<c.la.length;e++){var f=c.la[e];-1==ra.indexOf(f)&&ra.push(f)}});L.oe(a,function(b,c,e){b=L.Ba(a,b);c=L.Ba(a,c);-1==d.indexOf(b.type)&&sa(a,c,"STEREO")&&-1==
ra.indexOf(e)&&ra.push(e)});for(S=0;S<ra.length;S++)ra[S].Wh*=.5}}function E(a,b){a.yn=b;a.Qq=new Float32Array(3*b);a.nn=new Float32Array(3*b);a.mn=new Float32Array(3*b);a.Rq=new Float32Array(0==b%2?2*b:2*b+2)}function G(a,b,c,d){var e=m("SHADOW_CAST");e.Ep=a;e.self_shadow_polygon_offset=c.self_shadow_polygon_offset;e.ne=b;switch(c.ie[b]){case "SPOT":case "POINT":e.j=fa.Nb(fa.mc);fa.Tn(e.j,180*c.cx[b]/Math.PI,.1,2*c.lu[b]);break;default:e.j=fa.Nb(fa.Pg)}E(e,d);return e}function m(a){a={type:a,fb:"",
Za:!1,aw:!1,Uo:!1,wn:!1,Ak:0,Tf:0,Fm:[],time:0,j:null,yk:null,Gp:[],q:[],la:[],Pe:[],Ff:new Float32Array(3),iy:new Float32Array(3),Kc:new Float32Array(3),yc:new Float32Array(4),Rm:new Float32Array(4),hd:new Float32Array(16),Vw:0,Yf:0,yn:0,Qq:null,nn:null,mn:null,Rq:null,ag:new Float32Array(3),Mg:new Float32Array(3),Ww:new Float32Array(4),mx:new Float32Array([0,0,0]),gs:new Float32Array(3),nx:new Float32Array(4),Uw:new Float32Array(3),el:0,Tp:0,Xk:!1,uf:new Float32Array(3),Ig:0,Lb:null,ro:!1,vg:new Float32Array(2),
wg:new Float32Array(2),xj:0,cj:0,lp:0,se:null,Kg:0,mi:0,Jg:0,af:!1,Ct:0,Dt:new Float32Array(2),Bt:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,yj:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,Cj:0,Bj:0,Aj:0,ex:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,
god_rays_intensity:0,bj:0,Mn:0,Gj:0,Ep:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,vo:null,uo:null,Cs:null,Mh:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,cp:0,$p:0,mb_decay_threshold:0,mb_factor:0,Kv:0,In:"",bE:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,ps:new Float32Array(2),rb:new Float32Array(2),Bi:new Float32Array(4),chromatic_aberration_coefs:new Float32Array(4),enable_hmd_stereo:!1,ne:0,Ib:!0,enqueue:!0,
Fa:!0,Ja:!0,pc:!0,sa:!0,Df:1};a.rb[0]=1;a.rb[1]=1;a.Bi[2]=1;return a}function x(a){var b=a.j;a.j=null;var c=ya.xa(a);a.j=b;c.j=d(b);return c}function A(a,b,c,d,e,f){return{from:a,to:b,size:c,Wh:d,vl:e,Fl:f,zb:!0,va:null,hj:!1,Zd:!1,ra:Z.ad,qa:Z.ad,ko:!1}}function r(a,b){if(b){var c=a.va;a.va=null}a.va&&ya.W("Failed to clone slink with attached texture");var d=ya.ah(a);b&&(a.va=c,d.va=c);return d}function e(){var a=m("GRASS_MAP");a.j=fa.Nb(fa.Kf);return a}function v(a){var b=m("POSTPROCESSING");b.Fa=
!1;b.Ja=!1;b.pc=!1;b.j=fa.Nb(fa.Tb);b.In=a;switch(a){case "NONE":b.rb[0]=1;b.rb[1]=1;break;case "GRAYSCALE":b.rb[0]=1;b.rb[1]=1;break;case "X_BLUR":b.rb[0]=1;b.rb[1]=0;break;case "Y_BLUR":b.rb[0]=0;b.rb[1]=1;break;case "X_GLOW_BLUR":b.rb[0]=1;b.rb[1]=0;break;case "Y_GLOW_BLUR":b.rb[0]=0;b.rb[1]=1;break;case "X_EXTEND":b.rb[0]=1;b.rb[1]=0;break;case "Y_EXTEND":b.rb[0]=0;b.rb[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function J(a){var b=m("BLOOM_BLUR");b.Fa=!1;b.Ja=!1;b.pc=
!1;b.j=fa.Nb(fa.Tb);b.In=a;switch(a){case "X_BLUR":b.rb[0]=1;b.rb[1]=0;break;case "Y_BLUR":b.rb[0]=0;b.rb[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}return b}function D(a,b){var c=m("GLOW_COMBINE");c.Fa=!1;c.Ja=!1;c.pc=!1;c.small_glow_mask_coeff=b.$f.small_glow_mask_coeff;c.large_glow_mask_coeff=b.$f.large_glow_mask_coeff;c.small_glow_mask_width=b.$f.small_glow_mask_width;c.large_glow_mask_width=b.$f.large_glow_mask_width;c.j=a;return c}function H(a,b,c,d,e,f,h,k,g){var l=
m("MAIN_"+a);if("OPAQUE"===a)l.Fa=!0,l.Ja=c,l.Za=!1;else if("BLEND"===a)l.Fa=!1,l.Ja=!1,l.Za=!0;else if("XRAY"===a)l.Fa=!1,l.Ja=!0,l.Za=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)l.Fa=!0,l.Ja=!0,l.Za=!1;else if("GLOW"===a)l.Fa=!0,l.Ja=!1,l.Za=!1;else throw"wrong main subscene type";l.Za&&k&&(l.self_shadow_normal_offset=k.self_shadow_normal_offset);l.j=b;if(a=h.Vr)l.Ww.set([a.vA,a.ND,a.kI,a.jI]),l.Uw.set(a.color),l.Vw=a.Oa;l.ag.set(h.ag);l.Mg.set(h.Mg);l.Yf=h.Yf;l.yc=f.yc;l.Rm=f.Rm;d&&(l.Lb=
d,d.yc&&(l.se=new Float32Array(d.yc)),l.Kg=d.waves_height,l.mi=d.waves_length,l.Jg=d.Jg,d.af&&g&&(l.af=!0,l.Ct=d.JA,l.Dt.set(d.KA),l.Bt=d.IA),d.Vn&&(l.ro=!0,f=d.pG,l.vg[0]=(f[0]+f[1])/2,l.vg[1]=(f[2]+f[3])/2,l.wg[0]=f[0]-f[1],l.wg[1]=f[2]-f[3],l.xj=d.xj,l.cj=d.cj));E(l,e);return l}function I(){var a=m("RESOLVE");a.j=fa.Nb(fa.Tb);return a}function P(a,b,c){var d=m("COLOR_PICKING");b&&(d.type+="_XRAY",d.Fa=!1,d.Ja=!0);d.enqueue=!1;d.j=a;E(d,c);return d}function K(a){var b=m("WIREFRAME");b.Ib=!1;b.Fa=
!1;b.Ja=!1;b.j=a;return b}function y(a){var b=m("ANCHOR_VISIBILITY");b.Fa=!0;b.Ja=!1;b.j=a;return b}function F(a,b){var c=m("DEPTH");c.j=a;E(c,b);return c}function M(a){var b=m("DEPTH_PACK");b.Fa=!1;b.Ja=!1;b.j=a;return b}function O(a,b,c){var d=m("SSAO");d.Fa=!1;d.Ja=!1;d.pc=!1;d.j=a;d.yc=b.yc;d.se=new Float32Array(b.yc);d.Cj=c.radius_increase;d.ssao_hemisphere=c.MD;d.Bj=c.influence;d.Aj=c.dist_factor;d.ex=c.LF;return d}function V(a,b){var c=m("SSAO_BLUR");c.Fa=!1;c.Ja=!1;c.pc=!1;c.j=a;c.ssao_blur_depth=
b.yA;c.ssao_blur_discard_value=b.vt;return c}function T(a){var b=m("ANTIALIASING");b.Fa=!1;b.Ja=!1;b.pc=!1;b.Df=1/a.Tc;b.MC=a.bt;b.j=fa.Nb(fa.Tb);return b}function U(a,b){var c=m(a);c.Fa="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;c.Ja=!1;c.pc=!1;c.Df=1/b.Tc;c.j=fa.Nb(fa.Tb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(c.cE=new Float32Array(4));return c}function B(a,b,c,d){var e=m("COMPOSITING");e.Fa=!1;e.Ja=!1;e.pc=!1;e.j=fa.Nb(fa.Tb);e.brightness=a;e.contrast=b;e.exposure=c;
e.saturation=d;return e}function ha(a,b){var c=m("MOTION_BLUR");c.Fa=!1;c.Ja=!1;c.pc=!1;c.j=fa.Nb(fa.Tb);c.Uo=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function ba(a){var b=m("DOF");b.Fa=!1;b.Ja=!1;b.pc=!1;b.j=a;b.Df=b.j.dof_power;return b}function da(a,b){var c=m("OUTLINE_MASK");c.pc=!1;c.j=a;E(c,b);return c}function W(a){var b=m("OUTLINE");oa.outlining_overview_mode?b.uf.set(oa.uf):b.uf.set(a.uf);b.el=a.el;b.$p=5;b.cp=3;b.pc=!1;b.j=fa.Nb(fa.Tb);return b}function R(a,b,c,d,e,f,h){var k=m("GOD_RAYS");
k.Fa=!1;k.Ja=!1;k.pc=!1;k.ag=new Float32Array([1,1,1]);k.Mg=new Float32Array([1,1,1]);k.Yf=1;k.aw=d;k.Ig=b;k.Mn=e;k.bj=c;k.Gj=h;k.j=a;E(k,f);return k}function Y(a,b){var c=m("GOD_RAYS_COMBINE");c.Fa=!1;c.Ja=!1;c.pc=!1;c.j=fa.Nb(fa.Tb);c.god_rays_intensity=a;E(c,b);return c}function ka(a,b){var c=m("SKY");c.enqueue=!1;c.Fa=!1;c.Ja=!1;c.pc=!1;var d=fa.Nb(fa.Tb);d.width=Fb.zk;d.height=Fb.zk;c.j=d;c.yk=ya.PC();E(c,a);c.ag=new Float32Array([1,1,1]);c.Mg=new Float32Array([1,1,1]);c.Yf=1;c.yj.set(b.yj);
c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ea(){var a=m("COPY");
a.Fa=!1;a.Ja=!1;a.j=fa.Nb(fa.Tb);return a}function ma(a){var b=m("STEREO");b.Fa=!1;b.Ja=!1;b.fb=a?"HMD":"ANAGLYPH";b.j=fa.Nb(fa.Tb);return b}function la(){var a=m("LUMINANCE");a.Fa=!1;a.Ja=!1;a.j=fa.Nb(fa.Tb);return a}function N(){var a=m("AVERAGE_LUMINANCE");a.Fa=!1;a.Ja=!1;a.j=fa.Nb(fa.Tb);return a}function aa(a,b,c,d){var e=m("LUMINANCE_TRUNCED");e.Fa=!1;e.Ja=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;E(e,c);return e}function X(a){var b=m("BLOOM");b.Fa=!1;b.Ja=!1;b.j=fa.Nb(fa.Tb);b.bloom_blur=a;
return b}function Q(){var a=m("SINK");a.enqueue=!1;return a}function sa(a,b,c){if(b.type===c)return!0;b=ua(a,b);for(var d=0;d<b.length;d++)if(sa(a,b[d],c))return!0;return!1}function ca(a,b,c){if(b.type===c)return!0;b=ga(a,b);for(var d=0;d<b.length;d++)if(ca(a,b[d],c))return!0;return!1}function Ea(a,b,c){if(b.type===c)return b;b=ga(a,b);for(var d=0;d<b.length;d++){var e=Ea(a,b[d],c);if(e)return e}return null}function ga(a,b){var c=L.Ie(a,b);if(c==L.Rs)throw"Subscene not in graph";for(var d=[],e=L.bn(a,
c),f=0;f<e;f++){var h=L.Pi(a,c,f);h!=c&&d.push(L.Ba(a,h))}return d}function ua(a,b){var c=L.Ie(a,b);if(c==L.Rs)throw"Subscene not in graph";for(var d=[],e=L.kg(a,c),f=0;f<e;f++){var h=L.Zf(a,c,f);h!=c&&d.push(L.Ba(a,h))}return d}function Aa(a){var b=[],c=[];h(a,function(a){a.va&&-1==b.indexOf(a.va)&&(b.push(a.va),c.push(a.va,b.length-1))});return c}function qa(a,b){var c;c=""+(a.from+"\\n");c+="NONE"!=a.to?a.to+"\\n":"";c+="(";if(a.Fl){var d=a.Wh,e=a.vl;Math.round(d)!=d&&(d=d.toFixed(2));Math.round(e)!=
e&&(e=e.toFixed(2));c+=(1==d?"":d)+"Sx"+((1==e?"":e)+"S")}else d=a.Wh,e=a.vl,c+=a.size*d+"x"+a.size*e;if("SCREEN"!=a.from){c+=" ";if(a.Zd)c+="RR";else{var d=a.ra,e=a.qa,f="";d==Z.r?f+="L":d==Z.ad&&(f+="N");e==Z.r?f+="L":e==Z.ad&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.va&&(c+=" "+b[d+1])}return c+")\\n"}var fa=p("__camera"),pa=p("__config"),S=p("__debug"),L=p("__graph");p("__obj_util");var Ia=p("__renderer"),Z=p("__textures");p("__tsr");var ya=p("__util"),ra=pa.Mp,Ja=pa.p,oa=pa.Jb,Fb=pa.tj;
a.XA=function(a){switch(a.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "NONE":return!1;default:return!0}};a.XG=h;a.CB=function(a,c,f){function h(b){var e=d(Ma);c.L.push(e);e=H(b,e,!1,E,z,qb,rc,Ga,a.$h);L.u(g,e);"XRAY"==b?(L.m(g,m[0],e,A("COLOR","COLOR",1,1,1,!0)),e.la.push(A("DEPTH","DEPTH",1,1,1,!0))):(b=ib&&"RESOLVE"==m[0].type?Qa:m[0],L.m(g,b,e,jb),L.m(g,b,e,$b));$a&&(L.m(g,$a,e,Lb),L.m(g,$a,e,yb));for(b=0;b<n.length;b++)L.m(g,n[b],
e,t[b]);gc&&L.m(g,gc,e,tb);if(x.length){var f=x.length;for(b=0;b<f;b++)L.m(g,x[b],e,p[b])}if(oa.length)for(b=0;b<oa.length;b++)L.m(g,oa[b],e,Aa[b]);rb&&L.m(g,rb,e,A("COLOR","u_refractmap",1,1,1,!0));return e}var g=L.create(),m=[],l=[],n=[],t=[],x=[],p=[],oa=[],Aa=[],z=a.gE,E=a.Lb,Ia=a.shore_smoothing,qa=a.sG,pa=a.Xc,ca=a.Si,sa=a.LE,ma=a.rg,Zb=a.xA,dd=a.Fh,Ea=a.xi,Nc=a.antialiasing,rc=a.Ks,qb=a.gy,Ga=a.hc,Hb=a.PE,zc=a.LA,Ac=a.GD,Gc=a.cF,Xc=a.Ci,kb=a.cC,ab=a.Dc,Na=Boolean(f.length),ib=1<Ja.Ac,$b=A("COLOR",
"COLOR",1,1,1,!0),jb=A("DEPTH","DEPTH",1,1,1,!0);if(ib){r(jb);var Oa=r(jb);$b.hj=!0;$b.Zd=!0;jb.hj=!0;jb.Zd=!0}var Ma=c.L[0];if(Ga){fa.ws(Ma,Ga);for(var Fa=0;Fa<Ga.ie.length;Fa++)for(var Hc=Ga.csm_num,Wa=0;Wa<Hc;Wa++){var ub=G(Wa,Fa,Ga,z);L.u(g,ub);n.push(ub);var Ra=Ga.csm_resolution,za=ub.j;c.Pr.push(za);za.width=Ra;za.height=Ra;ub.Fa=!1;t.push(A("DEPTH","u_shadow_map"+(0<Fa?Fa:Wa),Ra,1,1,!1));(S.SA()||Ja.tu)&&ub.la.push(A("COLOR","COLOR",Ra,1,1,!1))}}if(ma&&ma.Tv&&!Na)for(Wa=0;Wa<ma.Tv;Wa++){za=
fa.Nb(fa.mc);za.width=a.fh;za.height=a.fh;fa.Tn(za,90,.1,100);fa.zf(za,za.Ua);var Ka=H("CUBE_REFLECT",za,!1,E,z,qb,rc,null,a.$h);Ka.yk=ya.TC();for(Fa=0;6>Fa;Fa++)Ka.Gp.push(fa.qB());L.u(g,Ka);var bb=A("CUBEMAP","u_cube_reflection",a.fh,1,1,!1);bb.ra=Z.r;bb.qa=Z.r;var Da=A("DEPTH","DEPTH",a.fh,1,1,!1);Aa.push(bb);Ka.la.push(Da);oa.push(Ka);ma.Sf.push(Ka)}if(ma&&0<ma.zw.length&&!Na)for(Fa=0;Fa<ma.zw.length;Fa++)za=d(Ma),za.cc=new Float32Array(4),c.L.push(za),Ka=H("PLANE_REFLECT",za,!1,E,z,qb,rc,null,
a.$h),L.u(g,Ka),bb=A("COLOR","u_plane_reflection",1,a.Oh,a.Oh,!0),bb.ra=Z.r,bb.qa=Z.r,Da=A("DEPTH","DEPTH",1,a.Oh,a.Oh,!0),p.push(bb),Ka.la.push(Da),x.push(Ka),ma.Je.push([Ka]);if(a.$b){var $a=e();L.u(g,$a);Ra=Fb.Xm;$a.j.width=Ra;$a.j.height=Ra;var Lb=A("DEPTH","u_grass_map_depth",Ra,1,1,!1);Lb.ra=Z.r;Lb.qa=Z.r;var yb=A("COLOR","u_grass_map_color",Ra,1,1,!1);yb.ra=Z.r;yb.qa=Z.r}else yb=Lb=$a=null;if(kb&&Ga){var Bc=d(Ma);c.L.push(Bc);var Sa=F(Bc,z);L.u(g,Sa);Sa.self_shadow_normal_offset=Ga.self_shadow_normal_offset;
for(Wa=0;Wa<n.length;Wa++)ub=n[Wa],L.m(g,ub,Sa,t[Wa]);var Yc=A("COLOR","u_color",1,1,1,!0),Ic=A("DEPTH","u_depth",1,1,1,!0);if(pa){var Pb=d(Ma);c.L.push(Pb);var Vb=a.GG,Cb=O(Pb,qb,Vb);L.u(g,Cb);var hc=A("COLOR","u_ssao_mask",1,1,1,!0);L.m(g,Sa,Cb,Yc);L.m(g,Sa,Cb,Ic);var Jc=d(Ma);c.L.push(Jc);var ic=V(Jc,Vb);L.u(g,ic);var zb=A("COLOR","u_shadow_mask",1,1,1,!0);L.m(g,Cb,ic,hc);L.m(g,Sa,ic,Ic)}ib&&Sa.la.push(A("DEPTH","DEPTH",1,1,1,!0));$a&&(L.m(g,$a,Sa,Lb),L.m(g,$a,Sa,yb))}else Sa=null;var Qa=H("OPAQUE",
Ma,ib||!Sa||Ja.lk,E,z,qb,rc,null,a.$h);L.u(g,Qa);if(ib){var Ha=I();L.u(g,Ha);l.push(Ha);var Ya=A("COLOR","RESOLVE",1,1,1,!0);Ya.hj=!0;Ya.Zd=!0;var Db=A("DEPTH","RESOLVE",1,1,1,!0);Db.hj=!0;Db.Zd=!0;L.m(g,Qa,Ha,Ya);L.m(g,Qa,Ha,Db);Sa&&(hc?L.m(g,ic,Qa,zb):Ga?L.m(g,Sa,Qa,A("COLOR","u_shadow_mask",1,1,1,!0)):ya.W("Internal error"))}else l.push(Qa),Sa&&(L.m(g,Sa,Qa,jb),hc?L.m(g,ic,Qa,zb):Ga?L.m(g,Sa,Qa,A("COLOR","u_shadow_mask",1,1,1,!0)):ya.W("Internal error"));$a&&(L.m(g,$a,Qa,Lb),L.m(g,$a,Qa,yb));if(x.length)for(var Ib=
x.length,Fa=0;Fa<Ib;Fa++)L.m(g,x[Fa],Qa,p[Fa]);if(oa.length)for(Fa=0;Fa<oa.length;Fa++)L.m(g,oa[Fa],Qa,Aa[Fa]);m=l;l=[];if(!Na&&a.eB){za=d(Ma);c.L.push(za);var ac=P(za,!1,z);L.u(g,ac);if(a.Hf){za=d(Ma);c.L.push(za);var Jb=P(za,!0,z);L.u(g,Jb);L.m(g,ac,Jb,A("COLOR","COLOR",1,1,1,!0));L.m(g,ac,Jb,A("DEPTH","DEPTH",1,1,1,!0))}}else ac=null;if(sa.Dc&&!Na)if(ib)rb=Ha;else{var rb=ea();L.u(g,rb);L.m(g,m[0],rb,A("COLOR","COPY",1,1,1,!0))}else rb=null;if(kb&&(sa.Dc&&ab||Ia||qa)){var Mb=d(Ma);c.L.push(Mb);
var gc=M(Mb);L.u(g,gc);L.m(g,ib?Ha:Qa,gc,A("DEPTH","u_depth",1,1,1,!0));var tb=A("COLOR","u_scene_depth",1,1,1,!0);tb.ra=Z.ad;tb.qa=Z.ad}else gc=null;if(a.Wm){var Qb=h("BLEND");l.push(Qb);m=l;l=[]}if(a.nf){var jc=d(Ma);c.L.push(jc);var Cc=H("GLOW",jc,!1,E,z,qb,rc);L.u(g,Cc);L.m(g,ib?Ha:Qa,Cc,ib?Oa:jb);var Ta=v("X_GLOW_BLUR");Ta.fb="GLOW_MASK_SMALL";Ta.Df=a.$f.small_glow_mask_width;var fb=A("COLOR","u_color",1,1,1,!0);fb.ra=Z.r;fb.qa=Z.r;L.u(g,Ta);L.m(g,Cc,Ta,fb);var va=v("Y_GLOW_BLUR");va.fb="GLOW_MASK_SMALL";
va.Df=a.$f.small_glow_mask_width;var wa=A("COLOR","u_color",1,.5,.5,!0);wa.ra=Z.r;wa.qa=Z.r;L.u(g,va);L.m(g,Ta,va,wa);var lb=v("X_GLOW_BLUR");lb.fb="GLOW_MASK_LARGE";lb.Df=a.$f.large_glow_mask_width;var cb=A("COLOR","u_color",1,.5,.5,!0);cb.ra=Z.r;cb.qa=Z.r;L.u(g,lb);L.m(g,va,lb,cb);var Wb=v("Y_GLOW_BLUR");Wb.fb="GLOW_MASK_LARGE";Wb.Df=a.$f.large_glow_mask_width;var Pa=A("COLOR","u_color",1,.25,.25,!0);Pa.ra=Z.r;Pa.qa=Z.r;L.u(g,Wb);L.m(g,lb,Wb,Pa);var sc=d(Ma);c.L.push(sc);var nb=D(sc,a);L.u(g,nb);
var vb=A("COLOR","u_src_color",1,1,1,!0);if(a.Wm)if(ib){var Rb=I();L.u(g,Rb);L.m(g,Qb,Rb,Ya);L.m(g,Qb,Rb,Db);L.m(g,Rb,nb,vb)}else L.m(g,Qb,nb,vb);else L.m(g,ib?Ha:Qa,nb,vb);L.m(g,a.Wm?Qb:Qa,nb,jb);var Nb=A("COLOR","u_glow_mask_small",1,.5,.5,!0);Nb.ra=Z.r;Nb.qa=Z.r;L.m(g,va,nb,Nb);var Ab=A("COLOR","u_glow_mask_large",1,.25,.25,!0);Ab.ra=Z.r;Ab.qa=Z.r;L.m(g,Wb,nb,Ab);m=[nb];l=[]}a.Wm||(Qb=h("BLEND"),l.push(Qb),m=l,l=[]);if(Ja.wireframe_debug){za=d(Ma);c.L.push(za);var bc=K(za);l.push(bc);L.u(g,bc);
L.m(g,m[0],bc,$b);L.m(g,m[0],bc,jb);$a&&(L.m(g,$a,bc,Lb),L.m(g,$a,bc,yb));m=l;l=[]}if(ib){var tc=I();L.u(g,tc);l.push(tc);L.m(g,m[0],tc,Ya);L.m(g,m[0],tc,Db);m=l;l=[]}var uc=m.slice(0);if(!Na&&a.Kz){za=d(Ma);c.L.push(za);var cc=y(za);L.u(g,cc);L.m(g,m[0],cc,ib?Oa:jb)}if(ca&&kb&&!Na){var ob=Ac.bj,La=Ac.Eq,eb=Ac.Gj,Ua=m[0],Dc=E?1:0,pb=A("DEPTH","u_input",1,1,1,!0);pb.ra=Z.r;pb.qa=Z.r;var Ob=A("COLOR","u_input",1,.25,.25,!0);Ob.ra=Z.r;Ob.qa=Z.r;var Xb=ob/eb,gb=d(Ma);c.L.push(gb);var Kb=R(gb,Dc,ob,!0,
Xb,z,eb);L.u(g,Kb);L.m(g,Ua,Kb,pb);var Xb=ob/eb*.5,kc=d(Ma);c.L.push(kc);var lc=R(kc,Dc,ob,!1,Xb,z,eb);L.u(g,lc);L.m(g,Kb,lc,Ob);var Xb=ob/eb*.25,Eb=d(Ma);c.L.push(Eb);var mc=R(Eb,Dc,ob,!1,Xb,z,eb);L.u(g,mc);L.m(g,lc,mc,Ob);var vc=Y(La,z);l.push(vc);L.u(g,vc);L.m(g,Ua,vc,A("COLOR","u_main",1,1,1,!0));L.m(g,mc,vc,A("COLOR","u_god_rays",1,1,1,!0));m=l;l=[]}if(Zb&&!Na){var Ua=m[0],nc=la();L.u(g,nc);L.m(g,Ua,nc,A("COLOR","u_input",1,1,1,!0));var Sb=N();L.u(g,Sb);Sb.j.width=Ja.Gk?2:1;Sb.j.height=Ja.Gk?
2:1;var oc=A("COLOR","u_input",1,.25,.25,!0);oc.ra=Z.r;oc.qa=Z.r;var dc=A("COLOR","u_luminance",1,.25,.25,!0);dc.ra=Z.r;dc.qa=Z.r;L.m(g,nc,Sb,oc);var wc=Zb.key,Kc=Zb.jC,Zc=d(Ma);c.L.push(Zc);var Ec=aa(wc,Kc,z,Zc);L.u(g,Ec);L.m(g,Ua,Ec,A("COLOR","u_main",1,1,1,!0));L.m(g,nc,Ec,dc);L.m(g,Sb,Ec,A("COLOR","u_average_lum",1,1,1,!1));var sb=A("COLOR","u_color",1,.25,.25,!0);sb.ra=Z.r;sb.qa=Z.r;Ta=J("X_BLUR");L.u(g,Ta);L.m(g,Ec,Ta,sb);va=J("Y_BLUR");L.u(g,va);L.m(g,Ta,va,sb);var Va=X(Zb.blur);L.u(g,Va);
var Xa=A("COLOR","u_bloom",1,.25,.25,!0);Xa.ra=Z.r;Xa.qa=Z.r;L.m(g,va,Va,Xa);L.m(g,Ua,Va,A("COLOR","u_main",1,1,1,!0));l.push(Va);m=l;l=[]}if(Xc&&kb&&!Na){var Ua=m[0],ec=d(Ma);c.L.push(ec);sb=A("COLOR","u_color",1,1,1,!0);sb.ra=Z.r;sb.qa=Z.r;var Fc=v("X_BLUR");L.u(g,Fc);L.m(g,Ua,Fc,sb);var xc=v("Y_BLUR");L.u(g,xc);L.m(g,Fc,xc,sb);var pc=uc[0],Rc=ba(ec);ec.dof_distance=c.dof_distance;ec.ld=c.ld;ec.dof_front=c.dof_front;ec.dof_rear=c.dof_rear;ec.dof_power=c.dof_power;ec.dof_on=!0;l.push(Rc);L.u(g,Rc);
L.m(g,Ua,Rc,A("COLOR","u_sharp",1,1,1,!0));L.m(g,xc,Rc,A("COLOR","u_blurred",1,1,1,!0));L.m(g,pc,Rc,A("DEPTH","u_depth",1,1,1,!0));m=l;l=[]}if(a.Hf){var md=h("XRAY");l.push(md);m=l;l=[]}if(dd&&!Na){var ed=m[0],$c=ha(Hb.mb_decay_threshold,Hb.mb_factor);l.push($c);L.u(g,$c);L.m(g,ed,$c,A("COLOR","u_mb_tex_curr",1,1,1,!0));$c.la.push(A("COLOR","u_mb_tex_accum",1,1,1,!0));m=l;l=[]}if(!Na&&a.outline){var Ua=m[0],fd=d(Ma);c.L.push(fd);var Oc=da(fd,z);L.u(g,Oc);var Lc=v("X_EXTEND"),qd=A("COLOR","u_color",
1,1,1,!0),nd=A("COLOR","u_outline_mask",1,1,1,!0);Lc.Xk=!0;L.u(g,Lc);L.m(g,Oc,Lc,qd);var ad=A("COLOR","u_color",1,.5,.5,!0);ad.ra=Z.r;ad.qa=Z.r;var Sc=v("Y_EXTEND");Sc.Xk=!0;L.u(g,Sc);L.m(g,Lc,Sc,ad);Fc=v("X_BLUR");Fc.Xk=!0;L.u(g,Fc);L.m(g,Sc,Fc,ad);var wb=A("COLOR","u_color",1,.25,.25,!0);wb.ra=Z.r;wb.qa=Z.r;var gd=A("COLOR","u_outline_mask_blurred",1,.25,.25,!0);gd.ra=Z.r;gd.qa=Z.r;xc=v("Y_BLUR");xc.Xk=!0;L.u(g,xc);L.m(g,Fc,xc,wb);var qc=W(Gc);L.u(g,qc);L.m(g,Ua,qc,A("COLOR","u_outline_src",1,1,
1,!0));L.m(g,Oc,qc,nd);L.m(g,xc,qc,gd);l.push(qc);m=l;l=[]}if(Ea&&!Na){var Ua=m[0],hd=B(zc.brightness,zc.contrast,zc.exposure,zc.saturation);L.u(g,hd);L.m(g,Ua,hd,A("COLOR","u_color",1,1,1,!0));l.push(hd);m=l;l=[]}if(Nc){Ua=m[0];if(Ja.smaa){var Pc=A("COLOR","u_color",1,1,1,!0);Pc.ra=Z.r;Pc.qa=Z.r;var bd=U("SMAA_EDGE_DETECTION",a);L.u(g,bd);L.m(g,Ua,bd,Pc);var yc=U("SMAA_BLENDING_WEIGHT_CALCULATION",a);L.u(g,yc);L.m(g,bd,yc,Pc);var jd=A("COLOR","u_search_tex",1,1,1,!1),kd=A("COLOR","u_area_tex",1,
1,1,!1);jd.ra=Z.r;jd.qa=Z.r;kd.ra=Z.r;kd.qa=Z.r;yc.la.push(jd);yc.la.push(kd);var Tc=U("SMAA_NEIGHBORHOOD_BLENDING",a);L.u(g,Tc);L.m(g,Ua,Tc,Pc);var ld=A("COLOR","u_blend",1,1,1,!0);ld.ra=Z.r;ld.qa=Z.r;L.m(g,yc,Tc,ld);l.push(Tc)}else{var cd=T(a);L.u(g,cd);var rd=A("COLOR","u_color",1,1,1,!0);rd.ra=Z.r;rd.qa=Z.r;L.m(g,Ua,cd,rd);l.push(cd)}m=l;l=[]}l.push(m[0]);var Ad=L.Ie(g,m[0]);if("MOTION_BLUR"==m[0].type||"RESOLVE"==m[0].type)var sd=!0;else sd=!1,L.pe(g,Ad,function(a,b,c){if(c.from==c.to)return sd=
!0});if(sd){var td=v("NONE");L.u(g,td);L.m(g,m[0],td,A("COLOR","u_color",1,1,1,!0));m=l;l=[];l.push(td)}ac&&(Jb?l.push(Jb):l.push(ac));cc&&l.push(cc);if(!Na&&a.Yn.procedural_skydome){var vd=ka(z,a.Yn);L.u(g,vd);l.push(vd)}var Uc=Q();L.u(g,Uc);for(Wa=0;Wa<l.length;Wa++){var od=l[Wa];switch(od.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":L.m(g,od,Uc,A("COLOR","NONE",1,1,1,!0));L.m(g,od,Uc,A("DEPTH","NONE",1,1,1,!0));break;case "SKY":L.m(g,od,Uc,A("CUBEMAP","u_sky",Fb.zk,1,1,!1));break;case "ANCHOR_VISIBILITY":L.m(g,
od,Uc,A("COLOR","NONE",1,1,1,!0));break;default:if(Na){var wd=f[0].k,pd=A("COLOR","OFFSCREEN",1,1,1,!0);pd.va=wd;L.m(g,l[Wa],Uc,pd);for(Fa=1;Fa<f.length;Fa++){var xd=f[Fa].k,ud=v("NONE");L.u(g,ud);L.m(g,l[Wa],ud,A("COLOR","SCALE",1,1,1,!0));var yd=xd.Xh/wd.Xh,pd=A("COLOR","OFFSCREEN",1,yd,yd,!0);pd.va=xd;L.m(g,ud,Uc,pd)}}else L.m(g,l[Wa],Uc,A("SCREEN","NONE",1,1,1,!0))}}Ha&&!ua(g,Ha).length&&(L.Le(g,L.Ie(g,Ha)),L.qp(g));b(g,kb);!a.anaglyph_use&&!a.ev||Na||C(g,a,c);if(ra.enabled){var zd=u(g);zd&&w(g,
zd)}q(g);k(g);Ga&&L.aa(g,function(a,b){if("DEPTH"==b.type||"MAIN_BLEND"==b.type||"MAIN_XRAY"==b.type){for(var c=0,d=ga(g,b),e=0,f=0;f<d.length;f++){var h=d[f];"SHADOW_CAST"==h.type&&(e++,b.Mh=b.Mh||[],b.Mh[0<h.ne?h.ne:c]=h.j.lb,c++)}b.vo&&b.uo||(Ja.qn?b.Cs=new Float32Array(9*e):(b.vo=new Float32Array(4*e),b.uo=new Float32Array(4*e)))}});return g};a.oK=m;a.zd=function(a,b,c){var d=a.Df;a.ps[0]=b*a.rb[0]*d;a.ps[1]=c*a.rb[1]*d};a.vc=function(a,b){a.Df=b};a.AB=function(){var a=L.create(),b=m("PERFORMANCE"),
c=fa.Nb(fa.Tb);c.width=1024;c.height=1024;b.j=c;L.u(a,b);c=Q();L.u(a,c);L.m(a,b,c,A("COLOR","NONE",1024,1,1,!1));q(a);k(a);return a};a.HJ=function(a){var b=null;L.aa(a,function(a,c){return c.j&&null===c.j.ge?(b=c,!0):!1});return b};a.$a=function(a,b,c){a=ga(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.fK=sa;a.hK=ca;a.tD=ga;a.vD=ua;a.qb=function(a,b){var c=null;L.aa(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.VB=function(a){var b="digraph scenegraph {\n",b=
b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=Aa(a);L.aa(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.In.replace(/_/g," ")+")");if(d.j){for(var f=f+"\\n",h=0;h<c.length;h+=2){var g=d.j.Hb;c[h]==g&&(f=Z.Xi(g)?f+("CR"+c[h+1]+" "):f+("C"+c[h+1]+" "))}for(h=0;h<c.length;h+=2)g=d.j.Ld,c[h]==g&&(f=Z.Xi(g)?f+("DR"+c[h+1]):f+("D"+c[h+1]))}d.la.length&&(f+="\\n-----\\n");
for(h=0;h<d.la.length;h++)f+=qa(d.la[h],c);h="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(h+",bold")+'"];\n')});L.oe(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+qa(e,c)+'" style="'+(e.zb?"solid":"dotted")+'"];\n'});return b+="}"};a.DB=function(a){a=L.SG(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function d(){return{name:"",type:0,source:"",Xr:"",width:0,height:0,xp:1,dm:!0,Xh:1024,Jk:!1,gd:null,Fb:0,Na:null,Gd:null,Zk:!1,Ef:-1,ga:null,gj:0,lf:0,N:0,ab:0,Ki:0,He:!1,wf:1,gc:null,Kr:0,Jr:0,Vh:-1,Lr:!1,uj:-1,yo:!1,IH:!1,ci:!1,qo:!1,repeat:!0}}function b(b,e,f,h){var g=b.type,k=new Uint8Array([204,204,204,255]),m=d();switch(g){case "DATA_TEX2D":case "IMAGE":var l=B.createTexture(),n=B.TEXTURE_2D;B.bindTexture(n,l);B.texImage2D(n,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,
k);b.image&&"MOVIE"==b.image.source&&(m.Zk=!0,m.N=b.frame_start,m.ab=b.frame_offset,m.Ki=b.frame_duration,m.IH=b.use_auto_refresh,m.ci=b.use_cyclic,m.gj=b.movie_length,m.qo=b.b4w_nla_video,0!=m.ab&&D.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":l=B.createTexture();n=B.TEXTURE_2D;B.bindTexture(n,l);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(f=I.keysearch("name",
b.b4w_source_id,f)))m.Xh=b.b4w_source_size,f.te=f.te||[],f.te.push(b),B.texImage2D(n,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":l=B.createTexture();n=B.TEXTURE_CUBE_MAP;B.bindTexture(n,l);f="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var r=0;6>r;r++)B.texImage2D(B["TEXTURE_CUBE_MAP_"+f[r]],0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,k);break;case "BLEND":return null;default:return D.error('texture "'+b.name+'" has unsupported type "'+
g+'"'),null}"NONE"==g&&(!b.b4w_enable_canvas_mipmapping||"CANVAS"!=b.b4w_source_type)||"DATA_TEX2D"==g||"IMAGE"==g&&"MOVIE"==b.image.source?B.texParameteri(n,B.TEXTURE_MIN_FILTER,B.LINEAR):B.texParameteri(n,B.TEXTURE_MIN_FILTER,ha[y.Mj]);B.texParameteri(n,B.TEXTURE_MAG_FILTER,B.LINEAR);k=n;f=b.b4w_anisotropic_filtering;"DEFAULT"===f&&(f=e);"OFF"!==f&&y.fm&&(e=J.dD())&&(f=parseFloat(f.split("x")[0]),B.texParameterf(k,e.TEXTURE_MAX_ANISOTROPY_EXT,f));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(m.repeat=
!1,B.texParameteri(n,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(n,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE)):(B.texParameteri(n,B.TEXTURE_WRAP_S,B.REPEAT),B.texParameteri(n,B.TEXTURE_WRAP_T,B.REPEAT));m.type=a.Og;m.width=1;m.height=1;m.Na=l;m.Fb=n;"CANVAS"==b.b4w_source_type&&"NONE"==g?(g=b.b4w_source_id,l=b.b4w_source_size,m.Jk=b.b4w_enable_canvas_mipmapping,m.Xr=g,m.source="CANVAS",n=document.createElement("canvas"),n.width=l,n.height=l,m.gd=n.getContext("2d"),h in T||(T[h]={}),T[h][g]=m,c(m)):"SCENE"==
b.b4w_source_type&&"NONE"==g?(m.Xr=b.b4w_source_id,m.source="SCENE"):(m.source=g,B.generateMipmap(n),B.bindTexture(n,null));m.name=b.name;return b.k=m}function c(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Fb;B.bindTexture(b,a.Na);var c=h(a),d=k(a),e=u(a),f=a.gd.canvas;B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!0);B.texImage2D(b,0,d,c,e,f);B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!1);a.Jk&&B.generateMipmap(b);B.bindTexture(b,null);a.width=f.width;a.height=f.height}function q(a){var b=a.Fb;B.bindTexture(b,
a.Na);B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!0);4!=a.ga.length?a.He?l(a,a.ga,a.width*a.wf,a.height*a.wf,!1):B.texImage2D(b,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,a.ga):B.texImage2D(b,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,a.ga);B.bindTexture(b,null)}function f(a){var b=a.Fb;B.bindTexture(b,a.Na);B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!0);a.He?l(a,a.gc[a.Vh],a.width*a.wf,a.height*a.wf,!1):B.texImage2D(b,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,a.gc[a.Vh]);B.bindTexture(b,null)}function t(){M||(M=document.createElement("canvas"));
return M}function l(a,b,c,d,e){e||(n(B.TEXTURE_2D),B.texImage2D(B.TEXTURE_2D,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,b));B.bindTexture(B.TEXTURE_2D,null);P.hC(a,c,d,V,O)}function n(a){V||(V=B.createFramebuffer());B.bindTexture(a,null);O||(O=B.createTexture());B.bindTexture(a,O);B.texParameteri(a,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE);B.texParameteri(a,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE);B.texParameteri(a,B.TEXTURE_MAG_FILTER,B.LINEAR);B.texParameteri(a,B.TEXTURE_MIN_FILTER,B.LINEAR)}function g(a){a.ga.IK=function(){q(a)}}
function z(a){return I.kk(a)?I.clamp(Math.pow(2,parseInt(a).toString(2).length),2,y.Db):a}function h(b){switch(b.type){case a.Og:b=B.RGBA;break;case a.am:b=B.RGB;break;case a.Wj:b=B.RGBA;break;case a.Xj:b=B.RGB;break;case a.oi:b=B.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function k(b){switch(b.type){case a.Og:b=y.Ec?B.RGBA8:B.RGBA;break;case a.am:b=y.Ec?B.RGB8:B.RGB;break;case a.Wj:b=y.Ec?B.RGBA8:B.RGBA;break;case a.Xj:b=y.Ec?B.RGB8:B.RGB;break;case a.oi:b=y.Ec?B.DEPTH_COMPONENT24:
B.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function u(b){switch(b.type){case a.Og:b=B.UNSIGNED_BYTE;break;case a.am:b=B.UNSIGNED_BYTE;break;case a.Wj:b=B.FLOAT;break;case a.Xj:b=B.FLOAT;break;case a.oi:b=B.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function w(a){return a&&a.name&&a.Gd?!0:!1}function C(a,b){if(b in U&&a in U[b]){var c=U[b][a];c.ga?c.ga.play():c.gc&&(c.Lr=!0);return!0}return!1}function E(a,b){if(b in U&&a in U[b]){var c=U[b][a];c.ga?c.ga.pause():
c.gc&&(c.Lr=!1);return!0}return!1}function G(a,b){if(b in U&&a in U[b]){var c=U[b][a];c.ga?c.ga.currentTime=c.ab/c.lf:c.gc&&(c.Vh=x(c,c.ab),f(c));return!0}return!1}function m(a){return a.ga?!a.ga.paused:a.gc?a.Lr:!1}function x(a,b){return Math.round(b*a.Kr/a.gj)}function A(a,b){if(K.ka(a))return r(a,b);for(var c=a.Jv,d=0;d<c.length;d++){var e=r(c[d],b);if(e)return e}return null}function r(a,b){for(var c=null,d=a.J,e=0;e<d.length;e++)for(var f=d[e].T,h=0;h<f.length;h++)for(var g=f[h],k=0;k<g.U.length;k++)if(g.U[k].name==
b){c=g.U[k];break}return c}var e=p("__config"),v=p("__dds"),J=p("__extensions"),D=p("__print"),H=p("__time"),I=p("__util"),P=p("__renderer"),K=p("__obj_util"),y=e.p,F=e.F,M=null,O=null,V=null;a.ad=0;a.r=0;a.Cz=0;a.Az=0;a.Bz=0;a.zz=0;a.Og=10;a.am=20;a.Wj=30;a.Xj=40;a.oi=50;a.Zl=60;a.Xl=70;a.$l=80;a.Yl=90;var T={},U={},B=null,ha;a.Ad=function(b){ha=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.ad=b.NEAREST;a.r=b.LINEAR;a.Cz=b.NEAREST_MIPMAP_NEAREST;
a.Az=b.LINEAR_MIPMAP_NEAREST;a.Bz=b.NEAREST_MIPMAP_LINEAR;a.zz=b.LINEAR_MIPMAP_LINEAR;B=b};a.hD=function(a,b){return b in T&&a in T[b]?T[b][a].gd:null};a.mH=function(a,b){return b in T&&a in T[b]?(c(T[b][a]),!0):!1};a.wk=function(b,c){var e=d();e.name=b;e.type=c;e.source="NONE";if(c==a.Zl||c==a.Xl||c==a.$l||c==a.Yl)e.Gd=B.createRenderbuffer();else{var f=B.TEXTURE_2D,h=B.createTexture();B.bindTexture(f,h);B.texParameteri(f,B.TEXTURE_MAG_FILTER,B.LINEAR);B.texParameteri(f,B.TEXTURE_MIN_FILTER,B.LINEAR);
B.texParameteri(f,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE);B.texParameteri(f,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE);B.bindTexture(f,null);e.Fb=f;e.Na=h}return e};a.nB=function(b){var c=B.createTexture(),e=B.TEXTURE_CUBE_MAP;B.bindTexture(e,c);B.texParameteri(e,B.TEXTURE_MAG_FILTER,B.LINEAR);B.texParameteri(e,B.TEXTURE_MIN_FILTER,B.LINEAR);B.texParameteri(e,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE);B.texParameteri(e,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),
h=0;6>h;h++)B.texImage2D(B[f[h]],0,B.RGBA,b,b,0,B.RGBA,B.UNSIGNED_BYTE,null);B.bindTexture(e,null);e=d();e.name="CUBEMAP";e.type=a.Og;e.source="NONE";e.width=3*b;e.height=2*b;e.xp=1;e.Na=c;e.Fb=B.TEXTURE_CUBE_MAP;return e};a.ul=function(a,b,c){if(!w(a)){var d=a.Fb;B.bindTexture(d,a.Na);b&&B.texParameteri(d,B.TEXTURE_MIN_FILTER,b);c&&B.texParameteri(d,B.TEXTURE_MAG_FILTER,c);B.bindTexture(d,null)}};a.VJ=function(b){if(w(b))return{min:a.ad,FE:a.ad};var c=b.Fb;B.bindTexture(c,b.Na);b=B.getTexParameter(c,
B.TEXTURE_MIN_FILTER);var d=B.getTexParameter(c,B.TEXTURE_MAG_FILTER);B.bindTexture(c,null);return{min:b,FE:d}};a.resize=function(b,c,d){c=Math.max(c,y.Gk?2:1);d=Math.max(d,y.Gk?2:1);if(b.width!=c||b.height!=d){switch(b.type){case a.Zl:B.bindRenderbuffer(B.RENDERBUFFER,b.Gd);B.renderbufferStorage(B.RENDERBUFFER,B.RGB565,c,d);B.bindRenderbuffer(B.RENDERBUFFER,null);break;case a.Xl:B.bindRenderbuffer(B.RENDERBUFFER,b.Gd);B.renderbufferStorage(B.RENDERBUFFER,B.DEPTH_COMPONENT16,c,d);B.bindRenderbuffer(B.RENDERBUFFER,
null);break;case a.$l:B.bindRenderbuffer(B.RENDERBUFFER,b.Gd);B.renderbufferStorageMultisample(B.RENDERBUFFER,y.Ac,B.RGBA8,c,d);B.bindRenderbuffer(B.RENDERBUFFER,null);break;case a.Yl:B.bindRenderbuffer(B.RENDERBUFFER,b.Gd);B.renderbufferStorageMultisample(B.RENDERBUFFER,y.Ac,B.DEPTH_COMPONENT24,c,d);B.bindRenderbuffer(B.RENDERBUFFER,null);break;default:var e=b.Fb;B.bindTexture(e,b.Na);var f=h(b),g=k(b),m=u(b);B.texImage2D(e,0,g,c,d,0,f,m,null);B.bindTexture(e,null)}c>y.Db||d>y.Db?D.error('Slink texture "'+
b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+y.Db+"x"+y.Db+"."):(b.width=c,b.height=d)}};a.MB=b;a.Ix=q;a.Hx=f;a.Gl=function(a,b,c,d,e){var f=a.source,h=a.Na,k=a.Fb,m=1,r=1;B.bindTexture(k,h);if(4==b.length){var q=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==f)if(q)B.texImage2D(k,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){r=v.Tu(b);q=I.kk(r.width)||I.kk(r.height);if(r.width>y.Db||r.height>y.Db){D.error('Texture "'+d+'" has unsupported size: '+
r.width+"x"+r.height+". Max available: "+y.Db+"x"+y.Db+".");return}m=r.width;r=r.height;q&&(a.He=!0,n(k),m=z(m*a.wf),r=z(r*a.wf));v.EH(B,J.Ru(),b,!0);a.He&&(l(a,null,m,r,!0),B.bindTexture(k,h),B.generateMipmap(k));a.width=m;a.height=r;a.xp=v.kD(b)}else{B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!0);a.Zk?y.tl?(m=b[0].width,r=b[0].height):(m=b.videoWidth,r=b.videoHeight):(m=b.width,r=b.height);a.width=m;a.height=r;if(m>y.Db||m>y.Db)D.warn('Texture "'+d+'" has unsupported size: '+m+"x"+r+". Max available: "+
y.Db+"x"+y.Db+". Reduced image size will be used."),a.wf=Math.min(y.Db/m,y.Db/r),a.He=!0;a.Zk&&(y.tl?(e in U||(U[e]={}),U[e][a.name]=a,a.gc=b,a.Kr=b.length,a.lf=a.Jr*a.gj/b.length,b=b[0]):(e in U||(U[e]={}),U[e][a.name]=a,a.ga=b,a.ga.loop=a.ci,a.lf=b.duration?a.gj/b.duration:H.Wb(),F.ku||(b.playbackRate=H.Wb()/a.lf,F.Lt&&2<b.playbackRate&&(b.playbackRate=2)),g(a)));m=z(a.width*a.wf);r=z(a.height*a.wf);a.He?(d=t(),h=d.getContext("2d"),d.width=m,d.height=r,h.drawImage(b,0,0,a.width,a.height,0,0,m,r),
B.texImage2D(k,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,d)):I.kk(a.width)||I.kk(a.height)?(l(a,b,m,r,!1),a.He=!0):B.texImage2D(k,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,b);h=a.Na;B.bindTexture(k,h);a.Zk||B.generateMipmap(k);B.bindTexture(k,null);a.width=m;a.height=r}else if("ENVIRONMENT_MAP"==f)if(r=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],q){for(m=0;6>m;m++)B.texImage2D(B["TEXTURE_CUBE_MAP_"+r[m][0]],0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,
b);a.width=3;a.height=2}else{B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!1);if(b.width%3||b.height%2){D.error('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". The width must be multiple of three and the height - multiple of two.");return}m=b.width/3;if(m>y.Dh)D.warn('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+3*y.Dh+"x"+2*y.Dh+". Reduced image size will be used."),d=z(y.Dh/m*m),a.He=!0;else if(d=z(m),3*d>y.Db||2*d>y.Db)a.He=!0;if(a.He||
y.Cw)for(h=d,q=0;6>q;q++)c=r[q],e=t(),e.width=h,e.height=h,f=e.getContext("2d"),"POSITIVE_Y"==c[0]||"NEGATIVE_Y"==c[0]?(f.translate(0,h),f.scale(1,-1)):(f.translate(h,0),f.scale(-1,1)),f.drawImage(b,c[1]*m,c[2]*m,m,m,0,0,h,h),B.texImage2D(B["TEXTURE_CUBE_MAP_"+c[0]],0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,e);else{r=b;b=d;n(B.TEXTURE_2D);B.texImage2D(B.TEXTURE_2D,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,r);B.bindTexture(B.TEXTURE_2D,null);for(r=0;6>r;r++)B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,B.RGBA,b,b,0,
B.RGBA,B.UNSIGNED_BYTE,null);B.bindTexture(a.Fb,null);B.bindFramebuffer(B.FRAMEBUFFER,V);for(r=0;6>r;r++)P.gC(a,B.TEXTURE_CUBE_MAP_POSITIVE_X+r,b,m,O,r);B.bindFramebuffer(B.FRAMEBUFFER,null);B.bindTexture(a.Fb,a.Na);B.texParameteri(a.Fb,B.TEXTURE_MIN_FILTER,ha[y.Mj]);B.texParameteri(a.Fb,B.TEXTURE_MAG_FILTER,B.LINEAR)}a.width=3*d;a.height=2*d;B.generateMipmap(k)}else"DATA_TEX2D"==f&&(B.texImage2D(k,0,B.RGBA,b.width,b.height,0,B.RGBA,B.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);B.bindTexture(k,
null)};a.bC=function(a){B.deleteTexture(a)};a.Zi=function(a){return a&&a.name&&(a.Na||a.Gd)?!0:!1};a.Xi=w;a.uK=function(b){return b.type==a.Wj||b.type==a.Xj?!0:!1};a.BD=function(b){var c=0;switch(b.type){case a.Og:case a.am:c=4;break;case a.Wj:case a.Xj:c=16;break;case a.oi:c=3;break;case a.Zl:case a.Xl:c=2;break;case a.$l:c=4*y.Ac;break;case a.Yl:c=3*y.Ac}return c};a.ZC=function(a){var c=null,c={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(c,
null,a,0);c.image={filepath:null};return c};a.cleanup=function(){if(!y.tl)for(var a in U)for(var b in U[a])U[a][b].ga.pause(),U[a][b].ga.src="",U[a][b].ga.load();T={};U={}};a.pause=function(){for(var a in U)for(var b in U[a]){var c=U[a][b];m(c)&&(E(b,a),c.yo=!0)}};a.reset=function(){for(var a in U)for(var b in U[a])G(b,a),U[a][b].yo=!1};a.play=function(a){for(var b in U)for(var c in U[b]){var d=U[b][c];if(!a||d.yo)C(c,b),d.yo=!1}};a.Fs=function(a,b){return b in U&&a in U[b]?U[b][a].qo:!1};a.play_video=
C;a.pause_video=E;a.reset_video=G;a.TF=function(a,b,c){c in U&&a in U[c]&&(a=U[c][a],a.ga?a.ga.currentTime=b/a.lf:a.gc&&(a.Vh=b,f(a)))};a.Xx=m;a.Yx=function(a){return a.ga||a.gc?a.ga?2<=a.ga.readyState:!0:0};a.Ux=function(a){return a.ga||a.gc?a.ga?Math.round(a.ga.currentTime*a.lf):a.Vh:0};a.Wx=function(a){return a.ga||a.gc?a.ga?a.ab:x(a,a.ab):0};a.aI=function(a){if(!a.ga&&!a.gc)return 0;var b=Math.min(a.Ki,a.gj-a.ab);return a.ga?a.ab+b:x(a,a.ab+b)};a.Rn=function(a,b){return Math.round(H.Wb()/a.lf*
a.Jr*b)};a.Vx=function(a){return Math.min(a.Ki,a.gj-a.ab)};a.$H=x;a.iD=function(a,b){var c=A(a,b);return c&&"CANVAS"==c.source?c.gd:null};a.nH=function(a,b){var d=A(a,b);return d&&"CANVAS"==d.source?(c(d),!0):!1};a.oG=function(a){for(var b={},e=0;e<a.length;e++){for(var f=a[e].U,h=[],g=0;g<f.length;g++){var k=f[g];if("CANVAS"==k.source)if(k.name in b)k=b[k.name];else{var m=f[g],k=d();k.name=m.name;k.source="CANVAS";k.width=m.width;k.height=m.height;k.Jk=m.Jk;k.type=m.type;m=document.createElement("canvas");
m.width=k.width;m.height=k.height;k.gd=m.getContext("2d");k.Fb=B.TEXTURE_2D;k.Na=B.createTexture();B.bindTexture(B.TEXTURE_2D,k.Na);k.Jk?B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,ha[y.Mj]):B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR);B.bindTexture(B.TEXTURE_2D,null);m=k;m.gd.drawImage(f[g].gd.canvas,0,0);c(m);b[k.name]=k}h.push(k)}a[e].U=h}}};b4w.module.__assets=function(a,p){function d(){return w.TD()?p(w.Bc.rm).data:null}function b(){var a={bm:null,Hz:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.bm=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=d();b&&a.bm in b&&(a.status=200,b[a.bm]&&(a.response=a.Hz(b[a.bm])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function c(b){for(var c=0,d=0;d<b.length;d++){var e=b[d];20===e.state&&c++;if(c>=r.NE)break;if(10===e.state)switch(e.state=20,c++,e.type){case a.AT_ARRAYBUFFER:q(e,"arraybuffer");break;case a.AT_JSON:q(e,"json");break;case a.AT_TEXT:q(e,"text");break;case a.AT_AUDIOBUFFER:f(e);break;case a.AT_IMAGE_ELEMENT:t(e);
break;case a.AT_AUDIO_ELEMENT:l(e);break;case a.Sl:n(e);break;case a.Rl:g(e);break;default:m.W("Wrong asset type: "+e.type)}}}function q(c,e){var f=d(),h=f&&c.url in f?new b:new XMLHttpRequest;if("GET"==c.Sc)h.open("GET",c.url,!0);else if("POST"==c.Sc)switch(h.open("POST",c.url,!0),c.og){case a.Co:h.setRequestHeader("Content-type","text/plain");break;case a.Bo:h.setRequestHeader("Content-type","application/json")}"text"==e?(h.overrideMimeType("text/plain"),h.responseType="text"):"json"==e?(h.overrideMimeType("application/json"),
h.responseType="text"):h.responseType=e;h.onreadystatechange=function(){if(40!=c.state&&4==h.readyState){if(200==h.status||0==h.status){var a=h.response;if(a){if("json"==e&&"string"==typeof a)try{a=JSON.parse(a,c.dE)}catch(b){E.error(b+" (parsing JSON "+c.url+")");c.Mb(null,c.id,c.type,c.url,c.eb);return}c.Mb(a,c.id,c.type,c.url,c.eb)}else E.error("empty responce when trying to get "+c.url),c.Mb(null,c.id,c.type,c.url,c.eb)}else E.error(h.status+" when trying to get "+c.url),c.Mb(null,c.id,c.type,
c.url,c.eb);c.state=30}};h.addEventListener("progress",function(a){a.lengthComputable&&c.qw(a.loaded/a.total)},!1);h.send(c.vf)}function f(a){"GET"!=a.Sc&&m.W("Unsupported request type for audio buffer");var c=d(),e=c&&a.url in c?new b:new XMLHttpRequest;e.open("GET",a.url,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?G.ZB(b,function(b){a.Mb(b,a.id,a.type,a.url,a.eb);a.state=30},function(){a.Mb(null,
a.id,a.type,a.url,a.eb);E.error("failed to decode "+a.url);a.state=30}):(a.Mb(null,a.id,a.type,a.url,a.eb),E.error("empty responce when trying to get "+a.url),a.state=30)}else a.Mb(null,a.id,a.type,a.url,a.eb),E.error(e.status+" when trying to get "+a.url),a.state=30};e.send(a.vf)}function t(a){"GET"!=a.Sc&&m.W("Unsupported request type for image element");var b=document.createElement("img");A.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.Mb(b,a.id,a.type,a.url,a.eb),
a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.Mb(null,a.id,a.type,a.url,a.eb),E.error("could not load image: "+a.url),a.state=30)},!1);var c=d();if(c&&a.url in c)if(c[a.url]){var e=h(a.url);b.src="data:"+e+";base64,"+c[a.url]}else C.Iq()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url}function l(a){"GET"!=a.Sc&&m.W("Unsupported request type for audio element");var b=document.createElement("audio");
if(A.allow_cors||A.Ut)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.Mb(b,a.id,a.type,a.url,a.eb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.Mb(null,a.id,a.type,a.url,a.eb),E.error("could not load sound: "+a.url),a.state=30)},!1);b.addEventListener("stalled",function(){40!=a.state&&(a.Mb(null,a.id,a.type,a.url,a.eb),E.error("could not load sound: "+a.url),a.state=30)},!1);var c=d();if(c&&a.url in c)if(c[a.url]){var e=k(a.url);b.src=
"data:"+e+";base64,"+c[a.url];40!=a.state&&(a.Mb(b,a.id,a.type,a.url,a.eb),a.state=30)}else C.Iq()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url,A.wh&&b.load();A.ar&&(b.autoplay=!0,b.pause());setTimeout(function(){b.uG=1},5E3)}function n(a){function b(){40!=a.state&&(a.Mb(null,a.id,a.type,a.url),E.error("could not load video: "+a.url,a.eb),a.state=30)}"GET"!=a.Sc&&m.W("Unsupported request type for video element");
var c=document.createElement("video");c.muted=!0;if(A.allow_cors||A.wh)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){c.removeEventListener("error",b,!1);40!=a.state&&(a.Mb(c,a.id,a.type,a.url,a.eb),a.state=30)},!1);c.addEventListener("error",b,!1);var e=d();if(e&&a.url in e)if(e[a.url]){var f=u(a.url);c.src="data:"+f+";base64,"+e[a.url];40!=a.state&&c.addEventListener("loadeddata",function(){a.Mb(c,a.id,a.type,a.url,a.eb);a.state=30},!1)}else C.Iq()?(e=document.createEvent("CustomEvent"),
e.initCustomEvent("error",!1,!1,null)):e=new CustomEvent("error"),c.dispatchEvent(e);else c.src=a.url,A.wh&&c.load();A.ar&&(c.autoplay=!0,c.pause());setTimeout(function(){c.uG=1},1E4)}function g(c){function e(a){c.Mb(a,c.id,c.type,c.url,c.eb);c.state=30}"GET"!=c.Sc&&m.W("Unsupported request type for seq video element");var f=d(),h=f&&c.url in f?new b:new XMLHttpRequest;if(null==c.og&&null==c.vf)h.open("GET",c.url,!0);else switch(h.open("POST",c.url,!0),c.og){case a.Co:h.setRequestHeader("Content-type",
"text/plain");break;case a.Bo:h.setRequestHeader("Content-type","application/json")}h.responseType="arraybuffer";h.onreadystatechange=function(){if(40!=c.state&&4==h.readyState)if(200==h.status||0==h.status){var a=h.response;a?z(a,e):(c.Mb(null,c.id,c.type,c.url,c.eb),E.error("empty responce when trying to get "+c.url),c.state=30)}else c.Mb(null,c.id,c.type,c.url,c.eb),E.error(h.status+" when trying to get "+c.url),c.state=30};h.addEventListener("progress",function(a){a.lengthComputable&&c.qw(a.loaded/
a.total)},!1);h.send(c.vf)}function z(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],ut:[],lf:c[4]},h=20,g=0;g<e;g++){var k=c[h/4],m=new Blob([d.subarray(h+4,h+4+k)],{type:"image/jpg"}),l=document.createElement("img");l.src=window.URL.createObjectURL(m);f.images.push(l);f.ut.push(m);h+=k+8-k%4}l.onload=function(){for(var a=0;a<f.images.length;a++)window.URL.revokeObjectURL(f.images[a].src);delete f.ut;b(f)}}function h(a){var b="image";switch(m.oq(a).toLowerCase()){case "jpeg":case "jpg":b+=
"/jpeg";break;case "png":b+="/png"}return b}function k(a){var b="audio";switch(m.oq(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function u(a){var b="video";switch(m.oq(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var w=p("__config"),C=p("__compat"),E=p("__print"),G=p("__sfx"),m=p("__util"),x=p("__version"),A=w.p,r=w.ve;a.AT_ARRAYBUFFER=
10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.Sl=70;a.Rl=80;a.Bo=a.AT_JSON;a.Co=a.AT_TEXT;var e=[],v=0,J={};a.zl=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.$J=function(a){if(J[a])return J[a];var b=r.qr?a+x.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return J[a]=b;m.W("Error XHR: responce is empty, GET "+
a)}else m.W("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<e.length;a++)e[a].state=40;e=[];v=0;J={}};a.enqueue=function(a,b,f,h,g){for(var k=0;k<a.length;k++){var m=a[k],m={id:m.id,type:m.type,url:m.url,Sc:m.Sc?m.Sc:"GET",og:m.og?m.og:null,vf:m.vf?m.vf:null,eb:m.eb?m.eb:null,state:10,Mb:b||function(){},bw:f||function(){},qw:h||function(){},dE:g||null,cw:v};if(r.qr){var l=d();l&&m.url in l||(m.url+=x.timestamp())}e.push(m)}c(e);v++};a.update=function(){c(e);for(var a=e,b=0,
d=!0,f=0;f<a.length;f++){var h=a[f];h.cw===a[b].cw?30!==h.state&&(d=!1):(d&&(a[f-1].bw(),d=f-b,a.splice(b,d),f-=d),b=f,d=30===a[f].state?!0:!1);f===a.length-1&&d&&(a[f].bw(),a.splice(b))}}};b4w.module.__loader=function(a,p){function d(c,d,f,e){var g=m,k=C.create(),l;for(l in d){var n=b(d[l]);(e&&n.ub||!c&&n.Kb)&&h(n);C.u(k,n)}for(l in d)for(n=d[l],n.name=l,c=0;c<n.H.length;c++)C.m(k,d[n.H[c]],n,null);d=b({name:"out",kb:a.ny,Bb:function(a,b,c,d,e){b.Wa&&(g.bs=!0);w(b)||(b.status=2);b.Bv(b.id,!0);e(b,c);E.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},vb:5});if(f)f=C.Tk(k);else{l=C.clone(k);do{f=C.Tk(l);n=[];for(c=0;c<f.length;c++){e=f[c];var q=C.Ba(l,e);q.sb&&n.push(e)}for(c=
0;c<n.length;c++)C.Le(l,n[c]);n.length&&C.qp(l)}while(n.length)}C.u(k,d);for(c=0;c<f.length;c++)e=f[c],q=C.Ba(k,e),d.H.push(q.name),C.m(k,q,d,null);return k}function b(a){a.sb=a.sb||!1;a.kb||0===a.kb||(a.kb=a.Fc);a.H=a.H||[];a.uh=a.uh||!1;a.Ur=a.Ur||!1;a.vb=a.vb||0;a.ub=a.ub||!1;a.Kb=a.Kb||!1;a.status=0;a.CK=0;a.Tq=0;a.hk=a.hk||null;return a}function c(a,b){for(var c=[],d=[],f=0;f<b.length;f++){var h=b[f];C.Ba(a.Oe,h).uh&&(C.Bg(a.Oe,h,function(d){var e=!0;C.pe(a.Oe,d,function(a,b){if(!b.uh)return e=
!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(f))}for(f=d.length-1;0<=f;f--)b.splice(d[f],1);return c}function q(a){function b(c,d){var e=C.Ba(a.Oe,c),f=C.Ba(a.Oe,d),h=f.kb-e.kb;0==h&&(h=e.sb-f.sb);return h}var d=[],e=a.Cf,f=!1;do{var h=c(a,e);d.push.apply(d,e);0<h.length&&(f=!0);e=h}while(0<h.length);f&&d.sort(b);a.Cf=d;return a.Cf.length}function f(a,b,c){if(b.Ur)return b.uh=!0,l(a,b),!1;if(!b.Bb&&!b.Qf&&!b.gk)return l(a,b),!1;if(0==b.status&&(b.status++,b.Bb))return b.Bb(c,a,
b,b.hk,l,n),!0;if(1==b.status){if(b.Qf)return b.Qf(c,a,b,b.hk,l,n),!0;b.status++}return 2==b.status&&(b.status++,b.gk)?(b.gk(c,a,b,b.hk,l,n),!0):!1}function t(a){if(0==a.$n)return 100;var b=0;C.aa(a.Oe,function(c,d){a.do_not_load_resources&&d.ub||(b+=d.Tq*d.vb)});return G.trunc(100*b/a.$n)}function l(a,b){b.uh=!0;b.status=3;g(a,b,1)}function n(a,b,c){1>c?g(a,b,c):b.status++}function g(a,b,c){var d=m;if(b.Bb||b.Qf||b.gk)if(b.Tq=c,b=t(a),a.bu!=b||1==c)a.as(b,performance.now()-a.vx),a.bu=b,d.Wq=!0}function z(a,
b){var c=null;C.aa(a.Oe,function(a,d){if(d.name==b)return c=d,1});return c}function h(a){a.Ur=!0;a.Tq=1}function k(a){a.as=null;a.wp=null;a.Oe=null;a.Cf=null}function u(){return 0==m.cm}function w(a){return a&&(3==a.status||4==a.status)}var C=p("__graph"),E=p("__print"),G=p("__util");a.Fc=0;a.Ng=1;a.ny=2;var m=null;a.Su=function(){return m};a.EB=function(){var a={Qe:[],Jp:0,cm:0,bs:!1,Wq:!1};return m=a};a.NB=function(a,b,c,e,f,h,g,k){var l=m,n=l.Qe.length,q={id:n,Wa:0==n,status:0,kf:b,st:"",Bv:c||
function(){},Av:k||!1,iL:h,vx:0,bu:0,$n:0,Ar:!1,as:e||function(){},wp:f||function(){},Oe:null,Cf:null,xq:!1,vq:!1,Aq:!1};a=d(q.Wa,a,h,g);q.Oe=a;b=[];c=C.yD(a);for(e=0;e<c.length;e++)b.push(c[e]);q.Cf=b;C.aa(a,function(a,b){!(b.Bb||b.Qf||b.gk)||q.do_not_load_resources&&b.ub||(q.$n+=b.vb)});l.Qe.push(q);l.cm++;return q.id};a.zH=function(b){var c=m;if(c&&!u())if(c.Wq)c.Wq=!1;else{var d=performance.now();do{var e=c.Qe[c.Jp],h=b[e.id];if(!w(e))if(0==e.status&&(e.status=1,e.vx=performance.now(),e.as(0,
0)),q(e)){var g=e,l=g.Cf.length;do{var n=C.Ba(g.Oe,g.Cf[0]),t=f(g,n,h);n.kb==a.Ng&&(g.Ar=!0);n=g.Cf.shift();g.Cf.push(n);l--}while(!t&&0!=l)}else g=c,l=e,l.wp(h,l),l.status=3,g.cm--,k(l);c.bs&&(c.Jp=(c.Jp+1)%c.Qe.length);if(e.Ar){e.Ar=!1;break}}while(16>performance.now()-d)}};a.ct=function(a){var b=m;a.wp(null,a);a.status=3;b.cm--;k(a);a.status=4;a.Wa&&(b.bs=!0);a.Bv(a.id,!1)};a.ZK=n;a.Xn=function(a,b){var c=z(a,b);null!==c&&h(c)};a.uh=u;a.RG=w;a.is_primary_loaded=function(a){var b=m;if(!b)return!1;
a|=0;return b.Qe[a]&&(3==b.Qe[a].status||2==b.Qe[a].status)};a.HD=function(){E.error("Debug mode isn't enabled. Can not retrieve the graph.")};a.cleanup=function(){m=null}};b4w.module.__logic_nodes=function(a,p){function d(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];if(-2==c.state){for(var f=0;f<c.Qn;f++)if(u.get_sensor_value(a,b,f))for(var g=0;g<c.Pn.length;g++)if(c.Pn[g]==f){e.Gh==c.tx?(h.is_play(e.S)&&(c.state=-1),d.Yd.od||(c.state=1,c.wl=c.pn[g])):(c.state=1,c.wl=c.pn[g]);return}c.state=0}}}function b(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];for(var f=0;f<c.Qn;f++)if(u.get_sensor_value(a,b,f)&&f==c.Jw){if(h.is_play(e.S)&&e.Gh==c.tx)c.state=-1;
else if(!d.Yd.od||c.Y.no_wait)c.state=1;return}c.state=0}}function c(a,b,c){switch(b.state){case 1:z.error("Unknown node type: "+a.type);break;case 2:c.V=a.ha}}function q(a){var b=k.get("url_params");if(b&&a in b)return Number(b[a]);b=location.href.toString();if(-1==b.indexOf("?"))return 0;for(var b=b.split("?")[1].split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if(1<d.length&&d[0]==a)return Number(d[1])}return 0}function f(a){return n.Qb(n.ec,a.Up,0)}function t(a,b){var d=a.b4w_logic_nodes,
e=b.qd;b.state=1;for(var f=0;f<d.length;f++){var h={D:[],Yd:{Ea:a,V:0,od:!1,qs:f,C:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}}};e.push(h);for(var g=e[e.length-1],k=d[f],m=0;m<k.length;m++){var l=k[m],l={type:l.type,label:l.label,ha:l.slot_idx_order,wl:l.slot_idx_jump,N:l.frame_range[0],ja:l.frame_range[1],GC:l.frame_range_mask?l.frame_range_mask[0]:!0,EC:l.frame_range_mask?l.frame_range_mask[1]:!0,state:-1,Qn:-1,Jw:-1,wo:l.variable1,xo:l.variable2,Cq:l.input1,gv:l.input2,hi:l.variabled,url:l.url,dF:l.param_name,
bF:l.operation,mute:l.mute,Up:l.object,obj:null,Xa:{},Id:l.anim_name,dw:l.parse_resp_list,fc:l.objects_paths,gr:l.nodes_paths,Ob:l.floats,Y:l.bools,ia:l.variables,es:l.strings,Xq:l.materials_names,Qw:l.shader_nd_type,cf:l.common_usage_names,Ir:l.send_req_vars_list,tx:g,pw:U[l.type]?U[l.type]:c,Kn:!1,eo:0,Cl:0,pb:null,Pn:null,uE:l.links,pn:[]};g.D.push(l)}for(k=0;k<g.D.length;k++)l=g.D[k],l.pw(l,b,h.Yd,0,0)}var d=a.timeline_markers,n;for(n in d)b.xl.push(d[n]);b.xl.sort(function(a,b){return a-b});
b.state=2;K.push(b)}function l(a,b){switch(b){case 0:return Boolean(Number(a))?Number(a):0;case 1:return String(a);default:return null}}var n=p("__objects");p("__obj_util");var g=p("__scenes"),z=p("__print"),h=p("__nla"),k=p("__config"),u=p("__controls"),w=p("__util"),C=p("__animation"),E=p("__assets"),G=p("__batch"),m=p("__geometry"),x=p("__time"),A=p("__camera"),r=p("__vec3");p("__vec4");var e=p("__physics"),v=p("__transform"),J=p("__sfx");p("__constraints");var D=p("__mat3"),H=p("__mat4"),I=p("__tsr"),
P=p("__quat"),K=[],y=new Float32Array(4);new Float32Array(4);var F=new Float32Array(3),M=new Float32Array(3),O=new Float32Array(2),V=new Float32Array(9),T=new Float32Array(16),U={ENTRYPOINT:function(a,b,c){switch(b.state){case 2:c.V=a.ha}},HIDE:function(a,b,c){switch(b.state){case 1:a.obj=f(a);break;case 2:g.ik(a.obj,!0),c.V=a.ha}},SHOW:function(a,b,c){switch(b.state){case 1:a.obj=f(a);break;case 2:g.ik(a.obj,!1),c.V=a.ha}},PAGEPARAM:function(a,b,c){switch(b.state){case 2:c.C[a.hi]=q(a.dF),c.V=a.ha}},
SWITCH_SELECT:function(a,b,c){switch(b.state){case 1:a:{c=b.qd[c.qs];var e=n.get_selectable_objects();a.Pn=[];a.pn=[];for(var f in a.fc){var h=n.Qb(n.ec,a.fc[f],0),g=e.indexOf(h);if(-1==g){z.error("logic script error: non-selectable object:",a.fc[f][a.fc[f].length-1]);break a}a.Pn.push(g);a.pn.push(a.uE[f])}a.state=-1;a.Qn=e.length;f=[];for(g=0;g<e.length;g++)f.push(u.create_selection_sensor(e[g],!0));u.create_sensor_manifold(h,"LOGIC_NODES_SWITCH_SELECT_"+a.label,u.CT_SHOT,f,u.fu,d(),[a,b,c])}break;
case 2:if(-1==a.state){b=b.qd[c.qs].D;for(h=0;h<b.length;h++)e=b[h],"SWITCH_SELECT"==e.type&&(e.state=-1);a.state=-2}-1<a.state&&(c.V=a.state?a.wl:a.ha,a.state=-1)}},SELECT:function(a,c,d){switch(c.state){case 1:d=c.qd[d.qs];var e=f(a),h=n.get_selectable_objects(),g=h.indexOf(e);if(-1==g)z.error("logic script error: non-selectable object:",a.Up[a.Up.length-1]);else{a.state=-1;a.Qn=h.length;a.Jw=g;for(var g=[],k=0;k<h.length;k++)g.push(u.create_selection_sensor(h[k],!0));u.create_sensor_manifold(e,
"LOGIC_NODES_SELECT_"+a.label,u.CT_SHOT,g,u.fu,b(),[a,c,d])}break;case 2:if(-1<a.state){d.V=a.state?a.wl:a.ha;a.state=-1;break}a.Y.not_wait&&(d.V=a.ha)}},PLAY:function(a,b,c,d){switch(b.state){case 1:h.cs();a.state=-1;a.Y.not_wait||(a.Y.not_wait=!1);break;case 2:switch(a.state){case -1:if(h.is_play(b.S))if(b.Hp==b.Gh&&c.od)break;else{var e=b.Gh;if(e){e.Yd.V=e.D[e.Yd.V].ha;e.D[e.Yd.V].state=-1;for(var e=b.Gh.D,f=0;f<e.length;f++){var g=e[f];"PLAY"==g.type&&(g.state=-1)}}}c.od=!a.Y.not_wait;b.Gh=b.Hp;
a.state=0;a.GC&&(h.dG(a.N),h.Lw(d));if(a.EC)h.Nr(a.ja);else{d=h.get_frame(d);var e=-1,k;for(k in b.xl)if(d<b.xl[k]){e=k;break}0<=e?h.Nr(b.xl[e]):h.Nr(h.get_frame_end())}h.hw(null);a.Y.not_wait&&(c.V=a.ha,a.state=-1,c.od=!1);break;case 0:h.is_play()||(c.V=a.ha,a.state=-1,c.od=!1);break;case 1:c.V=a.ha;a.state=-1;b.Gh=null;c.od=!1;break;default:w.W("Unknown state of "+a.name),a.state=-1}}},REDIRECT:function(a,b){switch(b.state){case 2:window.location.href=a.url,b.state=3}},MATH:function(a,b,c){switch(b.state){case 2:b=
-1==a.wo?a.Cq:l(c.C[a.wo],0);var d=-1==a.xo?a.gv:l(c.C[a.xo],0);switch(a.bF){case "ADD":c.C[a.hi]=b+d;break;case "MUL":c.C[a.hi]=b*d;break;case "SUB":c.C[a.hi]=b-d;break;case "DIV":0==d&&w.W("Division by zero in Logic script");c.C[a.hi]=b/d;break;case "RAND":c.C[a.hi]=Math.random()*(d-b)+b}c.V=a.ha}},CONDJUMP:function(a,b,c){switch(b.state){case 2:b=-1==a.wo?a.Cq:l(c.C[a.wo],0);var d=-1==a.xo?a.gv:l(c.C[a.xo],0),e=!1;switch(a.Ob.cnd){case 5:b==d&&(e=!0);break;case 4:b!=d&&(e=!0);break;case 3:b<d&&
(e=!0);break;case 2:b>d&&(e=!0);break;case 1:b<=d&&(e=!0);break;case 0:b>=d&&(e=!0)}c.V=e?a.wl:a.ha}},REGSTORE:function(a,b,c){switch(b.state){case 2:c.C[a.hi]=a.Cq,c.V=a.ha}},PLAY_ANIM:function(a,b,c){var d=C.SLOT_ALL;""==!a.Id&&(d=C.SLOT_0);switch(b.state){case 1:a.obj=f(a);(c=a.cf.param_anim_behavior)||(c="FINISH_STOP");a.Cl=C.jt(c);break;case 2:switch(C.is_play(a.obj,d)||0!=a.state||(a.state=1),a.state){case -1:for(var e in b.qd){var h=b.qd[e].Yd.V;-1!=h&&(h=b.qd[e].D[h],"PLAY_ANIM"==h.type&&
h!=a&&0==h.state&&h.obj==a.obj&&(h.state=1))}if(""==a.Id)C.apply_def(a.obj),C.set_behavior(a.obj,a.Cl,d);else{a:{for(e=b=0;8>e;e++)if((h=a.obj.M[e])&&h.Xe&&h.Xe==a.Id)if(0==b)b=1;else{b=!1;break a}b=1==b?!0:!1}b||(C.apply(a.obj,a.Id,d),C.set_behavior(a.obj,a.Cl,d))}a.Y.not_wait||(c.od=!0);C.play(a.obj,null,d);a.state=0;a.Y.not_wait&&(c.V=a.ha,a.state=-1);break;case 0:break;case 1:a.Y.not_wait||(c.od=!1);c.V=a.ha;a.state=-1;break;default:w.W("Unknown state of "+a.name),a.state=-1}}},SELECT_PLAY:function(a,
b,c){switch(b.state){case 2:c.V=a.ha}},SEND_REQ:function(a,b,c){function d(a,b,c,e,f){if(f[0].Y.prs)for(var h in a)for(var g in f[0].dw)h==f[0].dw[g]&&(f[1][h]=a[h]);else f[1][f[0].ia.dst]=a;f[0].state=1}function e(a,b){if(""===a)return b;switch(typeof b){case "string":return l(b,1);case "number":return l(b,0);default:return l(b,1)}}function f(a,b){if(""===a)return b;if(Infinity==b||-Infinity==b)return l(b,1);switch(typeof b){case "string":return l(b,1);case "number":return l(b,0);default:return l(b,
1)}}switch(b.state){case 2:switch(a.state){case -1:a.state=0;b=a.Y.prs?E.AT_JSON:E.AT_TEXT;var h=a.Y.prs?e:null;if("GET"==a.cf.request_type)E.enqueue([{id:a.url,type:b,url:a.url,eb:[a,c.C]}],d,null,null,h);else if("POST"==a.cf.request_type)if(a.Y.enc){for(var g={},k=0;k<a.Ir.length;k++){var m=a.Ir[k];switch(typeof c.C[a.Ir[k]]){case "string":g[m]=l(c.C[m],1);break;case "number":g[m]=l(c.C[m],0);break;default:g[m]=l(c.C[m],1)}}E.enqueue([{id:a.url,type:b,url:a.url,Sc:"POST",og:E.Bo,vf:JSON.stringify(g,
f),eb:[a,c.C]}],d,null,null,h)}else g=l(c.C[a.ia.dst1],1),E.enqueue([{id:a.url,type:b,url:a.url,Sc:"POST",og:E.Co,vf:g,eb:[a,c.C]}],d,null,null,h);break;case 1:a.state=-1,c.V=a.ha}}},INHERIT_MAT:function(a,b,c){switch(b.state){case 1:for(b=0;2>b;b++)a.Xa["id"+b]=n.Qb(n.ec,a.fc["id"+b],0);break;case 2:G.inherit_material(a.Xa.id0,a.Xq.id0,a.Xa.id1,a.Xq.id1),c.V=a.ha}},SET_SHADER_NODE_PARAM:function(a,b,c){switch(b.state){case 1:a.fc.id0&&(a.Xa.id0=n.Qb(n.ec,a.fc.id0,0),a.gr.id0.unshift(a.Xq.id0));break;
case 2:"ShaderNodeRGB"==a.Qw&&n.set_nodemat_rgb(a.Xa.id0,a.gr.id0,a.Y.id0?l(c.C[a.ia.id0],0):a.Ob.id0,a.Y.id1?l(c.C[a.ia.id1],0):a.Ob.id1,a.Y.id2?l(c.C[a.ia.id2],0):a.Ob.id2),"ShaderNodeValue"==a.Qw&&n.set_nodemat_value(a.Xa.id0,a.gr.id0,a.Y.id0?l(c.C[a.ia.id0],0):a.Ob.id0),c.V=a.ha}},DELAY:function(a,b,c,d,e){switch(b.state){case 2:-1==a.state?(a.state=0,a.eo=0,c.od=!0):0==a.state&&(a.eo+=e,(a.Y.dl?l(c.C[a.ia.dl],0):a.Ob.dl)<a.eo&&(a.state=-1,c.V=a.ha,c.od=!1))}},APPLY_SHAPE_KEY:function(a,b,c){switch(b.state){case 1:b=
a.Xa.id0=n.Qb(n.ec,a.fc.id0,0);c=a.cf.sk;m.check_shape_keys(b)?m.wq(b,c)||(z.error("Wrong key name:",c),a.mute=!0):(z.error("No shape keys in object:",b.name),a.mute=!0);break;case 2:m.lt(a.Xa.id0,a.cf.sk,a.Y.skv?l(c.C[a.ia.skv],0):a.Ob.skv),c.V=a.ha}},OUTLINE:function(a,b,c){switch(b.state){case 1:b=a.Xa.id0=n.Qb(n.ec,a.fc.id0,0);b&&b.f&&b.f.Jb||(z.error("Can't evaluate 'Outline' logic node: wrong object"),a.mute=!0);break;case 2:b=a.Xa.id0;switch(a.cf.outline_operation){case "PLAY":var d=b.f.mj;
n.apply_outline_anim(b,d.nj,d.oj,d.pj);break;case "STOP":n.clear_outline_anim(b);break;case "INTENSITY":b.f.lg=a.Y["in"]?l(c.C[a.ia["in"]],0):a.Ob["in"]}c.V=a.ha}},MOVE_CAMERA:function(a,b,c){function d(a,b,c,f){switch(A.get_move_style(a)){case A.MS_TARGET_CONTROLS:A.set_trans_pivot(a,b,c);break;case A.MS_EYE_CONTROLS:case A.MS_STATIC:v.set_tsr(a,f);break;case A.MS_HOVER_CONTROLS:r.sub(c,b,F),r.normalize(F,F),A.set_hover_pivot(a,c),c=b=0,M[0]=F[0],M[1]=0,M[2]=F[2],b=r.dot(M,F),c=Math.acos(b/(r.length(M)*
r.length(F))),b=F[2]?Math.atan(F[0]/F[2]):0<F[0]?0:Math.PI,0<F[2]&&0<F[0]?O[1]=-(Math.PI+O[1]):0<F[2]&&0>F[0]?O[1]=-(Math.PI+O[1]):0>F[2]&&0>F[0]?(O[0]+=Math.PI,b=-(Math.PI-b)):0>F[2]&&0<F[0]&&(O[0]+=Math.PI,b-=Math.PI),A.rotate_hover_camera(a,b+Math.PI,-c,!0,!0)}v.n(a);e.sync_transform(a)}function f(a,b,c,d){H.lookAt(b,c,w.AXIS_Y,T);H.invert(T,T);H.rotateX(T,Math.PI/2,T);D.fromMat4(T,V);P.fromMat3(V,y);P.normalize(y,y);a=I.get_scale(a.f.h);I.set_sep(b,a,y,d)}switch(b.state){case 1:a.Xa.ca=n.Qb(n.ec,
a.fc.id0,0);a.Xa.tr=n.Qb(n.ec,a.fc.id1,0);a.Xa.ta=n.Qb(n.ec,a.fc.id2,0);a.state=-1;a.pb={yx:new Float32Array(3),xx:new Float32Array(3),Gq:new Float32Array(3),ns:new Float32Array(3),sx:new Float32Array(3),Fq:new Float32Array(3),Dg:new Float32Array(8),Re:new Float32Array(8),Vk:new Float32Array(8)};break;case 2:var h=a.Xa.ca;b=I.get_trans_view(a.Xa.tr.f.h);var g=I.get_trans_view(a.Xa.ta.f.h);switch(a.state){case -1:var k=a.Y.dur?l(c.C[a.ia.dur],0):a.Ob.dur;if(0==k){f(h,b,g,a.pb.Re);d(h,b,g,a.pb.Re);
c.V=a.ha;break}c=I.get_trans_view(h.f.h);r.copy(c,a.pb.yx);var m=A.get_move_style(h);m==A.MS_HOVER_CONTROLS?r.copy(h.f.Ka,a.pb.ns):m==A.MS_STATIC||m==A.MS_EYE_CONTROLS?(I.copy(h.f.h,a.pb.Dg),f(h,b,g,a.pb.Re)):r.copy(h.f.Sa,a.pb.ns);r.copy(b,a.pb.xx);r.copy(g,a.pb.sx);a.state=0;k=x.animate(0,1,1E3*k,function(b){m==A.MS_STATIC||m==A.MS_EYE_CONTROLS?I.interpolate(a.pb.Dg,a.pb.Re,w.smooth_step(b),a.pb.Vk):(a.pb.Fq=r.lerp(a.pb.ns,a.pb.sx,w.smooth_step(b),a.pb.Fq),a.pb.Gq=r.lerp(a.pb.yx,a.pb.xx,w.smooth_step(b),
a.pb.Gq));d(h,a.pb.Gq,a.pb.Fq,a.pb.Vk);1==b&&(a.state=1)});break;case 1:x.clear_animation(k),a.state=-1,c.V=a.ha}}},SET_CAMERA_MOVE_STYLE:function(a,b,c){switch(b.state){case 1:a.Cl=A.UE(a.cf.camera_move_style);break;case 2:b=g.Ni(c.Ea),A.set_move_style(b,a.Cl),v.n(b),e.sync_transform(b),c.V=a.ha}},MOVE_TO:function(a,b,c){function d(a,b){v.set_tsr(a,b);v.n(a);e.sync_transform(a)}switch(b.state){case 1:a.Xa.ob=n.Qb(n.ec,a.fc.id0,0);a.Xa.de=n.Qb(n.ec,a.fc.id1,0);a.state=-1;a.jb={ju:new Float32Array(8),
Pp:new Float32Array(8),hv:new Float32Array(8)};break;case 2:var f=a.Xa.ob;I.copy(a.Xa.ob.f.h,a.jb.ju);I.copy(a.Xa.de.f.h,a.jb.Pp);switch(a.state){case -1:b=a.Y.dur?l(c.C[a.ia.dur],0):a.Ob.dur;if(0==b){d(f,a.jb.Pp);c.V=a.ha;break}a.state=0;var h=x.animate(0,1,1E3*b,function(b){a.jb.pK=I.interpolate(a.jb.ju,a.jb.Pp,w.smooth_step(b),a.jb.hv);d(f,a.jb.hv);1==b&&(a.state=1)});break;case 1:x.clear_animation(h),a.state=-1,c.V=a.ha}}},TRANSFORM_OBJECT:function(a,b,c){function d(a,b,c){0==c?v.set_tsr(a,b):
v.set_tsr_rel(a,b);v.n(a);e.sync_transform(a)}switch(b.state){case 1:a.Xa.ob=n.Qb(n.ec,a.fc.id0,0);a.state=-1;a.jb={Zn:0,Dg:new Float32Array(8),Re:new Float32Array(8),Vk:new Float32Array(8)};break;case 2:var f=a.Xa.ob;switch(a.state){case -1:M[0]=a.Y.trx?l(c.C[a.ia.trx],0):a.Ob.trx;M[1]=a.Y["try"]?l(c.C[a.ia["try"]],0):a.Ob["try"];M[2]=a.Y.trz?l(c.C[a.ia.trz],0):a.Ob.trz;F[0]=a.Y.rox?l(c.C[a.ia.rox],0):a.Ob.rox;F[1]=a.Y.roy?l(c.C[a.ia.roy],0):a.Ob.roy;F[2]=a.Y.roz?l(c.C[a.ia.roz],0):a.Ob.roz;b=a.Y.sc?
c.C[a.ia.sc]:a.Ob.sc;if(a.Y["try"]||a.Y.trz)M[1]^=M[2],M[2]^=M[1],M[1]^=M[2],M[2]=-M[2];if(a.Y.roy||a.Y.roz)F[1]^=F[2],F[2]^=F[1],F[1]^=F[2],F[2]=-F[2];w.euler_to_quat(F,y);I.set_sep(M,b,y,a.jb.Re);a.jb.Zn=a.cf.space_type;switch(a.jb.Zn){case 0:v.get_tsr(f,a.jb.Dg);break;case 1:v.get_tsr_rel(f,a.jb.Dg);break;case 2:v.get_tsr_rel(f,a.jb.Dg),I.multiply(a.jb.Dg,a.jb.Re,a.jb.Re)}b=a.Y.dur?l(c.C[a.ia.dur],0):a.Ob.dur;if(0==b){d(f,a.jb.Re,a.jb.Zn);c.V=a.ha;break}a.state=0;var h=x.animate(0,1,1E3*b,function(b){I.interpolate(a.jb.Dg,
a.jb.Re,w.smooth_step(b),a.jb.Vk);d(f,a.jb.Vk,a.jb.Zn);1==b&&(a.state=1)});break;case 1:x.clear_animation(h),a.state=-1,c.V=a.ha}}},SPEAKER_PLAY:function(a,b,c){switch(b.state){case 1:a.obj=n.Qb(n.ec,a.fc.id0,0);void 0==a.Y.not_wait&&(a.Y.not_wait=!0);break;case 2:switch(J.is_playing(a.obj)||0!=a.state||(a.state=1),a.state){case -1:for(var d in b.qd){var e=b.qd[d].Yd.V;-1!=e&&(e=b.qd[d].D[e],"SPEAKER_PLAY"==e.type&&e!=a&&0==e.state&&e.obj==a.obj&&(e.state=1))}a.Y.not_wait||(c.od=!0);J.play_def(a.obj);
a.state=0;break;case 0:a.Y.not_wait&&(c.V=a.ha,a.state=-1);break;case 1:a.Y.not_wait||(c.od=!1);c.V=a.ha;a.state=-1;break;default:w.W("Unknown state of "+a.name),a.state=-1}}},SPEAKER_STOP:function(a,b,c){switch(b.state){case 1:a.obj=n.Qb(n.ec,a.fc.id0,0);break;case 2:J.stop(a.obj),c.V=a.ha}},STOP_ANIM:function(a,b,c){switch(b.state){case 1:a.obj=f(a);break;case 2:C.stop(a.obj,C.SLOT_ALL),a.Y.rst&&C.set_first_frame(a.obj,C.SLOT_ALL),c.V=a.ha}},STOP_TIMELINE:function(a,b,c,d){switch(b.state){case 2:a.Y.rst&&
h.Lw(d),h.cs(),c.V=a.ha}},CONSOLE_PRINT:function(a,b,c){switch(b.state){case 2:b={};for(var d in a.ia){var e=a.ia[d];b[e]=c.C[e]}z.log(a.cf.msg,JSON.stringify(b));c.V=a.ha}},STRING:function(a,b,c){switch(b.state){case 2:b=a.Y.id0?l(c.C[a.ia.id0],1):a.es.id0;var d=a.Y.id1?l(c.C[a.ia.id1],1):a.es.id1;switch(a.Ob.sop){case 0:c.C[a.ia.dst]=b+d;break;case 1:c.C[a.ia.dst]=b.indexOf(d);break;case 2:c.C[a.ia.dst]=b.replace(d,a.Y.id2?l(c.C[a.ia.id2],1):a.es.id2);break;case 3:c.C[a.ia.dst]=b.substring(0,b.indexOf(d));
c.C[a.ia.dst1]=b.substring(b.indexOf(d)+1,b.length);""==c.C[a.ia.dst]&&(c.C[a.ia.dst]=c.C[a.ia.dst1],c.C[a.ia.dst1]="");break;case 4:switch(a.Ob.cnd){case 5:c.C[a.ia.dst]=b==d?1:0;break;case 4:c.C[a.ia.dst]=b!=d?1:0;break;case 3:c.C[a.ia.dst]=b<d?1:0;break;case 2:c.C[a.ia.dst]=b>d?1:0;break;case 1:c.C[a.ia.dst]=b<=d?1:0;break;case 0:c.C[a.ia.dst]=b>=d?1:0}}c.V=a.ha}}};a.OD=function(a,b){var c={Ic:b,MF:a.name,state:0,Gh:null,Ea:a,Hp:null,qd:[],xl:[]};a.QI=c;t(a,c)};a.update=function(a,b){var c=h.AD();
if(!(0>=c))for(var d=0;d<K.length;d++)for(var e=d,f=a,g=b,k=c,m=K[e],l=0;l<K[e].qd.length;l++){m.Hp=K[e].qd[l];var n=K[e].qd[l],r=m,q=f,t=g,u=k,p=n.D;if(p.length){for(var x=0;x<p.length;x++)p[x].Kn=!1;for(x=0;x<p.length;x++){if(0<=n.Yd.V)var v=p[n.Yd.V];else break;if(v.Kn)break;if(v.mute)if("ENTRYPOINT"==v.type)break;else n.Yd.V=v.ha,v.Kn=!0;else v.pw(v,r,n.Yd,q,t,u),v.Kn=!0}}}};a.cleanup=function(){K=[]}};b4w.module.__nla=function(a,p){function d(){return{type:"CLIP",N:0,ja:0,xf:!1,paused:!1,Id:"",$j:"",nc:0,Rg:0,Yj:0,qu:0,pu:0,Lx:!1,scale:1,repeat:1}}function b(a,c){if(a.animation_data){var d=a.animation_data.nla_tracks;if(d)for(var f=0;f<d.length;f++)c.push(d[f])}d=a.nodes;for(f=0;f<d.length;f++){var h=d[f];h.node_group&&(h=h.node_group.node_tree)&&b(h,c)}}function c(a,b){var c=Math.round(a)-b.N;b.ci&&(c%=b.Ki,0>c&&(c+=b.Ki));return b.ab+c}function q(a,b,c,d){b=(b-d)*G.Wb()+a.ab;b>a.N?(b-=a.N,a.cyclic&&
c&&(b%=a.ja-a.N+1),b+=a.N):b=a.N;return b}function f(a,b){a=m.clamp(a,b.N,b.ja);var c=a-b.N,d=(b.ja-b.N)/b.repeat,c=c/d&&0==c%d?b.Yj:b.Rg+c%d/b.scale;b.Lx&&(c=b.Yj-c+b.Rg);return c}function t(a,b){for(var c=[],f=0;f<a.length;f++){var h=a[f].strips;if(h)for(var g=0;g<h.length;g++){var k=h[g],m=d();m.type=k.type;m.N=k.frame_start;m.ja=k.frame_end;m.nc=b;m.Rg=k.action_frame_start;m.Yj=k.action_frame_end;m.Lx=k.use_reverse;m.scale=k.scale;m.repeat=k.repeat;k.action&&(m.Id=k.action.name,m.$j=k.action.uuid);
c.push(m)}}return c}function l(a){return("SPEAKER"==a.type||"LAMP"==a.type)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}function n(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c=c.use_nodes&&d)a:{if(d.animation_data&&(c=d.animation_data.nla_tracks)&&c.length){c=!0;break a}d=d.nodes;for(c=0;c<d.length;c++);c=!1}if(c)return!0}return!1}function g(a,b){var c=w.get_active();c.S&&(c.S.ab-=q(c.S,
b,!0,A)-a,c.S.Ii=!0)}var z=p("__animation");p("__camera");p("__controls");p("__config");p("__lights");p("__loader");var h=p("__objects"),k=p("__obj_util"),u=p("__print"),w=p("__scenes"),C=p("__sfx"),E=p("__textures"),G=p("__time"),m=p("__util"),x=[],A=-1;a.bi=function(a,c){var f;f=null;for(var h=c.J.length-1;0<=h;h--){var g=c.J[h];if(g.Ea.b4w_use_nla&&(f=g,g.Ea.at))break}if(f){f.Wv=!0;var n=0;if((h=a.animation_data)&&h.nla_tracks.length){var q=h.nla_tracks;if(k.is_armature(c)||k.is_camera(c)||k.is_mesh(c)||
k.is_empty(c)||k.is_lamp(c)||k.is_speaker(c))q=t(q,n),q.length&&(c.Td=c.Td.concat(q),n++)}l(a)&&(q=a.data.animation_data.nla_tracks,q=t(q,n),q.length&&(c.Td=c.Td.concat(q),n++));if(k.is_mesh(c))for(g=a.data.materials,h=0;h<g.length;h++){var u=g[h];if(u.use_nodes&&u.node_tree&&(q=[],b(u.node_tree,q),q=t(q,n),q.length)){for(var u=n,p=q,x=z.bD(),A=[],w=0,O=0;O<p.length;O++){var C=p[O];""!=C.$j?C=m.keysearch("uuid",C.$j,x):(C=C.Id,C=m.keysearch("name",C,x)||m.keysearch("name",C+"_B4W_BAKED",x));if(C){var C=
C.fcurves,E=[],G;for(G in C)E.push(G);A.push(E)}}for(O=0;O<A.length;O++){x=!1;for(C=0;C<O;C++)if(m.kA(A[O],A[C])){p[O].nc=p[C].nc;x=!0;break}x||(p[O].nc=n+w++)}n=u+w;c.Td=c.Td.concat(q)}}for(h=0;h<a.particle_systems.length;h++)g=a.particle_systems[h],G=g.settings,"EMITTER"==G.type&&G.b4w_allow_nla&&(G=d(),G.type="CLIP",G.N=f.Ea.frame_start,G.ja=f.Ea.frame_end+1,G.Id=g.name,G.nc=n,G.Rg=G.N,G.Yj=G.ja,c.Td.push(G),n++);g=n+1;for(h=0;h<c.jc.length;h++)q=c.jc[h],q.Jz&&(n=g,G=d(),G.type="CLIP",G.N=f.Ea.frame_start,
G.ja=f.Ea.frame_end+1,G.Id=q.name,G.nc=n,G.Rg=G.N,G.Yj=G.ja,c.Td.push(G))}};a.yH=function(a,b,c){a.S||(a.S={N:a.frame_start,ja:a.frame_end,ab:0,$k:-1,ml:a.frame_end,nl:a.frame_start,Qj:null,cyclic:b,Xa:[],U:[],MF:a.name,dg:!1,Ii:!1,Br:!0});b=a.S;for(var f=h.xD(a,c),g=0;g<f.length;g++){var k=f[g];if(k.Td.length){for(var l=0;l<k.J.length;l++){var n=k.J[l];n.Ea==a&&n.Wv&&b.Xa.push(k)}for(var l=k.Td,n=b,q=k.name,t=0;t<l.length;t++){var p=l[t],A=q+" ["+p.N+":"+p.ja+"]",w=Math.max(n.N,p.N);p.Rg+=w-p.N;
p.N=w;p.ja=Math.min(n.ja+1,p.ja);p.N>p.ja?(u.warn("NLA: out of scene range: "+A),l.splice(t,1),t--):p.Id||"CLIP"!=p.type||(u.warn('NLA: no action in strip for object "'+q+'".'),l.splice(t,1),t--)}k=k.Td;l=b;for(n=0;n<k.length;n++){q=k[n];t=l.N;p=l.ja+1;for(A=0;A<k.length;A++)w=k[A],q.nc==w.nc&&(w.ja<=q.N&&(t=q.N),w.N>=q.ja&&(p=Math.min(p,w.N)));q.qu=t;q.pu=p}}}a=a.k.Sj;for(g=0;g<a.length;g++)f=a[g].k,f.qo&&(f.ga||f.gc)&&f.Ef==c&&(k=d(),k.type="VIDEO",f.ci?(k.N=0,k.ja=b.ja):(k.N=m.clamp(f.N,0,b.ja),
k.ja=m.clamp(f.N+f.Ki,0,b.ja)),k.Id=a[g].name,b.U.push(f));x.push(b)};a.start=function(){A=0};a.AD=function(){return A};a.XJ=function(a){return a.S?a.S.ab:null};a.PK=function(a,b){return a.S?(a.S.ab=b,!0):!1};a.update=function(a,b){if(!(0>A)){0==A&&(A=a);for(var d=0;d<x.length;d++){var h=x[d];h.dg&&(h.ab-=G.Wb()*b);var k=q(h,a,!0,A);if((!h.dg||h.Ii)&&k>=h.ml)if(h.cyclic){var k=h,l=a;k.Qj&&k.Qj();g(k.nl,l);k.Br=!0;k=q(k,l,!0,A)}else{var l=h,n=k;l.dg=!0;l.ab-=n-l.ml;l.Qj&&l.Qj()}if(!h.dg||h.Ii){for(var l=
h,n=k,t=0;t<l.Xa.length;t++){for(var u=l.Xa[t],p=u.Td,w=0;w<p.length;w++){var M=p[w];"SOUND"==M.type&&n<l.$k-1E-6&&(M.xf=!1)}for(w=0;w<p.length;w++)switch(M=p[w],M.type){case "CLIP":if(M.qu<=n&&n<M.pu&&!M.xf){var O=u,V=M;""!=V.$j?z.eA(O,V.$j,V.nc):z.apply(O,V.Id,V.nc);z.set_behavior(O,z.AB_FINISH_STOP,V.nc);var T=f(V.N,V);z.set_frame(O,T,V.nc);for(O=0;O<p.length;O++)p[O]!=M&&p[O].nc==M.nc&&(p[O].xf=!1);M.xf=!0}M.xf&&(O=u,V=f(n,M),1E-6<Math.abs(V-z.Ju(O,M.nc))&&z.set_frame(O,V,M.nc));break;case "SOUND":(n<
l.$k-1E-6||l.$k<M.N)&&M.N<=n&&n<M.ja&&!M.xf&&(C.play(u,(M.N-n)/G.Wb(),(M.ja-M.N)/G.Wb()),M.xf=!0),l.$k<M.ja&&M.ja<=n&&M.xf&&(M.xf=!1)}}l=a;n=h;t=k;for(u=0;u<n.U.length;u++)if(p=n.U[u],p.ga||p.gc){w=E.Ux(p);M=p;O=m.clamp(c(t,M),M.ab,M.ab+E.Vx(M)-1);M.gc&&(O=E.$H(M,O),O==M.Kr&&O--);M=O;O=E.Wx(p);T=V=!1;if(n.Ii||n.Br)T=!0;if(!n.dg){var U;U=c(t,p);U=p.ab<=U&&U<=p.ab+E.Vx(p);var B=E.Xx(p);p.ci&&M==O&&(T=!0);B||w==M||(T=!0);U&&!B?E.play_video(p.name,p.Ef):U&&B?V=!0:!U&&B&&(p.ga&&w<M?V=!0:E.pause_video(p.name,
p.Ef))}T?(E.TF(p.name,M,p.Ef),p.gc&&(p.uj=E.Rn(p,l))):V&&E.Yx(p)&&(p.ga?E.Ix(p):(w=E.Rn(p,l),w!=p.uj&&(p.Vh=M,E.Hx(p)),p.uj=w))}h.$k=k}h.Ii=!1;h.Br=!1}}};a.hJ=q;a.cleanup=function(){x.length=0;A=-1};a.wt=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||l(a)||n(a)?!0:!1};a.set_frame=g;a.get_frame=function(a){var b=w.get_active();return b.S?q(b.S,a,!0,A):-1};a.cs=function(){var a=w.get_active();a.S&&(a.S.dg=!0);for(var a=a.S.U,b=0;b<a.length;b++){var c=a[b];E.pause_video(c.name,c.Ef)}};
a.hw=function(a){var b=w.get_active();b.S&&(b.S.dg=!1,b.S.Qj=a?a:null)};a.get_frame_start=function(){var a=w.get_active();return a.S?a.S.N:-1};a.get_frame_end=function(){var a=w.get_active();return a.S?a.S.ja:-1};a.is_play=function(){var a=w.get_active();return a.S?!a.S.dg:!1};a.check_nla=function(){var a=w.get_active();return a.S?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=w.get_active();return a.S?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,b){var c=w.get_active();if(c.S)c.S.nl=
a,c.S.ml=b;else return!1};a.Nr=function(a){var b=w.get_active();b.S&&(b.S.ml=a)};a.dG=function(a){var b=w.get_active();b.S&&(b.S.nl=a)};a.reset_range=function(){var a=w.get_active();if(a.S)a=a.S,a.nl=a.N,a.ml=a.ja;else return!1};a.set_cyclic=function(a){var b=w.get_active();if(b.S)b.S.cyclic=a;else return!1};a.clear_callback=function(){var a=w.get_active();a.S&&(a.S.Qj=null)};a.Lw=function(a){var b=w.get_active().S;b&&(b.ab=-(a-A)*G.Wb()+b.nl,b.Ii=!0)};a.get_frame_end=function(){var a=w.get_active().S;
return a?a.ja:null}};b4w.module.__camera=function(a,p){function d(a){var b=a.f,c=a.f,d=W.get_trans_view(c.h),f=W.get_quat_view(c.h),f=R.quat_to_dir(f,R.AXIS_MY,N),h=ca;h.set(R.AXIS_Y);h[3]=0;f=R.line_plane_intersect(h,-c.fv,d,f,c.Ka);h=l(a,ma)[1];if(!f||Math.abs(h)<ea)B.warn("Active hover camera view vector and the supporting plane are parallel to each other. Hover pivot will be set based on the camera position."),c.Ka[0]=d[0],c.Ka[1]=0,c.Ka[2]=d[2],k(a,d,c.Ka),O.correct_up(a,c.Se,!0);c=l(a,ma);d=da.kj(a,a.f.Ka);b.hb||
(b.hb={min:d,max:d});b.s||(b.s={down:c[1],up:c[1]});b=R.Pf(c[1],b.s.up,b.s.down);0<c[1]&&B.warn("Active hover camera has wrong orientation");b?A(a,0,b):e(a)}function b(b){b=b.f;switch(b.Qa){case a.MS_TARGET_CONTROLS:var c=W.get_trans_view(b.h);b.Vi=Y.dist(c,b.Sa);b.Wi=b.L[0].top;break;case a.MS_HOVER_CONTROLS:c=W.get_trans_view(b.h),b.Vi=Y.dist(c,b.Ka),b.Wi=b.L[0].top}}function c(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,
0,0,0]),Ra:new Float32Array([0,0,0,0]),Cb:new Float32Array([0,0,0,0])}}function q(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function f(b){var d={type:b,name:"",WK:1,width:0,height:0,ge:null,fq:null,Hb:null,Ld:null,Ua:0,Jc:0,Ra:0,Cb:0,left:0,right:0,top:0,bottom:0,Lc:ka.create(),h:new Float32Array(9),Ta:new Float32Array(16),gJ:new Float32Array(16),
lb:new Float32Array(16),re:new Float32Array(16),Zx:new Float32Array(16),rF:new Float32Array(16),Me:new Float32Array(16),$d:W.Bp(),Qr:W.Bp(),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,ld:null,dof_on:!1,Cv:new Float32Array(3),Ok:c(),Hj:0,Xd:0,cc:null,xk:null,Fp:null,Zt:new Float32Array(4),Fn:new Float32Array(4)};d.Lc[0]=d.Lc[2]=45;d.Lc[1]=d.Lc[3]=55;if(b==a.Tb)return d;switch(b){case a.mc:g(d,40,.1,1E3);break;case a.bd:g(d,2.5,.1,1E3);break;case a.Ue:break;case a.Kf:break;case a.Pg:break;case a.xb:case a.Gb:case a.kc:case a.lc:throw"Stereo camera may only be created from perspective one";
default:throw"Unknown camera type";}return d}function t(b,c,d){if(b.type!=a.xb&&b.type!=a.Gb&&b.type!=a.kc&&b.type!=a.lc)throw"set_stereo_params(): wrong camera type";if(b.type==a.xb||b.type==a.Gb)b.Hj=c;b.Xd=d;v(b,b.Ua);if(ba.ma()&&(c=ba.get_active(),b=c.k.hc))for(c=ba.Ni(c).f.L,d=0;d<c.length;d++)P(c[d],b)}function l(a,b){var c=W.get_quat_view(a.f.h);return n(c,b)}function n(a,b){var c=R.quat_to_dir(a,R.AXIS_Y,N),d=R.quat_to_dir(a,R.AXIS_Z,aa),e=-Math.asin(c[1]/Y.length(c)),c=Math.abs(e)>Math.PI/
4?Y.scale(d,-R.sign(e),X):Y.scale(c,-R.sign(d[1]),X),f=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=R.sign(e)*Math.PI-e);d=f;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function g(b,c,d,e,f){switch(b.type){case a.mc:case a.xb:case a.Gb:b.Jc=c;b.Ua=1;break;case a.bd:b.top=c;b.Ua=1;break;case a.Ue:delete b.Jc;b.Jc=c;b.Ua=f/c;break;case a.Kf:b.top=c;b.Ua=f/c;break;case a.kc:case a.lc:break;default:B.error("set_frustum(): Unsupported camera type: "+b.type)}b.Ra=d;b.Cb=e}function z(b,
c){var d=W.get_trans_view(c.f.h),e=W.get_quat_view(c.f.h),d=T.fromRotationTranslation(e,d,ga);T.rotateX(d,-Math.PI/2,d);T.invert(d,b.Ta);if(b.cc){var d=b.cc[0],e=b.cc[1],f=b.cc[2],h=b.cc[3],g=ga;g[0]=1-2*d*d;g[1]=-2*d*e;g[2]=-2*d*f;g[3]=0;g[4]=-2*d*e;g[5]=1-2*e*e;g[6]=-2*e*f;g[7]=0;g[8]=-2*d*f;g[9]=-2*e*f;g[10]=1-2*f*f;g[11]=0;g[12]=-2*d*h;g[13]=-2*e*h;g[14]=-2*f*h;g[15]=1;T.multiply(b.Ta,g,b.Ta);W.from_mat4(b.Ta,b.$d);v(b,b.Ua,!0);d=ca;e=ga;T.invert(b.Ta,e);T.transpose(e,e);ka.transformMat4(b.cc,
e,d);e=Ea;e[0]=(R.sign(d[0])+b.lb[8])/b.lb[0];e[1]=(R.sign(d[1])+b.lb[9])/b.lb[5];e[2]=-1;e[3]=(1+b.lb[10])/b.lb[14];ka.scale(d,2/(d[0]*e[0]+d[1]*e[1]+d[2]*e[2]+d[3]*e[3]),d);b.lb[2]=d[0];b.lb[6]=d[1];b.lb[10]=d[2]+1;b.lb[14]=d[3]}if(ba.ma())var k=ba.get_active(),k=ba.Z(k,"STEREO");if(b.type==a.xb||k&&k.enable_hmd_stereo&&b.type==a.kc)b.Ta[12]+=b.Xd/2;else if(b.type==a.Gb||k&&k.enable_hmd_stereo&&b.type==a.lc)b.Ta[12]-=b.Xd/2;W.from_mat4(b.Ta,b.$d);D(b);J(b);W.copy(c.f.h,b.h)}function h(b,c,d,e){T.lookAt(c,
d,e,b.Ta);d=ba.get_active();d=ba.Z(d,"STEREO");ba.ma()&&(d=ba.get_active(),d=ba.Z(d,"STEREO"));if(b.type==a.xb||d&&d.enable_hmd_stereo&&b.type==a.kc)b.Ta[12]+=b.Xd/2;else if(b.type==a.Gb||d&&d.enable_hmd_stereo&&b.type==a.lc)b.Ta[12]-=b.Xd/2;W.from_mat4(b.Ta,b.$d);D(b);J(b);W.set_trans(c,b.h)}function k(a,b,c){c=Y.subtract(c,b,N);Y.normalize(c,c);c=R.Gw(R.AXIS_MY,c,Q);da.set_rotation(a,c);da.set_translation(a,b)}function u(a){var b=a.f,c=b.L;if(!c)throw"Wrong object";for(var d=b.Pr,e=0;e<d.length;e++){var f=
d[e];Y.copy(W.get_trans_view(b.h),f.Cv)}for(e=0;e<c.length;e++)if(f=c[e],z(f,a),R.Om(f.re,f.Ok),f.ld&&f.dof_on){var d=W.get_trans_view(b.h),h=da.get_translation(f.ld,N),d=Y.dist(d,h);f.dof_distance=d}}function w(b){b=b.f;if(b.Qa==a.MS_TARGET_CONTROLS){var c=W.get_quat_view(b.h),c=R.quat_to_dir(c,R.AXIS_Z,N);b.ms=0<c[1]}}function C(b){var c=b.f,d=c.ba;!d||c.Qa!=a.MS_EYE_CONTROLS&&c.Qa!=a.MS_TARGET_CONTROLS||(b=l(b,ma),d.camera_space?(d.left+=b[0],d.right+=b[0]):(d.eg-=b[0],d.sg-=b[0]),d.left=R.angle_wrap_0_2pi(d.left),
d.right=R.angle_wrap_0_2pi(d.right),d.eg=R.angle_wrap_0_2pi(d.eg),d.sg=R.angle_wrap_0_2pi(d.sg))}function E(b){var c=b.f,d=c.s;if(d)switch(c.Qa){case a.MS_EYE_CONTROLS:case a.MS_TARGET_CONTROLS:b=l(b,ma);d.camera_space?(d.up+=b[1],d.down+=b[1]):(d.Eg-=b[1],d.Xf-=b[1]);d.up=R.angle_wrap_periodic(d.up,-Math.PI,Math.PI);d.down=R.angle_wrap_periodic(d.down,-Math.PI,Math.PI);d.Eg=R.angle_wrap_periodic(d.Eg,-Math.PI,Math.PI);d.Xf=R.angle_wrap_periodic(d.Xf,-Math.PI,Math.PI);break;case a.MS_HOVER_CONTROLS:d.up=
R.angle_wrap_periodic(d.up,-Math.PI,Math.PI),d.down=R.angle_wrap_periodic(d.down,-Math.PI,Math.PI),d.up=R.clamp(d.up,-Math.PI/2,0),d.down=R.clamp(d.down,-Math.PI/2,0)}}function G(b){var c=b.f;if(U.is_camera(b)){var d=c.L;if(d[0].type===a.bd){switch(c.Qa){case a.MS_TARGET_CONTROLS:var e=W.get_trans_view(c.h),e=Y.dist(e,c.Sa),c=e/c.Vi*c.Wi;break;case a.MS_HOVER_CONTROLS:e=W.get_trans_view(c.h);e=Y.distance(e,c.Ka);c=e/c.Vi*c.Wi;break;default:c=d[0].top}for(e=0;e<d.length;e++){var f=d[e];f.top=c;v(f,
f.Ua)}u(b)}}}function m(a,b,c,d,e){var f=a.f,h=b,g=c;if(d||e)a=l(a,la),d&&(h=b-a[0]),e&&(g=c-a[1]);if(h||g)b=ha.identity(Q),h&&(h=ha.setAxisAngle(f.Se,h,sa),ha.multiply(b,h,b)),f=W.get_quat_view(f.h),g&&(h=R.quat_to_dir(f,R.AXIS_X,N),g=ha.setAxisAngle(h,g,sa),ha.normalize(g,g),ha.multiply(b,g,b)),ha.multiply(b,f,f)}function x(a,b,c,d,e){var f=a.f,h=b,g=c;if(d||e){var k=l(a,la);d&&(h=b-k[0]);e&&(g=c-k[1])}r(a,a.f.Sa,h,g);a=l(a,la);a=R.angle_wrap_periodic(a[1],-Math.PI,Math.PI);f.ms=Math.abs(a)>Math.PI/
2}function A(a,b,c,d,f){var h=a.f,g=b,k=c;if(d||f){var m=l(a,la);d&&(g=b-m[0]);f&&(k=c-m[1])}h.Vp||(g=0);r(a,h.Ka,g,k);k&&e(a)}function r(a,b,c,d){var e=a.f;if(c||d){var f=ha.identity(Q);c&&(c=ha.setAxisAngle(R.AXIS_Y,c,sa),ha.multiply(f,c,f));I(a);a=W.get_quat_view(e.h);d&&(c=R.quat_to_dir(a,R.AXIS_X,N),d=ha.setAxisAngle(c,d,sa),ha.normalize(d,d),ha.multiply(f,d,f));e=W.get_trans_view(e.h);R.IF(e,b,f,e);ha.multiply(f,a,a)}}function e(a){var b=a.f,c=l(a,ma)[1],d=a.f;a=d.s;d=d.hb;a.down-a.up?(c=(a.down-
c)/(a.down-a.up),c=Math.max(c,0)):c=0;c=c*(d.max-d.min)+d.min;a=W.get_trans_view(b.h);d=W.get_quat_view(b.h);d=R.quat_to_dir(d,R.AXIS_MY,N);Y.normalize(d,d);Y.scale(d,c,d);Y.subtract(b.Ka,d,a)}function v(b,c,d){switch(b.type){case a.mc:if(!c)throw"No aspect ratio";b.Ua=c;case a.Ue:T.perspective(R.xd(b.Jc),b.Ua,b.Ra,b.Cb,b.lb);break;case a.bd:if(!c)throw"No aspect ratio";b.Ua=c;case a.Kf:c=b.top*b.Ua;T.ortho(-c,c,-b.top,b.top,b.Ra,b.Cb,b.lb);break;case a.Pg:T.ortho(b.left,b.right,b.bottom,b.top,b.Ra,
b.Cb,b.lb);break;case a.xb:case a.Gb:if(!c)throw"No aspect ratio";b.Ua=c;var e=Math.tan(b.Jc*Math.PI/360);c=b.Ra*e;var f=b.Ua*b.Hj*e;b.type==a.xb?(e=f-b.Xd/2,f+=b.Xd/2):(e=f+b.Xd/2,f-=b.Xd/2);e=-(b.Ra/b.Hj*e);f*=b.Ra/b.Hj;T.frustum(e,f,-c,c,b.Ra,b.Cb,b.lb);b.left=e;b.right=f;break;case a.kc:case a.lc:ba.ma()&&(e=ba.get_active(),(e=ba.Z(e,"STEREO"))&&e.enable_hmd_stereo?(c=Math.tan(R.xd(b.Lc[1])/2),e=Math.tan(R.xd(b.Lc[2])/2),f=Math.tan(R.xd(b.Lc[3])/2),b.top=b.Ra*Math.tan(R.xd(b.Lc[0])/2),b.right=
b.Ra*c,b.bottom=-b.Ra*e,b.left=-b.Ra*f,T.frustum(b.left,b.right,b.bottom,b.top,b.Ra,b.Cb,b.lb)):(c||(c=b.Ua),T.perspective(R.xd(b.Jc),c,b.Ra,b.Cb,b.lb)));break;case a.Tb:return;default:throw"Wrong camera type: "+b.type;}d||(D(b),J(b))}function J(a){T.copy(a.Ta,a.Me);a.Me[12]=0;a.Me[13]=0;a.Me[14]=0;a.Me[15]=1;T.multiply(a.lb,a.Me,a.Me);T.invert(a.Me,a.Me)}function D(a){T.copy(a.Ta,a.re);T.multiply(a.lb,a.re,a.re);T.invert(a.re,a.Zx)}function H(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.Ra);d||
(d=b.Cb);var h,g,k,m,l,n,q,r;switch(b.type){case a.Tb:throw"Extraction from NONE camera is not possible";case a.mc:case a.Ue:h=c*Math.tan(b.Jc*Math.PI/360);m=-h;g=h*b.Ua;k=-g;l=d/c*h;r=-l;n=l*b.Ua;q=-n;break;case a.bd:case a.Kf:k=b.top*b.Ua;h=l=b.top;g=n=k;m=r=-b.top;k=q=-k;break;case a.Pg:h=l=b.top;g=n=b.right;m=r=b.bottom;k=q=b.left;break;case a.xb:case a.Gb:l=c/b.Ra;h=c*Math.tan(b.Jc*Math.PI/360);m=-h;g=b.right*l;k=b.left*l;q=d/c;l=h*q;r=-l;n=g*q;q*=k;break;case a.kc:case a.lc:l=c/b.Ra;h=b.top*
l;m=b.bottom*l;g=b.right*l;k=b.left*l;q=d/c;l=h*q;r=m*q;n=g*q;q*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=m;e[2]=-c;e[3]=g;e[4]=m;e[5]=-c;e[6]=g;e[7]=h;e[8]=-c;e[9]=k;e[10]=h;e[11]=-c;e[12]=q;e[13]=r;e[14]=-d;e[15]=q;e[16]=l;e[17]=-d;e[18]=n;e[19]=l;e[20]=-d;e[21]=n;e[22]=r;e[23]=-d;f&&(c=ga,T.invert(b.Ta,c),R.sj(e,c,e,0));return e}function I(b){return U.is_camera(b)&&b.f&&b.f.Qa==a.MS_HOVER_CONTROLS}function P(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.xk){var d=b.csm_num;
a.xk=Array(d);for(var e=0;e<d;e++)a.xk[e]=new Float32Array(3);a.Fp=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Ra:K(b,a,d-1),f=K(b,a,d),e=H(a,e,f,ua),e=M.rD(e);a.xk[d].set(e.I);a.Fp[d]=e.Ma;a.Zt[d]=Y.length(e.I);a.Fn[d]=y(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.Fn[0]=b.first_cascade_blur_radius}function K(a,b,c){var d=a.csm_num,e=R.clamp(a.csm_first_cascade_border,b.Ra,b.Cb);a=R.clamp(a.csm_last_cascade_border,b.Ra,b.Cb);return R.clamp(y(e,a,d,c),b.Ra,b.Cb)}function y(a,
b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}function F(a,b){b||(b=new Float32Array(3));var c=W.get_trans_view(a.f.h);Y.copy(c,b);return b}var M=p("__boundings");p("__config");var O=p("__constraints"),V=p("__container");p("__mat3");var T=p("__mat4"),U=p("__obj_util"),B=p("__print"),ha=p("__quat"),ba=p("__scenes"),da=p("__transform"),W=p("__tsr"),R=p("__util"),Y=p("__vec3"),ka=p("__vec4");p("__physics");a.Tb=10;a.mc=20;a.bd=30;a.Ue=40;a.Kf=50;a.Pg=
60;a.xb=70;a.Gb=80;a.kc=90;a.lc=100;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var ea=Math.PI/180/2,ma=new Float32Array(2),la=new Float32Array(2),N=new Float32Array(3),aa=new Float32Array(3),X=new Float32Array(3),Q=new Float32Array(4),sa=new Float32Array(4),ca=new Float32Array(4),Ea=new Float32Array(4);new Float32Array(16);var ga=new Float32Array(16),ua=new Float32Array(24);a.HA=function(c,e){var h=e.f,k=c.data;switch(k.type){case "PERSP":var m=f(a.mc);if(k.angle_y)var l=
k.angle_y/Math.PI*180;g(m,l,k.clip_start,k.clip_end);break;case "ORTHO":m=f(a.bd),g(m,k.ortho_scale/2,k.clip_start,k.clip_end)}m.name=e.name;h.ZG=!1;h.Qa=q(k.b4w_move_style);h.dof_distance=k.dof_distance;l=k.dof_object;h.ld=l?l.oa:null;h.dof_front=k.b4w_dof_front;h.dof_rear=k.b4w_dof_rear;h.dof_power=k.b4w_dof_power;h.Vp=k.b4w_enable_hover_hor_rotation;h.fv=k.b4w_hover_zero_level;h.L=[m];h.Pr=[];h.Nl=k.b4w_trans_velocity;h.Ml=k.b4w_rot_velocity;h.Ol=k.b4w_zoom_velocity;h.Qa==a.MS_TARGET_CONTROLS&&
(h.Sa.set(k.b4w_target),w(e));k=e.f;l=k.Qa;if(l===a.MS_TARGET_CONTROLS||l===a.MS_EYE_CONTROLS||l===a.MS_HOVER_CONTROLS){var n=c.data,r=null,t=null,u=null,p=null,x=null;l===a.MS_TARGET_CONTROLS||l===a.MS_EYE_CONTROLS?(n.b4w_use_panning&&(k.Bs=n.b4w_use_panning),n.b4w_use_horizontal_clamping&&(r={left:n.b4w_rotation_left_limit,eg:n.b4w_rotation_left_limit,right:n.b4w_rotation_right_limit,sg:n.b4w_rotation_right_limit,camera_space:"LOCAL"==n.b4w_horizontal_clamping_type}),n.b4w_use_vertical_clamping&&
(t={down:n.b4w_rotation_down_limit,Xf:n.b4w_rotation_down_limit,up:n.b4w_rotation_up_limit,Eg:n.b4w_rotation_up_limit,camera_space:"LOCAL"==n.b4w_vertical_clamping_type}),l===a.MS_TARGET_CONTROLS&&n.b4w_use_target_distance_limits&&n.b4w_distance_min<=n.b4w_distance_max&&(u={min:n.b4w_distance_min,max:n.b4w_distance_max})):l===a.MS_HOVER_CONTROLS&&(n.b4w_use_horizontal_clamping&&n.b4w_horizontal_translation_min<=n.b4w_horizontal_translation_max&&(p={min:n.b4w_horizontal_translation_min,max:n.b4w_horizontal_translation_max}),
n.b4w_use_vertical_clamping&&n.b4w_vertical_translation_min<=n.b4w_vertical_translation_max&&(x={min:n.b4w_vertical_translation_min,max:n.b4w_vertical_translation_max}),n.b4w_use_zooming&&(n.b4w_hover_angle_min<=n.b4w_hover_angle_max?t={down:n.b4w_hover_angle_min,up:n.b4w_hover_angle_max}:B.error("Wrong angle limits for the HOVER camera. Disabling angle limits."),n.b4w_distance_min<=n.b4w_distance_max?u={min:n.b4w_distance_min,max:n.b4w_distance_max}:B.error("Wrong distance limits for the HOVER camera. Disabling distance limits.")));
k.ba=r;k.s=t;k.hb=u;k.bc=p;k.tb=x;k=e.f;switch(k.Qa){case a.MS_EYE_CONTROLS:k.ba&&(k.ba.left*=-1,k.ba.right*=-1);break;case a.MS_TARGET_CONTROLS:k.s&&(k.s.down*=-1,k.s.up*=-1);break;case a.MS_HOVER_CONTROLS:k.tb&&(l=-k.tb.min,k.tb.min=-k.tb.max,k.tb.max=l),k.s&&(k.s.down*=-1,k.s.up*=-1)}C(e);E(e)}h.Qa===a.MS_HOVER_CONTROLS&&d(e);m.type==a.bd&&b(e)};a.mK=d;a.nK=b;a.qB=c;a.UE=q;a.Nb=f;a.iJ=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.Hb);case "DEPTH":return Boolean(a.Ld);case "SCREEN":return!Boolean(a.Hb)&&
!Boolean(a.Ld);default:throw"Wrong attachment type: "+b;}};a.Sn=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.Hb=c;break;case "DEPTH":a.Ld=c;break;case "SCREEN":a.Hb=null;a.Ld=null;break;default:throw"Wrong attachment type: "+b;}};a.TJ=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.Hb;case "DEPTH":return a.Ld;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.rn=function(b,c){if(b.type!=a.mc||c!=a.xb&&c!=a.Gb&&c!=a.kc&&c!=a.lc)throw"make_stereo(): wrong camera type";
b.type=c;t(b,6,.065)};a.Mw=t;a.get_camera_angles=l;a.Hu=n;a.get_camera_angles_char=function(a,b){l(a,b);b[0]=R.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.SJ=function(a,b){var c=W.get_quat_view(a.f.h),d=R.quat_to_dir(c,R.AXIS_MY,N),e=Math.asin(d[1]/Y.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?R.quat_to_dir(c,R.AXIS_MZ,aa):R.quat_to_dir(c,R.AXIS_Z,aa)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.Tn=g;a.VF=function(b,
c,d,e,f,h,g){switch(b.type){case a.Pg:b.left=c;b.right=d;b.bottom=e;b.top=f;b.Ra=h;b.Cb=g;break;default:B.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.f.Qa};a.hG=z;a.RK=h;a.Or=function(a,b,c){var d=N;d[0]=0;d[1]=-1;d[2]=0;Y.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=aa;e[0]=0;e[1]=0;e[2]=-1;Y.transformQuat(e,c,e);h(a,b,d,e)};a.set_look_at=k;a.lH=u;a.kH=function(b){var c=b.f,d=b.f;if(d.Qa===a.MS_TARGET_CONTROLS||d.Qa===
a.MS_EYE_CONTROLS){if(d.ba){var e=d.ba.left,f=d.ba.right,h=l(b,ma);(h=d.Qa==a.MS_TARGET_CONTROLS?R.Pf(h[0],e,f):R.Pf(h[0],f,e))&&(d.Qa==a.MS_TARGET_CONTROLS?x(b,h,0):m(b,h,0))}d.s&&(e=d.s.down,f=d.s.up,h=l(b,ma),(h=d.Qa==a.MS_TARGET_CONTROLS?R.Pf(h[1],f,e):R.Pf(h[1],e,f))&&(d.Qa==a.MS_TARGET_CONTROLS?x(b,0,h):m(b,0,h)));if(d.Qa===a.MS_TARGET_CONTROLS&&d.hb){var h=b.f,e=W.get_trans_view(h.h),f=Y.subtract(e,h.Sa,N),g=Y.length(f);g>h.hb.max?(Y.scale(f,h.hb.max/g,f),Y.add(h.Sa,f,e)):g<h.hb.min&&(g=W.get_quat_view(h.h),
g=R.quat_to_dir(g,R.AXIS_MY,aa),Y.scale(g,100*h.hb.min,g),Y.add(f,g,f),Y.scale(f,-h.hb.min/Y.length(f),f),Y.add(h.Sa,f,e))}}d.Qa===a.MS_HOVER_CONTROLS&&(d=b.f,d.bc&&(e=R.clamp(d.Ka[0],d.bc.min,d.bc.max)-d.Ka[0],d.Ka[0]+=e,h=W.get_trans_view(d.h),h[0]+=e),d.tb&&(e=R.clamp(d.Ka[2],d.tb.min,d.tb.max)-d.Ka[2],d.Ka[2]+=e,h=W.get_trans_view(d.h),h[2]+=e),d=b.f,h=l(b,ma)[1],(d=R.Pf(h,d.s.up,d.s.down))&&A(b,0,d));G(b);switch(c.Qa){case a.MS_TARGET_CONTROLS:d=W.get_trans_view(c.h);h=W.get_quat_view(c.h);O.JF(d,
h,c.Sa);h=c.L;for(e=0;e<h.length;e++)f=h[e],f.type!=a.xb&&f.type!=a.Gb||t(f,Y.dist(d,c.Sa),f.Xd);O.correct_up(b,c.Se);break;case a.MS_EYE_CONTROLS:b.gb||O.correct_up(b,c.Se)}w(b)};a.xs=w;a.jw=C;a.kw=E;a.xH=G;a.rotate_eye_camera=m;a.rotate_target_camera=x;a.rotate_hover_camera=A;a.vK=function(b){switch(b.type){case a.mc:case a.bd:case a.xb:case a.Gb:return!0;default:return!1}};a.Eu=function(b){b=b.f.L[0];switch(b.type){case a.mc:case a.Ue:case a.xb:case a.Gb:return Math.PI*b.Jc/180;default:return B.error("get_angular_diameter(): Unsupported camera type: "+
b.type),0}};a.zf=v;a.tm=J;a.kp=D;a.vC=H;a.mA=function(a){a=a.f;var b=M.$c();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Zb=b;var c=M.Cm(1,[0,0,0]);a.fd=c;a.Xo=M.Vt(1,b);a.Zo=M.Xt(1,b);a.Yo=M.Wt(1,b)};a.is_static_camera=function(b){return U.is_camera(b)&&b.f&&b.f.Qa==a.MS_STATIC};a.is_target_camera=function(b){return U.is_camera(b)&&b.f&&b.f.Qa==a.MS_TARGET_CONTROLS};a.is_eye_camera=function(b){return U.is_camera(b)&&b.f&&b.f.Qa==a.MS_EYE_CONTROLS};a.is_hover_camera=I;a.is_ortho_camera=
function(b){return U.is_camera(b)&&b.f&&b.f.L[0].type==a.bd};a.ws=P;a.RB=K;a.project_point=function(b,c,d){b=b.f.L[0];switch(b.type){case a.mc:case a.Ue:case a.bd:case a.Kf:case a.xb:case a.Gb:case a.kc:case a.lc:var e=ca;e.set(c);e[3]=1;ka.transformMat4(e,b.re,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;V.bI(d[0],d[1],d,b);2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return B.error("Non-compatible camera"),d}};a.pD=function(a){return a.f.L[0]};a.Oi=function(b,
c){switch(b.type){case a.mc:case a.Ue:case a.xb:case a.Gb:var d=Math.tan(R.xd(b.Jc)/2);switch(c){case "LEFT":return-d*b.Ua;case "RIGHT":return d*b.Ua;case "TOP":return d;case "BOTTOM":return-d}break;case a.bd:case a.Kf:switch(c){case "LEFT":return-b.top*b.Ua;case "RIGHT":return b.top*b.Ua;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.Pg:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;case a.kc:case a.lc:switch(c){case "LEFT":return Math.tan(R.xd(b.Lc[3])/
2);case "RIGHT":return Math.tan(R.xd(b.Lc[1])/2);case "TOP":return Math.tan(R.xd(b.Lc[0])/2);case "BOTTOM":return Math.tan(R.xd(b.Lc[2])/2)}break;default:R.W("Unknown camera type")}};a.aE=function(b){switch(b.type){case a.bd:case a.Kf:case a.Pg:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.mc:case a.Ue:case a.xb:case a.Gb:var d=R.xd(b.Jc);return c?d*b.Ua:d;default:return 0}};a.set_trans_pivot=function(a,b,c){a=a.f;W.set_trans(b,a.h);Y.copy(c,a.Sa)};a.hover_set_vertical_limits=
function(a,b){var c=a.f;c.s=c.s||{};c.s.down=b.down;c.s.up=b.up;E(a);e(a)};a.apply_distance_limits=function(b,c){var d=b.f;c?(d.hb=d.hb||{},d.hb.min=c.min,d.hb.max=c.max,b.f.Qa==a.MS_HOVER_CONTROLS&&e(b)):d.hb=null};a.set_hover_pivot=function(a,b){var c=a.f,d=Y.subtract(b,c.Ka,N),e=W.get_trans_view(c.h),d=Y.add(d,e,d);da.set_translation(a,d);Y.copy(b,c.Ka)};a.eG=function(a,b){var c=a.f,d=Y.subtract(b,c.Sa,N),e=W.get_trans_view(c.h),d=Y.add(d,e,d);da.set_translation(a,d);Y.copy(b,c.Sa)};a.get_eye=
F;a.set_move_style=function(c,e){c.f.Qa=e;c.f.ba=null;c.f.s=null;c.f.hb=null;c.f.bc=null;c.f.tb=null;c.f.L[0].type==a.bd&&b(c);switch(e){case a.MS_HOVER_CONTROLS:d(c);break;case a.MS_TARGET_CONTROLS:var f=F(c,N),h=W.get_quat_view(c.f.h),h=R.quat_to_dir(h,R.AXIS_MY,aa),f=Y.scaleAndAdd(f,h,10,h);Y.copy(f,c.f.Sa)}}};b4w.module.__lights=function(a,p){function d(a){q.scale(a.color,a.hf,a.rk)}p("__print");var b=p("__tsr"),c=p("__util"),q=p("__vec3"),f=new Float32Array(3);new Float32Array(3);a.fE=function(a,l){var n=a.data,g=l.La={name:"",type:n.type,lw:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),rk:new Float32Array(3),gu:0,Zh:0,Al:0,Du:!1,Lv:!1,nu:!1,Pj:!0,ei:!0,hf:1,distance:25,GJ:"INVERSE_SQUARE"};g.name=l.name;g.Pj=n.use_diffuse;g.ei=n.use_specular;var p=b.get_quat_view(l.f.h),
p=c.quat_to_dir(p,c.AXIS_Y,f);q.normalize(p,p);g.direction.set(p);g.color[0]=n.color[0];g.color[1]=n.color[1];g.color[2]=n.color[2];g.hf=g.gu=n.energy;d(g);g.distance=n.distance;if("POINT"===g.type||"SPOT"===g.type)g.distance=n.distance;"SPOT"===g.type?(g.Al=n.spot_blend,g.Zh=n.spot_size):"POINT"===g.type&&(g.Zh=Math.PI/2);g.Du=n.b4w_generate_shadows;g.nu=n.b4w_dynamic_intensity};a.Kw=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];d(a)};a.ZF=function(a,b){a.Al=b};a.YF=function(a,b){a.distance=
b};a.$F=function(a,b){a.Zh=b};a.Mr=function(a,b){a.hf=b;d(a)};a.sH=function(a){if("LAMP"!=a.type)throw"Wrong light object";var d=a.La;if(d){a=b.get_quat_view(a.f.h);c.quat_to_dir(a,c.AXIS_Y,d.direction);q.normalize(d.direction,d.direction);if("SUN"==d.type){a=Math.acos(q.dot(d.lw,c.Xs));var f=Math.acos(q.dot(d.direction,c.Xs));d.Lv=Math.floor(a/.025)!=Math.floor(f/.025)?!0:!1}q.copy(d.direction,d.lw)}}};b4w.module.__scenes=function(a,p){function d(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.te||!c.te.length)return c}return null}function b(){if(!qb)throw"No active scene available";return qb}function c(a,b,c){if(!ta.Ck||!q(a,b,c))return null;c=a.b4w_shadow_settings;var d={};c.csm_resolution>ta.Db?(d.csm_resolution=ta.Db,db.error("Shadow map texture has unsupported size. Changed to "+ta.Db+".")):d.csm_resolution=c.csm_resolution;a=xa.Vm(b,ta.Xc&&a.b4w_enable_ssao);d.self_shadow_polygon_offset=c.self_shadow_polygon_offset;
d.self_shadow_normal_offset=c.self_shadow_normal_offset;d.enable_csm=c.b4w_enable_csm&&1==a.length;d.ie=[];d.cx=[];d.lu=[];for(b=0;b<a.length;b++)d.ie.push(a[b].La.type),d.cx.push(a[b].La.Zh),d.lu.push(a[b].La.distance),"SPOT"!=d.ie[b]&&"POINT"!=d.ie[b]||!d.enable_csm||(db.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),d.enable_csm=!1);d.enable_csm?(d.csm_num=c.csm_num,d.csm_first_cascade_border=c.csm_first_cascade_border,d.first_cascade_blur_radius=c.first_cascade_blur_radius,
d.csm_last_cascade_border=c.csm_last_cascade_border,d.last_cascade_blur_radius=c.last_cascade_blur_radius,d.fade_last_cascade=c.fade_last_cascade,d.blend_between_cascades=c.blend_between_cascades):(d.csm_num=1,d.csm_first_cascade_border=c.csm_first_cascade_border,d.first_cascade_blur_radius=c.first_cascade_blur_radius,d.csm_last_cascade_border=c.csm_last_cascade_border,d.last_cascade_blur_radius=c.last_cascade_blur_radius,d.fade_last_cascade=!1,d.blend_between_cascades=!1);return d}function q(a,b,
c){if(0!=b.length&&ta.vj)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var d=!1,e=!1;a=ta.Xc&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var f=c[b];f.b4w_shadow_cast&&(d=!0);f.b4w_shadow_receive&&(e=!0);if((a||d)&&e)return!0}return!1}function f(a){for(var b=0;b<a.length;b++)if("SUN"==a[b].La.type)return!0;return!1}function t(a){if(!ta.shore_smoothing)return!1;a=la(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}
function l(a){for(var b=0;b<a.length;b++)for(var c=a[b].particle_systems,d=0;d<c.length;d++)if(xa.It(a[b],c[d].settings))return!0;return!1}function n(a){for(var b=la(a),c=[],d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var f={},h=0;h<a.length;h++)for(var g=a[h],k=g.data.materials,m=0;m<k.length;m++)k[m]==e&&(f.Jg=g.location[1]);f.yc=e.b4w_water_fog_color.slice(0);f.yc.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(f.Fk=!0,f.waves_height=e.b4w_waves_height,f.waves_length=e.b4w_waves_length,
f.dst_noise_scale0=e.b4w_water_dst_noise_scale0,f.dst_noise_scale1=e.b4w_water_dst_noise_scale1,f.dst_noise_freq0=e.b4w_water_dst_noise_freq0,f.dst_noise_freq1=e.b4w_water_dst_noise_freq1,f.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,f.dir_freq=e.b4w_water_dir_freq,f.dir_noise_scale=e.b4w_water_dir_noise_scale,f.dir_noise_freq=e.b4w_water_dir_noise_freq,f.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,f.dst_min_fac=e.b4w_water_dst_min_fac,f.waves_hor_fac=e.b4w_water_waves_hor_fac):(f.Fk=!1,f.waves_height=
0,f.waves_length=0);f.af=e.b4w_water_enable_caust;f.JA=e.b4w_water_caust_scale;f.IA=e.b4w_water_caust_brightness;f.KA=new Float32Array([.3,.7]);f.Vn=null;e=e.texture_slots;for(h=0;h<e.length;h++)g=e[h].texture,!0===g.b4w_shore_dist_map&&(f.Vn=g.image,f.xj=g.image.size[0],f.pG=g.b4w_shore_boundings,f.cj=g.b4w_max_shore_dist);c.push(f)}}if(0<c.length){f=c[0];if(!f.Fk)for(d=0;d<c.length;d++)c[d].Fk&&(f=c[d]);return f}return null}function g(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=
a[d];"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.Dc=!0)}}}var c={Dc:!1};a=la(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.Dc=!0);e.node_tree&&b(e.node_tree)}return c}function z(a,b){if(ta.pl)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;for(var c=[],d=0,e=0;e<b.length;e++){var f=b[e];f.f.Rc&&"CUBE"==f.f.Ke&&d++;if(f.ql.length){for(var h=null,g=0;g<c.length;g++)if(c[g]==f){h=g;break}null==h&&
c.push(f)}}return{zw:c,Tv:d,Sf:[],Je:[]}}function h(a,b){var c=a.b4w_sky_settings,d={};d.AF=c.render_sky;d.procedural_skydome=c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;d.yj=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=c.scatter_strength;d.rayleigh_strength=c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=c.rayleigh_collection_power;
d.mie_collection_power=c.mie_collection_power;d.mie_distribution=c.mie_distribution;d.Cc=c.reflexible;d.tc=c.reflexible_only;!b&&c.procedural_skydome&&db.warn("There is no sun on the scene. Procedural sky won't be rendered");return d}function k(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.MD=a.hemisphere;b.yA=a.blur_depth;b.vt=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.LF=a.samples;return b}function u(a){if(!(ta.pm&&a.b4w_enable_bloom&&a.k.$h))return null;
var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.jC=a.edge_lum;b.key=a.key;return b}function w(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;return b}function C(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function E(a){var b={};a=a.b4w_god_rays_settings;b.Eq=a.intensity;b.bj=a.max_ray_length;b.Gj=a.steps_per_pass;return b}
function G(a){var b={};b.uf=a.b4w_outline_color;b.el=a.b4w_outline_factor;return b}function m(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}function x(a,b){var c=a.light_settings,d={};d.Yf=c.environment_energy;d.As=c.use_environment_light;d.Wp=c.environment_color;d.ag=a.horizon_color.slice(0);d.Mg=a.zenith_color.slice(0);
d.TH=a.use_sky_paper;d.SH=a.use_sky_blend;d.UH=a.use_sky_real;d.Xw=null;d.Vr=null;d.Xp=null;if(d.As&&"SKY_TEXTURE"==d.Wp&&(!b.procedural_skydome||!b.use_as_environment_lighting)){for(var c=null,e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_environment_lighting){c=a.texture_slots[e];break}c?d.Xp=c:(db.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),d.As=!1)}for(e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_skydome){c=
a.texture_slots[e];d.Xw=c;d.Vr={vA:c.blend_factor,ND:c.horizon_factor,kI:c.zenith_up_factor,jI:c.zenith_down_factor,color:c.color,Oa:c.default_value,invert:c.invert,RH:c.use_rgb_to_intensity,wA:c.blend_type,NH:c.use_map_blend,OH:c.use_map_horizon,QH:c.use_map_zenith_up,PH:c.use_map_zenith_down};break}return d}function A(a){var b=a.fog_settings,c={};c.JH=b.use_fog;c.Eq=b.intensity;c.depth=b.depth;c.start=b.start;c.height=b.height;c.yC=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);
a=c.color;c.yc=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.Rm=new Float32Array([c.Eq,c.depth,c.start,c.height]);return c}function r(a){if(!ta.$b)return!1;for(var b=!1,c=!1,d=0;d<a.length;d++){for(var e=a[d],f=e.data.materials,h=0;h<f.length;h++)f[h].b4w_terrain&&(b=!0);e=e.particle_systems;for(h=0;h<e.length;h++)f=e[h].settings,"HAIR"==f.type&&f.b4w_dynamic_grass&&(c=!0);if(b&&c)return!0}return!1}function e(a,b){if(Wc.outlining_overview_mode)return!0;if(ta.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;
case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].oa.f.yf)return!0;return!1}else return!1}function v(a,b){if(Wc.outlining_overview_mode)return!0;if(ta.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].oa.f.Jb)return!0;return!1}else return!1}function J(a,b){if(ta.nf)switch(a.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,
e=0;e<d.length;e++)if(Ba.Ht(d[e]))return!0;return!1}else return!1}function D(a,b){if(ta.Dc)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.Dc}else return!1}function H(a){for(var b=0;b<a.length;b++)for(var c=a[b].data.materials,d=0;d<c.length;d++){var e=c[d],f=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f)return!0}return!1}function I(a,b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=
0;c<b.length;c++){var d=b[c].oa;if(d.anchor&&d.anchor.Ai)return!0}return!1}}function P(a,b,c){var d=oa.Ie(a,b);oa.pe(a,d,function(a,b,d){if(d.zb){switch(d.from){case "COLOR":case "CUBEMAP":a=b.j.Hb;break;case "DEPTH":a=b.j.Ld;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";
if(a.Gd)throw"Batch texture can't use renderbuffer";ia.Kt(c.dc,d.to)&&S.si(c,a,d.to)}}});for(a=0;a<b.la.length;a++){var d=b.la[a],e=b.Pe[a];switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":break;default:if(e.Gd)throw"Batch texture can't use renderbuffer";ia.Kt(c.dc,d.to)&&S.si(c,e,d.to)}}}function K(a,b){return{Ib:!0,Sp:[!0,!0,!0,!0,!0,!0],ke:a,G:b}}function y(a,b,c,d,e,f){function h(a,b){return a==b?0:a>b?1:-1}for(var g=b.f,
k=xa.Pa(b,e).T,m=0;m<k.length;m++){var l=k[m];l.Vc||l.tc||"MAIN"!=l.type&&"NODES_GLOW"!=l.type&&"PARTICLES"!=l.type&&"LINE"!=l.type||!("OPAQUE"==l.fb&&"OPAQUE"==d||"BLEND"==l.fb&&"BLEND"==d||"XRAY"==l.fb&&"XRAY"==d||"NODES_GLOW"==l.type&&"GLOW"==d)||(f||(F(l,a,b,c,d,e),S.Sb(l),M(l)),a.q.push(K(g,l)),P(c,a,l),O(l))}a.q.sort(function(a,b){return a.G&&b.G?-h(a.G.Za,b.G.Za)||-h(a.G.Tg,b.G.Tg)||h(a.G.Ih,b.G.Ih):0})}function F(a,b,c,d,e,f){var h=c.f,g=xa.Pa(c,f),k="NO_SHADOWS";c=aa(f,["SHADOW_CAST"]);if(c.length&&
a.wc){switch(e){case "OPAQUE":k="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":k="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":k="NO_SHADOWS";break;case "DEPTH":k="SHADOW_MASK_GENERATION";break;default:throw"Wrong subscene type";}for(var m=0;m<c.length;m++)S.mt(a,f.k.hc)}c=a.wb;ia.K(c,"SHADOW_USAGE",k);a.$b&&(m=ja.qb(d,"GRASS_MAP"))&&V(a,m,h);if("DEPTH"!=a.type&&"COLOR_ID"!=e||a.Ui){m=b.yn;ia.K(c,"NUM_LIGHTS",m);ia.K(c,"NUM_LFACTORS",0==m%2?m/2:Math.floor(m/2)+1);
ia.K(c,"REFLECTION_PASS",0);ia.K(c,"SSAO_ONLY",0);ia.K(c,"INVERT_FRONTFACING",0);b.Lb&&b.se?ia.K(c,"WATER_EFFECTS",1):ia.K(c,"WATER_EFFECTS",0);if(b.Lb&&b.af&&h.af){ia.K(c,"CAUSTICS",1);if(m=f.k.hc){h=m.ie;for(m=e=0;m<h.length;m++)"SUN"==h[m]&&(e=m);ia.K(c,"SUN_NUM",e)}ia.K(c,"CAUST_SCALE",ia.t(b.Ct));ia.K(c,"CAUST_SPEED",ia.t(b.Dt,2));ia.K(c,"CAUST_BRIGHT",ia.t(b.Bt))}else ia.K(c,"CAUSTICS",0);b.Lb&&(ia.K(c,"WAVES_HEIGHT",ia.t(b.Kg)),ia.K(c,"WAVES_LENGTH",ia.t(b.mi)),ia.K(c,"WATER_LEVEL",ia.t(b.Jg)));
m=g.Sf;h=g.Je;if(-1!==a.ic.indexOf("u_mirrormap"))ia.K(c,"REFLECTION_TYPE","REFL_MIRRORMAP");else if(a.Rc&&m)g=m.j.Hb,S.si(a,g,"u_cube_reflection"),ia.K(c,"REFLECTION_TYPE","REFL_CUBE");else if(a.Rc&&h.length)for(m=0;m<h.length;m++)g=h[m].j.Hb,S.si(a,g,"u_plane_reflection"),ia.K(c,"REFLECTION_TYPE","REFL_PLANE");else ia.K(c,"REFLECTION_TYPE","REFL_NONE");(m=ja.qb(d,"SKY"))?a.ow?(g=m.j.Hb,S.si(a,g,"u_sky")):ta.Jn?(a.hd=m.hd,ia.K(c,"PROCEDURAL_FOG",1)):ia.K(c,"PROCEDURAL_FOG",0):ia.K(c,"PROCEDURAL_FOG",
0);g=f.k.Ks;g.As&&(ia.K(c,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==g.Wp?(g=g.Xp?S.fD(g.Xp,!1):m.j.Hb,ia.K(c,"SKY_TEXTURE",1),S.si(a,g,"u_sky_texture")):"SKY_COLOR"==g.Wp&&ia.K(c,"SKY_COLOR",1));g=f.k.gy;g.JH&&(ia.K(c,"USE_FOG",1),ia.K(c,"FOG_TYPE",g.yC));a.wr?(ta.Ck&&ia.K(c,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.Ui||"NODES_GLOW"==a.type?(ia.K(c,"REFRACTIVE",1),f.k.Dc?ia.K(c,"USE_REFRACTION",1):ia.K(c,"USE_REFRACTION",0)):f.k.Dc?ia.K(c,"REFRACTIVE",1):ia.K(c,"REFRACTIVE",0)):(ia.K(c,"REFRACTIVE",
0),ia.K(c,"USE_REFRACTION",0),ia.K(c,"USE_REFRACTION_CORRECTION",0));a.Ig&&(ta.shore_smoothing&&a.Ao&&ja.qb(d,"DEPTH_PACK")?ia.K(c,"SHORE_SMOOTHING",1):ia.K(c,"SHORE_SMOOTHING",0),a.water_dynamic&&b.Lb&&b.Kg?ia.K(c,"DYNAMIC",1):ia.K(c,"DYNAMIC",0));"PARTICLES"==a.type&&(ia.K(c,"SIZE_RAMP_LENGTH",a.Da.Sw),ia.K(c,"COLOR_RAMP_LENGTH",a.Da.Qt));if(!a.nh)for(a=a.U,b=0;b<a.length;b++)if(g=a[b],"SCENE"==g.source)for(d=0;d<Ga.length;d++)for(c=Ga[d],m=Ga[d].te,h=0;h<m.length;h++)m[h].k==g&&oa.m(Hb,c,f,null)}}
function M(a){var b=a.dc.attributes,c=a.O.Eb,d;for(d in b)c[d]||Ca.W('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=ia.CD(a.dc.Gs),10<b&&("MAIN"==a.type&&db.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.rd.join(", ")+'"'),"MAIN"==a.type&&a.Ui||"NODES_GLOW"==a.type))d=c=0,a.gi&&(c=Ca.Sk(a.gi)),a.Yb&&(d=Ca.Sk(a.Yb)),db.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.rd.join(", ")+'"')}function O(a){8<
a.U.length&&db.warn(a.type,"too many textures used - "+a.U.length+' (max 8), materials "'+a.rd.join(", ")+'"')}function V(a,b,c){a.Kc=b.Kc;var d=b.Kc[0],e=b.Kc[1],f=b.Kc[2];c=c.Zb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.Kc[2]=f;b=b.j;Ia.Tn(b,f/2,-e,-d,f/2);Ia.zf(b);d=a.rq||0;d=0==d?c:Math.max(d,c);a.rq=d}function T(a){ea(a);var b=X(a,"MAIN_OPAQUE"),c=!0,d=a.k.hc;oa.aa(a.k.ib,function(e,f){"SHADOW_CAST"===f.type&&(B(f,a,b.j,f.q,d,c),c=!1)})}function U(a){oa.aa(a.k.ib,function(a,
b){"OUTLINE"===b.type&&(b.Tp=1)})}function B(a,b,c,d,e,f){if(0!=d.length){var h=a.j,g=mb.Ri(c.h,Gc);mb.set_trans(g,h.h);mb.copy(c.$d,h.Qr);if("SUN"===e.ie[a.ne]||"HEMI"===e.ie[a.ne]){g=$b;L.$c(g);for(var k=0;k<d.length;k++){var m=d[k].ke;0==k?L.zm(m.Ab,g):L.ou(g,m.Ab)}d=L.uC(g,Na);Ca.sj(d,h.Ta,d);if(e.enable_csm){b=Za.copy(c.xk[a.Ep],Gc);e=na.invert(c.Ta,ab);Ca.sj(b,e,b);Ca.sj(b,h.Ta,b);a=c.Fp[a.Ep];if(f)for(Oa=0,Ma=-Infinity,f=2;f<d.length;f+=3)Oa=Math.min(Oa,d[f]),Ma=Math.max(Ma,d[f]);f=$b;f.max_x=
b[0]+a;f.max_y=b[1]+a;f.max_z=Ma;f.min_x=b[0]-a;f.min_y=b[1]-a;f.min_z=Oa}else{c=f=$b;e=ib;e.set(d);d=zc/9;g=na.identity(ab);na.rotate(g,d,Ca.AXIS_MZ,g);for(var m=k=-1,l=0;10>l;l++){var n=L.tA(e,jb),q=(n.max_x-n.min_x)*(n.max_y-n.min_y);if(-1==k||q<k)k=q,m=l,L.zm(n,c);Ca.sj(e,g,e)}c=m*d;0<c&&(d=na.identity(ab),na.rotate(d,c,Ca.AXIS_MZ,d),na.multiply(d,h.Ta,h.Ta),mb.from_mat4(h.Ta,h.$d));c=f.max_x-f.min_x;d=f.max_y-f.min_y;c&&d&&(e=Math.abs(c-d)/2,2<c/d?(f.max_y+=e,f.min_y-=e):2<d/c&&(f.max_x+=e,f.min_x-=
e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005;ha(a,b.k.ib)}Ia.VF(h,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);Ia.zf(h);Ca.Om(h.re,h.Ok)}else"SPOT"!==e.ie[a.ne]&&"POINT"!==e.ie[a.ne]||Ia.zf(h,h.Ua)}}function ha(a,b){for(var c=a.j,d=ja.vD(b,a),e=0;e<d.length;e++){var f=d[e];if("MAIN_OPAQUE"==f.type||"DEPTH"==f.type||"MAIN_BLEND"==f.type||"MAIN_XRAY"==f.type)if(ta.qn)f.Cs.set(c.$d,9*a.ne);else{var h=mb.get_trans_view(c.$d),g=mb.get_scale(c.$d),k=mb.get_quat_view(c.$d);
Qc.set(h[0],h[1],h[2],g,kb);f.vo.set(kb,4*a.ne);f.uo.set(k,4*a.ne)}}}function ba(a,b,c,d,e){for(var f=b.f,h=xa.Pa(b,d).T,g=0;g<h.length;g++){var k=h[g];"COLOR_ID"==k.type&&(e||(F(k,a,b,c,"COLOR_ID",d),S.Sb(k),M(k)),"COLOR_PICKING"==a.type&&"COLOR_ID"==k.fb||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==k.fb)&&(e||(S.Aa(k,"USE_OUTLINE",0),S.Sb(k),M(k)),a.q.push(K(f,k)))}}function da(a,b,c,d,e){d||(e.$b&&(d=ja.qb(c,"GRASS_MAP"))&&V(e,d,b),S.Sb(e),M(e));a.q.push(K(b,e));P(c,a,e);O(e)}function W(a,b){R(a,
b);for(var c=0;c<a.J.length;c++)for(var d=Bb.Ia(a.J[c].Ea,"ALL",-1),e=0;e<d.length;e++)d[e].parent==a&&W(d[e],b)}function R(a,b){a.f.rh=b;if(xa.is_lamp(a))for(var c=0;c<a.J.length;c++)for(var d=a.J[c],e=aa(d.Ea,Zb),f=0;f<e.length;f++)ka(a,d,e[f])}function Y(a,b){for(var c=aa(b,Zb),d=a.La,e=a.f,f=xa.Pa(a,b),h=f.xh,g=mb.get_trans_view(e.h),e=mb.get_quat_view(e.h),k=0;k<c.length;k++){var m=c[k];m.nn.set(g,3*h);m.Qq.set(d.direction,3*h);m.mn.set(d.rk,3*h);switch(d.type){case "SUN":m.nx.set(e);m.mx=d.rk;
"SKY"===m.type?(m.wn=d.Lv,Za.copy(d.direction,m.gs),ma(b,m)):Za.copy(d.direction,m.gs);break;case "HEMI":case "POINT":case "SPOT":break;default:db.error("Unknown light type: "+d.type+'".')}ka(a,f,m);for(var l=0;l<m.q.length;l++){var n=m.q[l].G;n.$i&&S.XF(n,a)}}c=X(b,"MAIN_OPAQUE").j;f=f.Rr;d=b.k.hc;for(k=0;k<f.length;k++)m=f[k],Ia.Or(m.j,g,e),B(m,b,c,m.q,d,!0),ha(m,b.k.ib)}function ka(a,b,c){var d=a.f;a=a.La;b=b.xh;var e=Ac;e[0]=a.Pj&&!d.rh?1:0;e[1]=a.ei&&!d.rh?1:0;c.Rq.set(e,2*b);c.sa=!0}function ea(a){var b=
Bb.Ia(a,"LAMP",Bb.DATA_ID_ALL),b=xa.Vm(b,ta.Xc&&a.b4w_enable_ssao);if(b.length)for(var c=0;c<b.length;c++)for(var d=b[c],e=d.f,f=mb.Ri(e.h,Gc),e=mb.Ou(e.h,Xc),h=0;h<d.J.length;h++){var g=d.J[h],k=g.Rr;if(g.Ea==a)for(g=0;g<k.length;g++)Ia.Or(k[g].j,f,e)}}function ma(a,b){xb.Di(b);if(b.wn)for(var c=aa(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var e=c[d].q,f=0;f<e.length;f++){var h=e[f];h.Ib&&(h=h.G,S.NA(h)&&xb.gH(h))}}function la(a){for(var b=[],c=0;c<a.length;c++)for(var d=
a[c].data,e=0;e<d.materials.length;e++){var f=d.materials[e];-1==b.indexOf(f)&&b.push(f)}return b}function N(a,b,c){for(var d=a.k,e=a.Qg.f.L,f=0;f<e.length;f++){var h=e[f];Ia.zf(h,b/c);d.hc&&Ia.ws(h,d.hc)}d.hc&&(d.xn=!0,X(a,"DEPTH").sa=!0,X(a,"MAIN_BLEND").sa=!0);var g=d.ib;ja.XG(g,function(d,e,f){if(d.Fl){var h=d.Wh*b,k=d.vl*c;if(e)for(e=0;e<f.la.length;e++)f.la[e]==d&&hb.resize(d.va,h,k);else switch(hb.Zi(d.va)&&hb.resize(d.va,h,k),d=f.j,d.width=h,d.height=k,f.type){case "DOF":Q(a,{dof_power:f.j.dof_power,
dof_on:f.j.dof_on});break;case "GLOW_COMBINE":ca(a,{small_glow_mask_width:f.small_glow_mask_width,large_glow_mask_width:f.large_glow_mask_width});break;case "BLOOM":sa(a,{bloom_blur:f.bloom_blur});break;case "OUTLINE":f=ja.$a(g,f,"POSTPROCESSING");h=ja.$a(g,f,"POSTPROCESSING");k=ja.$a(g,h,"POSTPROCESSING");d=ja.$a(g,k,"POSTPROCESSING");ja.zd(f,1/b,1/c);ja.zd(h,1/b,1/c);ja.zd(k,1/b,1/c);ja.zd(d,1/b,1/c);break;default:ja.zd(f,1/b,1/c)}}})}function aa(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];
oa.aa(a.k.ib,function(a,b){b.type==e&&c.push(b)})}return c}function X(a,b){return ja.qb(a.k.ib,b)}function Q(a,b){var c=X(a,"DOF");if(!c)return db.error("DOF is not enabled on the scene. Check camera settings"),0;var d=a.k.ib;"boolean"==typeof b.dof_on&&(c.j.dof_on=b.dof_on);"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=
b.dof_power;var e=ja.$a(d,c,"POSTPROCESSING"),d=ja.$a(d,e,"POSTPROCESSING");ja.vc(e,c.j.dof_power);ja.zd(e,1/c.j.width,1/c.j.height);ja.vc(d,c.j.dof_power);ja.zd(d,1/c.j.width,1/c.j.height)}}function sa(a,b){var c=X(a,"LUMINANCE_TRUNCED"),d=X(a,"BLOOM");if(!c||!d)return db.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.sa=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.sa=!0);if("number"==typeof b.bloom_blur){var e=
a.k.ib,c=ja.$a(e,d,"BLOOM_BLUR"),e=ja.$a(e,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;ja.vc(c,b.bloom_blur);ja.zd(c,1/d.j.width,1/d.j.height);ja.vc(e,b.bloom_blur);ja.zd(e,1/d.j.width,1/d.j.height)}}function ca(a,b){var c=X(a,"GLOW_COMBINE");if(!c)return db.error("Glow is not enabled on the scene"),null;for(var d=a.k.ib,e=ja.tD(d,c),f=0;f<e.length;++f){var h=e[f];if("POSTPROCESSING"===h.type&&"GLOW_MASK_LARGE"===h.fb)var g=h;if("POSTPROCESSING"===h.type&&"GLOW_MASK_SMALL"===h.fb)var k=h}e=ja.$a(d,
g,"POSTPROCESSING");d=ja.$a(d,k,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.sa=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=b.large_glow_mask_coeff,c.sa=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ja.vc(k,b.small_glow_mask_width),ja.zd(k,1/c.j.width,1/c.j.height),k.sa=!0,ja.vc(d,b.small_glow_mask_width),ja.zd(d,1/c.j.width,1/c.j.height),d.sa=!0);"number"==
typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,ja.vc(g,b.large_glow_mask_width),ja.zd(g,1/c.j.width,1/c.j.height),g.sa=!0,ja.vc(e,b.large_glow_mask_width),ja.zd(e,1/c.j.width,1/c.j.height),e.sa=!0)}function Ea(a,b){var c=X(qb,"MAIN_OPAQUE");if(!c||!c.Lb)return db.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.Kg,e=c.mi,f=c.Jg,h=c.Lb;if(!d||!h.Fk)return h.Jg;var g=Za.length(c.Ff),k=c.time;g&&(k*=g);var m=Ac;m[0]=20/e*(a-.25*k);m[1]=
20/e*(b-.25*k);g=Ca.Et(m);m[0]=17/e*(b+.1*k);m[1]=17/e*(a+.1*k);var m=Ca.Et(m),g=g+m-1,l=h.dst_noise_scale0,m=h.dst_noise_scale1,n=h.dst_noise_freq0,q=h.dst_noise_freq1,r=Ac;r[0]=l*(a+n*k);r[1]=l*(b+n*k);l=Ca.Wr(r);r[0]=m*(b-q*k);r[1]=m*(a-q*k);m=Ca.Wr(r);m*=d*l;if(c.ro)if(q=(a-c.vg[0])/c.wg[0],r=(c.vg[1]+b)/c.wg[1],q+=.5,r+=.5,1<q||0>q||1<r||0>r)d=m;else var q=Ca.Fu(qb.k.Sr,c.xj,q,r),l=h.dir_freq,t=h.dir_noise_scale,u=h.dir_noise_freq,n=h.dir_min_noise_fac,r=h.dst_min_fac,c=e/c.cj/Math.PI,t=[t/e*
(a+u*k),t/e*(b+u*k)],e=Math.sqrt(q),d=d*Math.max(q,h.dir_min_shore_fac)*Math.sin(e/c+l*k)*Math.max(Ca.Wr(t),n),h=Math.max(e,r),d=d*(1-h)+m*h,g=g*q;else d=m;return f+(d+.05*g)}function ga(a,b){a.Xk&&"POSTPROCESSING"==a.type&&b.Ib!=a.Ib&&(a.Ib=b.Ib);b.Ib||"OUTLINE"!=a.type||(a.Tp=0)}function ua(a,b,c,d){var e=oa.Ba(a,b);Ia.Sn(e.j,c,d);e.Uo=!0;oa.Bg(a,b,function(b,e,f){f.zb&&f.from==c&&ja.XA(f)&&Aa(a,b,f.to,d)});oa.pe(a,b,function(b,e,f){f.zb&&f.from==c&&f.from==f.to&&ua(a,b,c,d)})}function Aa(a,b,c,
d){a=oa.Ba(a,b).q;for(b=0;b<a.length;b++)S.EF(a[b].G,d,c)}function qa(a){var b=X(a,"GRASS_MAP");if(b){var c=b.j,d=a.Qg.f;a=mb.get_trans_view(d.h);var e=Gc;e[0]=0;e[1]=-b.Kc[2]/2;e[2]=0;b=mb.get_quat_view(d.h);Za.transformQuat(e,b,e);e[0]+=a[0];e[1]=0;e[2]+=a[2];b=Xc;b[0]=0;b[1]=0;b[2]=0;b[3]=1;Ia.Or(c,e,b)}}function fa(a,b){oa.aa(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.la[0]||!d.Pe[0])throw"Wrong MOTION_BLUR subscene";var e=d.la[0],f=d.Pe[0];d.Pe[0]=d.j.Hb;oa.Bg(a,c,function(b,c,d){d.zb&&
Aa(a,b,d.to,f)});ua(a,c,e.from,f);Aa(a,c,e.to,d.Pe[0]);d.Kv=Math.exp(-b/d.mb_factor)}})}function pa(a){return a.k.Ff}var S=p("__batch"),L=p("__boundings"),Ia=p("__camera");p("__compat");var Z=p("__config"),ya=p("__container");p("__constraints");var ra=p("__debug"),Ja=p("__geometry"),oa=p("__graph"),Fb=p("__hud");p("__lights");var na=p("__mat4"),Ba=p("__nodemat"),Bb=p("__objects"),xa=p("__obj_util"),Yb=p("__physics"),fc=p("__prerender"),Tb=p("__primitives"),db=p("__print"),xb=p("__renderer"),ja=p("__scenegraph"),
Mc=p("__sfx"),ia=p("__shaders"),hb=p("__textures"),mb=p("__tsr"),Ca=p("__util"),Za=p("__vec3"),Qc=p("__vec4"),ta=Z.p,Wc=Z.Jb,Gb=Z.tj,Ub="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.HI=Ub;var Zb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED DEPTH SHADOW_CAST COLOR_PICKING COLOR_PICKING_XRAY OUTLINE_MASK".split(" "),
dd="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Vc="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),Nc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),rc=null,qb=null,Ga=[],Hb=null,zc=Math.PI/2,Ac=new Float32Array(2),Gc=new Float32Array(3),Xc=new Float32Array(4),kb=new Float32Array(4),
ab=new Float32Array(16),Na=new Float32Array(24),ib=new Float32Array(24),$b=L.$c(),jb=L.$c(),Oa=0,Ma=-Infinity;a.uJ=function(){return{}};a.set_active=function(a){qb=a;Mc.RF(a)};a.qF=function(a,b){var c=a.k,d=ja.DB(c.ib);if(a==b){N(a,ya.ED(),ya.DD());for(var e=0;e<d.length;e++)a.k.Rh.push(d[e])}else for(e=a.te[0],N(a,e.k.Xh,e.k.Xh),e=0;e<d.length;e++)b.k.Rh.push(d[e]);d=aa(a,Vc);for(e=0;e<d.length;e++)d[e].Ff.set(c.Ff);for(e=0;e<c.Rh.length;e++)"SHADOW_CAST"==c.Rh[e].type&&xb.Di(c.Rh[e])};a.Qi=function(){rc||
(rc=d(Ga));return rc};a.Pm=d;a.get_active=b;a.ma=function(){return qb?!0:!1};a.Ni=function(a){return a.Qg};a.Mi=function(){return Ga};a.Pu=function(){if(1==Ga.length)return Ga;for(var a=0;a<Ga.length;a++){var b=Ga[a].k.ib;oa.aa(b,function(b,c){for(var d=0;d<c.q.length;d++){for(var e=c.q[d].G.U,f=null,h=0;h<e.length;h++)if("SCENE"==e[h].source&&e[h].Xr==Ga[a].name&&"COPY"!=c.type){db.error('Texture-scene loop detected. A scene is rendered to texture "'+e[h].name+'" yet this texture belongs to the same scene.');
oa.Ie(Hb,Ga[a]);f=c.q[d].G;break}f&&(f.U=[],f.ic=[],S.fH(f,null),S.Sb(f))}})}for(var c=[],a=0;a<Ga.length;a++)if(b=Ga[a],!b.te.length){b=oa.Ie(Hb,b);oa.nC(Hb,b);b=oa.ao(Hb,b,oa.Tl);b=oa.ss(b);oa.aa(b,function(a,b){c.push(b)});break}return c};a.Sz=function(a,b,d,q,S){a.te=a.te||[];a.S=null;var p=a.k,ra=a.Qg.f;p.Sj=[];var L=a.world;p.gE=d.length;p.$h=f(d);p.Yn=h(L,p.$h);p.Ks=x(L,p.Yn);p.gy=A(L);p.Kz=I(a,S);ra.L[0].type!=Ia.mc&&"HMD"==ta.stereo?(db.warn("Head-mounted display stereo is disabled for the non-perspective camera"),
S=!1):S="HMD"==ta.stereo;p.ev=S;ra.L[0].type!=Ia.mc&&"ANAGLYPH"==ta.stereo?(db.warn("Anaglyph stereo is disabled for the non-perspective camera"),S=!1):S="ANAGLYPH"==ta.stereo;p.anaglyph_use=S;p.rg=z(a,b);p.xA=u(a);p.PE=w(a);p.LA=C(a);p.GD=E(a);p.cF=G(a);p.$f=m(a);p.Ci=ta.Ci&&(0<ra.dof_distance||ra.ld);p.Fh=ta.Fh&&a.b4w_enable_motion_blur;p.xi=ta.xi&&a.b4w_enable_color_correction;p.antialiasing=ta.antialiasing&&1==ta.Ac&&"NONE"!=a.b4w_antialiasing_quality;p.Xc=ta.Xc&&a.b4w_enable_ssao;p.Si=ta.Si&&
a.b4w_enable_god_rays&&p.$h;p.cC=ta.Ck;p.Wm=a.b4w_glow_settings.render_glow_over_blend;p.GG=k(a);S=g(q);p.LE=S;p.Dc=D(a,S);p.hc=c(a,d,q);p.Lb=n(q);p.Hf=H(q);p.sG=l(q);p.shore_smoothing=t(q);p.$b=r(q);p.eB=e(a,q);p.outline=v(a,q);p.nf=J(a,q);switch(a.b4w_reflection_quality){case "LOW":p.fh=Gb.$t;p.Oh=Gb.fw;break;case "MEDIUM":p.fh=Gb.TB;p.Oh=Gb.mF;break;case "HIGH":p.fh=Gb.SB;p.Oh=Gb.lF;break;default:p.fh=Gb.$t,p.Oh=Gb.fw}if(ya.XD())db.log("%cENABLE HIDPI MODE","color: #00a"),p.bt="AA_QUALITY_LOW",
p.Tc=1,ta.Ac=1;else if(1<ta.Ac)db.log("%cENABLE MSAA RENDERING: "+ta.Ac+"x","color: #00a"),p.Tc=1;else{p.bt="AA_QUALITY_"+a.b4w_antialiasing_quality;switch(a.b4w_antialiasing_quality){case "LOW":p.antialiasing&&(p.Tc=1);break;case "MEDIUM":ta.quality==Z.P_LOW||ta.quality==Z.P_HIGH?p.Tc=1:ta.quality==Z.P_ULTRA&&(p.Tc=1.33);break;case "HIGH":ta.quality==Z.P_LOW?p.Tc=1:ta.quality==Z.P_HIGH?p.Tc=1.33:ta.quality==Z.P_ULTRA&&(p.Tc=2);break;case "NONE":ta.quality==Z.P_LOW||ta.quality==Z.P_HIGH?p.Tc=1:ta.quality==
Z.P_ULTRA&&(p.Tc=2)}ta.quality==Z.P_CUSTOM&&(p.Tc=1)}d=a.te.sort(function(a,b){return b.k.Xh-a.k.Xh});p.ib=ja.CB(p,ra,d);p.Rh=[];p.xn=!1;p.br=!1;p.cr=!1;p.Ff=new Float32Array(3);Ga.push(a);Hb||(Hb=oa.create());oa.u(Hb,a);for(p=0;p<b.length;p++)xa.Gr(b[p],!0,a);a=ya.get_container();ya.resize(a.clientWidth,a.clientHeight,!0)};a.Tz=function(a,b,c){for(var d=0;d<b.length;d++)b[d].k&&b[d].k.Zk&&(b[d].k.Ef=c,a.k.Sj.push(b[d]))};a.Lu=function(a){return a.k.ib};a.Bu=function(a){oa.aa(a,function(b,c){var d=
null;switch(c.type){case "POSTPROCESSING":d=S.Dp(c.In);break;case "SSAO":d=S.JB(c);break;case "SSAO_BLUR":d=S.KB(c);break;case "DEPTH_PACK":d=S.oB();break;case "GOD_RAYS":ja.$a(a,c,"RESOLVE")||ja.$a(a,c,"WIREFRAME")||ja.$a(a,c,"MAIN_BLEND")||ja.$a(a,c,"GOD_RAYS");d=S.sB(c.aw,c.Ig,c.Gj);break;case "GOD_RAYS_COMBINE":ja.$a(a,c,"RESOLVE")||ja.$a(a,c,"WIREFRAME")||ja.$a(a,c,"MAIN_BLEND");ja.$a(a,c,"GOD_RAYS");d=S.tB();break;case "MOTION_BLUR":d=S.xB();break;case "DOF":var d=S.pB(),e=ja.$a(a,c,"POSTPROCESSING"),
f=ja.$a(a,e,"POSTPROCESSING");ja.vc(e,c.j.dof_power);ja.vc(f,c.j.dof_power);break;case "OUTLINE":var d=S.yB(),e=ja.$a(a,c,"POSTPROCESSING"),f=ja.$a(a,e,"POSTPROCESSING"),h=ja.$a(a,f,"POSTPROCESSING"),g=ja.$a(a,h,"POSTPROCESSING");ja.vc(f,c.cp);ja.vc(e,c.cp);ja.vc(g,c.$p*c.el);ja.vc(h,c.$p*c.el);break;case "GLOW_COMBINE":d=S.rB();break;case "COMPOSITING":d=S.mB();break;case "ANTIALIASING":d=S.iB(c);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=
S.HB(c.type);break;case "STEREO":d=S.LB(c.fb);break;case "SKY":d=S.BB();break;case "LUMINANCE":d=S.uB();break;case "AVERAGE_LUMINANCE":d=S.jB();break;case "LUMINANCE_TRUNCED":d=S.vB();break;case "BLOOM_BLUR":d=S.kB();break;case "BLOOM":d=ja.$a(a,c,"BLOOM_BLUR");e=ja.$a(a,d,"BLOOM_BLUR");ja.vc(d,c.bloom_blur);ja.vc(e,c.bloom_blur);d=S.lB();break;case "VELOCITY":d=S.OB();break;case "ANCHOR_VISIBILITY":d=S.hB();break;case "PERFORMANCE":d=S.zB()}d&&(e=K(xa.zi("NONE"),d),M(d),c.q.push(e),P(a,c,d),O(d))})};
a.append_object=function(a,b,c){switch(b.type){case "MESH":case "LINE":var d=a.k.ib,e=b.f;!ja.qb(d,"SHADOW_CAST")&&e.wc&&(e.wc=!1);var f=aa(a,Ub);c&&b.di&&Yb.append_object(b,a);for(e=0;e<f.length;e++){var h=f[e],g=b,k=d,m=a,l=c;switch(h.type){case "MAIN_OPAQUE":y(h,g,k,"OPAQUE",m,l);break;case "MAIN_BLEND":y(h,g,k,"BLEND",m,l);break;case "MAIN_XRAY":y(h,g,k,"XRAY",m,l);break;case "MAIN_GLOW":y(h,g,k,"GLOW",m,l);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var n=g.f,q=xa.Pa(g,m).T,
r=0;r<q.length;r++){var t=q[r];if(("MAIN"==t.type||"PARTICLES"==t.type||"LINE"==t.type)&&"REFLECT"==t.fb){if("MAIN_PLANE_REFLECT"==h.type){var p;a:{p=m.k.rg.Je;for(var u=0;u<p.length;u++)for(var ra=0;ra<p[u].length;ra++)if(p[u][ra]==h){p=u;break a}p=null}if(p==n.vd)continue}else{a:{if(m.k.rg)for(p=m.k.rg.Sf,u=0;u<p.length;u++)if(p[u]==h){p=u;break a}p=null}if(p==n.Kd)continue}l||(F(t,h,g,k,"REFLECT",m),p=t.wb,ia.K(p,"WATER_EFFECTS",0),ia.K(p,"REFLECTION_PASS",1),ia.K(p,"TEXTURE_NORM",0),"MAIN_PLANE_REFLECT"==
h.type&&ia.K(p,"INVERT_FRONTFACING",1),S.Sb(t),M(t));h.q.push(K(n,t))}}break;case "DEPTH":n=xa.Pa(g,m).T;for(q=0;q<n.length;q++)r=n[q],"DEPTH"!=r.type||r.Vc||!r.wc||"DEPTH"!=r.fb&&"NODES"!=r.fb||(l||(F(r,h,g,k,"DEPTH",m),S.Sb(r),M(r)),h.q.push(K(g.f,r)),P(k,h,r),O(r));break;case "SHADOW_CAST":n=!1;q=g.f;g=xa.Pa(g,m).T;r=ja.qb(k,"GRASS_MAP");for(t=0;t<g.length;t++)p=g[t],"DEPTH"==p.type&&"SHADOW_CAST"==p.fb&&(n=!0,l||(u=h.yn,S.Aa(p,"NUM_LIGHTS",u),S.Aa(p,"NUM_LFACTORS",0==u%2?u/2:Math.floor(u/2)+1),
ia.K(p.wb,"SHADOW_USAGE","SHADOW_CASTING"),p.$b&&r&&V(p,r,q),S.Aa(p,"SHADOW_TEX_RES",ia.t(m.k.hc.csm_resolution)),S.Sb(p),M(p)),h.q.push(K(q,p)));n&&(g=m.k.hc,l=ja.qb(k,"MAIN_OPAQUE"),B(h,m,l.j,h.q,g,!0));break;case "COLOR_PICKING":ba(h,g,k,m,l);break;case "COLOR_PICKING_XRAY":ba(h,g,k,m,l);break;case "OUTLINE_MASK":k=g.f;g=xa.Pa(g,m).T;for(m=0;m<g.length;m++)n=g[m],"COLOR_ID"==n.type&&"OUTLINE"==n.fb&&(l||(S.Aa(n,"USE_OUTLINE",1),S.Sb(n),M(n)),h.q.push(K(k,n)));break;case "GRASS_MAP":k=g.f;g=xa.Pa(g,
m).T;for(m=0;m<g.length;m++)n=g[m],"GRASS_MAP"==n.type&&(l||(S.Sb(n),M(n)),h.q.push(K(k,n)),n=h.j,p=k.Ab,q=h.Kc[0],r=h.Kc[1],t=h.Kc[2],0==q&&0==r?(q=p.min_y,r=p.max_y):(q=Math.min(q,p.min_y),r=Math.max(r,p.max_y)),p=1E-4*(r-q),h.Kc[0]=q-p,h.Kc[1]=r+p,Ia.Tn(n,t/2,-r,-q,t/2),Ia.zf(n));break;case "WIREFRAME":for(n=g.f,g=xa.Pa(g,m).T,m=0;m<g.length;m++)q=g[m],"WIREFRAME"==q.type&&da(h,n,k,l,q)}}for(e=0;e<b.J.length;e++)for(c=b.J[e].T,d=0;d<c.length;d++)null==c[d].dc&&c.splice(d--,1);break;case "LAMP":Y(b,
a),Bb.vG(a)}xa.Gr(b,!0,a)};a.Hr=function(a){a.k.xn=!0};a.AH=function(a,b){var c=a.f.L[0];oa.aa(b,function(a,b){if("SHADOW_CAST"===b.type){var d=mb.get_trans_view(c.h);mb.set_trans(d,b.j.h);mb.copy(c.$d,b.j.Qr)}})};a.gL=ha;a.lD=function(a,b){for(var c=a.k.hc,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=Ia.RB(c,b,e);return d};a.SI=da;a.Ft=W;a.ik=R;a.is_hidden=function(a){return a.f.rh};a.yF=function(a,b,c){b=b.f;a=aa(a,Ub);for(var d=0;d<a.length;d++)for(var e=a[d].q,f=e.length-1;0<=f;f--){var h=
e[f];h.ke==b&&(h.G&&c&&Ja.Mt(h.G.O),e.splice(f,1))}};a.rH=function(a,b){for(var c=a.La,d=xa.Pa(a,b).xh,e=aa(b,Zb),f=0;f<e.length;f++){var h=e[f];h.mn.set(c.rk,3*d);h.sa=!0}};a.mo=Y;a.cleanup=function(){for(var a=0;a<Ga.length;a++){var b=Ga[a];oa.aa(b.k.ib,function(a,b){if("SINK"!=b.type){var c=b.j;xb.BF(c.ge,c.Hb,c.Ld,c.width,c.height);for(var c=b.q,d=0;d<c.length;d++){var e=c[d].G;e&&S.dB(e)}}});b.k.ib=[];b.k.Rh=[]}qb=rc=null;Ga.length=0;Hb=null};a.Dv=function(a,b,c){a=Ia.vC(a,a.Ra,a.Cb,null,!0);
var d=Tb.RC(a);a=xa.zi("DYNAMIC");a.Ab=a.Zb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.Ub=a.fd=L.uA();var e=a.Ub.Ma;a.Nf=a.Ze=L.Bm([e,0,0],[0,e,0],[0,0,e],a.Ub.I);c=S.GB(d,c);b.q.push(K(a,c))};a.ZJ=function(a){return[a.frame_start,a.frame_end]};a.Ow=function(a,b,c){ya.lG(a,b,c);qb&&N(qb,a,b)};a.SK=N;a.lx=aa;a.Z=X;a.get_environment_colors=function(a){a=aa(a,Zb)[0];var b=a.ag,c=a.Mg,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Yf,d,e]};
a.set_environment_colors=function(a,b,c,d){a=aa(a,Zb);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Yf=b);c&&f.ag.set(c);d&&f.Mg.set(d);f.sa=!0}};a.get_sky_params=function(a){if(a=X(a,"SKY")){var b={};b.color=Array(3);Za.copy(a.yj,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=
a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=X(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.yj.set(b.color),
"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=
b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.sa=!0,c.wn=!0,ma(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=aa(a,dd)[0].yc;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=aa(a,dd),d=0;d<c.length;d++){var e=c[d];e.yc.set(b);e.sa=!0}};a.get_ssao_params=function(a){var b=X(a,"SSAO");a=X(a,
"SSAO_BLUR");if(!b)return null;var c=b.q[0].G,d={};d.ssao_quality=S.ac(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.vt=a.ssao_blur_discard_value;d.radius_increase=b.Cj;d.influence=b.Bj;d.dist_factor=b.Aj;d.ssao_only=b.ssao_only;d.ssao_white=S.ac(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=X(a,"SSAO"),d=X(a,"SSAO_BLUR");if(!c)return db.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=c.q[0].G;
S.Aa(e,"SSAO_QUALITY",b.ssao_quality);S.Sb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.q[0].G,S.Aa(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),S.Sb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.q[0].G,S.Aa(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),S.Sb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.Cj&&(c.Cj=b.Cj);"number"==typeof b.Bj&&(c.Bj=b.Bj);"number"==typeof b.Aj&&(c.Aj=b.Aj);if("number"==typeof b.ssao_only){c=X(a,"MAIN_OPAQUE");
c.ssao_only=b.ssao_only;for(var f=0;f<c.q.length;f++)e=c.q[f].G,S.Aa(e,"SSAO_ONLY",b.ssao_only),S.Sb(e,!0)}"number"==typeof b.ssao_white&&(e=c.q[0].G,S.Aa(e,"SSAO_WHITE",b.ssao_white),S.Sb(e,!0));c.sa=!0;d.sa=!0};a.get_dof_params=function(a){a=X(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;b.ld=a.j.ld;return b};a.set_dof_params=Q;a.get_god_rays_params=function(a){var b=aa(a,["GOD_RAYS"]);a=X(a,"GOD_RAYS_COMBINE");
if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].bj;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=S.ac(b[0].q[0].G,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=aa(a,["GOD_RAYS"]),d=X(a,"GOD_RAYS_COMBINE");if(!c||!d)return db.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].bj=
e,c[f].Mn=e/c[f].Gj/(f+1),c[f].sa=!0;if("number"==typeof b.god_rays_steps)for(var h=ia.t(b.god_rays_steps,1),e=c[0].bj,f=0;f<c.length;f++){c[f].Gj=h;c[f].Mn=e/h/(f+1);c[f].sa=!0;var g=c[f].q[0].G;S.Aa(g,"STEPS_PER_PASS",h);S.Sb(g,!0)}d.sa=!0};a.get_bloom_params=function(a){var b=X(a,"LUMINANCE_TRUNCED");a=X(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=sa;a.get_glow_material_params=function(a){a=
X(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=ca;a.get_wind_params=function(a){a=pa(a);var b=Za.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.OF=function(a){a.k.br=!0};a.get_water_surface_level=Ea;a.get_water_mat_params=
function(a,b){var c=X(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.Kg,b.waves_length=c.mi,c.se)){b.water_fog_density=c.se[3];var d=b.water_fog_color=[];d[0]=c.se[0];d[1]=c.se[1];d[2]=c.se[2]}};a.set_water_params=function(a,b){var c=X(a,"MAIN_OPAQUE");if(!c||!c.Lb)return db.error("set_water_params() - no water parameters on the scene"),null;c=c.Lb;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==
typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==
typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.Fk=b.water_dynamic);for(var d=aa(a,Nc),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.yc&&(f.se[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.yc&&f.se.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.Kg=b.waves_height);"number"==typeof b.waves_length&&(f.mi=b.waves_length);f.sa=!0}};a.get_shore_dist=
function(a,b){var c=X(qb,"MAIN_OPAQUE");if(!c.ro)return 100;var d=c.cj,e=c.Jg,f=(a[0]-c.vg[0])/c.wg[0],h=(c.vg[1]+a[2])/c.wg[1],f=f+.5,h=h+.5;if(1<f||0>f||1<h||0>h)e=1;else return c=d*Ca.Fu(qb.k.Sr,c.xj,f,h),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,c){for(var d=b().Qg.f,e=0;e<Ga.length;e++){var f=Ga[e],h=f.k.ib,g=f.k;if(g.Lb)var k=mb.get_trans_view(d.h),m=k[1]-Ea(k[0],k[2]);for(k=0;k<g.Sj.length;k++){var l=g.Sj[k].k,n=l.ga,q=l.gc;if(!(f.b4w_use_nla&&l.qo||!n&&!q)&&hb.Xx(l)){var r=hb.Ux(l),
t=hb.Wx(l);n&&ta.wh&&(t-=5);var p=hb.aI(l);r>=p&&l.ci||r<t?(hb.reset_video(l.name,l.Ef),q&&(l.uj=hb.Rn(l,a))):r>=p&&!l.ci?hb.pause_video(l.name,l.Ef):hb.Yx(l)&&(n?hb.Ix(l):(n=hb.Rn(l,a),n!=l.uj&&(hb.Hx(l),l.Vh++),l.uj=n))}}oa.aa(h,function(b,c){-1<Vc.indexOf(c.type)&&(c.time=a);g.Lb&&(c.lp=m)})}for(e=0;e<Ga.length;e++)if(f=Ga[e],g=f.k,h=g.ib,d=g.Rh,d.length)for(g.xn&&(T(f),g.xn=!1),g.br&&(qa(f),g.br=!1),g.cr&&(U(f),g.cr=!1),g.Fh&&fa(h,c),f=ja.qb(h,"OUTLINE_MASK"),k=0;k<d.length;k++)h=d[k],fc.pr(h),
f&&ga(h,f),xb.Di(h);ta.show_hud_debug_info&&Fb.qG(Ga,c)};a.FF=function(a){a.k.cr=!0};a.lq=function(a){var b=[];oa.aa(a.k.ib,function(a,c){b.push(c)});return b};a.get_cam_water_depth=function(){var a=X(qb,"MAIN_BLEND"),b=qb;return a||b.k.Lb?a.lp:null};a.get_object_data_id=function(a){return a.f.Ic};a.ys=function(a){oa.aa(a.k.ib,function(a,b){b.sa=!0})};a.jG=function(a,b){a.Ib=b!=ra.WM_NONE;for(var c=0;c<a.q.length;c++)a.q[c].G.wireframe_mode=b;a.Za=b==ra.WM_TRANSPARENT_WIREFRAME;a.sa=!0};a.iG=function(a,
b){for(var c=0;c<a.q.length;c++)a.q[c].G.wireframe_edge_color=b,a.sa=!0};a.qH=function(a,b){var c=b.Fi,d=a.k.Ff;if(c&&"WIND"==c.type&&d){var e=mb.get_quat_view(b.f.h);Ca.quat_to_dir(e,Ca.AXIS_Y,d);Za.normalize(d,d);Za.scale(d,c.ix,d);c=aa(a,Vc);for(e=0;e<c.length;e++)c[e].Ff.set(d)}};a.gF=function(a,b,c){var d=X(a,"COLOR_PICKING");if(d)return b=ya.np(b,c,Ac,d.j),fc.pr(d),xb.Di(d),(a=X(a,"COLOR_PICKING_XRAY"))?(fc.pr(a),xb.Di(a),d=a.j):d=d.j,b[1]=d.height-b[1],xb.xw(d.ge,b[0],b[1]);db.error("Object Selection is not available on the scene");
return null};a.set_outline_color=function(a){var c=b();if(c=X(c,"OUTLINE"))c.uf.set(a),c.sa=!0};a.dK=pa;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.Cx=function(a,b){var c=Gc;Za.negate(b,c);for(var d=0;6>d;d++){var e=a.yk[d],f=a.Gp[d],h=a.j;na.translate(Ca.oy[d],c,e);na.multiply(h.lb,e,h.re);Ca.Om(h.re,f)}};a.Fx=function(a,b,c){Ca.UG(b,c,Ca.AXIS_Y,a.j.cc)};a.oA=function(a,b,c){var d=a.k.hc,e=a.k.rg;
c=xa.Vm(c,ta.Xc&&a.b4w_enable_ssao);for(var f=0;f<b.length;f++){var h=b[f],g=xa.Pa(h,a);if(e)if(null!=h.f.vd){var k=e.Je;k.length&&(h=h.f.vd,g.Je=k[h])}else null!=h.f.Kd&&(k=e.Sf,k.length&&(h=h.f.Kd,g.Sf=k[h]))}for(f=0;f<c.length;f++)if(g=xa.Pa(c[f],a),d)for(b=aa(a,["SHADOW_CAST"]),e=0;e<b.length;e++)f==b[e].ne&&g.Rr.push(b[e])};a.marker_frame=function(a,b){return a.timeline_markers[b]}};b4w.module.__physics=function(a,p){function d(a,b){for(var c=a.be,e=0;e<c.length;e++)c[e].le.Jl&&b.push(c[e]),d(c[e],b)}function b(a,b,c){for(var d=a.yb.q,e=0;e<d.length;e++)for(var f=d[e].o,h=0;h<f.Hc.length;h++){var g=f.Hc[h];"ANY"!=g.Va&&c!=g.Va||x(g,a,b)}}function c(a,b,c){if(F.fn(a))switch(b){case F.xy:var d=q(a);d.yb.fy=!0;F.A(a,F.ez,Date.now()-performance.now(),W.je,W.jp?R.wu:0);break;case F.yy:O.Vq("URANIUM:",c.slice(1));break;case F.ty:O.error(c);break;case F.uy:y.fbmsg.apply(this,c.slice(1));
break;case F.Dy:var h=f(c.v);if(h){a=c.trans;d=c.quat;b=c.Fe;var g=c.ue,h=h.o;h.Dm=c.time;B.set_sep(a,1,d,h.Ip);ba.copy(b,h.Fe);ba.copy(g,h.ue)}break;case F.Ay:(a=f(c.op))&&B.set_sep(c.trans,1,c.quat,a.l.ll[c.rr]);break;case F.vy:if(d=f(c[1]))a=c[4],d=d.Od.qm[c[2]],U.set_translation(d,c[3]),U.set_rotation(d,a),U.n(d);break;case F.Ey:if(h=f(c[1]))h.l.speed=c[2];break;case F.py:d=q(a);t(d,c.Xg,c.Yg,c.result,null,null,0);break;case F.ry:d=q(a);t(d,c.Xg,c.Yg,c.result,c.dh,c.coll_norm,c.coll_dist);break;
case F.qy:if(h=f(c[1]))a=h.o,a.bh&&a.bh(c[2]);break;case F.Qs:case F.By:d=q(a);if(a=d.yb.pg[c.id])if(d=f(c.ui),b==F.Qs)b=a.callback,b(a.id,c.hit_fract,d,c.hit_time);else{b=c.hit_fract;var g=c.hit_time,h=c.hit_pos,k=a.callback;h?k(a.id,b,d,g,h,c.hit_norm):k(a.id,b,d,g)}break;case F.Cy:e(id);break;case F.zy:a=ea.indexOf(a);console.log("Physics #"+a+" Ping: OUT "+(c[2]-c[1]).toFixed(3)+" ms, IN "+(performance.now()-c[2]).toFixed(3)+" ms, ALL "+(performance.now()-c[1]).toFixed(3)+" ms");break;case F.wy:ka=
c[1];break;case F.sy:a=ea.indexOf(a);console.log("Worker: #"+String(a));console.log(c[1]);break;default:O.error("Wrong message: "+b)}}function q(a){for(var b=0;b<ea.length;b++)if(ea[b]==a)return ma[b]}function f(a){return la[a]||null}function t(a,b,c,d,e,h,g){a=a.yb.q;for(var k=0;k<a.length;k++)for(var m=a[k].o,n=0;n<m.Hc.length;n++){for(var q=m.Hc[n],r=q.mg,t=!1,p=0;p<r.length;p++){var u=r[p];if(u[0]===b&&u[1]===c){q.fl[p]=d;t=!0;break}}t&&(r=l(q),e&&q.dp!=b&&(t=e,p=h,u=g,t[0]+=p[0]*u,t[1]+=p[1]*
u,t[2]+=p[2]*u,p[0]*=-1,p[1]*=-1,p[2]*=-1),q.callback(r,r?q.dp==b?f(c):f(b):null,e,h,g))}}function l(a){a=a.fl;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function n(){X.body++;return X.body}function g(a){var b=aa.indexOf(a);return-1==b?(aa.push(a),aa.length-1):b}function z(a){return{v:a,Ge:0,gn:!1,xg:!0,Mc:!1,is_character:!1,VD:!1,ym:null,Va:"",ok:0,oJ:{},Hc:[],bh:null,Dm:0,Ip:new Float32Array([0,0,0,1,0,0,0,1]),Fe:new Float32Array(3),ue:new Float32Array(3),sm:new Float32Array(3),fk:new Float32Array(4)}}
function h(a,b){switch(a){case "BOX":var c=b.Zb;break;case "CYLINDER":c=b.Zo;break;case "CONE":c=b.Yo;break;case "SPHERE":c=b.fd;break;case "CAPSULE":c=b.Xo}return c}function k(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.I&&(b.center=
a.I);"number"===typeof a.Ma&&(b.radius=a.Ma);"number"===typeof a.height&&(b.height=a.height);return b}function u(a,b,c,d,e){var f=B.get_trans_view(a.f.h),h=B.invert(b.f.h,ca),g=new Float32Array(3);B.transform_vec3(f,h,g);switch(b.l.type){case 10:b=b.Zc;a=a.f.Zb;F.A(e,F.Iy,c,g,b.PG,b.Cr,(a.max_y-a.min_y)/2,d);break;case 20:F.A(e,F.Hy,c,g,a.bL)}}function w(a){return a.o&&a.o.ym}function C(a,b,c,d,e,f,h,g,k,m){var l;X.gb++;l=X.gb.toString(16);var n=b.o.v;F.A(E(n),F.Py,l,a,g,n,c,d,e.o.v,f,h,k,m);b.o.ym=
l}function E(a){for(var b=0;b<ma.length;b++)for(var c=ma[b].yb.q,d=0;d<c.length;d++)if(c[d].o.v==a)return ea[b];return null}function G(a){var b=a.o;if(b=b?0===b.Ge?!0:!0===b.gn?!0:!1===b.xg?!0:"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type?!0:!1:!1)var b=B.get_trans_view(a.f.h),c=B.get_quat_view(a.f.h),b=b[0]!=a.o.sm[0]||b[1]!=a.o.sm[1]||b[2]!=a.o.sm[2]||c[0]!=a.o.fk[0]||c[1]!=a.o.fk[1]||c[2]!=a.o.fk[2]||c[3]!=a.o.fk[3];if(b){var b=a.o,d=a.f,c=B.get_trans_view(d.h),d=B.get_quat_view(d.h);ba.copy(c,b.sm);
V.copy(d,b.fk);var e=F.Nu(F.Wl);e.v=b.v;e.trans=c;"DYNAMIC"==b.type?V.identity(e.quat):e.quat=d;F.A(E(b.v),F.Wl)}a=a.be;for(b=0;b<a.length;b++)G(a[b])}function m(a,b,c,d,e){e=e||new Float32Array(3);a=B.get_quat_view(a.f.h);e[0]=b;e[1]=c;e[2]=d;ba.transformQuat(e,a,e)}function x(a,b,c){var d=a.mg,e=a.fl,f=a.dp,h=[],g=a.Va;if(!h)throw"At least one destination required";for(var k=0;k<b.yb.q.length;k++){var m=b.yb.q[k];if("ANY"==g||m.o.Va==g)m=m.o.v,h&&-1==h.indexOf(m)&&h.push(m)}for(b=0;b<h.length;b++)g=
h[b],f<g&&!A(d,f,g)?(d.push([f,g]),e.push(!1)):f>g&&!A(d,g,f)&&(d.push([g,f]),e.push(!1));F.A(c,F.Gy,f);F.A(c,F.Oy,d,a.Ae)}function A(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function r(a){a.o&&a.o.bh&&(a=a.o,F.A(E(a.v),F.az,a.v),a.bh=null)}function e(a){var b=J(a),c=v(a).yb;c.pg[a]&&(delete c.pg[a],c.vr.splice(c.vr.indexOf,1),F.A(b,F.jz,a))}function v(a){for(var b=0;b<ma.length;b++){var c=ma[b];if(c.yb.pg[a])return c}return null}function J(a){for(var b=0;b<ma.length;b++)if(ma[b].yb.pg[a])return ea[b];
return null}function D(a,b,c){if(b.Fj){a=a.o.v;var d=b.Ei*b.Lk,e=b.dk*b.ek,f=-b.Dj*b.Ej*2*Math.PI/b.Bl;b.Wk&&(f*=-1);switch(b.type){case 10:F.A(c,F.wz,a,d,e,f);break;case 20:F.A(c,F.vz,a,d,e,f)}}}function H(a){return a.Mc&&"CHASSIS"==a.Zc.Oc}function I(a){return a.Mc&&"HULL"==a.Zc.Oc}function P(a){return a.vh&&"MAIN_BODY"==a.Gi.Oc}var K=p("__config");p("__constraints");var y=p("__debug"),F=p("__ipc");p("__mat4");var M=p("__obj_util"),O=p("__print"),V=p("__quat");p("__renderer");var T=p("__scenes"),
U=p("__transform"),B=p("__tsr"),ha=p("__util"),ba=p("__vec3"),da=p("__version"),W=K.o,R=K.p,Y=K.ve,ka=0,ea=[],ma=[],la={},N=[],aa=["ANY"],X={body:0,gb:0,uw:0},Q=new Float32Array(3);new Float32Array(4);var sa=new Float32Array(4);new Float32Array(16);var ca=B.create(),Ea=B.create();a.QD=function(a){a.yb={fy:!1,q:[],pg:{},vr:[]};var b=W.Hl;Y.qr&&(b+=da.timestamp());O.log("%cLOAD PHYSICS","color: #0a0",W.Ll?"Using Separate Worker Thread,":"Using Same Thread,","Max FPS: "+W.je);O.log("%cPHYSICS PATH",
"color: #0a0",b);var d=F.PB(b,!W.Ll);F.qA(d,c);ea.push(d);ma.push(a);W.ping&&setInterval(function(){F.A(d,F.gz,performance.now())},1E3)};a.ZA=function(a){return a.yb?a.yb.fy:!0};a.cleanup=function(){for(var a=0;a<ea.length;a++)F.terminate(ea[a]);ea.length=0;ma.length=0;la={};N.length=0;aa.length=0;for(var b in X)X[b]=0};a.append_object=function(a,c){if(!a.f)throw"No object render: "+a.name;var e;a:{for(var f=0;f<ma.length;f++)if(ma[f]==c){e=ea[f];break a}e=void 0}var m=[];a.le.Jl&&d(a,m);var l=c.yb.q;
if(H(a)||I(a)||a.is_character||P(a)||a.di){var q,r=a,t=e,p=r.f,x=r.le,ra=x.Gn,A=n();if("CAMERA"==r.type)var oa=x.zs?x.vm:"BOX",v=h(oa,p),y=p.Nk,aa=p.Hk,y=.5,aa=0;else if("EMPTY"==r.type)oa="EMPTY",v=null,aa=y=0;else{var oa=x.zs?x.vm:"BOX",v=h(oa,p),X=B.get_scale(p.h);if(1!=X){var E=v;switch(oa){case "BOX":E.min_x*=X;E.max_x*=X;E.min_y*=X;E.max_y*=X;E.min_z*=X;E.max_z*=X;break;case "CYLINDER":case "CONE":case "CAPSULE":E.height*=X;E.Ma*=X;break;case "SPHERE":E.Ma*=X}}y=p.Nk;aa=p.Hk}var Q=B.get_trans_view(p.h),
K=B.get_quat_view(p.h),G=x.Kl,J=x.Mx,U=x.Ge,ja=x.Qx,ka=x.Px,ia=x.Kp,R=x.Er,W=r.Va,da=g(W),Y=x.pk,ba=x.nk,ta=x.qk,Wc=p.fd.Ma,Gb=k(v),Ub=r.Am,Zb;var dd=oa;if(m.length){var Vc=[],Nc={};Nc.quat=new Float32Array([0,0,0,1]);Nc.trans=new Float32Array(3);Nc.worker_bounding=Gb;Nc.bounding_type=dd;Vc.push(Nc);var rc=B.invert(p.h,ca),qb=B.get_quat_view(p.h);V.invert(qb,sa);for(var Ga=0;Ga<m.length;Ga++){var Hb={},zc=m[Ga],Ac=zc.le.vm,Gc=new Float32Array(4),Xc=new Float32Array(3),kb=B.get_trans_view(zc.f.h),
ab=B.get_quat_view(zc.f.h);B.transform_vec3(kb,rc,Xc);V.multiply(sa,ab,Gc);Hb.trans=Xc;Hb.quat=Gc;Hb.bounding_type=Ac;Hb.worker_bounding=k(h(Ac,zc.f));Vc.push(Hb)}Zb=Vc}else Zb=[];F.A(t,F.Ly,A,Q,K,ra,G,J,U,ja,ka,ia,R,da,Y,ba,ta,oa,Gb,Wc,y,aa,Zb,Ub);la[A]=r;N.push(r);var Na=z(A);Na.type=ra;Na.Ge=U;Na.gn=G;Na.Va=W;Na.ok=da;q=Na;a.o=q;var ib={G:null,o:q};l.push(ib);b(c,e,q.Va)}else for(var $b=M.Pa(a,c).T,jb=0;jb<$b.length;jb++){var Oa=$b[jb],Ma;if(Ma="PHYSICS"==Oa.type){var Fa;a:{for(var Hc=c.yb.q,Wa=
0;Wa<Hc.length;Wa++){var ub=Hc[Wa].G;if(ub&&ub.id==Oa.id){Fa=!0;break a}}Fa=!1}Ma=!Fa}if(Ma)if(Oa.Cd.ea)if(Oa.Ig&&c.k.Lb){var Ra=Oa,za=c,Ka=e,bb=T.Z(za,"MAIN_OPAQUE");F.A(Ka,F.Uy,bb.Jg);if(bb.Lb&&Ra.fI){var Da={};Da.dst_noise_scale0=Ra.dst_noise_scale0;Da.dst_noise_scale1=Ra.dst_noise_scale1;Da.dst_noise_freq0=Ra.dst_noise_freq0;Da.dst_noise_freq1=Ra.dst_noise_freq1;Da.dir_min_shore_fac=Ra.dir_min_shore_fac;Da.dir_freq=Ra.dir_freq;Da.dir_noise_scale=Ra.dir_noise_scale;Da.dir_noise_freq=Ra.dir_noise_freq;
Da.dir_min_noise_fac=Ra.dir_min_noise_fac;Da.dst_min_fac=Ra.dst_min_fac;Da.waves_hor_fac=Ra.waves_hor_fac;var $a=bb.Kg,Lb=bb.mi;bb.ro?F.A(Ka,F.Ss,Da,bb.wg[0],bb.wg[1],bb.vg[0],bb.vg[1],bb.cj,$a,Lb,bb.xj,za.k.Sr):F.A(Ka,F.Ss,Da,0,0,0,0,0,$a,Lb,0,null)}}else{var yb;if(Oa.Kl){var Bc=a,Sa=Oa,Yc=e,Ic=n(),Pb=Sa.Cd,Vb=Pb.B[0].a_position,Cb=Pb.Ca||null,hc=Sa.Va,Jc=g(hc),ic=Sa.pk,zb=Sa.nk,Qa=Sa.qk,Ha=B.get_trans_view(Bc.f.h);F.A(Yc,F.Ry,Ic,Vb,Cb,Ha,Jc,ic,zb,Qa);var Ya=z(Ic);Ya.gn=!0;Ya.Va=hc;Ya.ok=Jc;yb=Ya}else{var Db=
a,Ib=Oa,ac=e,Jb=n(),rb=Ib.Cd,Mb=rb.B[0].a_position,gc=rb.Ca||null,tb=B.get_trans_view(Db.f.h),Qb=Ib.Nk,jc=Ib.Hk,Cc=Ib.Va,Ta=g(Cc);F.A(ac,F.Ty,Jb,Mb,gc,tb,Qb,jc,Ta,Ib.pk,Ib.nk,Ib.qk);var fb=z(Jb);fb.Va=Cc;fb.ok=Ta;yb=fb}q=yb;ib={G:Oa,o:q};l.push(ib);b(c,e,q.Va)}else O.error("Object "+a.name+" has collision material with no assigned vertices")}if(H(a)||I(a)){var va=a,wa=e,lb=va.o.v;H(va)?(va.l.type=10,F.A(wa,F.My,lb,va.l.hs,va.l.ks,va.l.js,va.l.Js,va.l.Yq)):I(va)&&(va.l.type=20,F.A(wa,F.Ky,lb,va.l.mh,
va.l.ki,va.l.li));if(va.l.Qh){var cb=va.l.Qh;switch(va.l.type){case 10:u(cb[1],va,lb,!0,wa);u(cb[0],va,lb,!0,wa);u(cb[3],va,lb,!1,wa);u(cb[2],va,lb,!1,wa);break;case 20:for(var Wb=0;Wb<cb.length;Wb++)u(cb[Wb],va,lb,!1,wa)}}D(a,a.l,e)}else if(a.is_character){var Pa=e,sc=a.f,nb=a.o,vb=sc.Zb.max_y-sc.Zb.min_y,Rb=nb.v,Nb=a.Gt,Ab=Nb.eI,bc=Nb.KF,tc=Nb.HG,uc=Nb.eE,cc=Nb.gI,ob=ha.eC(a);F.A(Pa,F.Ny,Rb,ob,vb,Ab,bc,tc,uc,cc);nb.is_character=!0}else if(P(a)){var La=a,eb=e,Ua=La.o.v;F.A(eb,F.Qy,Ua,La.Od.mh,La.Od.ki,
La.Od.li);if(La.Od.qm)for(var Dc=La.Od.qm,pb=0;pb<Dc.length;pb++){var Ob=Dc[pb],Xb=B.get_trans_view(Ob.f.h),gb=B.invert(La.f.h,ca),Kb=new Float32Array(3);B.transform_vec3(Xb,gb,Kb);F.A(eb,F.Jy,Ua,Kb,Ob.zA)}La.o.VD=!0}for(jb=0;jb<N.length;jb++)if(a=N[jb],a.o){var kc=a;if(!w(kc))for(var lc=0;lc<kc.nr.length;lc++){var Eb=kc.nr[lc],mc=Eb.target,vc=Eb.hF;if(mc.o){var nc=new Float32Array([Eb.iF,Eb.jF,Eb.kF]),Sb,oc=new Float32Array([Eb.we,Eb.xe,Eb.ye]);Sb=ha.euler_to_quat(oc,new Float32Array(4));var dc=
B.identity(ca),dc=B.set_trans(nc,dc),dc=B.set_quat(Sb,dc),wc=B.multiply(kc.f.h,dc,ca),Kc=B.invert(mc.f.h,Ea),Zc=B.multiply(Kc,wc,Kc),Ec=B.get_trans_view(Zc),sb=B.get_quat_view(Zc),Va=Eb,Xa={};Xa.use_limit_x=Va.KH;Xa.use_limit_y=Va.LH;Xa.use_limit_z=Va.MH;Xa.use_angular_limit_x=Va.FH;Xa.use_angular_limit_y=Va.GH;Xa.use_angular_limit_z=Va.HH;Xa.limit_max_x=Va.oE;Xa.limit_min_x=Va.rE;Xa.limit_max_y=Va.pE;Xa.limit_min_y=Va.sE;Xa.limit_max_z=Va.qE;Xa.limit_min_z=Va.tE;Xa.limit_angle_max_x=Va.iE;Xa.limit_angle_min_x=
Va.lE;Xa.limit_angle_max_y=Va.jE;Xa.limit_angle_min_y=Va.mE;Xa.limit_angle_max_z=Va.kE;Xa.limit_angle_min_z=Va.nE;C(vc,kc,nc,Sb,mc,Ec,sb,Xa,null,null)}}}};a.AC=f;a.update=function(a,b){for(var c=0;c<ea.length;c++){var d=ea[c],e=a;d&&F.mv(d)&&F.A(d,F.xz,e,b);for(var f=0;f<N.length;f++){var h=N[f],g=h.o;if(g.xg&&g.Dm){var k=F.mv(d)?e-g.Dm:performance.now()/1E3-g.Dm,k=Math.min(k,10/W.je),k=k-1/W.je;R.WE&&(k=0);var m=ca;B.RD(g.Ip,k,g.Fe,g.ue,ca);U.set_tsr(h,m);U.n(h);G(h);if(h.l)for(var g=h,k=g.l.Qh,
m=g.f.h,l=ca,n=0;n<k.length;n++){var q=k[n];B.multiply(m,g.l.ll[n],l);U.set_tsr(q,l);U.n(q)}h.l&&h.l.Fj&&(l=h,k=l.l,g=k.Fj)&&(n=l.l.fx,B.multiply(l.f.h,l.l.gx,g.f.h),m=Q,B.transform_dir_vec3(n,l.f.h,m),l=sa,V.setAxisAngle(m,-k.Dj*k.Ej*2*Math.PI,l),k=B.get_quat_view(g.f.h),V.multiply(l,k,k),U.n(g));h.l&&h.l.$r&&(l=h,k=l.l,g=k.$r)&&(n=l.l.ax,B.multiply(l.f.h,l.l.bx,g.f.h),m=Q,B.transform_dir_vec3(n,l.f.h,m),l=sa,n=Math.abs(k.speed)*k.yl,n>k.dj&&(n=k.dj),V.setAxisAngle(m,-n,l),k=B.get_quat_view(g.f.h),
V.multiply(l,k,k),V.normalize(k,k),U.n(g));h.l&&h.l.ls&&(m=h,g=m.l,h=g.ls)&&(l=m.l.px,B.multiply(m.f.h,m.l.qx,h.f.h),k=Q,B.transform_dir_vec3(l,m.f.h,k),m=sa,V.setAxisAngle(k,-Math.abs(g.Ei)*g.Bk,m),g=B.get_quat_view(h.f.h),V.multiply(m,g,g),V.normalize(g,g),U.n(h))}}F.nF(d);d=T.Z(ma[c],"MAIN_OPAQUE");d.Lb&&0<d.Lb.waves_height&&(e=ba.length(d.Ff),F.A(ea[c],F.uz,d.time*e))}};a.aD=function(){return ma[0]};a.pause=function(){for(var a=0;a<ea.length;a++)F.A(ea[a],F.fz)};a.resume=function(){for(var a=
0;a<ea.length;a++)F.A(ea[a],F.kz)};a.enable_simulation=function(a){a=a.o;if(!a)throw"No object physics";if(!a.xg){var b=a.v,c=E(b);a.xg=!0;F.A(c,F.dz,b)}};a.disable_simulation=function(a){a=a.o;if(!a)throw"No object physics";if(a.xg){var b=a.v,c=E(b);a.xg=!1;F.A(c,F.cz,b)}};a.On=function(a){return Boolean(a.yb)};a.P=function(a){return Boolean(a.o)};a.has_dynamic_physics=function(a){return(a=a.o)&&a.xg&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.Ge&&0==a.gn?!0:!1};a.has_simulated_physics=function(a){return(a=
a.o)&&a.xg?!0:!1};a.set_gravity=function(a,b){var c=a.o.v;F.A(E(c),F.tz,c,b)};a.KD=w;a.apply_constraint=C;a.clear_constraint=function(a){a=a.o;F.A(E(body_a),F.iz,a.ym);a.ym=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,h){c=B.set_sep(c,1,d,ca);f=B.set_sep(f,1,h,Ea);B.invert(c,c);B.multiply(f,c,c);U.get_tsr(e,f);B.multiply(f,c,c);U.set_tsr(b,c);U.n(b);e=B.get_trans_view(b.f.h);f=B.get_quat_view(b.f.h);a.set_transform(b,e,f)};a.set_transform=function(a,b,c){var d=a.o,e=B.get_trans_view(a.f.h);
a=B.get_quat_view(a.f.h);B.set_sep(e,1,a,d.Ip);e=F.Nu(F.Wl);e.v=d.v;e.trans=b;e.quat=c;F.A(E(d.v),F.Wl)};a.sync_transform=G;a.apply_velocity=function(a,b,c,d){m(a,b,c,d,Q);a=a.o.v;b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(Q[0]),f=Math.abs(Q[1]),h=Math.abs(Q[2]);Q[0]=e?Q[0]/e*Math.max(e,b):0;Q[1]=f?Q[1]/f*Math.max(f,c):0;Q[2]=h?Q[2]/h*Math.max(h,d):0;F.A(E(a),F.Us,a,Q[0],Q[1],Q[2])};a.apply_velocity_world=function(a,b,c,d){a=a.o.v;F.A(E(a),F.Us,a,b,c,d)};a.apply_force=function(a,b,c,
d){m(a,b,c,d,Q);a=a.o.v;F.A(E(a),F.Vy,a,Q[0],Q[1],Q[2])};a.apply_torque=function(a,b,c,d){m(a,b,c,d,Q);a=a.o.v;F.A(E(a),F.Xy,a,Q[0],Q[1],Q[2])};a.set_character_move_dir=function(a,b,c){a=a.o.v;F.A(E(a),F.nz,a,b,c)};a.set_character_move_type=function(a,b){var c=a.o.v;F.A(E(c),F.oz,c,b)};a.set_character_walk_velocity=function(a,b){var c=a.o.v;F.A(E(c),F.sz,c,b)};a.set_character_run_velocity=function(a,b){var c=a.o.v;F.A(E(c),F.qz,c,b)};a.set_character_fly_velocity=function(a,b){var c=a.o.v;F.A(E(c),
F.lz,c,b)};a.character_jump=function(a){a=a.o.v;F.A(E(a),F.Zy,a)};a.character_rotation_inc=function(a,b,c){a=a.o.v;F.A(E(a),F.$y,a,b,c)};a.set_character_rotation=function(a,b,c){a=a.o.v;F.A(E(a),F.pz,a,b,c)};a.set_character_rotation_h=function(a,b){var c=a.o.v;F.A(E(c),F.mz,c,b)};a.set_character_rotation_v=function(a,b){var c=a.o.v;F.A(E(c),F.rz,c,b)};a.append_collision_test=function(a,b,c,d){var e=a.o,f=e.v;b=b||"ANY";for(var h=0;h<e.Hc.length;h++)if(a=e.Hc[h],a.Va==b&&a.callback==c)return;a={dp:f,
Ae:d||!1,Va:b,callback:c,mg:[],fl:[]};e.Hc.push(a);b=E(f);x(a,q(b),b)};a.remove_collision_test=function(a,b,c){a=a.o;for(var d=E(a.v),e=q(d),f=0;f<a.Hc.length;f++){var h=a.Hc[f];if(h.Va==b&&h.callback==c){if(l(h)){var g=ba.set(0,0,0,Q);h.callback(!1,null,g,g,0)}a.Hc.splice(f,1);f--;for(var g=d,h=h.mg,k=e.yb.q,m=0;m<k.length;m++)for(var n=k[m].o,r=0;r<n.Hc.length;r++)for(var t=n.Hc[r],p=0;p<t.mg.length;p++)for(var u=t.mg[p],x=0;x<h.length;x++){var A=h[x];u[0]==A[0]&&u[1]==A[1]&&(h.splice(x,1),x--)}h.length&&
F.A(g,F.Ts,h)}}};a.apply_collision_impulse_test=function(a,b){a.o&&a.o.bh&&r(a);var c=a.o;F.A(E(c.v),F.Wy,c.v);c.bh=b};a.clear_collision_impulse_test=r;a.append_ray_test=function(a,b,c,d,e,f,h,k,m){var l;X.uw++;l=X.uw;d=d||"ANY";a={id:l,v:a?a.o.v:0,from:new Float32Array(b),to:new Float32Array(c),Va:d,ok:g(d),qt:f,DA:h,Ae:k,an:m,callback:e};b=E(a.v)||ea[0];c=q(b).yb;l=a.id;c.pg[l]=a;c.vr.push(a);F.A(b,F.Sy,a.id,a.v,a.from,a.to,a.ok,a.qt,a.DA,a.Ae,a.an);return l};a.remove_ray_test=e;a.change_ray_test_from_to=
function(a,b,c){var d=J(a),e=v(a).yb.pg[a];e&&!e.qt&&(e.from.set(b),e.to.set(c),F.A(d,F.Yy,a,b,c))};a.nv=function(a){return v(a).yb.pg[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.l;c.Ei=b;D(a,c,E(a.o.v))};a.vehicle_steer=function(a,b){var c=a.l;c.Dj=b;D(a,c,E(a.o.v))};a.vehicle_brake=function(a,b){var c=a.l;c.dk=b;D(a,c,E(a.o.v))};a.is_vehicle_chassis=H;a.is_vehicle_hull=I;a.UD=function(a){if(!a.Mc)return!1;a=a.Zc.Oc;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||
"WHEEL_BACK_RIGHT"==a?!0:!1};a.SD=function(a){return a.Mc?"BOB"==a.Zc.Oc?!0:!1:!1};a.WD=function(a){return a.vh?"BOB"==a.Gi.Oc?!0:!1:!1};a.pv=function(a){return a.Mc&&"STEERING_WHEEL"==a.Zc.Oc?!0:!1};a.ov=function(a){return a.Mc&&"SPEEDOMETER"==a.Zc.Oc?!0:!1};a.qv=function(a){return a.Mc&&"TACHOMETER"==a.Zc.Oc?!0:!1};a.get_vehicle_speed=function(a){return a.l.speed};a.iI=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};
a.is_character=function(a){return a.is_character};a.wK=P;a.qD=function(){return ka};a.YB=function(){for(var a=0;a<ea.length;a++)F.A(ea[a],F.bz)};a.xF=function(a){var b=N.indexOf(a);-1==b&&O.error("Object "+a.name+" doesn't have bounding physics");for(var c=a.o.v,d=E(c),e=q(d),f=e.yb.q,h=[],g=0;g<f.length;g++)for(var k=f[g].o,m=0;m<k.Hc.length;m++)for(var n=k.Hc[m],t=0;t<n.mg.length;t++){var p=n.mg[t],u=n.fl[t];if(p[0]==c||p[1]==c)n.mg.splice(t,1),n.fl.splice(t,1),t--,u&&!l(n)&&(u=ba.set(0,0,0,Q),
n.callback(!1,null,u,u,0)),h.push(p)}h.length&&F.A(d,F.Ts,h);a.o&&a.o.bh&&r(a);delete la[c];N.splice(b,1);a=e.yb.q;for(b=0;b<a.length;b++)a[b].o.v==c&&(a.splice(b,1),b--);F.A(d,F.hz,c)}};b4w.module.__data=function(a,p){function d(a,b){xb[b.id]=null;ja[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=Q.Tu(a));d=a.width;a=a.height;S.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Mc)&&c&&S.warn("image",b,"is not from app root.")}function c(a,b,c,d,e,f){d=b.kf;if(!d)throw"Nothing requested";la.enqueue([{id:d,type:la.AT_JSON,url:d}],function(d,f,h,g){if(d){S.log("%cLOAD METADATA","color: #616",g);f=Ba.hx(d.b4w_format_version);
switch(Ba.Rx(f,xa.Eh)){case -1:f[0]<xa.Eh[0]?Ba.W("JSON version is too old relative to B4W engine: "+Ba.Gg(f)+", required: "+Ba.Gg(xa.Eh)+". Reexport scene with the latest B4W addon to fix it."):S.warn("JSON version is a bit old relative to B4W engine: "+ +Ba.Gg(f)+", required: "+Ba.Gg(xa.Eh)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");break;case 1:f[0]>xa.Eh[0]?Ba.W("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):
S.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}xa.Uq=f;for(var k in d)a[k]=d[k];b.Wa&&(ia=Z.Pm(a.scenes));(d=a.binaries[0].binfile)?b.st=d:(ca.Xn(b,"load_binaries"),ca.Xn(b,"prepare_bindata"));xa.wh||ca.Xn(b,"mobile_media_start");xa.antialiasing&&xa.smaa||ca.Xn(b,"load_smaa_textures");if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)k=a.b4w_export_errors[d],(b.Wa&&"PRIMARY"==k.type||"ALL"==k.type)&&
S.rC(k.text);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)k=a.b4w_export_warnings[d],(b.Wa&&"PRIMARY"==k.type||"ALL"==k.type)&&S.sC(k.text);e(b,c)}else ca.ct(b)},null,function(a){f(b,c,a)})}function q(a,b,c,d,e,f){d=R(b.kf)+b.st;if(!d)throw"Binary data is missing";la.enqueue([{id:d,type:la.AT_ARRAYBUFFER,url:d}],function(d,f,h,g){d?(S.log("%cLOAD BINARY","color: #616",g),a.bin_data=d,d=l(d),f=Ba.hx(a.b4w_format_version),d[0]!=f[0]&&Ba.W("BIN version does not match to JSON version: "+
Ba.Gg(d)+", required: "+Ba.Gg(xa.Eh)+". Couldn't load the scene. Reexport scene to fix it."),d[1]!=f[1]&&S.warn("BIN version does not match to JSON version: "+ +Ba.Gg(d)+", required: "+Ba.Gg(xa.Eh)+". Some compatibility issues can occur. Reexport scene to fix it."),e(b,c)):ca.ct(b)},null,function(a){f(b,c,a)})}function f(a,b,c,d,e){ra.WA()&&e(b,c)}function t(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],h=a.objects,g=a.meshes;a=a.actions;for(var k=Ba.TA(),m=l(d),m=5<=m[0]&&4<m[1]?12:0,q=["indices"],
r=["normal","tangent"],t=["color","group"],p=["position","texcoord","texcoord2"],u=0;u<g.length;u++)for(var S=g[u].submeshes,x=0;x<S.length;x++)for(var ra in S[x]){var A=S[x][ra][1];if(-1!=q.indexOf(ra)){var oa=4*S[x][ra][0]+f["int"]+m,w=S[x],N=ra,L=d;if(k)var v=new Uint32Array(L,oa,A);else for(var v=new Uint32Array(A),L=new DataView(L),z=0;z<A;z++)v[z]=L.getUint32(oa+4*z,!0);w[N]=v}else if(-1!=p.indexOf(ra))oa=4*S[x][ra][0]+f["float"]+m,S[x][ra]=n(d,oa,A,k);else if(-1!=r.indexOf(ra)){oa=2*S[x][ra][0]+
f["short"]+m;w=S[x];N=ra;L=d;v=new Float32Array(A);L=new DataView(L);for(z=0;z<A;z++)v[z]=L.getInt16(oa+2*z,!0)/32767;w[N]=v}else if(-1!=t.indexOf(ra)){oa=2*S[x][ra][0]+f.ushort+m;w=S[x];N=ra;L=d;v=new Float32Array(A);L=new DataView(L);for(z=0;z<A;z++)v[z]=L.getUint16(oa+2*z,!0)/65535;w[N]=v}}for(ra=0;ra<h.length;ra++)for(g=h[ra].particle_systems,q=0;q<g.length;q++)r=g[q],r.transforms=n(d,4*r.transforms[0]+f["float"]+m,r.transforms[1],k);for(h=0;h<a.length;h++){ra=a[h];g=ra.fcurves;q=ra.frame_range;
t=q[0];p=q[1];u=ma.eD(t,p);q=null;0>u&&(u=0);var x=S=!1,y;for(y in g)S|=-1<y.indexOf("rotation_euler"),x|=-1<y.indexOf("rotation_quaternion");r=[];for(y in g)if(S&&x&&-1<y.indexOf("rotation_euler"))delete g[y];else{var A=g[y],O;for(O in A)oa=A[O],w=n(d,f["float"]+4*oa.bin_data_pos[0]+m,oa.bin_data_pos[1],k),N=new Float32Array(u),null===q&&(q=new Int8Array(u)),ma.iA(oa,w,N,q,t,p),oa.dd=N;-1<y.indexOf("rotation_euler")&&(ma.zC(g[y]),r.push(y))}for(t=0;t<r.length;t++)p=r[t],u=p.replace("euler","quaternion"),
g[u]=g[p],delete g[p];ra.Ez=q}e(b,c)}function l(a){var b=new Uint8Array(a,0,4),c=(new Uint32Array(a,4,1))[0];a=(new Uint32Array(a,8,1))[0];for(var d=0;d<b.length;d++)if("B4WB"[d]!=String.fromCharCode(b[d])){c=5;a=4;break}return[c,a]}function n(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function g(a,b,c,d,e){var f=a.cameras,g=a.groups,k=a.materials,l=a.meshes,n=a.node_groups,q=a.objects,r=a.particles,
t=a.scenes,p=a.speakers,u=a.lamps,ra=a.textures,A=a.worlds;n||(S.warn('"node_groups" datablock undefined. reexport main scene.'),n=a.node_groups=[]);for(var N="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),w={},v=0;v<N.length;v++)for(var O=a[N[v]],aa=0;aa<O.length;aa++){var B=O[aa];w[B.uuid]=B}for(var D=0;D<t.length;D++){for(var X=t[D],Fb=X.objects,C=0;C<Fb.length;C++)x(Fb,C,w);X.camera&&x(X,"camera",
w);X.world&&x(X,"world",w)}for(D=0;D<g.length;D++)for(var E=g[D].objects,C=0;C<E.length;C++)x(E,C,w);for(D=0;D<q.length;D++){var na=q[D];na.dupli_group&&x(na,"dupli_group",w);na.parent&&x(na,"parent",w);na.dg_parent&&x(na,"dg_parent",w);if(na.animation_data){var H=na.animation_data;H.action&&x(H,"action",w);if(H.nla_tracks)for(C=0;C<H.nla_tracks.length;C++)for(var I=H.nla_tracks[C],F=0;F<I.strips.length;F++)I.strips[F].action&&x(I.strips[F],"action",w)}switch(na.type){case "MESH":if(!na.data)throw"mesh not found for object "+
na.name;x(na,"data",w);for(var Q=!1,K=na.modifiers,C=0;C<K.length;C++){var G=K[C];"ARMATURE"==G.type?(Q&&S.warn('Object "'+na.name+'" has more than one armature modifiers. Only the first one will be used.'),Q=!0,x(G,"object",w)):"CURVE"==G.type&&x(G,"object",w)}var V=na.particle_systems;if(V)for(C=0;C<V.length;C++)x(V[C],"settings",w);break;case "ARMATURE":x(na,"data",w);for(var xa=na.pose.bones,P=na.data.bones,C=0;C<xa.length;C++){var T=xa[C];T.bone=P[T.bone];var M=T.constraints;if(M)for(F=0;F<M.length;F++){var Bb=
M[F];Bb.target&&x(Bb,"target",w)}for(var J=T.parent_recursive,F=0;F<J.length;F++)J[F]=xa[J[F]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":x(na,"data",w)}if(M=na.constraints)for(C=0;C<M.length;C++)Bb=M[C],Bb.target&&x(Bb,"target",w);var ca=na.lod_levels;if(ca)for(C=0;C<ca.length;C++){var Ia=ca[C];Ia.object&&x(Ia,"object",w)}}for(D=0;D<l.length;D++)for(var Yb=l[D].materials,C=0;C<Yb.length;C++)x(Yb,C,w);for(D=0;D<k.length;D++){for(var U=k[D],sa=U.texture_slots,C=0;C<sa.length;C++)x(sa[C],
"texture",w);var Tb=U.node_tree;Tb&&m(Tb,w)}for(D=0;D<n.length;D++)(Tb=n[D].node_tree)&&m(Tb,w);for(D=0;D<ra.length;D++){var ka=ra[D],db=ka.type;"IMAGE"!=db&&"ENVIRONMENT_MAP"!=db||x(ka,"image",w)}for(D=0;D<f.length;D++){var ea=f[D];ea.dof_object&&x(ea,"dof_object",w)}for(D=0;D<p.length;D++){var ga=p[D];ga.sound&&x(ga,"sound",w);if(ga.animation_data&&(H=ga.animation_data,H.action&&x(H,"action",w),H.nla_tracks))for(C=0;C<H.nla_tracks.length;C++)for(I=H.nla_tracks[C],F=0;F<I.strips.length;F++)I.strips[F].action&&
x(I.strips[F],"action",w)}for(D=0;D<r.length;D++){for(var xb=r[D],sa=xb.texture_slots,C=0;C<sa.length;C++)x(sa[C],"texture",w);xb.dupli_group&&x(xb,"dupli_group",w);xb.dupli_object&&x(xb,"dupli_object",w)}for(D=0;D<u.length;D++){var Ea=u[D];if(Ea.animation_data&&(H=Ea.animation_data,H.action&&x(H,"action",w),H.nla_tracks))for(C=0;C<H.nla_tracks.length;C++)for(I=H.nla_tracks[C],F=0;F<I.strips.length;F++)I.strips[F].action&&x(I.strips[F],"action",w)}for(D=0;D<A.length;D++)if(sa=A[D].texture_slots)for(C=
0;C<sa.length;C++)x(sa[C],"texture",w);L.PA(a);for(var R=a.textures,W=b.Wa?a.scenes[0].b4w_anisotropic_filtering:ia.b4w_anisotropic_filtering,da=0;da<R.length;da++)b.Wa||"SCENE"!=R[da].b4w_source_type||(R[da].b4w_source_id=""),Ja.MB(R[da],W,a.scenes,b.id);for(var la={},Y=a.objects,Ca=0;Ca<Y.length;Ca++){var ba=Y[Ca];if("MESH"===ba.type&&!ba.particle_systems.length)for(var hb=ba.data,ha=hb.name,mb=hb.submeshes,fa=hb.materials,ua=0;ua<mb.length;ua++)0!==mb[ua].base_length||la[ha]||(fa[ua]&&S.warn('material "'+
fa[ua].name+'" is not assigned to any face (object "'+ba.name+'").'),la[ha]=!0)}for(var Mc=a.meshes,ta=0;ta<Mc.length;ta++){var Aa=Mc[ta];Aa.materials.length||Aa.uv_textures.length&&S.warn('mesh "'+Aa.name+'" has a UV map but has no exported material.')}a.materials.push(L.wB());for(var Za=a.meshes,Ub=Ba.keysearch("name","DEFAULT",a.materials),Gb=0;Gb<Za.length;Gb++){var Qc=Za[Gb];0==Qc.materials.length&&Qc.materials.push(Ub)}for(var uc=a.actions,cc=b.id,ob=0;ob<uc.length;ob++){var La=uc[ob];La.Fz=
cc;ma.Mz(La)}for(var eb=a.scenes,Ua=0;Ua<eb.length;Ua++){for(var Dc=eb[Ua],pb=[],Ob=[],Xb=eb[Ua].objects,gb=0;gb<Xb.length;gb++){var Kb=Xb[gb];y(Xb,Kb,pb,Ob);var kc=Kb.dupli_group;if(kc)for(var lc=kc.objects,Eb=0;Eb<lc.length;Eb++)y(lc,lc[Eb],pb,Ob)}for(gb=0;gb<Ob.length;gb++)for(var mc=Ob[gb],vc=[Dc],nc=0;nc<vc.length;nc++){for(var Sb=vc[nc].objects,oc=0;oc<Sb.length;oc++){var dc=Sb[oc].dupli_group;if(dc){var wc=dc.objects,Kc=wc.indexOf(mc);-1<Kc&&wc.splice(Kc,1)}}var Kc=Sb.indexOf(mc);-1<Kc&&Sb.splice(Kc,
1)}for(gb=0;gb<pb.length;gb++)Ba.dA(pb[gb][0],pb[gb][1])}!b.Wa&&1<a.scenes.length&&(a.scenes=[Z.Pm(a.scenes)],S.warn("loading data contains multiple scenes.","Only the first one will be loaded."));var Zc=b.Wa?ia:Z.Pm(a.scenes);oa.UF(ia.fps);1<a.scenes.length&&(a.scenes.splice(a.scenes.indexOf(ia),1),a.scenes.unshift(ia));for(var Ec=0;Ec<a.scenes.length;Ec++){var sb=a.scenes[Ec];sb.k={};sb.at=sb==Zc;sb.Gz=b.Wa;fc.enabled&&sb.b4w_enable_physics&&(b.Wa||!pa.On(ia)&&sb==Z.Pm(a))&&pa.QD(sb);b.Wa?sb.b4w_enable_audio&&
ya.ot(sb):sb.b4w_enable_audio&&!ia.wa&&ya.ot(ia)}for(var Va=0;Va<a.scenes.length;Va++){var Xa=a.scenes[Va],ec,Fc=[];z(Xa.objects,"ALL",Fc);ec=Fc;Xa.b4w_use_logic_editor&&L.nA(ec,Xa);for(var xc=0;xc<ec.length;xc++){var pc=ec[xc];qa.QA(pc,Xa,a)&&(pc.Gc||(pc.Gc=[]),pc.Gc.push(b.Wa?Xa:ia))}for(var Rc=ec,md=0;md<Rc.length;md++){var ed=Rc[md];if(ed.Gc)for(var $c=ed.particle_systems,fd=0;fd<$c.length;fd++){var Oc=$c[fd].settings;if("HAIR"==Oc.type)if("OBJECT"==Oc.render_type){var Lc=Oc.dupli_object;Lc.Gc||
(Lc.Gc=ed.Gc.slice())}else if("GROUP"==Oc.render_type)for(var qd=Oc.dupli_group,nd=0;nd<qd.objects.length;nd++)Lc=qd.objects[nd],Lc.Gc||(Lc.Gc=ed.Gc.slice())}}}for(var ad=a.scenes,Sc=[],wb=0;wb<ad.length;wb++)h(ad[wb].objects,0,b.Wa,Sc);ja[b.id]=[];for(wb=0;wb<Sc.length;wb++)for(var gd=Sc[wb],qc=0;qc<gd.length;qc++)for(var hd=gd[qc],Pc=0;Pc<hd.length;Pc++)ja[b.id].push(hd[Pc]);for(var bd=a.particles,wb=0;wb<bd.length;wb++){var yc=bd[wb].dupli_object;yc&&(yc.$s=!0,ja[b.id].push(yc));var jd=bd[wb].dupli_group;
if(jd)for(var kd=jd.objects,qc=0;qc<kd.length;qc++)yc=kd[qc],yc.$s=!0,ja[b.id].push(yc)}for(var Tc=ja[b.id],wb=Tc.length-1;0<=wb;wb--)Tc[wb].Gc||Tc.splice(wb,1);for(var ld=ja[b.id],Va=0;Va<ld.length;Va++)if(pc=ld[Va],!b.Wa&&pc.parent&&-1<Wc.indexOf(pc.parent.type)&&(pc.parent=""),"MESH"==pc.type){var cd=L.gA(pc);cd&&(a.meshes.push(cd),pc.data=cd)}e(b,c)}function z(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&z(e.objects,b,c)}}function h(a,b,c,d){d[b]=
d[b]||[];for(var e=d[b],f=0;f<a.length;f++){var g=a[f],k=ka(g);e[k]=e[k]||[];(c||-1==Wc.indexOf(g.type))&&-1==e[k].indexOf(g)&&e[k].push(g);(g=g.dupli_group)&&h(g.objects,b+1,c,d)}}function k(a,b,c){var d=[];a=ja[a];for(var e=0;e<a.length;e++){var f=a[e];if(f.type==c||"ALL"==c)for(var h=0;h<f.Gc.length;h++)b==f.Gc[h]&&d.push(f)}return d}function u(a,b,c,d,e){var f=ja[b.id];d=b.id;for(var h=0;h<f.length;h++){for(var g=f[h],k=fa.vk(g.name,g.type,g.origin_name),m=0;m<g.Gc.length;m++)fa.ak(k,g.Gc[m]);
g.oa=k;qa.bi(g,k);k.f.Ic=d;k.Yk=g.$s||!1}d=qa.get_all_objects(b.id);for(h=0;h<f.length;h++)g=f[h],k=g.oa,ga.bi(g,k);if(b.Wa)for(h=b.id,g=0;g<a.scenes.length;g++)for(var k=a.scenes[g],m=0,l=qa.Ia(k,"LAMP",h),n=0;n<l.length;n++)fa.Pa(l[n],k).xh=m++;for(h=0;h<f.length;h++)g=f[h],k=g.oa,k.Yk||(qa.vH(g,k),Fb.n(k));for(a=0;a<f.length;a++)if(h=f[a],g=h.oa,fa.is_mesh(g)&&(k=h.lod_levels.length))for(m=g,l=0;l<k;l++)if(n=h.lod_levels[l].object){n=n.oa;n.f.Ah=g.f.Ah;m.f.fg=h.lod_levels[l].distance;n.f.al=h.lod_levels[l].distance;
if(h.lod_levels[l+1])n.f.fg=h.lod_levels[l+1].distance;else{n.f.ln=!0;n.f.fg=1E6;break}m.f.ln=!1;m=n}else{m.f.ln=!0;m.f.fg=h.lod_levels[l].distance;break}for(f=0;f<d.length;f++)if(a=d[f],"MESH"==a.type&&(h=a.im)){var h=h.f,g=a.f.vi,k=[],q;for(q in g)m=g[q],k.push(4*m.Np,4*m.Of);h.Iv.push(k);h.Wn.push(a.f)}f=q=-1;a=ma.Mu();for(h=0;h<d.length;h++)g=d[h],k=g.f,fa.is_mesh(g)&&k.Yi&&(g=k.sf,g>q&&(q=g),a>=g&&g>f&&(f=g));for(h=0;h<d.length;h++)g=d[h],k=g.f,fa.is_mesh(g)&&k.Yi&&(k.Mk=!0,q<a?k.sf=q:k.sf<=
a?k.sf=f:(S.warn('too many bones for "'+g.name+'" / '+k.sf+" bones (max "+a+" with blending, "+2*a+" without blending). Blending between frames will be disabled."),k.sf=q,k.Mk=!1),k.Mk=k.Mk&&!Tb.xu);for(q=0;q<d.length;q++)if(f=d[q],f.Mc)if(a=f.Zc,"CHASSIS"==a.Oc){f.l={};f.l.Lk=a.Lk;f.l.ek=a.ek;f.l.hs=a.hs;f.l.ks=a.ks;f.l.js=a.js;f.l.Js=a.Js;f.l.Cr=a.Cr;f.l.Yq=a.Yq;f.l.Ei=0;f.l.dk=1;f.l.Dj=0;f.l.speed=0;f.l.Qh=[];f.l.ll=[];f.l.Fj=null;g=(h=fa.get_dg_parent(f))?fa.nq(h,d):d;for(h=0;h<g.length;h++)k=
g[h],k.Mc&&(m=k.Zc,pa.UD(k)&&a.name==m.name?(m=pa.iI(k.Zc.Oc),f.l.Qh[m]=k,f.l.ll[m]=new Float32Array(8)):pa.pv(k)&&a.name==m.name?(f.l.Fj=k,f.l.Ej=m.Ej,f.l.Bl=m.Bl,f.l.Wk=m.Wk,m=na.invert(f.f.h,na.create()),k=na.multiply(m,k.f.h,m),f.l.gx=k,m=new Float32Array([1,0,0]),na.transform_dir_vec3(m,k,m),f.l.fx=m):pa.ov(k)&&a.name==m.name?(f.l.$r=k,f.l.yl=m.yl,f.l.dj=m.dj,m=na.invert(f.f.h,na.create()),k=na.multiply(m,k.f.h,m),f.l.bx=k,m=new Float32Array([1,0,0]),na.transform_dir_vec3(m,k,m),f.l.ax=m):pa.qv(k)&&
a.name==m.name&&(f.l.ls=k,f.l.Bk=m.Bk,m=na.invert(f.f.h,na.create()),k=na.multiply(m,k.f.h,m),f.l.qx=k,m=new Float32Array([1,0,0]),na.transform_dir_vec3(m,k,m),f.l.px=m));if(4!=f.l.Qh.length)throw"Not enough wheels for chassis "+f.name;}else if("HULL"==a.Oc)for(f.l={},f.l.Qh=[],f.l.ll=[],f.l.Lk=a.Lk,f.l.ek=a.ek,f.l.mh=a.mh,f.l.ki=a.ki,f.l.li=a.li,f.l.Ei=0,f.l.dk=1,f.l.Dj=0,f.l.speed=0,f.l.Fj=null,g=(h=fa.get_dg_parent(f))?fa.nq(h,d):d,h=0;h<g.length;h++)k=g[h],k.Mc&&(m=k.Zc,pa.SD(k)&&a.name==m.name?
(f.l.Qh.push(k),f.l.ll.push(new Float32Array(8))):pa.pv(k)&&a.name==m.name?(f.l.Fj=k,f.l.Ej=m.Ej,f.l.Bl=m.Bl,f.l.Wk=m.Wk,m=na.invert(f.f.h,na.create()),k=na.multiply(m,k.f.h,m),f.l.gx=k,m=new Float32Array([1,0,0]),na.transform_dir_vec3(m,k,m),f.l.fx=m):pa.ov(k)&&a.name==m.name?(f.l.$r=k,f.l.yl=m.yl,f.l.dj=m.dj,m=na.invert(f.f.h,na.create()),k=na.multiply(m,k.f.h,m),f.l.bx=k,m=new Float32Array([1,0,0]),na.transform_dir_vec3(m,k,m),f.l.ax=m):pa.qv(k)&&a.name==m.name&&(f.l.ls=k,f.l.Bk=m.Bk,m=na.invert(f.f.h,
na.create()),k=na.multiply(m,k.f.h,m),f.l.qx=k,m=new Float32Array([1,0,0]),na.transform_dir_vec3(m,k,m),f.l.px=m));for(q=0;q<d.length;q++)if(f=d[q],f.vh&&(a=f.Gi,"MAIN_BODY"==a.Oc))for(f.Od={},f.Od.mh=a.mh,f.Od.ki=a.ki,f.Od.li=a.li,f.Od.qm=[],h=(h=fa.get_dg_parent(f))?fa.nq(h,d):d,g=0;g<h.length;g++)k=h[g],k.vh&&(m=k.Gi,pa.WD(k)&&a.name==m.name&&(f.Od.qm.push(k),k.zA=k.Gi.ox));e(b,c)}function w(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];f.Qg=f.camera.oa}for(d=0;d<a.scenes.length;d++){var f=
b.Wa?a.scenes[d]:ia,h=b.Wa?qa.Ia(f,"LAMP",b.id):qa.Ia(f,"LAMP",0),g=qa.Ia(f,"ALL",b.id),m=k(b.id,f,"MESH"),l=k(b.id,f,"EMPTY");b.Wa&&Z.Sz(f,g,h,m,l);for(var n=0;n<l.length;n++)qa.Dx(l[n].oa);g=[];Z.set_active(f);N.WC(f,m,h,g);n=k(b.id,f,"LINE");N.VC(f,n);l=Z.Lu(f);if(b.Wa){n=f.k.Yn;if(n.AF||n.procedural_skydome)n=N.YC(f,n),g.push(n);Z.Bu(l)}for(n=0;n<m.length;n++)N.Yt(m[n].oa,l,f);for(n=0;n<g.length;n++)N.Yt(g[n],l,f),qa.$E(g[n]);g=qa.Ia(f,"ALL",b.id);Z.oA(f,g,h);for(n=0;n<g.length;n++)f=g[n],f.f.qe&&
qa.update_boundings(f)}Z.Tz(ia,a.textures,b.id);b.Wa&&ia.k.Sj.length&&(b.xq=!0);d=a.materials;if(Yb.Lp&&xa.Kx)for(a=0;a<d.length;a++){m=d[a];n=m.texture_slots;for(f=0;f<n.length;f++)if(g=n[f],l=g.texture,"IMAGE"==l.type||"ENVIRONMENT_MAP"==l.type)h=l.image,h.cd||(-1<h.filepath.indexOf(".dds")?h.cd=!0:(h.cd=!l.b4w_disable_compression&&!g.use_map_normal&&"ENVIRONMENT_MAP"!=l.type&&!l.b4w_shore_dist_map&&"MOVIE"!=h.source,h.cd&&(h.filepath+=".dds")));if(f=m.node_tree)for(m=f.nodes,f=0;f<m.length;f++)h=
m[f],"TEXTURE"==h.type&&(n=h.texture)&&(h=n.image)&&!h.cd&&(h.cd=n.k.dm&&!n.b4w_disable_compression&&"MOVIE"!=h.source&&"ENVIRONMENT_MAP"!=n.type,h.cd&&(h.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.cd=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function C(a,b,c,d,e){d=a.groups;for(var f=a.objects,h={},g={},k={},m={},l=0;l<d.length;l++){var n=d[l];h[n.uuid]=n;k[n.uuid]=n}for(l=0;l<f.length;l++)n=f[l],g[n.uuid]=n,m[n.uuid]=n;a=a.scenes;for(l=0;l<a.length;l++)E(a[l].objects,
null,m,k);for(var q in k)q in h||d.push(k[q]);for(q in m)q in g||f.push(m[q]);e(b,c)}function E(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var h=a[f],g=c[h.uuid];if(h=g.proxy){b&&-1==e.indexOf(h.uuid)&&e.push(h.uuid);for(var k=c[h.uuid],m=k.constraints,h=0;h<m.length;h++){var l=Ba.ah(m[h]);l.name+="_CLONE";g.constraints.push(l)}"b4w_proxy_inherit_anim"in g&&!g.b4w_proxy_inherit_anim||(g.animation_data&&(k.animation_data=Ba.ah(g.animation_data)),k.b4w_use_default_animation=g.b4w_use_default_animation,
k.b4w_auto_skel_anim=g.b4w_auto_skel_anim,k.b4w_anim_behavior=g.b4w_anim_behavior,k.b4w_cyclic_animation=g.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)g=Ba.sD(a,e[f]),-1<g&&a.splice(g,1);e={};if(b)for(f=0;f<a.length;f++)h=a[f],g=c[h.uuid],m=Ba.ah(g),g="origin_name"in g?g.origin_name:g.name,m.name=fa.Au(b.name,g),m.origin_name=g,m.dg_parent={uuid:b.uuid},G(m),c[m.uuid]=m,e[h.uuid]=m.uuid,h.uuid=m.uuid;for(f=0;f<a.length;f++)h=a[f],g=c[h.uuid],g.dupli_group&&(h=g.dupli_group,m=d[h.uuid],k=Ba.ah(m),
k.name=Ba.Oj(m.name+"_CLONE"),k.uuid=Ea.dv("Group"+k.name),d[k.uuid]=k,h.uuid=k.uuid,E(k.objects,g,c,d));if(b)for(f=0;f<a.length;f++){h=a[f];g=c[h.uuid];g.parent&&g.parent.uuid in e?g.parent.uuid=e[g.parent.uuid]:g.parent&&(S.warn("Object's \""+g.name+'" parent is not in dupli group. Disabling parenting.'),g.parent=null);m=g.constraints;for(h=0;h<m.length;h++)b=m[h],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);if(b=g.pose)for(d=b.bones,h=0;h<d.length;h++)if(m=d[h].constraints)for(k=
0;k<m.length;k++)b=m[k],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=g.modifiers;for(h=0;h<b.length;h++)d=b[h],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((g=g.lod_levels)&&g.length)for(h=0;h<g.length;h++)b=g[h],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var n in e)hb[n]=e[n]}function G(a){a.uuid=Ea.dv("Object"+a.name)}function m(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&x(e,"texture",b);"LAMP"==
e.type&&e.lamp&&(e.lamp.uuid in hb&&(e.lamp.uuid=hb[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&x(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];A(f,"from_node",c);A(f,"to_node",c);r(f,"from_socket",f.from_node.outputs);r(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&x(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&x(e.strips[f],"action",b)}function x(a,
b,c){(c=c[a[b].uuid])||S.error("Dangling link found:",b,a);a[b]=c}function A(a,b,c){c=Ba.keysearch("name",a[b].name,c);a[b]=c}function r(a,b,c){c=Ba.keysearch("identifier",a[b].identifier,c);a[b]=c}function e(a,c,d,e,f,h){e=R(c.kf);for(var g=a.images,k={},m=[],l=0;l<g.length;l++){var n=g[l],q=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var r=J(n,a.textures);if(!r.length)S.warn("image ",n.name," has no users.");else if(!r[0].b4w_shore_dist_map){r=Ba.bl(e+n.filepath);if("FILE"===n.source){var t=
n.cd?la.AT_ARRAYBUFFER:la.AT_IMAGE_ELEMENT;Yb.Zq&&xa.po&&(r=la.zl(r),"dds"==r[1]?(r=la.zl(r[0]),r=r[0]+".min50."+r[1]+".dds"):r=r[0]+".min50."+r[1])}else"MOVIE"===n.source&&(xa.tl?(r=la.zl(r),r=r[0]+".altconv.seq",t=la.Rl):(r=la.zl(r),t=ya.detect_video_container(r[1]),r=t!=r[1]?r[0]+".altconv."+t:r[0]+"."+t,t=la.Sl));m.push({id:q,type:t,url:r});k[q]=n}}}if(m.length){var p=0;la.enqueue(m,function(e,f,g,l){if(e){if(g==la.Sl||g==la.Rl){if(g==la.Sl)var n=e.videoWidth,q=e.videoHeight;else n=e.images[0].width,
q=e.images[0].height;S.log("%cLOAD VIDEO "+n+"x"+q,"color: #"+(2048<n||2048<q?"a00":1024<n||1024<q?"aa0":"0a0"),l);-1==l.indexOf(Mc)&&S.warn("video",l,"is not from app root.")}else b(e,l,!0);f=k[f];l=J(f,a.textures);for(n=0;n<l.length;n++){var q=l[n],r=q.image.filepath;g==la.Rl?(q.k.Jr=e.lf,Ja.Gl(q.k,e.images,f.cd,r,c.id)):Ja.Gl(q.k,e,f.cd,r,c.id)}}e=++p/m.length;h(c,d,e)},function(){S.log("%cLOADED ALL IMAGES","color: #0a0");f(c,d)})}else f(c,d)}function v(a,b,c,d,e){a=Z.Pu();for(d=0;d<a.length;d++){var f=
a[d];if(f.b4w_use_nla){var h=f.b4w_nla_cyclic;f.b4w_use_logic_editor&&(h=!1);ga.yH(f,h,b.id)}}e(b,c)}function J(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function D(a,b,c,d,e,f){a=R(b.kf);var h=[],g={};d=qa.get_all_objects(b.id);for(var k=0;k<d.length;k++){var m=d[k];if(H(m)){var l=m.F.fi;"BACKGROUND_MUSIC"==ya.qq(m)?(l=Ba.iq(),b.vq=!0):"NONE"!=ya.qq(m)&&xa.Bq&&(b.Aq=!0);if(!(l in g)){g[l]=[];var n=Ba.bl(a+m.F.kf);switch(ya.$w(m)){case ya.Do:var q=la.AT_AUDIOBUFFER;
break;case ya.Ls:q=la.AT_AUDIO_ELEMENT}var n=la.zl(n),r=ya.detect_audio_container(n[1]),n=r!=n[1]?n[0]+".altconv."+r:n[0]+"."+r;h.push({id:l,type:q,url:n})}g[l].push(m)}}if(h.length){var t=0;la.enqueue(h,function(a,d,e,k){if(a)for(S.log("%cLOAD SOUND","color: #0aa",k),-1==k.indexOf(Mc)&&S.warn("sound",k,"is not from app root."),d=g[d],e=0;e<d.length;e++)ya.CH(d[e],a);a=++t/h.length;f(b,c,a)},function(){S.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)})}else e(b,c)}function H(a){return fa.is_speaker(a)&&
ya.$w(a)!=ya.Ms}function I(a,b,c){a=qa.Ia(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];fa.is_speaker(d)&&(ya.is_cyclic(d)||c)&&ya.play_def(d)}}function P(a,b){for(var c=a.k.Sj,d=0;d<c.length;d++){var e=c[d].k;a.b4w_use_nla&&c[d].b4w_nla_video||!c[d].use_auto_refresh||b!=e.Ef||(Ja.reset_video(e.name,b),Ja.play_video(e.name,b))}}function K(a,b,c,d,e){ga.start();S.log("%cSTART NLA","color: #0a0");e(b,c)}function y(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<
e;f++){var h=b.lod_levels[f],g=h.object;if(g){var k=Ba.mk(g);k.name=b.name+"_LOD_"+String(f+1);G(k);k.lod_levels=[];c.push([a,k]);d.push(g);h.object=k}}}function F(a,b,c,d,e){d=!0;for(var f=0;f<a.scenes.length;f++)if(!pa.ZA(a.scenes[f])){d=!1;break}d&&(e(b,c),S.log("%cPHYSICS READY","color: #0a0"))}function M(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(b.Wa)var h=pa.On(f);else h=pa.On(ia)||pa.On(f),f=ia;if(fc.enabled&&h)for(h=0;h<Gb.length;h++)for(var g=qa.Ia(f,Gb[h],b.id),k=0;k<
g.length;k++){var m=g[k];m.f.Ic==b.id&&(pa.append_object(m,f),b.Av&&pa.P(m)&&pa.disable_simulation(m))}}e(b,c)}function O(a,c,d,e,f){var h={};e=[];for(var g=a.scenes,k=0;k<a.scenes.length;k++){var m=g[k];if(m.k.Lb&&(m=m.k.Lb.Vn)&&"FILE"===m.source){var l=m.uuid,n=Ba.bl(R(c.kf)+m.filepath);e.push({id:l,type:m.cd?la.AT_ARRAYBUFFER:la.AT_IMAGE_ELEMENT,url:n});h[l]=m}}e.length?la.enqueue(e,function(d,e,f,k){if(d){b(d,k,!0);e=h[e];k=J(e,a.textures);for(f=0;f<k.length;f++){var m=k[f];Ja.Gl(m.k,d,e.cd,m.image.filepath,
c.id)}for(f=0;f<g.length;f++)if(k=g[f],k.k.Lb.Vn===e){var l=d,n=document.createElement("canvas"),m=e.size[0],q=e.size[1];n.width=m;n.height=q;n=n.getContext("2d");n.drawImage(l,0,0);l=n.getImageData(0,0,m,q).data;n=new Float32Array(4);n[0]=1/16581375;n[1]=1/65025;n[2]=1/255;n[3]=1;for(var m=m*q,q=new Float32Array(m),r=0;r<m;r++)q[r]=n[1]*l[4*r+2]+n[2]*l[4*r+3];k.k.Sr=q}}},function(){f(c,d)}):f(c,d)}function V(a,c,d,e,f){e=a.scenes[0];a=[];for(var h=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION",
"SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],g=0;g<h.length;g++){var k=Z.Z(e,h[g]);k&&a.push(k)}if(a.length){e=[];g=la.AT_IMAGE_ELEMENT;e.push({id:"SEARCH_TEXTURE",type:g,kf:aa.Bc.smaa_search_texture_path});e.push({id:"AREA_TEXTURE",type:g,url:aa.Bc.smaa_area_texture_path});for(g=0;g<a.length;g++)if(h=a[g],"SMAA_BLENDING_WEIGHT_CALCULATION"==h.type){a=h.la;for(g=0;g<a.length;g++)if(h=a[g],"u_search_tex"==h.to)var m=h.va;else if("u_area_tex"==h.to)var l=h.va;break}e.length?la.enqueue(e,function(a,
d,e,f){a&&(b(a,f,!1),d="SEARCH_TEXTURE"==d?m:l,d.source="IMAGE",d.bJ=!0,Ja.Gl(d,a,-1!=f.indexOf(".dds")?1:0,f,c.id),Ja.ul(d,Ja.r,Ja.r))},function(){f(c,d)}):f(c,d)}else f(c,d)}function T(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];b.Wa||(e=ia);for(var f=qa.Ia(e,"LAMP",b.id),h=0;h<f.length;h++){var g=f[h];g.f.Ic==b.id&&d.Ko.push({Ea:e,obj:g})}f=qa.Ia(e,"ALL",b.id);for(h=0;h<f.length;h++)g=f[h],"LAMP"!=g.type&&g.f.Ic==b.id&&(b.Av&&fa.is_mesh(g)&&Z.ik(g,!0),d.Ko.push({Ea:e,obj:g}))}}function U(a,
b,c,d,e,f){var h=d.Ko;e=d.Uv;if(h.length){a=h[e].obj;var g=h[e].Ea;e=fa.Pa(a,g);Z.append_object(g,a,!1);a.anchor&&ea.append(a);d=++d.Uv/h.length;h=e.Sf;if(null!=a.f.Kd&&h){var k=Bb.copy(a.f.Ub.I,mb);Z.Cx(h,k)}h=a.ql;if(h.length&&g.k.rg)for(g=na.get_trans_view(a.f.h),a=na.get_quat_view(a.f.h),e=e.Je,k=0;k<e.length;k++)Z.Fx(e[k],g,a),fa.Gx(h,e[k].j.cc)}else d=1;f(b,c,d)}function B(a,b,c,d,e){if(b.Wa){a=Z.Qi();d=Z.Pu();for(var f=0;f<d.length;f++){var h=d[f];Z.qF(h,a);h.b4w_use_logic_editor&&ua.OD(h,
b.id)}Z.set_active(a)}else Z.ys(ia);a=qa.get_all_objects(b.id);qa.wH(a);e(b,c)}function ha(a,b,c,d,e){if(b.Wa)for(d=0;d<a.scenes.length;d++)P(a.scenes[d],b.id),I(a.scenes[d],b.id);else P(ia,b.id),I(ia,b.id);e(b,c)}function ba(a,b,c,d,e){for(d=0;d<a.scenes.length;d++)a.scenes[d].camera=null;xa.media_auto_activation&&(b.xq||b.vq||b.Aq)?Ca||da(a,e,b,c):e(b,c)}function da(a,b,c,d){var e=Ub.parentElement;Qc=e.style.zIndex;e.style.zIndex="999";Ca=document.createElement("div");Ca.style.position="relative";
Ca.style.height="88px";Ca.style.width="88px";var f=Math.round(Ub.offsetWidth/2-44);Ca.style.top=Math.round(Ub.offsetHeight/2-44).toString()+"px";Ca.style.left=f.toString()+"px";Ca.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
Ca.style.backgroundSize="88px";Za=document.createElement("div");Za.style.position="relative";Za.style.height=Ub.offsetHeight.toString()+"px";Za.style.width=Ub.offsetWidth.toString()+"px";Za.style.background="rgba(0, 0, 0, 0.5)";Za.style.zIndex="999";e.appendChild(Za);Za.appendChild(Ca);Ca.addEventListener("click",function(){c.xq&&(Ja.play(),Ja.pause(),Ja.reset());if(c.vq){if(c.Wa)for(var e=0;e<a.scenes.length;e++)I(a.scenes[e],c.id,!0);else I(ia,c.id,!0);ya.pause()}c.Aq&&ya.gw();W();b(c,d)},!1)}function W(){if(Ca){var a=
Ub.parentElement;a.style.zIndex=Qc;Za.removeChild(Ca);a.removeChild(Za);Ca=Za=null;Qc=0}}function R(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function Y(a,b,c){ma.is_animated(b)&&ma.remove(b);qa.clear_outline_anim(b);X.check_sensor_manifold(b)&&X.remove_sensor_manifold(b);pa.P(b)&&pa.xF(b);Z.yF(a,b,c);fa.is_speaker(b)&&ya.xG(b);ea.is_anchor(b)&&ea.remove(b)}function ka(a){var b=ma.Gu(a);return(a=b&&b.parent==a?null:a.parent||b)?1+ka(a):0}var ea=p("__anchors"),ma=p("__animation"),
la=p("__assets"),N=p("__batch");p("__camera");var aa=p("__config"),X=p("__controls"),Q=p("__dds"),sa=p("__extensions");p("__lights");var ca=p("__loader");p("__mat4");var Ea=p("__md5"),ga=p("__nla"),ua=p("__logic_nodes"),Aa=p("__nodemat"),qa=p("__objects"),fa=p("__obj_util"),pa=p("__physics"),S=p("__print"),L=p("__reformer"),Ia=p("__renderer"),Z=p("__scenes"),ya=p("__sfx"),ra=p("__shaders"),Ja=p("__textures"),oa=p("__time"),Fb=p("__transform"),na=p("__tsr"),Ba=p("__util"),Bb=p("__vec3"),xa=aa.p,Yb=
aa.ve,fc=aa.o,Tb=aa.Vg,db=aa.F,xb=null,ja=null,Mc="",ia=null,hb={},mb=new Float32Array(3),Ca=null,Za=null,Qc=0,ta=!1,Wc=["LAMP","CAMERA"],Gb=["MESH","CAMERA","EMPTY"],Ub=null;a.is_primary_loaded=function(a){return ca.is_primary_loaded(a)};a.update=function(){ca.zH(xb)};a.kG=function(a){Ub=a};a.tH=function(a,b){if(Ca){Za.style.height=b.toString()+"px";Za.style.width=a.toString()+"px";var c=Math.round(a/2-44);Ca.style.top=Math.round(b/2-44).toString()+"px";Ca.style.left=c.toString()+"px"}};a.load=function(a,
b,h,k,m){var l={load_main:{kb:ca.Ng,sb:!1,H:[],ub:!1,vb:500,Kb:!1,Bb:c},duplicate_objects:{kb:ca.Fc,sb:!1,H:["load_main"],ub:!1,vb:50,Kb:!1,Bb:C},load_binaries:{kb:ca.Ng,sb:!1,H:["load_main"],ub:!1,vb:500,Kb:!1,Bb:q},wait_for_shaders:{kb:ca.Fc,sb:!1,H:[],ub:!1,vb:50,Kb:!0,Qf:f},prepare_bindata:{kb:ca.Fc,sb:!1,H:["duplicate_objects","load_binaries"],ub:!1,vb:100,Kb:!1,Bb:t},prepare_bpy_data:{kb:ca.Fc,sb:!1,H:["duplicate_objects","prepare_bindata"],ub:!1,vb:100,Kb:!1,Bb:g},process_objects:{kb:ca.Fc,
sb:!1,H:["prepare_bpy_data"],ub:!1,vb:150,Kb:!1,Bb:u},process_scenes:{kb:ca.Fc,sb:!1,H:["process_objects","wait_for_shaders"],ub:!1,vb:300,Kb:!1,Bb:w},load_smaa_textures:{kb:ca.Ng,sb:!1,H:["process_scenes"],ub:!1,vb:30,Kb:!0,Bb:V},load_shoremap:{kb:ca.Ng,sb:!1,H:["process_scenes"],ub:!1,vb:30,Kb:!0,Bb:O},load_textures:{kb:ca.Ng,sb:!0,H:["process_scenes"],ub:!0,vb:500,Kb:!1,Bb:e},update_scenes_nla:{kb:ca.Fc,sb:!1,H:["process_scenes","load_textures"],ub:!1,vb:50,Kb:!1,Bb:v},wait_physics_workers:{kb:ca.Fc,
sb:!1,H:["load_shoremap"],ub:!1,vb:20,Kb:!1,Qf:F},add_physics_objects:{kb:ca.Fc,sb:!1,H:["wait_physics_workers"],ub:!1,vb:50,Kb:!1,Bb:M},add_objects:{kb:ca.Fc,sb:!1,H:["add_physics_objects"],ub:!1,vb:600,Kb:!1,Bb:T,Qf:U,gk:B,hk:{Ko:[],Uv:0}},load_speakers:{kb:ca.Ng,sb:!0,H:["add_objects"],ub:!0,vb:100,Kb:!1,Bb:D},mobile_media_start:{kb:ca.Fc,sb:!1,H:["load_textures","update_scenes_nla","load_speakers"],ub:!0,vb:5,Kb:!1,Bb:ba,Qf:ba},synchronize_media:{kb:ca.Fc,sb:!0,H:["mobile_media_start"],ub:!0,
vb:50,Kb:!1,Bb:ha},start_nla:{kb:ca.Fc,sb:!0,H:["mobile_media_start"],ub:!1,vb:5,Kb:!0,Bb:K}},n=ca.Su();n||(n=ca.EB(),xb={},ja={},hb={});xb[n.Qe.length]={};return ca.NB(l,a,b,h,d,k||db.pt,xa.do_not_load_resources,m)};a.unload=function(a){var b=ca.Su();if(!b||!b.Qe.length||a&&!ca.RG(b.Qe[a]))S.error("Unable to unload data!");else{if(0==a)S.log("%cUNLOAD ALL","color: #00a"),ea.cleanup(),ma.cleanup(),ya.cleanup(),ga.cleanup(),Z.cleanup(),ca.cleanup(),pa.cleanup(),qa.cleanup(),Ba.cleanup(),Ia.cleanup(),
Aa.cleanup(),ra.cleanup(),X.cleanup(),sa.cleanup(),la.cleanup(),Ja.cleanup(),ua.cleanup(),ja=null,hb={},xb=ia=null,ta=!1;else{S.log("%cUNLOAD DATA "+a,"color: #00a");ma.wF(a);for(var b=Z.Mi(),c=0;c<b.length;c++)for(var d=b[c],e=qa.Ia(d,"ALL",a),f=e.length-1;0<=f;f--){var h=e[f];Y(d,h,!0);qa.remove_object(h)}}W()}};a.pF=Y;a.set_debug_resources_root=function(a){Mc=a};a.activate_media=function(){ta||xa.media_auto_activation||(Ja.play(),Ja.pause(),Ja.reset(),I(ia,qa.DATA_ID_ALL,!0),ya.pause(),xa.Bq&&
ya.gw(),ta=!0)}};b4w.module.__batch=function(a,p){function d(a){a={type:a,fb:"",id:0,zF:0,lj:"",U:[],ic:[],rd:[],tk:[],gi:null,Yb:{},dc:null,wb:{Rj:null,Ji:null,Wf:[],ig:[]},jm:[],KK:null,O:null,qe:!1,gh:!1,cu:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,rv:0,sv:0,Uu:0,rq:0,Kc:new Float32Array(3),hd:new Float32Array(16),Tg:!1,Za:!1,Ot:!1,pa:!1,Hf:!1,mb:!1,Fd:!1,De:!1,Uc:!1,Vc:!1,wc:!1,Cc:!1,tc:!1,Rc:!1,$b:!1,ow:!1,Ce:da.Vj,Jf:da.Ve,mp:!1,nh:!1,tF:"",UK:"",Wu:!1,$u:0,Xu:0,av:0,bv:0,Zu:new Float32Array(3),Yu:new Float32Array(3),
qh:!1,We:0,gf:0,Vf:1,reflect_factor:0,Yh:0,Yr:1,parallax_scale:0,Uf:0,Lf:1,Qv:0,$q:0,Ih:0,Aw:0,kd:Array(2),Wc:new Float32Array(3),Ag:new Float32Array(3),Ne:new Float32Array(3),rc:new Float32Array(4),he:new Float32Array(4),$i:null,Mq:null,Kq:null,Jq:null,Lq:null,Ui:!1,Ig:!1,water_dynamic:!1,Ao:!1,ay:!1,by:0,cy:0,$x:0,Tj:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,vu:new Float32Array(2),uu:new Float32Array(2),cq:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
Hh:null,wr:!1,Da:null,on:0};a.rc[3]=1;a.Ot=!0;a.pa=!0;a.on=1;return a}function b(a){switch(a.type){case "MAIN":case "PARTICLES":case "LINE":a.fb=a.Za?a.Hf?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.fb=a.Ui?"NODES":"DEPTH";break;case "COLOR_ID":a.fb=a.Hf?"COLOR_ID_XRAY":"COLOR_ID"}}function c(a){var b=a.O;a.O=null;var c=Y.yi(a);a.O=b;c.O=b;return c}function q(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=e.oa.f,h=U.$c();U.zm(f.ti,h);var g=e.data.b4w_bounding_cylinder_radius,k=e.data.b4w_bounding_sphere_radius,
m=e.data.b4w_bounding_sphere_center,n=e.data.b4w_bounding_ellipsoid_axes,q=e.data.b4w_bounding_ellipsoid_center;if(f.ae){var g=Math.max(Math.abs(h.max_x),Math.abs(h.min_x)),k=Math.max(Math.abs(h.max_y),Math.abs(h.min_y)),r=Math.max(Math.abs(h.max_z),Math.abs(h.min_z)),r=Math.sqrt(g*g+k*k+r*r),g=Math.sqrt(g*g+k*k);h.max_x=h.max_y=h.max_z=r;h.min_x=h.min_y=h.min_z=-r;k=r;m[0]=m[1]=m[2]=0;n[0]=n[1]=n[2]=r;q[0]=q[1]=q[2]=0}f.Zb=h;r=U.fp(h,f.h);f.Ab=r;l(f,g,g,h);h=U.Cm(k,m);f.fd=h;h=U.hp(h,f.h);f.Ub=h;
n=U.Bm([n[0],0,0],[0,n[1],0],[0,0,n[2]],q);f.Ze=n;n=U.gp(n,f.h);f.Nf=n;c=c.concat(t(e,f,b))}return c}function f(a,b,c){for(var d=[],e=[],f={},h=0;h<a.length;h++){var g=a[h],k=g.oa.f,m=U.$c();U.zm(k.ti,m);var l=U.fp(m,k.h),n=U.Cm(g.data.b4w_bounding_sphere_radius,g.data.b4w_bounding_sphere_center),q=U.hp(n,k.h),r=g.data.b4w_bounding_ellipsoid_axes,r=U.Bm([r[0],0,0],[0,r[1],0],[0,0,r[2]],g.data.b4w_bounding_ellipsoid_center),p=U.gp(r,k.h);k.Zb=m;k.Ab=l;k.fd=n;k.Ub=q;k.Ze=r;k.Nf=p;m={};m.Uc=k.Uc;m.Vc=
k.Vc;m.wc=k.wc;m.yf=k.yf;m.Bn=k.Bn;m.Jb=k.Jb;m.An=k.An;m.mj=k.mj;m.Cc=k.Cc;m.tc=k.tc;m.Rc=k.Rc;m.Kd=k.Kd;m.vd=k.vd;m.Ke=k.Ke;m.af=k.af;m.Hd=k.Hd;m.qf=k.qf;m.qc=k.qc;m.ae=k.ae;m.ck=k.ck;m.bk=k.bk;m.$b=k.$b;m.ih=k.ih;m.Hm=k.Hm;m.rf=k.rf;m.Ch=k.Ch;m.sn=k.sn;m.sd=k.sd;m.Bh=k.Bh;m.tn=k.tn;m.De=k.De;l=k.Ub.I;m.ID=0==c?[0,0]:[Math.floor(l[0]/c),Math.floor(l[2]/c)];m.fg=k.fg;m.al=k.al;m.Ah=k.Ah;m.Im=k.Im;k=JSON.stringify(m);f[k]=f[k]||[];f[k].push(g)}for(var u in f){m=JSON.parse(u);c=f[u];var g=Y.zi("STATIC"),
A;for(A in m)g[A]=m[A];g.Ic=a[0].oa.f.Ic;g.Te=0;g.Gf=0;g.ff=0;g.ef=0;g.$e=0;g.rh=!1;for(h=0;h<c.length;h++)k=c[h].oa,0==h?(g.Ab=ca.xa(k.f.Ab),g.Ub=ca.xa(k.f.Ub),g.Ze=ca.xa(k.f.Ze),g.Nf=ca.xa(k.f.Nf)):(U.ou(g.Ab,k.f.Ab),U.qC(g.Ub,k.f.Ub));g.Zb=ca.xa(g.Ab);g.fd=ca.xa(g.Ub);e.push({f:g,CA:c})}for(a=0;a<e.length;a++)for(f=e[a].f,h=e[a].CA,u=0;u<h.length;u++){A=h[u];c=A.oa.f;g=t(A,f,b);k=sa.create();c.ae&&!c.bp?(m=sa.get_trans_view(c.h),sa.set_trans(m,k)):sa.copy(c.h,k);m={};if(f.Hd||f.ae)m.au_center_pos=
[k[0],k[1],k[2]];f.Hd&&(m.au_wind_bending_amp=[c.Te],m.au_wind_bending_freq=[A.b4w_wind_bending_freq],m.au_detail_bending_amp=[A.b4w_detail_bending_amp],m.au_detail_bending_freq=[A.b4w_detail_bending_freq],m.au_branch_bending_amp=[A.b4w_branch_bending_amp]);for(l=0;l<g.length;l++)r=g[l].f,n=g[l].Cd,q=g[l].G,r.hn?r.ae?da.JG(n,k):da.kx(n,k):("COLOR_ID"==q.type&&(g[l].f=c,q.lj=A.uuid,x(q,c),r=P(c),I(q,r)),n=da.kx(n,k),da.IG(n,m));d=d.concat(g)}return d}function t(a,b,c){var e=[],f=n(c,b),h=P(b),k=a.data,
m=k.materials,l=Array(m.length),q=aa.qb(c,"MAIN_OPAQUE"),r=!1;q&&(r=q.nn.length?!0:!1);for(var t=0;t<f.length;t++)for(var p=f[t],u=0;u<m.length;u++){var A=m[u];if(("LENS_FLARES"!=A.name||r)&&!da.cv(k,u)){var w=d(p);"COLOR_ID"==p&&(w.mp=!(a.b4w_do_not_render||A.b4w_do_not_render));"MAIN"==p&&(l[u]=w);if(H(w,A)){"DEPTH"==p&&l[u]&&(w.Fd=l[u].Fd);w.Ce=b.qe||b.De?da.Ul:da.Vj;x(w,b);for(var N=w,z=a.particle_systems,y=0;y<z.length;y++){var C=z[y].settings.b4w_vcol_from_name,O=z[y].settings.b4w_vcol_to_name;
""!==C&&""!==O&&(N.Yb[C]={ph:!1,src:[{name:C,Sd:7}]})}"DYNAMIC"==b.type&&(w.lj=a.uuid);I(w,h);var B=da.ru(k,u,w.tk,b.vi,w.Yb,w.gi);"LENS_FLARES"==A.name&&(B=ka.oF(B));e.push({G:w,Cd:B,Nc:[A.name],f:b,yd:[a]})}}}var E=a.particle_systems;if(0<E.length&&e.length){for(var F=!1,Q=!1,t=0;t<E.length;t++){var K=E[t],G=K.settings;G.use_render_emitter&&(F=!0);"HAIR"!=G.type||"OBJECT"!=G.render_type&&"GROUP"!=G.render_type&&K.transforms.length||(Q=!0);if(F&&Q)break}var V=e[0].G.Yb,T;if(Q){var M;if(1<m.length){for(var J=
{},U=0;U<E.length;U++){var ea=E[U].settings;if("HAIR"==ea.type&&("OBJECT"==ea.render_type||"GROUP"==ea.render_type)){var ga=ea.b4w_vcol_from_name,ma=ea.b4w_vcol_to_name;""!==ga&&""!==ma&&(J[ga]=ca.xa(V[ga]))}}"a_bending_col_main"in V&&(J.a_bending_col_main=ca.xa(V.a_bending_col_main));"a_bending_col_detail"in V&&(J.a_bending_col_detail=ca.xa(V.a_bending_col_detail));M=da.su(k,[],J)}else M=e[0].Cd;T=M}else T=null;for(var R,W=T,ba=a.oa,fa=[],qa=a.particle_systems,Aa=a.data,pa=0;pa<qa.length;pa++){var kb=
qa[pa],ab=kb.settings;if(ab.count)if("EMITTER"==ab.type){if("DYNAMIC"==b.type){var Na=d("PARTICLES"),ib,$b=Aa.materials,jb=kb.settings.material-1;jb>=$b.length&&(ha.warn('Wrong material used for rendering particle system "'+kb.name+'"'),jb=0);ib=$b[jb];"HALO"===kb.settings.render_type&&(Na.qh=!0);g(Na,ib);var Oa=Na,Ma=a,Fa=kb.settings;switch(Fa.b4w_billboard_align){case "VIEW":v(Oa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":v(Oa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":v(Oa,
"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":v(Oa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}v(Oa,"BILLBOARD",0);var Hc=Fa.b4w_enable_soft_particles&&Y.It(Ma,Fa);Fa.b4w_enable_soft_particles&&!Hc&&ha.warn('Emitter object "'+Ma.name+'" has a particle settings "'+Fa.name+'", which uses material with incorrect type of alpha.');v(Oa,"SOFT_PARTICLES",0<Fa.b4w_particles_softness&&Hc&&ua.Ck?1:0);v(Oa,"SOFT_STRENGTH",X.t(Fa.b4w_particles_softness));
X.K(Oa.wb,"WORLD_SPACE","WORLD"==Fa.b4w_coordinate_system?1:0);Na.De=!0;Na.lj=ba.name+"_"+ab.uuid;Na.tF=kb.name;I(Na,h);ka.PD(Na,kb,ib);var Wa=ka.QC(Na,Aa,kb,ba.f.h);fa.push({G:Na,Cd:Wa,Nc:[ib.name],f:b,yd:[a]})}}else if("HAIR"==ab.type){var ub=ca.dn(kb.seed);ab.b4w_dynamic_grass&&(b.ih=!0);var Ra=la.Jt(ua.Uq)&&!ab.b4w_initial_rand_rotation&&!ab.b4w_hair_billboard,za=4;Ra&&(za=8);if(kb.transforms.length)var Ka=kb.transforms;else for(var bb=da.kq(W,ab.count,!1,ub),Ka=new Float32Array(bb.length*za),
Da=0;Da<bb.length;Da++){var $a=.75+.5*ca.Vd(ub);Ka[Da*za]=bb[Da][0];Ka[Da*za+1]=bb[Da][1];Ka[Da*za+2]=bb[Da][2];Ka[Da*za+3]=$a;Ra&&(Ka[Da*za+4]=1,Ka[Da*za+5]=0,Ka[Da*za+6]=0,Ka[Da*za+7]=0)}var Lb=aa.qb(c,"GRASS_MAP")?!0:!1;if("OBJECT"==ab.render_type)var yb=[n(c,ab.dupli_object.oa.f,!0)],Bc=D(a,b,V,W,[ab.dupli_object],yb,[Ka],ab,kb,Lb,ub,!1),fa=fa.concat(Bc);else if("GROUP"==ab.render_type){for(var Sa=ab.dupli_group.objects,yb=[],Da=0;Da<Sa.length;Da++){var Yc=n(c,Sa[Da].oa.f,!0);yb.push(Yc)}for(var Ic=
!1,Pb=[],Da=0;Da<Sa.length;Da++)Pb.push(Sa[Da].oa);if(ab.use_whole_group){for(var Vb,Cb=Ka,hc=Pb,Jc=Ra,ic=za,zb={},Qa=new Float32Array([0,0,0,1]),Ha=0;Ha<Cb.length;Ha+=ic)for(var Ya=0;Ya<hc.length;Ya++){var Db=Ea.create(),Ib=sa.get_scale(hc[Ya].f.h),ac=sa.get_trans_view(hc[Ya].f.h);Ea.scale(ac,Ib,Db);var Jb=Ea.clone([Cb[Ha],Cb[Ha+1],Cb[Ha+2]]);zb[Ya]||(zb[Ya]=new Float32Array(Cb.length));Jc&&(zb[Ya][Ha+4]=Qa[0]=Cb[Ha+4],zb[Ya][Ha+5]=Qa[1]=Cb[Ha+5],zb[Ya][Ha+6]=Qa[2]=Cb[Ha+6],zb[Ya][Ha+7]=Qa[3]=Cb[Ha+
7],ca.sr(Qa,Qa),ca.VG(Db,Qa,Db));Ea.add(Jb,Db,Jb);zb[Ya][Ha]=Jb[0];zb[Ya][Ha+1]=Jb[1];zb[Ya][Ha+2]=Jb[2];zb[Ya][Ha+3]=Cb[Ha+3]}Vb=zb;Ic=!0}else{var rb;if(ab.use_group_count){for(var Mb=Ka,gc=Pb,tb=ab.dupli_weights,Qb=ub,jc=Ra,Cc=za,Ta={},fb=[],va=0;va<gc.length;va++)for(var wa=gc[va],lb=wa.Jh||wa.name,cb=0;cb<tb.length;cb++){var Wb=tb[cb];lb==Wb.name&&fb.push(Wb)}tb.length!=fb.length&&ha.error("dupli weights match failed");for(va=0;va<Mb.length;va+=Cc){for(var Pa,sc=fb,nb=[0],vb=0;vb<sc.length;vb++)nb[vb+
1]=nb[vb]+sc[vb].count;for(var Rb=nb[nb.length-1]*ca.Vd(Qb),Nb=0,vb=0;vb<nb.length;vb++)if(Rb>=nb[vb]&&Rb<nb[vb+1]){Nb=vb;break}Pa=Nb;Ta[Pa]=Ta[Pa]||[];Ta[Pa].push(Mb[va],Mb[va+1],Mb[va+2],Mb[va+3]);jc&&Ta[Pa].push(Mb[va+4],Mb[va+5],Mb[va+6],Mb[va+7])}for(Pa in Ta)Ta[Pa]=new Float32Array(Ta[Pa]);rb=Ta}else{for(var Ab=Ka,bc=ub,tc=Ra,uc=za,cc=Pb.length,ob={},La=0;La<Ab.length;La+=uc){var eb=Math.floor(cc*ca.Vd(bc));ob[eb]=ob[eb]||[];ob[eb].push(Ab[La],Ab[La+1],Ab[La+2],Ab[La+3]);tc&&ob[eb].push(Ab[La+
4],Ab[La+5],Ab[La+6],Ab[La+7])}for(eb in ob)ob[eb]=new Float32Array(ob[eb]);rb=ob}Vb=rb}Bc=D(a,b,V,W,Sa,yb,Vb,ab,kb,Lb,ub,Ic);fa=fa.concat(Bc)}"INSTANCE"==ab.b4w_wind_bend_inheritance&&ba.f.Hd&&ha.warn('Emitter object "'+ba.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";}R=fa;e=F?e.concat(R):R}return e}function l(a,b,c,d){a.Zo=U.Xt(b,d);a.Xo=
U.Vt(c,d);a.Yo=U.Wt(b,d)}function n(a,b,c){var d;b.Im&&!c?(d=[],b.yf&&aa.qb(a,"COLOR_PICKING")&&d.push("COLOR_ID")):(d=["MAIN","NODES_GLOW"],(b.yf&&aa.qb(a,"COLOR_PICKING")||b.Jb&&aa.qb(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID"),aa.qb(a,"WIREFRAME")&&d.push("WIREFRAME"),((b.Uc||b.wc)&&aa.qb(a,"DEPTH")||aa.qb(a,"SHADOW_CAST"))&&d.push("DEPTH"),aa.qb(a,"GRASS_MAP")&&d.push("GRASS_MAP"));d.push("PHYSICS");if(b.Vc||b.tc)for(a=null,b.Vc&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.tc&&
(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?ca.jA(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function g(a,b){var c;switch(a.type){case "MAIN":if(b.b4w_do_not_render)c=!1;else{if(b.use_nodes)G(a,b,"MAIN");else{h(a,b);var d=b.game_settings.alpha_blend;a.Hf=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;a.Ih=b.offset_z;a.Ag.set([1,1,1]);var f=b.texture_slots;ga.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.rc);switch(b.name){case "LENS_FLARES":y(a,
"special_lens_flares.glslv","special_lens_flares.glslf");e(a,"a_position");e(a,"a_texcoord");var g=k(f[0],null);F(a,g);break;default:y(a,"main.glslv","main_stack.glslf");b.use_shadeless||(c=R.Cp(b.uuid,b.name,{Fd:b.use_shadeless,Dk:b.diffuse_shader,zj:b.specular_shader}),a.wb.ig=R.xm(c));var m=u("use_map_color_diffuse",f),l=u("use_map_color_spec",f),n=u("use_map_normal",f),q=u("use_map_mirror",f),g=u("use_stencil",f);c=m[0];l=l[0];n=n[0];q=q[0];m=m[1];f=g[0]&&u("use_rgb_to_intensity",f)[0];if(c){switch(c.blend_type){case "MIX":v(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}g=k(c,null);F(a,g,"u_colormap0");ua.Mo&&"CLIP"==d&&Q.ul(g,Q.ad,Q.ad);a.Uf=c.diffuse_color_factor;a.Lf=c.use_map_alpha?c.alpha_factor:0;a.Ag.set(c.scale)}d=c&&c==l;l&&(d||(g=k(l,null),F(a,g,"u_specmap0")),a.Yh=l.specular_color_factor);if(n&&(e(a,"a_normal"),e(a,"a_tangent"),g=k(n,null),F(a,g,"u_normalmap0"),a.Qv=n.normal_factor,g=n.texture,g.b4w_use_map_parallax&&ua.hl)){var r=
X.t(g.b4w_parallax_steps),t=X.t(g.b4w_parallax_lod_dist);v(a,"PARALLAX",1);v(a,"PARALLAX_STEPS",r);v(a,"PARALLAX_LOD_DIST",t);a.parallax_scale=g.b4w_parallax_scale}q&&(g=k(q,null),F(a,g,"u_mirrormap"),a.$q=q.mirror_factor);if(q=c&&m&&f?1:0)g=k(m,null),F(a,g,"u_colormap1"),g=k(f,null),F(a,g,"u_stencil0");(g=c||l||n)&&a.Ag.set(g.scale);v(a,"TEXTURE_SPEC",void 0==l?0:1);v(a,"ALPHA_AS_SPEC",d?1:0);v(a,"TEXTURE_STENCIL_ALPHA_MASK",q);e(a,"a_position");e(a,"a_normal");(c||l||n)&&e(a,"a_texcoord");if(b.b4w_water){a.Ig=
!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.Za?(ha.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),a.Ao=!1):a.Ao=b.b4w_water_shore_smoothing;y(a,"special_water.glslv","special_water.glslf");d=R.Cp(b.uuid,b.name,{Fd:!1,Dk:b.diffuse_shader,zj:b.specular_shader});a.wb.ig=R.xm(d);e(a,"a_position");ua.dy?(e(a,"a_polyindex"),a.pa=!0,a.wireframe_edge_color=[0,0,0],v(a,"DEBUG_WIREFRAME",1)):v(a,"DEBUG_WIREFRAME",0);q=b.texture_slots;d=u("use_map_normal",q);
g=u("use_map_mirror",q)[0];d.length&&(r=k(d[0]),F(a,r,"u_normalmap0"),a.Tj=b.b4w_water_norm_uv_velocity);v(a,"NUM_NORMALMAPS",d.length);a.Hh=Array(d.length);for(r=0;r<d.length;r++)a.Hh[r]=new Float32Array(2),a.Hh[r].set([d[r].scale[0],d[r].scale[1]]);g&&(r=k(g),F(a,r,"u_mirrormap"),a.$q=g.mirror_factor);g=null;if(ua.Hi)for(r=0;r<q.length;r++){var p=q[r];if(!0===p.texture.b4w_water_foam){g=p;break}}g?(v(a,"FOAM",1),r=k(g),F(a,r,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.vu.set(g.texture.b4w_foam_uv_freq),
a.uu.set(g.texture.b4w_foam_uv_magnitude),a.cq[0]=g.scale[0],a.cq[1]=g.scale[1]):v(a,"FOAM",0);for(r=0;r<q.length;r++)if(p=q[r],!0===p.texture.b4w_shore_dist_map){var x=p;break}x&&ua.Lo?(x=k(x),F(a,x,"u_shore_dist_map"),v(a,"SHORE_PARAMS",1),x=p.texture.b4w_shore_boundings,v(a,"MAX_SHORE_DIST",X.t(p.texture.b4w_max_shore_dist)),v(a,"SHORE_MAP_SIZE_X",X.t(x[0]-x[1])),v(a,"SHORE_MAP_SIZE_Y",X.t(x[2]-x[3])),v(a,"SHORE_MAP_CENTER_X",X.t((x[0]+x[1])/2)),v(a,"SHORE_MAP_CENTER_Y",X.t((x[2]+x[3])/2))):v(a,
"SHORE_PARAMS",0);if(b.b4w_generated_mesh&&ua.Ck)v(a,"GENERATED_MESH",1),a.ay=!0,a.by=b.b4w_water_num_cascads,a.cy=b.b4w_water_subdivs,a.$x=b.b4w_water_detailed_dist;else{e(a,"a_normal");if(g||d.length)e(a,"a_texcoord"),e(a,"a_tangent");v(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){var p=X.t(b.b4w_water_dst_noise_scale0),x=X.t(b.b4w_water_dst_noise_scale1),d=X.t(b.b4w_water_dst_noise_freq0),q=X.t(b.b4w_water_dst_noise_freq1),g=X.t(b.b4w_water_dir_min_shore_fac),r=X.t(b.b4w_water_dir_freq),t=X.t(b.b4w_water_dir_noise_scale),
A=X.t(b.b4w_water_dir_noise_freq),N=X.t(b.b4w_water_dir_min_noise_fac),D=X.t(b.b4w_water_dst_min_fac),O=X.t(b.b4w_water_waves_hor_fac);v(a,"DST_NOISE_SCALE_0",p);v(a,"DST_NOISE_SCALE_1",x);v(a,"DST_NOISE_FREQ_0",d);v(a,"DST_NOISE_FREQ_1",q);v(a,"DIR_MIN_SHR_FAC",g);v(a,"DIR_FREQ",r);v(a,"DIR_NOISE_SCALE",t);v(a,"DIR_NOISE_FREQ",A);v(a,"DIR_MIN_NOISE_FAC",N);v(a,"DST_MIN_FAC",D);v(a,"WAVES_HOR_FAC",O)}C(a,b);E(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);
a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;v(a,"ABSORB",X.t(b.b4w_water_absorb_factor));v(a,"SSS_STRENGTH",X.t(b.b4w_water_sss_strength));v(a,"SSS_WIDTH",X.t(b.b4w_water_sss_width))}"HALO"===b.type&&(p=b.halo,y(a,"halo.glslv","halo.glslf"),v(a,"NUM_RINGS",p.ring_count),v(a,"NUM_LINES",p.line_count),v(a,"NUM_STARS",p.star_tip_count),v(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.tk=["a_position"],a.$u=p.size,a.Xu=p.hardness/20,a.Zu.set(p.b4w_halo_rings_color),
a.Yu.set(p.b4w_halo_lines_color),a.av=1/b.b4w_halo_stars_blend_height,a.bv=b.b4w_halo_stars_min_height,a.Wu=!0);v(a,"TEXCOORD",0);v(a,"NORMAL_TEXCOORD",0);c&&z(a,c,"TEXTURE_COLOR0_CO");m&&z(a,m,"TEXTURE_COLOR1_CO");f&&z(a,f,"TEXTURE_STENCIL_ALPHA_MASK_CO");l&&z(a,l,"TEXTURE_SPEC_CO");n&&z(a,n,"TEXTURE_NORM_CO");v(a,"SHADELESS",b.use_shadeless?1:0);a.Fd=b.use_shadeless}d=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===d?0:1);v(a,"ALPHA_CLIP","CLIP"===d?1:0);v(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?
1:0);b.use_vertex_color_paint?(v(a,"VERTEX_COLOR",1),e(a,"a_color")):v(a,"VERTEX_COLOR",0);a.We=b.ambient;a.Vf=b.diffuse_intensity;a.gf=b.emit;a.Ne.set(b.specular_color);a.Yr=b.specular_alpha;C(a,b);E(a,b);b.b4w_wettable?v(a,"WETTABLE",1):v(a,"WETTABLE",0);w(a,b);a.wr=b.b4w_refractive;a.Aw=b.b4w_refr_bump}c=!0}break;case "NODES_GLOW":c=G(a,b,"GLOW");break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)c=!1;else if(h(a,b),a.Za)c=!1;else{l=b.game_settings.alpha_blend;
b.use_nodes&&"CLIP"==l?G(a,b,"DEPTH"):(y(a,"depth.glslv","depth.glslf"),ga.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.rc));e(a,"a_position");e(a,"a_normal");v(a,"ALPHA","OPAQUE"===l?0:1);a.Ag.set([1,1,1]);if((c=u("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===l){switch(c.blend_type){case "MIX":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Ag.set(c.scale);v(a,"TEXTURE_COLOR",1);
e(a,"a_texcoord");if("IMAGE"==c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source||"CANVAS"==c.texture.k.source)l=k(c),F(a,l,"u_colormap0");"NONE"==c.texture.k.source&&(l=k(c),F(a,l,"u_colormap0"))}else v(a,"TEXTURE_COLOR",0);c=!0}break;case "PHYSICS":b.b4w_collision?(a.Kl=b.b4w_use_ghost,a.Va=b.b4w_collision_id,a.pk=b.b4w_collision_margin,a.nk=b.b4w_collision_group,a.qk=b.b4w_collision_mask,a.Nk=b.physics.friction,a.Hk=b.physics.elasticity,c=!0):b.b4w_water?(a.Ig=!0,a.fI=b.b4w_water_dynamic,
a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,c=!0):c=!1;
break;case "COLOR_ID":if("LENS_FLARES"===b.name||"HALO"===b.type)c=!1;else{h(a,b);a.Jf=da.Ve;a.pa=!0;a.Za=!1;l=b.game_settings.alpha_blend;a.Hf=b.b4w_render_above_all&&"OPAQUE"!=l&&"CLIP"!=l;b.use_nodes&&"CLIP"==l?G(a,b,"COLOR_ID"):(y(a,"color_id.glslv","color_id.glslf"),ga.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.rc));e(a,"a_position");v(a,"ALPHA","OPAQUE"===l?0:1);a.Ag.set([1,1,1]);if((c=u("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===l){switch(c.blend_type){case "MIX":v(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Ag.set(c.scale);v(a,"TEXTURE_COLOR",1);e(a,"a_texcoord");if("IMAGE"==c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source)l=k(c),F(a,l,"u_colormap0");"NONE"==c.texture.k.source&&(l=k(c),F(a,l,"u_colormap0"))}else v(a,"TEXTURE_COLOR",0);c=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?c=!1:(h(a,b),a.Za=!1,a.Jf=da.Ve,a.pa=!0,y(a,"grass_map.glslv","grass_map.glslf"),
e(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,l=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.Yb.a_grass_size={ph:!0,src:[]},c?(a.Yb.a_grass_size.src.push({name:c,Sd:4}),v(a,"DYNAMIC_GRASS_SIZE",1)):v(a,"DYNAMIC_GRASS_SIZE",0),a.Yb.a_grass_color={ph:!0,src:[]},l?(a.Yb.a_grass_color.src.push({name:l,Sd:7}),v(a,"DYNAMIC_GRASS_COLOR",1)):v(a,"DYNAMIC_GRASS_COLOR",0),c=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===
b.type?c=!1:(y(a,"wireframe.glslv","wireframe.glslf"),e(a,"a_position"),e(a,"a_normal"),e(a,"a_polyindex"),a.pa=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],c=!0);break;case "PARTICLES":if(b.b4w_do_not_render)c=!1;else{c=b.texture_slots;if(a.qh)y(a,"particles_color.glslv","particles_color.glslf");else if(y(a,"particles_texture.glslv","particles_texture.glslf"),l=R.Cp(b.uuid,b.name,{Fd:!1,Dk:b.diffuse_shader,zj:b.specular_shader}),a.wb.ig=R.xm(l),c=u("use_map_color_diffuse",c)[0]){v(a,"TEXTURE_COLOR",
1);switch(c.blend_type){case "MIX":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Uf=c.diffuse_color_factor;a.Lf=c.use_map_alpha?c.alpha_factor:0;c=k(c);F(a,c)}ga.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.rc);a.We=b.ambient;a.Vf=b.diffuse_intensity;a.gf=b.emit;a.Ne.set(b.specular_color);a.Yr=b.specular_alpha;e(a,"a_position");e(a,"a_normal");c=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===
c?0:1);v(a,"ALPHA_CLIP","CLIP"===c?1:0);v(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);C(a,b);E(a,b);h(a,b);c=b.game_settings.alpha_blend;a.Hf=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=c;a.Ih=b.offset_z;c=!0}break;default:throw"Wrong batch type: "+a.type;}return c}function z(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":v(a,c,"TEXTURE_COORDS_UV_ORCO");v(a,"TEXCOORD",1);break;case "NORMAL":v(a,c,"TEXTURE_COORDS_NORMAL");v(a,"NORMAL_TEXCOORD",1);break;default:v(a,c,0)}}function h(a,b){var c=
b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Za=!0;a.Jf=da.Ys;a.pa=!0;a.Tg=!1;break;case "ALPHA":a.Za=!0;a.Jf=da.Ve;a.pa=!0;a.Tg=!1;break;case "CLIP":a.Za=!1;a.Jf=da.Ve;a.pa=!0;a.Tg=!0;break;case "ADD":a.Za=!0;a.Jf=da.Ve;a.pa=!1;a.Tg=!1;break;case "OPAQUE":a.Za=!1;a.Jf=da.Ve;a.pa=!0;a.Tg=!1;break;default:throw Error("Unknown alpha blend mode: "+d);}a.mb=c.use_backface_culling}function k(a,b){var c=a.texture,d=c.k,c=c.image;d&&b&&c&&Q.Gl(d,b,c.cd,c.filepath);return d}function u(a,
b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.k&&c.push(f)}return c}function w(a,b){var c=b.raytrace_transparency;a.he[0]=c.fresnel;a.he[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.he[2]=c.fresnel;a.he[3]=1-c.fresnel_factor/5}function C(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;d=b.specular_toon_smooth;
break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:ha.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.Wc[0]=b.specular_intensity;a.Wc[1]=c;a.Wc[2]=d}function E(a,b){switch(b.diffuse_shader){case "LAMBERT":a.kd[0]=0;a.kd[1]=0;break;case "OREN_NAYAR":a.kd[0]=b.roughness;a.kd[1]=0;break;case "FRESNEL":a.kd[0]=b.diffuse_fresnel;a.kd[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.kd[0]=b.darkness;a.kd[1]=0;break;case "TOON":a.kd[0]=
b.diffuse_toon_size;a.kd[1]=b.diffuse_toon_smooth;break;default:ha.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.kd[0]=0,a.kd[1]=0}}function G(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":y(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":y(a,"main.glslv","main.glslf");d=!0;break;case "DEPTH":y(a,"depth.glslv","depth.glslf");d=!1;break;case "COLOR_ID":y(a,"color_id.glslv","color_id.glslf"),d=!1}c=R.fB(b.node_tree,b.uuid,
!1,b.name,c);if(!c)return ha.error('Failed to create node graph for material "'+b.name+'", disable nodes'),m(a,b),!0;a.Ui=!0;v(a,"NODES",1);v(a,"NODES_GLOW",d?1:0);var f=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===f?0:1);v(a,"ALPHA_CLIP","CLIP"===f?1:0);v(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);e(a,"a_position");b.use_orco_tex_coord&&e(a,"a_orco_tex_coord");h(a,b);a.Ih=b.offset_z;f=b.game_settings.alpha_blend;a.Hf=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;ga.set(b.diffuse_color[0],
b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.rc);a.gf=b.emit;a.We=b.ambient;w(a,b);b.b4w_wettable?v(a,"WETTABLE",1):v(a,"WETTABLE",0);a.wb.ig=R.xm(c);var g=!1;W.aa(c,function(c,d){switch(d.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var h=d.data.name,k=d.data.value;a.gi||(a.gi={});a.gi[k]=h;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":h=d.data.name;a.Yb[h]={ph:!0,src:[{name:d.data.value}]};k=0;if("GEOMETRY_VC"==d.type)k=7;else for(var l=
0;l<d.ya.length;l++){var n="RGB".indexOf(d.ya[l].identifier);-1<n&&(k|=1<<2-n)}a.Yb[h].src[0].Sd=k;break;case "TEX_COORD_NO":case "GEOMETRY_NO":e(a,"a_normal");break;case "MATERIAL_BEGIN":e(a,"a_normal");g=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":h=d.data.name;k=d.data.value;if(!k.k){ha.warn('Wrong texture "'+d.data.value.name+'" in material "'+b.name+'".');m(a,b);break}!1!==k.k.dm&&(k.k.dm="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);F(a,k.k,h);ua.Mo&&"CLIP"==f&&Q.ul(d.data.value.k,Q.ad,
Q.ad);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":v(a,"CALC_TBN_SPACE",1);e(a,"a_normal");e(a,"a_tangent");h=d.data.name;k=d.data.value;k.k.dm=!1;F(a,k.k,h);break;case "LAMP":d.data&&(a.$i=d.data);break;case "B4W_REFRACTION":a.wr=!0}});g||(a.Fd=!0);return!0}function m(a,b){switch(a.type){case "DEPTH":y(a,"depth.glslv","depth.glslf");break;case "COLOR_ID":y(a,"color_id.glslv","color_id.glslf");break;default:y(a,"main.glslv","main_stack.glslf")}v(a,"SHADELESS",1);e(a,"a_position");e(a,"a_normal");
ga.set(1,0,1,1,a.rc);if(b){var c=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===c?0:1);v(a,"ALPHA_CLIP","CLIP"===c?1:0);v(a,"VERTEX_COLOR",0);a.Ih=b.offset_z;h(a,b)}return!0}function x(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.hn?v(a,"AU_QUALIFIER","attribute"):v(a,"AU_QUALIFIER","uniform"),v(a,"STATIC_BATCH",0)):(v(a,"AU_QUALIFIER","attribute"),v(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(ba.zD()?v(a,"WIREFRAME_QUALITY",1):v(a,"WIREFRAME_QUALITY",0),a.gh?(v(a,"DEBUG_SPHERE",1),a.cu?v(a,
"DEBUG_SPHERE_DYNAMIC",1):v(a,"DEBUG_SPHERE_DYNAMIC",0)):v(a,"DEBUG_SPHERE",0),v(a,"ALPHA",1));b.qe&&(a.qe=b.qe);b.Hd?(""!==b.qf?(a.Yb.a_bending_col_main={ph:!0,src:[{name:b.qf,Sd:4}]},e(a,"a_bending_col_main"),""!==b.qc.wv&&""!==b.qc.vv&&""!==b.qc.$v?(a.Yb.a_bending_col_detail={ph:!0,src:[{name:b.qc.wv,Sd:4},{name:b.qc.vv,Sd:2},{name:b.qc.$v,Sd:1}]},e(a,"a_bending_col_detail"),e(a,"a_normal"),v(a,"DETAIL_BEND",1)):v(a,"DETAIL_BEND",0),v(a,"MAIN_BEND_COL",1)):v(a,"MAIN_BEND_COL",0),v(a,"WIND_BEND",
1)):v(a,"WIND_BEND",0);b.nm?v(a,"BEND_CENTER_ONLY",1):v(a,"BEND_CENTER_ONLY",0);v(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.bp|0);b.ae?v(a,"BILLBOARD",1):v(a,"BILLBOARD",0);b.ae&&b.hn?v(a,"HAIR_BILLBOARD",1):v(a,"HAIR_BILLBOARD",0);b.bk?v(a,"BILLBOARD_SPHERICAL",1):v(a,"BILLBOARD_SPHERICAL",0);switch(b.ck){case "RANDOM":v(a,"BILLBOARD_RANDOM",1);v(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":v(a,"BILLBOARD_RANDOM",0);v(a,"BILLBOARD_JITTERED",1);break;default:v(a,"BILLBOARD_RANDOM",0),v(a,"BILLBOARD_JITTERED",
0)}b.$b&&ua.Lo?v(a,"DYNAMIC_GRASS",1):v(a,"DYNAMIC_GRASS",0);a.$b=b.$b;a.De=b.De;a.Uc=b.Uc;a.Vc=b.Vc;a.wc=b.wc&&!a.Fd&&!(a.Za&&ua.Qp);a.Cc=b.Cc;a.tc=b.tc;a.Rc=b.Rc;b.Yi?(e(a,"a_influence"),v(a,"SKINNED",1),ua.No?(v(a,"DISABLE_TANGENT_SKINNING",1),v(a,"FRAMES_BLENDING",0)):(v(a,"DISABLE_TANGENT_SKINNING",0),b.Mk?v(a,"FRAMES_BLENDING",1):v(a,"FRAMES_BLENDING",0)),v(a,"MAX_BONES",b.sf)):(v(a,"SKINNED",0),v(a,"FRAMES_BLENDING",0),v(a,"DISABLE_TANGENT_SKINNING",0));b.jc?(v(a,"VERTEX_ANIM",1),ua.Sx?v(a,
"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):v(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):v(a,"VERTEX_ANIM",0);if(b.Yi&&b.jc)throw"Skinning and vertex animation are mutually exlusive";b.Hm?v(a,"DISABLE_FOG",1):v(a,"DISABLE_FOG",0);if(a.Ui){for(var c=a.wb.ig,d=b.Ch,f=b.Bh,h=0;h<c.length;h++){var g=c[h];switch(g.id){case "VALUE":var k=g.Cn[0];if(k)for(var m=0;m<d.length;m+=2)if(d[m]==k){g.Md.push(["VALUE_IND",d[m+1]]);break}break;case "RGB":if(k=g.Cn[0])for(m=0;m<f.length;m+=2)if(f[m]==k){g.Md.push(["RGB_IND",
f[m+1]]);break}}}v(a,"NUM_VALUES",b.rf.length);v(a,"NUM_RGBS",b.sd.length)}}}function A(a,b,c){if(b.length){for(var d=Y.Vm(b,ua.Xc&&c.b4w_enable_ssao),e=a.wb,f=0,h=0;h<a.wb.ig.length;h++){var g=a.wb.ig[h];if("LIGHTING_LAMP"==g.id){var k=b[f++%b.length],m=k.La;"AREA"==m.type&&(k=b[f++%b.length],m=k.La);var l=Y.Pa(k,c);if("SPOT"==m.type||"POINT"==m.type)var n=Math.cos(m.Zh/2);if("SPOT"==m.type)var q=m.Al*(1-n);l=l.xh;k=d.indexOf(k);g.Md=[["LAMP_TYPE",m.type],["LAMP_IND",l],["LAMP_LIGHT_FACT_IND",Math.floor(l/
2)],["LAMP_FAC_CHANNELS",0==l%2?"rg":"ba"],["LAMP_SPOT_SIZE",X.t(n||.01)],["LAMP_SPOT_BLEND",X.t(q||.01)],["LAMP_LIGHT_DIST",X.t(m.distance)],["LAMP_SHADOW_MAP_IND",k]]}}if(a.$i){c=0;for(var t in a.$i)c++;a.Mq=new Float32Array(3*c);a.Kq=new Float32Array(3*c);a.Jq=new Float32Array(3*c);a.Lq=new Float32Array(4*c);X.K(e,"NUM_LAMP_LIGHTS",c);for(h=0;h<b.length;h++)r(a,b[h])}}}function r(a,b){if(b.fi in a.$i){var c=a.$i[b.fi],d=sa.get_trans_view(b.f.h);a.Mq.set(d,3*c);a.Kq.set(b.La.direction,3*c);a.Jq.set(b.La.rk,
3*c);var d=fa,e=b.La;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.ei?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var f=d[0]=Math.cos(e.Zh/2);d[1]=e.Al*(1-f)}a.Lq.set(d,4*c)}}function e(a,b){var c=a.tk;-1==c.indexOf(b)&&c.push(b)}function v(a,b,c){X.K(a.wb,b,c)}function J(a,b){if("PHYSICS"==a.type)0<b.na.length&&da.KG(b,b.B[0]),a.Cd=b;else{var c=a.Jf,d=a.Ce;a.Wu&&(b=da.wC(b));a.ay&&(b=ea.XC(a.by,a.cy,a.$x));c=da.MG(b,c,d,a.Yb);a.O=c;a.De||c.cn||a.qe||(c.bg=null,c.xc=null);c=
b.B.length;a.num_vertices=b.ea*c;a:switch(a.Ce){case da.Vj:case da.Vl:case da.Ul:d=!0;break a;default:d=!1}d?da.YD(b)?a.num_triangles=b.Ca.length/3*c:a.num_triangles=b.ea/3*c:a.num_triangles=0}}function D(a,b,c,e,f,h,g,k,m,l,n,q){var r=a.oa,t=[],p=k.b4w_dynamic_grass;if(!l&&p)return t;for(var u="INSTANCE"==k.b4w_wind_bend_inheritance,A="INSTANCE"==k.b4w_shadow_inheritance,w="INSTANCE"==k.b4w_reflection_inheritance,N=[],v=[],z=0;z<f.length;z++){var y=f[z].oa.f,D=ca.mk(b);D.ae=k.b4w_hair_billboard;
D.ck=k.b4w_hair_billboard_type;D.bk="SPHERICAL"==k.b4w_hair_billboard_geometry;D.$b=p;D.hn=!0;D.rf=y.rf;D.Ch=y.Ch;D.sd=y.sd;D.Bh=y.Bh;u?(D.Hd=y.Hd,D.Ql=y.Ql,D.Gf=y.Gf,D.ff=y.ff,D.qf=y.qf,D.ef=y.ef,D.$e=y.$e,D.Te=y.Te,D.qc=y.qc,D.nm=!1):(D.Hd=r.f.Hd,D.Ql=r.f.Ql,D.Gf=r.f.Gf,D.ff=r.f.ff,D.qf=r.f.qf,D.ef=r.f.ef,D.$e=r.f.$e,D.Te=r.f.Te,D.qc=r.f.qc,D.nm=!0);A?(D.Uc=y.Uc,D.Vc=y.Vc,D.wc=y.wc):(D.Uc=r.f.Uc,D.Vc=r.f.Vc,D.wc=r.f.wc);w?(D.Cc=y.Cc,D.tc=y.tc,D.Rc=y.Rc,D.Kd=y.Kd,D.vd=y.vd,D.Ke=y.Ke):(D.Cc=r.f.Cc,
D.tc=r.f.tc,D.Rc=r.f.Rc,D.Kd=r.f.Kd,D.vd=r.f.vd,D.Ke=r.f.Ke);N.push(D);var C=g[z];C||(C=new Float32Array);q&&ca.dn(m.seed,n);var O=new Float32Array(3),aa=new Float32Array([0,0,0,1]),B=[],X=la.Jt(ua.Uq)&&!k.b4w_initial_rand_rotation&&!k.b4w_hair_billboard,E=4;X&&(E=8);for(var F=0;F<C.length;F+=E){O[0]=C[F];O[1]=C[F+1];O[2]=C[F+2];var Q=C[F+3]*sa.get_scale(y.h);if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var K=new Float32Array([ca.Vd(n),ca.Vd(n),ca.Vd(n)]);Ea.normalize(K,
K);break;case "Z":K=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}ma.setAxisAngle(K,k.b4w_rand_rotation_strength*(2*Math.PI*ca.Vd(n)-Math.PI),aa)}else if(X&&(aa.set(C.subarray(F+4,F+8)),ca.sr(aa,aa),!k.use_whole_group))if(k.use_rotation_dupli){var G=sa.get_quat_view(y.h);ma.multiply(aa,G,aa)}else ma.multiply(aa,qa,aa);var V=sa.set_sep(O,Q,aa,sa.create());B.push(V)}v.push(B)}for(var T={},z=0;z<f.length;z++){var M=f[z],J=h[z],D=N[z],U={};D.Hd&&
(U.au_wind_bending_amp=[D.Te],U.au_wind_bending_freq=[D.Gf],U.au_detail_bending_freq=[D.ff],U.au_detail_bending_amp=[D.ef],U.au_branch_bending_amp=[D.$e],D.Te=0,D.Gf=0,D.ff=0,D.ef=0,D.$e=0);var ka=P(D),B=v[z];if(B.length)for(var ea=M.data,ga=ea.materials,R=Array(ga.length),F=0;F<ga.length;F++)if(!da.cv(ea,F))for(var W=0;W<J.length;W++){var Y=J[W],ba=d(Y),fa=ga[F];"COLOR_ID"==Y&&(ba.mp=!(M.b4w_do_not_render||fa.b4w_do_not_render));"MAIN"==Y&&(R[F]=ba);if(H(ba,fa)){"DEPTH"==Y&&R[F]&&(ba.Fd=R[F].Fd);
ba.Ce=da.Vj;x(ba,D);ba.lj=k.uuid;"JITTERED"==k.b4w_hair_billboard_type&&(ba.rv=k.b4w_hair_billboard_jitter_amp,ba.sv=k.b4w_hair_billboard_jitter_freq);p&&(ba.Uu=k.b4w_dynamic_grass_scale_threshold);u||(delete ba.Yb.a_bending_col_main,delete ba.Yb.a_bending_col_detail);I(ba,ka);var Aa=da.ru(ea,F,ba.tk,b.vi,ba.Yb,ba.gi),pa=da.GE(Aa,U,B),Oa=pa,Ma=B;Oa.X.au_center_pos=new Float32Array(3*Oa.ea);for(var Fa=Ma.length,Hc=Oa.ea/Fa,Wa=0;Wa<Fa;Wa++)for(var ub=Ma[Wa],Ra=3*Hc*Wa,za=0;za<Hc;za++)Oa.X.au_center_pos[Ra+
3*za]=ub[0],Oa.X.au_center_pos[Ra+3*za+1]=ub[1],Oa.X.au_center_pos[Ra+3*za+2]=ub[2];pa=Oa;if(D.Hd&&D.nm){var Ka=pa,bb=r.f.h;Ka.X.a_emitter_center=new Float32Array(3*Ka.ea);var Da=Ea.fromValues(0,0,0);sa.transform_vec3(Da,bb,Da);for(var $a=0;$a<Ka.ea;$a++)Ka.X.a_emitter_center[3*$a]=Da[0],Ka.X.a_emitter_center[3*$a+1]=Da[1],Ka.X.a_emitter_center[3*$a+2]=Da[2];pa=Ka}var Lb=k.b4w_vcol_from_name,yb=k.b4w_vcol_to_name,Bc=ba,Sa=c,Yc=!u,Ic=ea,Pb=[];if(""!==Lb&&""!==yb){var Vb,Cb=yb,hc=Bc.Yb,Jc=[],ic=void 0;
for(ic in hc)for(var zb=hc[ic].src,Qa=0,Ha=0;Ha<zb.length;Ha++){var Ya=zb[Ha].Sd;Cb==zb[Ha].name&&Jc.push(ic,Ya,Qa);Qa+=ca.Th(Ya)}Vb=Jc;if(0<Vb.length)for(var Db=0;Db<Vb.length;Db+=3)Pb.push({Ik:Lb,Mm:7,Dn:Vb[Db],En:Vb[Db+1],Jm:Vb[Db+2]});else da.JD(Bc.tk,"a_color")&&yb==Ic.active_vcol_name&&Pb.push({Ik:Lb,Mm:7,Dn:"a_color",En:7,Jm:0})}Yc&&("a_bending_col_main"in Sa&&Pb.push({Ik:"a_bending_col_main",Mm:4,Dn:"a_bending_col_main",En:4,Jm:0}),"a_bending_col_detail"in Sa&&Pb.push({Ik:"a_bending_col_detail",
Mm:7,Dn:"a_bending_col_detail",En:7,Jm:0}));for(var Ib=pa,ac=B,Jb=e,rb=Pb,Mb=ba.Yb,gc=!1,tb=0;tb<rb.length;tb++){var Qb=rb[tb].Ik,jc=Jb.X[Qb];if(jc&&0<jc.length){gc=!0;break}}if(gc){var Cc,Ta=r.f.Zb,fb=Jb.B[0].a_position,va=ac,wa=T,lb=new Float32Array(3),cb=new Float32Array(3),Wb=new Uint32Array(va.length);if(!("verts_indices"in wa)){wa.bf=new Float32Array(3);wa.Ye=new Float32Array(3);wa.Es=new Uint32Array(fb.length/3);wa.cl=new Uint32Array(fb.length/3);wa.bf[0]=(Ta.max_x-Ta.min_x)/20;wa.bf[1]=(Ta.max_y-
Ta.min_y)/20;wa.bf[2]=(Ta.max_z-Ta.min_z)/20;wa.Ye[0]=Ta.min_x;wa.Ye[1]=Ta.min_y;wa.Ye[2]=Ta.min_z;for(var Pa=0;Pa<fb.length/3;Pa++){var sc=ca.trunc((fb[3*Pa]-wa.Ye[0])/wa.bf[0]),nb=ca.trunc((fb[3*Pa+1]-wa.Ye[1])/wa.bf[1]),vb=ca.trunc((fb[3*Pa+2]-wa.Ye[2])/wa.bf[2]),sc=ca.clamp(sc,0,19),nb=ca.clamp(nb,0,19),vb=ca.clamp(vb,0,19);wa.Es[Pa]=Pa;wa.cl[Pa]=vb*Math.pow(20,2)+20*nb+sc}da.Zw(wa.cl,wa.Es,da.Io,!0);wa.ii=new Uint32Array(Math.pow(20,3));for(Pa=0;Pa<wa.cl.length;Pa++)wa.ii[wa.cl[Pa]]++;delete wa.cl;
for(Pa=1;Pa<wa.ii.length;Pa++)wa.ii[Pa]+=wa.ii[Pa-1]}for(var Rb=0;Rb<va.length;Rb++){lb[0]=va[Rb][0];lb[1]=va[Rb][1];lb[2]=va[Rb][2];for(var Nb=1E10,Ab=-1,bc=ca.trunc((lb[0]-wa.Ye[0])/wa.bf[0]),tc=ca.trunc((lb[1]-wa.Ye[1])/wa.bf[1]),uc=ca.trunc((lb[2]-wa.Ye[2])/wa.bf[2]),bc=ca.clamp(bc,0,19),tc=ca.clamp(tc,0,19),uc=ca.clamp(uc,0,19),cc=uc*Math.pow(20,2)+20*tc+bc,ob=wa.ii[cc],La=0==cc?0:wa.ii[cc-1];La<ob;La++){var eb=wa.Es[La];cb[0]=fb[3*eb];cb[1]=fb[3*eb+1];cb[2]=fb[3*eb+2];Ea.sub(cb,lb,cb);var Ua=
Ea.sqrLen(cb);Ua<=Nb&&(Nb=Ua,Ab=eb)}if(-1==Ab)for(La=0;La<fb.length/3;La++)cb[0]=fb[3*La],cb[1]=fb[3*La+1],cb[2]=fb[3*La+2],Ea.sub(cb,lb,cb),Ua=Ea.sqrLen(cb),Ua<=Nb&&(Nb=Ua,Ab=La);Wb[Rb]=Ab}Cc=Wb;for(var Dc=Ib.ea/ac.length,tb=0;tb<rb.length;tb++){var pb=rb[tb].Dn,Ob=rb[tb].En,Qb=rb[tb].Ik,Xb=rb[tb].Mm,jc=Jb.X[Qb];switch(pb){case "a_bending_col_main":var gb=1;break;case "a_bending_col_detail":gb=3;break;case "a_color":gb=3;break;default:for(var Kb=gb=0;Kb<Mb[pb].src.length;Kb++)gb+=ca.Th(Mb[pb].src[Kb].Sd)}if(jc&&
0<jc.length){var kc=ca.Th(Xb),lc=ca.Th(Ob),Eb=Xb&Ob,mc=ca.Ew(Eb);Eb!=Ob&&ha.error("Wrong color extraction from "+Qb+" to "+pb+".");if("a_bending_col_main"==pb||"a_bending_col_detail"==pb)Ib.X[pb]=new Float32Array(Ib.ea*lc);for(Kb=0;Kb<ac.length;Kb++){var vc=Cc[Kb],nc=vc*kc,Sb=Kb*Dc*gb;if(-1!=vc)for(var oc=0;oc<Dc;oc++)for(var dc=oc*gb,wc=0;wc<mc.length;wc++)mc[wc]&&(Ib.X[pb][Sb+dc+(rb[tb].Jm+ca.rl(Ob,wc))]=jc[nc+ca.rl(Xb,wc)])}}else Ib.X[pb]=new Float32Array(0)}}pa=Ib;t.push({G:ba,Cd:pa,Nc:[fa.name],
f:D,yd:[a]})}}}return t}function H(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=R.Ht(b));return c=c&&g(a,b)}function I(a,b){for(var c=null,d=null,e=0;e<a.U.length;e++){var f=a.U[e].gd;f&&(c||(c={}),c[e]=f,a.U[e].gd=null);if(f=a.U[e].ga)d||(d={}),d[e]=f,a.U[e].ga=null}a.id=0;a.zF=b;a.id=ca.At(a,b);if(c)for(var h in c)a.U[h].gd=c[h];if(d)for(h in d)a.U[h].ga=d[h]}function P(a){var b=a.Jd;a.Jd=null;var c=ca.At(a,0);a.Jd=b;return c}function K(a,b,c,e,f){var h=d("WIREFRAME");y(h,"wireframe.glslv","wireframe.glslf");
h.wireframe_mode=0;h.gh=!0;h.pa=!0;h.lj=c;f&&(h.cu=!0);x(h,b);b=P(b);I(h,b);e?(e=ea.jq(1,a.I),da.Iw(e,[a.we[0],a.xe[1],a.ye[2]],a.I)):e=ea.jq(a.Ma,a.I);da.bo(e,1,!0);e.X.a_polyindex=da.aq(e);J(h,e);return h}function y(a,b,c){a.wb.Rj=b;a.wb.Ji=c;X.SF(a.wb)}function F(a,b,c){1==a.U.length&&0==a.ic.length&&a.ic.push("default0");c=c||"default"+String(a.U.length);-1==a.ic.indexOf(c)&&(a.U.push(b),a.ic.push(c));a.dc&&N.nt(a)}function M(a){if(!a.wb)throw"No shaders info for batch "+a.name;a.dc=X.jD(a.wb);
N.pA(a.dc);N.To(a);N.nt(a)}function O(a,b,c){a=a.J[0].T;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].nh&&-1!=a[d].rd.indexOf(b))return a[d];return null}function V(a,b,c){a=a.J[0].T;for(var d=0;d<a.length;d++)if(a[d].type==c&&a[d].nh&&-1!=a[d].rd.indexOf(b))return a[d];return null}function T(a,b){a.rc.set(b.rc);a.Vf=b.Vf;a.Ne.set(b.Ne);a.Yh=b.Yh;a.Wc.set(b.Wc);a.gf=b.gf;a.We=b.We;a.Uf=b.Uf;a.Lf=b.Lf;a.reflect_factor=b.reflect_factor;a.he.set(b.he);a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);
a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.Tj=b.Tj}var U=p("__boundings");p("__camera");var B=p("__config"),ha=p("__print"),ba=p("__extensions"),da=p("__geometry"),W=p("__graph");p("__lights");var R=p("__nodemat"),Y=p("__obj_util"),ka=p("__particles"),ea=p("__primitives"),ma=p("__quat"),la=p("__reformer"),N=p("__renderer"),aa=p("__scenegraph"),X=p("__shaders");p("__scenes");var Q=
p("__textures"),sa=p("__tsr"),ca=p("__util"),Ea=p("__vec3"),ga=p("__vec4"),ua=B.p,Aa=["MAIN"],qa=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]);new Float32Array(3);var fa=new Float32Array(4);a.nI=pa;var pa="u_colormap0 u_colormap1 u_stencil0 u_specmap0 u_normalmap0 u_mirrormap".split(" ");a.lK=d;a.WC=function(a,c,d,e){for(var h=[],g=[],k=0;k<c.length;k++){var m=c[k],l=m.oa;l.Yk||(Y.ka(l)?h.push(m):g.push(m))}for(var k=[],k=k.concat(q(h,a.k.ib)),l=k=k.concat(f(g,a.k.ib,a.b4w_batch_grid_size)),
h=[],g=[],n={},k=0;k<l.length;k++){var r=l[k].G,t=l[k].f,p=null;if(r.id in n){for(var u=n[r.id],x=g[u].G,w=g[u].f,N=null,v=null,m=0;m<r.U.length;m++){var D=r.U[m].gd;D&&(N||(N={}),N[m]=D,r.U[m].gd=null);if(D=r.U[m].ga)v||(v={}),v[m]=D,r.U[m].ga=null}ca.jx(r,x)&&ca.jx(t,w)&&(p=g[u]);if(N)for(m in N)r.U[m].gd=N[m];if(v)for(m in v)r.U[m].ga=v[m];if(!p){do r.id++;while(n[r.id])}}p||(p={G:r,f:l[k].f,yd:[],fs:[],Nc:[]},n[r.id]=g.length,g.push(p));p.yd=p.yd.concat(l[k].yd);l[k].Cd&&l[k].Cd.ea&&p.fs.push(l[k].Cd);
if(p.Nc.length)for(m=0;m<l[k].Nc.length;m++)r=l[k].Nc[m],-1==p.Nc.indexOf(r)&&p.Nc.push(r);else p.Nc=l[k].Nc;da.Zw(p.Nc,p.fs,da.yz,!1)}for(k=0;k<g.length;k++){l=g[k].fs;if(0==l.length)m=ca.Vb(ca.Oj("%empty"));else if(1==l.length)m=l[0];else{n=[];for(m=0;m<l.length;m++)da.ZD(l[m])||n.push(m);if(n.length<l.length)for(m=0;m<n.length;m++)da.bo(l[n[m]]);m=da.LG(l)}h.push({G:g[k].G,f:g[k].f,Cd:m,Nc:g[k].Nc,yd:g[k].yd})}for(g=0;g<h.length;g++)if(l=h[g].G,l.rd=h[g].Nc,J(l,h[g].Cd),A(l,d,a),"STATIC"==h[g].f.type&&
"COLOR_ID"!=l.type){if(k=ca.Oj("%meta%"+l.type+"%"+l.rd.join("%")+"%"),n=Y.vk(k,"MESH"),n.f=h[g].f,Y.ak(n,a),Y.hm(n,a,l),e.push(n),"MAIN"==l.type)for(m=0;m<h[g].yd.length;m++)k=h[g].yd[m],k=k.oa,k.Jv.push(n)}else for(n=[],m=0;m<h[g].yd.length;m++)k=h[g].yd[m],k=k.oa,-1==n.indexOf(k.name)&&(Y.hm(k,a,l),n.push(k.name));if(ua.wireframe_debug){for(g=0;g<h.length;g++)if(d=h[g].f,"DYNAMIC"==d.type&&(k=h[g].yd[0].oa,-1<Aa.indexOf(h[g].G.type))){m=Y.Pa(k,a);l=m.T;n=!1;for(m=0;m<l.length;m++)l[m].gh&&(n=!0);
n||(d=K(d.Ze,d,k.name,!0,!0),Y.hm(k,a,d))}for(g=0;g<e.length;g++)k=e[g],d=k.f,m=Y.Pa(k,a),l=m.T,-1<Aa.indexOf(l[0].type)&&(d=K(d.fd,d,k.name,!1),Y.hm(k,a,d))}for(g=0;g<c.length;g++)for(m=Y.Pa(c[g].oa,a),l=m.T,m=0;m<l.length;m++)b(l[m]);for(g=0;g<e.length;g++)for(m=Y.Pa(e[g],a),l=m.T,m=0;m<l.length;m++)b(l[m])};a.YC=function(a,c){var f=a.k.Ks,h=d("MAIN");y(h,"special_skydome.glslv","special_skydome.glslf");if(c.procedural_skydome)v(h,"PROCEDURAL_SKYDOME",1),h.ow=!0;else{var g=f.Vr;if(g){v(h,"WO_SKYTEX",
1);var m=k(f.Xw,null);F(h,m,"u_sky");g.invert&&v(h,"MTEX_NEGATIVE",1);g.RH&&v(h,"MTEX_RGBTOINT",1);v(h,"BLENDTYPE",g.wA);g.NH&&v(h,"WOMAP_BLEND",1);g.OH&&v(h,"WOMAP_HORIZ",1);g.QH&&v(h,"WOMAP_ZENUP",1);g.PH&&v(h,"WOMAP_ZENDOWN",1)}f.SH&&v(h,"WO_SKYBLEND",1);f.TH&&v(h,"WO_SKYPAPER",1);f.UH&&v(h,"WO_SKYREAL",1)}c.Cc&&(h.Cc=!0,c.tc&&(h.tc=!0));h.Ih=99999;e(h,"a_position");f=ea.SC();J(h,f);b(h);f=ca.Oj("%meta_sky%");f=Y.vk(f,"MESH");Y.ak(f,a);g=Y.Pa(f,a);f.f=Y.zi("STATIC");f.f.ih=!0;f.f.Zb=U.$c();f.f.fd=
U.ni();f.f.Ab=U.$c();f.f.Ub=U.ni();g.T.push(h);return f};a.Yt=function(a,b,d){d=Y.Pa(a,d).T;var e=[],f=aa.qb(b,"SHADOW_CAST"),h=aa.qb(b,"MAIN_PLANE_REFLECT"),g=aa.qb(b,"MAIN_CUBE_REFLECT"),k=aa.qb(b,"OUTLINE_MASK");b=aa.qb(b,"COLOR_PICKING");for(var m=0;m<d.length;m++){var l=d[m],n=null;"DEPTH"==l.type&&f&&l.Uc&&(n=c(l),n.fb="SHADOW_CAST");"MAIN"!=l.type&&"PARTICLES"!=l.type||!h&&!g||l.Za||!l.Cc||(n=c(l),n.fb="REFLECT");"COLOR_ID"==l.type&&l.mp&&k&&a.f.Jb&&(b&&a.f.yf?(n=c(l),n.fb="OUTLINE"):l.fb=
"OUTLINE");n&&(n.nh=!0,I(n,a.f.id),e.push(n))}d.push.apply(d,e)};a.aG=l;a.hI=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.sA=function(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.fD=k;a.fH=m;a.eH=A;a.XF=r;a.mt=function(a,b){v(a,"CSM_SECTION0",0);v(a,"CSM_SECTION1",0);v(a,"CSM_SECTION2",0);v(a,"CSM_SECTION3",0);v(a,"NUM_CAST_LAMPS",
0);if(b){v(a,"NUM_CAST_LAMPS",b.ie.length);ua.qn&&v(a,"MAC_OS_SHADOW_HACK",1);for(var c=0;c<b.csm_num;c++)v(a,"CSM_SECTION"+String(c),1);v(a,"SHADOW_TEX_RES",X.t(b.csm_resolution));v(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);v(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else v(a,"SHADOW_TEX_RES",0),v(a,"CSM_FADE_LAST_CASCADE",0),v(a,"CSM_BLEND_BETWEEN_CASCADES",0)};a.Aa=v;a.ac=function(a,b){return X.nD(a.wb,b)};a.cH=J;a.dH=I;a.FA=P;a.sJ=K;a.si=F;a.EF=function(a,b,c){c=a.ic.indexOf(c);
-1<c&&(a.U[c]=b)};a.GB=function(a,b){var c=d("MAIN");c.Za=!0;ga.set(b[0],b[1],b[2],.5,c.rc);c.Ce=da.Vl;J(c,a);y(c,"main.glslv","main_stack.glslf");v(c,"SHADELESS",1);M(c);return c};a.Sb=M;a.VC=function(a,c){for(var e=0;e<c.length;e++){var f=c[e].oa,h=d("LINE");y(h,"line.glslv","line.glslf");h.Za=!0;var g=ea.UC();J(h,g);b(h);Y.ak(f,a);Y.Pa(f,a).T.push(h);M(h)}};a.NA=function(a){return a.dc.kl.length?a.dc.mr.u_cube_fog?!0:!1:!1};a.oB=function(){var a=d("DEPTH_PACK");a.mb=!0;a.pa=!1;var b=ea.Pb();J(a,
b);y(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");M(a);return a};a.Dp=function(a){var b=d("POSTPROCESSING");y(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":v(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":v(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":v(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":v(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":v(b,"POST_EFFECT",
"POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":v(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":v(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":v(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;case "FLIP_CUBEMAP_COORDS":v(b,"POST_EFFECT","FLIP_CUBEMAP_COORDS");break;default:throw"Wrong postprocessing effect: "+a;}b.mb=!0;b.pa=!1;a=ea.Pb();J(b,a);M(b);return b};a.JB=function(a){var b=d("SSAO");b.pa=!1;b.mb=!0;var c=ea.Pb();J(b,c);y(b,"postprocessing/postprocessing.glslv",
"postprocessing/ssao.glslf");v(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.ex);v(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:Q.ZC(a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=k(a,c);F(b,a,"u_ssao_special_tex");M(b);return b};a.KB=function(a){var b=d("SSAO_BLUR");b.pa=!1;b.mb=!0;var c=ea.Pb();J(b,
c);y(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");v(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);M(b);return b};a.pB=function(){var a=d("DOF");a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");v(a,"DEPTH_RGBA",1);M(a);return a};a.yB=function(){var a=d("OUTLINE");a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");M(a);return a};a.rB=function(){var a=d("GLOW_COMBINE");
a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");M(a);return a};a.sB=function(a,b,c){var e=d("GOD_RAYS");e.pa=!1;e.mb=!0;var f=ea.NC();J(e,f);y(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");v(e,"DEPTH_RGBA",a?1:0);v(e,"WATER_EFFECTS",b?1:0);v(e,"STEPS_PER_PASS",X.t(c,1));M(e);return e};a.tB=function(){var a=d("GOD_RAYS_COM");a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");
v(a,"SAFARI_CANVAS_ALPHA_HACK",ua.Hw?1:0);M(a);return a};a.BB=function(){var a=d("SKY");a.pa=!1;a.mb=!0;var b=ea.OC();J(a,b);y(a,"procedural_skydome.glslv","procedural_skydome.glslf");v(a,"WATER_EFFECTS",1);M(a);return a};a.iB=function(a){var b=d("ANTIALIASING");b.pa=!1;b.mb=!0;var c=ea.Pb();J(b,c);y(b,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");ua.rw?(v(b,"AA_METHOD","AA_METHOD_FXAA_QUALITY"),v(b,"AA_QUALITY",a.MC)):v(b,"AA_METHOD","AA_METHOD_FXAA_LIGHT");M(b);return b};
a.HB=function(a){var b=d("SMAA"),c=ea.Pb();J(b,c);y(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");v(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");v(b,"SMAA_PASS",a);v(b,"SMAA_PREDICATION",0);v(b,"SMAA_REPROJECTION",0);M(b);b.pa=!1;b.mb=!0;return b};a.mB=function(){var a=d("COMPOSITING");a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");M(a);return a};a.xB=function(){var a=d("MOTION_BLUR");a.mb=!0;a.pa=!1;var b=ea.Pb();J(a,b);y(a,
"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");M(a);return a};a.LB=function(a){var b=d("STEREO");b.mb=!0;b.pa=!1;var c=ea.Pb();J(b,c);y(b,"postprocessing/postprocessing.glslv","postprocessing/stereo.glslf");v(b,"ANAGLYPH","ANAGLYPH"===a?1:0);v(b,"DISABLE_DISTORTION_CORRECTION",ua.no?1:0);M(b);return b};a.uB=function(){var a=d("LUMINANCE");a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");M(a);return a};a.jB=
function(){var a=d("LUMINANCE");a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");M(a);return a};a.vB=function(){var a=d("LUMINANCE_X_BLUR");a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");M(a);return a};a.kB=function(){var a=d("POSTPROCESSING");a.mb=!0;a.pa=!1;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");
M(a);return a};a.lB=function(){var a=d("BLOOM");a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");M(a);return a};a.OB=function(){var a=d("VELOCITY");a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");M(a);return a};a.hB=function(){var a=d("ANCHOR_VISIBILITY");a.pa=!0;a.mb=!0;a.Ce=da.Ps;y(a,"anchors.glslv","anchors.glslf");var b=ea.Cu(1);J(a,b);v(a,"ANCHOR_NUM",1);M(a);a.rj=
new Float32Array([0,0,0]);return a};a.zB=function(){var a=d("PERFORMANCE");a.pa=!1;a.mb=!0;var b=ea.Pb();J(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/performance.glslf");v(a,"POST_EFFECT","POST_EFFECT_X_BLUR");M(a);return a};a.bH=function(a,b){var c=b.length/3;if(c!=a.rj.length/3){var d=ea.Cu(c);J(a,d);v(a,"ANCHOR_NUM",c);M(a)}a.rj=b};a.pq=function(a){if(!a.J.length)return null;a=a.J[0];return a.T.length?a.T[0]:null};a.Ha=O;a.nd=V;a.QK=T;a.jJ=function(a,b){for(var c=a.J[0].T,d=
0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.dB=function(a){for(var b=a.U,c=0;c<b.length;c++)Q.bC(b[c].Na);da.Mt(a.O)};a.inherit_material=function(a,b,c,d){for(var e=["MAIN","DEPTH","COLOR_ID"],f=!1,h=0;h<e.length;h++){var g=e[h],k=O(a,b,g),m=O(c,d,g);if(k&&m){var f=!0,l=V(c,d,g);"MAIN"==g&&(T(m,k),l&&T(l,k));for(g=0;g<m.ic.length;g++){var n=m.ic[g];if(-1!==pa.indexOf(n)){var q=k.ic.indexOf(n);-1!==q&&(m.U[g]=k.U[q],l&&(n=l.ic.indexOf(n),-1!==n&&(l.U[n]=k.U[q])))}}}}f||ha.error("Wrong objects for inheriting material!")}};b4w.module.__nodemat=function(a,p){function d(a,c,g,m,q){var r=Aa.get_active(),r=f(c,q,r.uuid);if(r in S)return S[r];if("DEPTH"!=q&&"COLOR_ID"!=q){c=Q.create();for(var p=a.nodes,x=0;x<p.length;x++)if(null==D(c,p[x],0,m,q))return S[r]=null;if(g&&-1==v(a,c,"GROUP_OUTPUT","group"))return null;x=Y(c);p=g?a.links:a.links.slice();if(!ka(c,p,x))return null;if(g)return c;for(x=0;x<p.length;x++){g=p[x];for(var A=k(g.from_node,c),w=k(g.to_node,c),N=0;N<A.length;N++)for(var y=0;y<w.length;y++){var O=A[N],aa=
w[y],B=Q.Ba(c,O),X=Q.Ba(c,aa);if(!W(c,O,aa,B,X,g))return S[r]=null}}h(c);a="GLOW"==q?v(a,c,"B4W_GLOW_OUTPUT","material",!0):v(a,c,"OUTPUT","material",!1,!0);-1==a&&(c=l(),a=0);u(c);a=Q.ao(c,a,Q.Tl);b(a,m);n(a);C(a);e(a);z(a,m,q)}else m=d(a,c,g,m,"MAIN"),m=Q.clone(m,function(a){var b=qa.mk(a);b.H=qa.xa(a.H);b.ya=qa.xa(a.ya);return b}),a=v(a,m,"OUTPUT","material",!1,!0),t(m,a),a=Q.ao(m,a,Q.Tl),n(a);return S[r]=a}function b(a,b){var d=[];Q.aa(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=b.type||
d.push({ZE:a,node:b})});for(var e=0;e<d.length;++e){var f=d[e].ZE,h=d[e].node,g=Q.Rk(a);Q.ri(a,g,h.data.JE);var k=Q.Rk(a);Q.ri(a,k,h.data.KE);Q.oc(a,g,k,[4,2]);for(var m={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},l=Q.bn(a,f),n=[],q=[],r=[],t={},p=0;p<l;p++){var u=Q.Pi(a,f,p);u in t||(t[u]=0);var x=Q.mf(a,u,f,t[u]++);n.push([u,f,x]);var A=m[x[1]];if(A)switch(A[0]){case "MATERIAL_END":q.push([u,k,[x[0],A[1]]]);break;case "LIGHTING_APPLY":r.push([u,
[x[0],A[1]]])}else q.push([u,g,x])}c(a,h.data.value,g,k,r,b);for(p=0;p<n.length;p++)Q.Nn(a,n[p][0],n[p][1],n[p][2]);for(p=0;p<q.length;p++)Q.oc(a,q[p][0],q[p][1],q[p][2]);h=Q.kg(a,f);g=[];m=[];l={};for(p=0;p<h;p++)n=Q.Zf(a,f,p),n in l||(l[n]=0),x=Q.mf(a,f,n,l[n]++),g.push([f,n,x]),m.push([k,n,x]);for(p=0;p<g.length;p++)Q.Nn(a,g[p][0],g[p][1],g[p][2]);for(p=0;p<m.length;p++)Q.oc(a,m[p][0],m[p][1],m[p][2]);Q.Le(a,f)}}function c(a,b,c,d,e,f){var h={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},g=
D(a,h,0,f,null),k=g;q(a,c,g,"E");q(a,c,g,"A");q(a,c,g,"D");g=Aa.get_active();g=Ea.Ia(g,"LAMP",Ea.DATA_ID_ALL);if(!b.Fd)for(var m,l,n=0;n<g.length;n++){var r=g[n].La,h={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};m=D(a,h,0,f,null);h={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};l=D(a,h,0,f,null);q(a,k,l,"color");q(a,k,l,"specular");q(a,m,l,"ldir");q(a,c,l,"normal");q(a,c,l,"D");q(a,c,l,"S");q(a,m,l,"lcolorint");q(a,c,m,"shadow_factor");k="COOKTORR"==b.zj?"SPECULAR_PHONG":"SPECULAR_"+b.zj;h={name:k,
type:k};h=D(a,h,0,f,null);q(a,m,h,"ldir");q(a,m,h,"lfac");q(a,c,h,"normal");q(a,h,l,"sfactor");"SPECULAR_PHONG"!=k&&"SPECULAR_BLINN"!=k||q(a,m,h,"norm_fac");q(a,c,h,"sp_params");k="HEMI"==r.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.Dk;h={name:k,type:k};h=D(a,h,0,f,null);q(a,m,h,"ldir");q(a,m,h,"lfac");q(a,c,h,"normal");q(a,m,h,"norm_fac");q(a,h,l,"lfactor");"DIFFUSE_LAMBERT"!=k&&q(a,c,h,"dif_params");for(m=0;m<e.length;m++)Q.oc(a,e[m][0],l,e[m][1]);k=l}q(a,k,d,"color");q(a,k,d,"specular")}function q(a,
b,c,d){for(var e=Q.Ba(a,b),f=Q.Ba(a,c),h,g=0;g<f.H.length;g++)if(d==f.H[g].identifier){h=g;break}for(var k,g=0;g<e.ya.length;g++)if(d==e.ya[g].identifier){k=g;break}void 0!=h&&void 0!=k&&Q.oc(a,b,c,[k,h])}function f(a,b,c){switch(b){case "GLOW":return a+c+"11";case "COLOR_ID":case "DEPTH":return a+c+"00";default:return a+c+"10"}}function t(a,b){Q.oe(a,function(c,d,e){var f=Q.Ba(a,d);d==b&&"Color"==f.H[e[1]].identifier&&Q.Nn(a,c,d,e)})}function l(){var a=Q.create(),b={data:null,Md:[],R:[],H:[{Oa:new Float32Array([0,
0,0]),identifier:"Color",Xb:!1,name:"Color"},{Oa:1,identifier:"Alpha",Xb:!1,name:"Alpha"}],ya:[],type:"OUTPUT",Hg:[]};Q.ri(a,0,b);return a}function n(a){Q.aa(a,function(b,c){for(var d=c.H,e=c.ya,f=0;f<d.length;f++)g(a,d[f],b,f,1);for(f=0;f<e.length;f++)g(a,e[f],b,f,0)})}function g(a,b,c,d,e){if(b.Xb){var f=!0;Q.oe(a,function(a,b,h){if(!e&&a==c&&h[0]==d||e&&b==c&&h[1]==d)f=!1});f&&(b.Xb=!1)}}function z(a,b,c){var d=[];Q.oe(a,function(e,f,h){var g=Q.Ba(a,e),k=Q.Ba(a,f),g=qa.is_vector(g.ya[h[0]].Oa),
k=qa.is_vector(k.H[h[1]].Oa);if(g!=k){var m,l={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},n={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};g&&!k?m=J("vector_to_scalar","B4W_VECTOSCAL",[l],[n]):!g&&k&&(m=J("scalar_to_vector","B4W_SCALTOVEC",[n],[l]));D(a,m,0,b,c);d.push([e,f,a.D[a.D.length-2],h])}});for(var e=0;e<d.length;++e)Q.Nn(a,d[e][0],d[e][1],d[e][3]),Q.oc(a,d[e][0],d[e][2],[d[e][3][0],0]),Q.oc(a,d[e][2],d[e][1],[0,d[e][3][1]])}function h(a){var b=[];
Q.aa(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":Q.oe(a,function(a,e,f){a==c&&"Translucency"==d.ya[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)Q.oc(a,b[c],b[c+1],b[c+2])}function k(a,b){var c=[];Q.aa(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function u(a){var b=[];Q.aa(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var f=
w(a,d);if(-1!=f){var h=Q.Pi(a,f,0);Q.Sh(a,f,d,-1);-1!=h&&Q.Sh(a,h,f,-1);d=Q.Ba(a,f);e.data=d.data;e.R[0]=d.R[0];Q.Le(a,f)}e.H.splice(1,1)}else if("REROUTE"==e.type){for(var e=Q.Pi(a,d,0),g=Q.kg(a,d),f=[],h=[],k=[],m=0;m<g;m++){var l=Q.Zf(a,d,m),n=h.indexOf(l);-1!=n?k[n]+=1:(h.push(l),k.push(1),f.push(d,l))}if(-1!=e)for(g=Q.mf(a,e,d,0)[0],m=0;m<h.length;m++)for(l=0;l<k[m];l++)n=Q.mf(a,d,h[m],l)[1],Q.oc(a,e,h[m],[g,n]);for(m=0;m<f.length;m+=2)Q.Sh(a,f[m],f[m+1],-1)}}}function w(a,b){for(var c=a.fa,
d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function C(a){G(a);x(a);E(a)}function E(a){var b=[],c="",d="",e={};Q.aa(a,function(a,f){if("GEOMETRY_UV"==f.type||"UVMAP"==f.type||"TEX_COORD_UV"==f.type){b.push(a,f);var h=f.data.value;c?c==h||d||(d=h,e[d]=0):(c=h,e[c]=0);e[h]++}});for(var f in e)if(2>e[f]){for(var h=0;h<b.length;h+=2)b[h+1].data.value==f&&b.splice(h,2);delete e[f];c==f&&(c=d,d="");d==f&&(d="")}if(!(3>b.length)){var h={default_value:[0,0,0],identifier:"UV_geom",
is_linked:!1,name:"UV_geom"},g={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,name:"UV_cycles"};f=J("merged_uv","UV_MERGED",[],[h,g]);f.uv_layer=c;D(a,f,0,"",void 0);var k=a.D[a.D.length-2];f=a.D[a.D.length-1];if(d){g=J("merged_uv","UV_MERGED",[],[h,g]);g.uv_layer=d;D(a,g,0,"",void 0);var m=a.D[a.D.length-2],g=a.D[a.D.length-1]}else g=null;for(var l=-1,n=null,h=0;h<b.length;h+=2){var q=b[h],t=b[h+1];r(t,b[1])?(l=k,n=f):g&&(l=m,n=g);for(var p=[],u=Q.kg(a,q),x={},A=0;A<u;A++){var w=Q.Zf(a,
q,A);w in x||(x[w]=0);var N=Q.mf(a,q,w,x[w]++);p.push(q,w,N);N=N.splice(0,N.length);switch(t.type){case "GEOMETRY_UV":N[0]=0;n.ya[0].Xb=!0;break;case "UVMAP":case "TEX_COORD_UV":N[0]=1,n.ya[1].Xb=!0}Q.oc(a,l,w,N)}for(var A=0;A<p.length;A+=3)Q.Sh(a,p[A],p[A+1],0);Q.Le(a,q)}}}function G(a){var b=[];Q.aa(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||b.push(a,c)});for(var c=
[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],h=!0,g=0;g<c.length;g++){var k=c[g];if(A(f,k.ed)){h=[];g=Q.kg(a,e);for(n=0;n<g;n++){var m=Q.Zf(a,e,n),l=Q.mf(a,e,m,0);h.push(e,m,l);Q.oc(a,k.id,m,l)}for(var n=0;n<h.length;n+=3)Q.Sh(a,h[n],h[n+1],0);Q.Le(a,e);h=!1;break}}h&&(k={id:e,ed:f},c.push(k))}}function m(a){for(var b={},c=0;c<a.D.length;c+=2)b[a.D[c]]=[];for(c=0;c<a.fa.length;c+=3){for(var d=a.fa[c],e=a.fa[c+1],f=b[e],h=d,g=0;g<=f.length;g++){if(g>=f.length||f[g]>h)f.splice(g,0,h);else if(f[g]!=
h)continue;break}for(var e=b[e],d=b[d],h=f=0,g=e.length+d.length,k=[],m=0;m<g;m++)f>e.length||e[f]>d[h]?k.push(d[h++]):k.push(e[f++])}return b}function x(a){var b=[];Q.aa(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=m(a),d=[],e=0;e<b.length;e+=2){for(var f=b[e],h=b[e+1],g=!0,k=0;k<d.length;k++){var l=d[k];if(!(3<=l.ej.length||!A(h,l.ed)||-1<c[f].indexOf(l.id)||-1<c[l.id].indexOf(f))){for(var n=!1,q=0;q<l.ej.length;q++){var r=l.ej[q].id;if(-1<
c[f].indexOf(r)||-1<c[r].indexOf(f)){n=!0;break}}if(!n){for(var k=[],r=Q.bn(a,f),t={},q=0;q<r;q++)n=Q.Pi(a,f,q),n in t||(t[n]=0),g=Q.mf(a,n,f,t[n]++),k.push(n,f,g);for(var r=[],t=Q.kg(a,f),p={},q=0;q<t;q++)n=Q.Zf(a,f,q),n in p||(p[n]=0),g=Q.mf(a,f,n,p[n]++),r.push(f,n,g);g=k.concat(r);for(q=0;q<g.length;q+=3)Q.Sh(a,g[q],g[q+1],0);Q.Le(a,f);q={id:f,ed:h,kC:k,lC:r};l.ej.push(q);g=!1;break}}}g&&(l={id:f,ed:h,ej:[]},d.push(l))}for(e=0;e<d.length;e++){l=d[e];c=l.ej.length;for(k=0;k<c;k++){h=l.ej[k];q=
h.ed;f=h.kC;h=h.lC;l.ed.H[k+1].Xb=q.H[0].Xb;l.ed.H[k+1].Oa=q.H[0].Oa;l.ed.ya[2*(k+1)].Xb=q.ya[0].Xb;l.ed.ya[2*(k+1)].Oa=q.ya[0].Oa;l.ed.ya[2*(k+1)+1].Xb=q.ya[1].Xb;l.ed.ya[2*(k+1)+1].Oa=q.ya[1].Oa;for(q=0;q<f.length;q+=3)n=f[q],g=f[q+2],g[1]+=k+1,Q.oc(a,n,l.id,g);for(q=0;q<h.length;q+=3)n=h[q+1],g=h[q+2],g[0]+=2*(k+1),Q.oc(a,l.id,n,g);l.ed.Md.push(["USE_uv"+(k+2),1])}Q.Le(a,l.id);Q.ri(a,l.id,l.ed)}}}function A(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==
b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value.uuid==b.data.value.uuid;default:return!1}}function r(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function e(a){var b=[];Q.aa(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=
b[c],e=b[c+1],f=!1,h=[],g=[],k=[[],[],[]],m=Q.kg(a,d),l=0;l<m;l++){var n=Q.Zf(a,d,l);if("SEPRGB"!=Q.Ba(a,n).type){f=!1;break}h.push(d,n);for(var q={},r=Q.kg(a,n),f=0;f<r;f++){var t=Q.Zf(a,n,f);t in q||(q[t]=0);var p=Q.mf(a,n,t,q[t]++);h.push(n,t);k[p[0]].push(d,t,p)}g.push(n);f=!0}if(f){for(l=d=m=0;l<k.length;l++)k[l].length&&(m++,d|=1<<2-l);if(m){e.type+=m;e.ya=[];for(l=0;l<k.length;l++)if(k[l].length)for(e.ya.push({Oa:0,identifier:"RGB"[l],Xb:!0,name:"RGB"[l]}),f=0;f<k[l].length;f+=3)k[l][f+2][0]=
qa.rl(d,l);for(l=0;l<h.length;l+=2)Q.Sh(a,h[l],h[l+1],0);for(l=0;l<g.length;l++)Q.Le(a,g[l]);for(l=0;l<k.length;l++)for(f=0;f<k[l].length;f+=3)Q.oc(a,k[l][f],k[l][f+1],k[l][f+2])}}}}function v(a,b,c,d,e,f){a=a.nodes;for(var h=null,g=0;g<a.length;g++){var m=a[g];e?"GROUP"==m.type&&m.node_tree_name==c&&(h=m):m.type==c&&(h=m)}return h?k(h,b)[0]:(f||ga.error('No "'+c+'" node in node '+d),-1)}function J(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function D(a,b,c,d,e){var f=b.name,h=b.type,g=[],
k=[],m=[],l=[],n=null,q=[];switch(h){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "PARTICLE_INFO":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":k=
ha(b);m=ba(b);ga.warn(h+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":k=ha(b);m=ba(b);break;case "UVMAP":var r=b.uv_layer;r||(h="EMPTY_UV");if("EMPTY_UV"!=h){var n=K("param_"+h+"_a"),t=K("param_"+h+"_v");g.push(da(n));g.push(da(t));l.push(da(t));n={name:n,value:r}}m=ba(b);break;case "UV_MERGED":n=K("param_UV_MERGED_a");t=K("param_UV_MERGED_v");g.push(da(n));g.push(da(t));m.push(T(b,"UV_geom"));m.push(T(b,"UV_cycles"));l.push(da(t));n={name:n,value:b.uv_layer};
break;case "CAMERA":k=[];m=ba(b);break;case "COMBRGB":case "COMBHSV":k=ha(b);m=ba(b);break;case "CURVE_RGB":k=ha(b);m=ba(b);ga.warn("CURVE_RGB node is not fully supported.");break;case "CURVE_VEC":k=ha(b);m=ba(b);ga.warn("CURVE_VEC node is not fully supported.");break;case "GEOMETRY":if(!y(b))return!0;h=F(b,c);if(!h)return ga.error("Geometry output is not supported"),null;switch(h){case "GEOMETRY_UV":(r=b.uv_layer)||(h="EMPTY_UV");"EMPTY_UV"!=h&&(n=K("param_GEOMETRY_UV_a"),t=K("param_GEOMETRY_UV_v"),
g.push(da(n)),g.push(da(t)),l.push(da(t)),n={name:n,value:r});m.push(T(b,"UV"));break;case "GEOMETRY_VC":(r=b.color_layer)||(h="EMPTY_VC");"EMPTY_VC"!=h&&(n=K("param_GEOMETRY_VC_a"),t=K("param_GEOMETRY_VC_v"),g.push(da(n)),g.push(da(t)),l.push(da(t)),n={name:n,value:r});m.push(T(b,"Vertex Color"));break;case "GEOMETRY_NO":m.push(T(b,"Normal"));break;case "GEOMETRY_FB":m.push(T(b,"Front/Back"));break;case "GEOMETRY_VW":m.push(T(b,"View"));break;case "GEOMETRY_GL":m.push(T(b,"Global"));break;case "GEOMETRY_LO":m.push(T(b,
"Local"));break;case "GEOMETRY_OR":r=K("param_GEOMETRY_OR_v"),g.push(da(r)),m.push(T(b,"Orco")),l.push(da(r))}break;case "TEX_COORD":if(!y(b))return!0;h=M(b,c);if(!h)return ga.error("Texture coordinate output is not supported"),null;switch(h){case "TEX_COORD_UV":(r=b.uv_layer)||(h="EMPTY_UV");"EMPTY_UV"!=h&&(n=K("param_TEX_COORD_UV_a"),t=K("param_TEX_COORD_UV_v"),g.push(da(n)),g.push(da(t)),l.push(da(t)),n={name:n,value:b.uv_layer});m.push(T(b,"UV"));break;case "TEX_COORD_NO":m.push(T(b,"Normal"));
break;case "TEX_COORD_GE":r=K("param_TEX_COORD_GE_v");g.push(da(r));m.push(T(b,"Generated"));l.push(da(r));break;case "TEX_COORD_OB":m.push(T(b,"Object"));ga.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":m.push(T(b,"Camera"));break;case "TEX_COORD_WI":m.push(T(b,"Window"));ga.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":m.push(T(b,"Reflection")),ga.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;
case "GROUP":r=b.node_tree_name;switch(r){case "B4W_LINEAR_TO_SRGB":if(!H(b,[1],[1])){n=I(b,d,e);break}h="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!H(b,[1],[1])){n=I(b,d,e);break}h="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!H(b,[1],[1])){n=I(b,d,e);break}h="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!H(b,[1,1],[1])){n=I(b,d,e);break}h="B4W_REFLECT";break;case "B4W_REFRACTION":if(!H(b,[1,0],[1])){n=I(b,d,e);break}h="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!H(b,
[1,1,0,0,0],[1])){n=I(b,d,e);break}h="B4W_PARALLAX";t=K("temp_texture");l.push(da(t));break;case "B4W_CLAMP":if(!H(b,[1],[1])){n=I(b,d,e);break}h="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!H(b,[0,0,0,0,0],[0])){n=I(b,d,e);break}h="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!H(b,[],[0])){n=I(b,d,e);break}h="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!H(b,[0,0,0],[0])){n=I(b,d,e);break}h="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":h="B4W_GLOW_OUTPUT";break;default:n=I(b,d,e)}k=ha(b);m=ba(b);"B4W_TRANSLUCENCY"==
r&&(r=B("TranslucencyParams","TranslucencyParams",[0,0,0,0]),r.Xb=m[0].Xb,m.push(r));break;case "LAMP":n=b.lamp;if(!n)return ga.error("There is no lamp in node: "+b.name),null;m.push(T(b,"Color"));m.push(T(b,"Light Vector"));m.push(T(b,"Distance"));m.push(T(b,"Visibility Factor"));n.uuid in L?q.push(["LAMP_INDEX",String(L[n.uuid])]):(L[n.uuid]=Ia,q.push(["LAMP_INDEX",String(Ia++)]));n=L;break;case "LIGHTING_AMBIENT":k=[B("E","E",[0,0,0],!0),B("A","A",[0,0,0],!0),B("D","D",[0,0,0],!0)];m=[B("color",
"color",[0,0,0],!0),B("specular","specular",[0,0,0],!0)];break;case "LIGHTING_BEGIN":m=[B("E","E",[0,0,0],!0),B("A","A",[0,0,0],!0),B("D","D",[0,0,0],!0),B("S","S",[0,0,0],!0),B("normal","normal",[0,0,0],!0),B("dif_params","dif_params",[0,0],!0),B("sp_params","sp_params",[0,0],!0),B("shadow_factor","shadow_factor",0,!0),B("translucency_color","translucency_color",0,!0),B("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":k=[B("color","color",[0,0,0],!0),B("specular",
"specular",[0,0,0],!0)];break;case "LIGHTING_LAMP":k=[B("shadow_factor","shadow_factor",0,!0)];m=[B("ldir","ldir",[0,0,0],!0),B("lfac","lfac",[0,0],!0),B("lcolorint","lcolorint",[0,0,0],!0),B("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":k=[B("ldir","ldir",[0,0,0],!0),B("lfac","lfac",[0,0],!0),B("normal","normal",[0,0,0],!0),B("norm_fac","norm_fac",0,!0)];m=[B("lfactor","lfactor",0,!0)];break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":k=
[B("ldir","ldir",[0,0,0],!0),B("lfac","lfac",[0,0],!0),B("normal","normal",[0,0,0],!0),B("norm_fac","norm_fac",0,!0),B("dif_params","dif_params",[0,0],!0)];m=[B("lfactor","lfactor",0,!0)];break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":k=[B("ldir","ldir",[0,0,0],!0),B("lfac","lfac",[0,0],!0),B("normal","normal",[0,0,0],!0),B("norm_fac","norm_fac",0,!0),B("sp_params","sp_params",[0,0],!0)];m=[B("sfactor","sfactor",0,!0)];break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":k=[B("ldir","ldir",[0,0,
0],!0),B("lfac","lfac",[0,0],!0),B("normal","normal",[0,0,0],!0),B("sp_params","sp_params",[0,0],!0)];m=[B("sfactor","sfactor",0,!0)];break;case "LIGHTING_APPLY":k=[B("color","color",[0,0,0,0],!0),B("specular","specular",[0,0,0],!0),B("lfactor","lfactor",0,!0),B("sfactor","sfactor",0,!0),B("ldir","ldir",[0,0,0],!0),B("normal","normal",[0,0,0],!0),B("translucency_params","translucency_params",[0,0,0,0],!0),B("D","D",[0,0,0],!0),B("S","S",[0,0,0],!0),B("lcolorint","lcolorint",[0,0,0],!0),B("translucency_color",
"translucency_color",0,!0)];m=[B("color","color",[0,0,0,0],!0),B("specular","specular",[0,0,0],!0)];break;case "NORMAL":k=ha(b);m=ba(b);r=T(b,"Normal");l.push(da(K("param_NORMAL_Normal"),r.Oa,3));break;case "MAPPING":r=b.vector_type;h="MAPPING";k.push(V(b,"Vector"));m.push(T(b,"Vector"));var t=b.rotation,p=b.scale,u=b.translation,x=sa.create(),A=qa.pC(t);"TEXTURE"==r&&(p[0]=p[0]||1,p[1]=p[1]||1,p[2]=p[2]||1);var w=new Float32Array([p[0],0,0,0,p[1],0,0,0,p[2]]);sa.multiply(A,w,x);x=qa.IE(x,ca.create());
switch(r){case "POINT":x[12]=u[0];x[13]=u[1];x[14]=u[2];break;case "TEXTURE":x[12]=u[0];x[13]=u[1];x[14]=u[2];x=ca.invert(x,x);break;case "NORMAL":ca.invert(x,x),ca.transpose(x,x)}switch(r){case "NORMAL":q.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":q.push(["MAPPING_TRS_MATRIX",ua.t(x,16)]);break;case "POINT":0!==fa.length(t)?q.push(["MAPPING_TRS_MATRIX",ua.t(x,16)]):(0!==fa.length(p)&&q.push(["MAPPING_SCALE",ua.t(p,3)]),0!==fa.length(u)&&q.push(["MAPPING_TRANSLATION",ua.t(u,3)]));break;case "VECTOR":0!==
fa.length(t)?q.push(["MAPPING_TRS_MATRIX",ua.t(x,16)]):0!==fa.length(p)&&q.push(["MAPPING_SCALE",ua.t(p,3)])}b.use_min&&q.push(["MAPPING_MIN_CLIP",ua.t(b.min,3)]);b.use_max&&q.push(["MAPPING_MAX_CLIP",ua.t(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":n=[];r=[];t=[];p=[B("E","E",[0,0,0],!0),B("A","A",[0,0,0],!0),B("D","D",[0,0,0],!0),B("S","S",[0,0,0],!0),B("normal","normal",[0,0,0],!0),B("dif_params","dif_params",[0,0],!0),B("sp_params","sp_params",[0,0],!0),B("shadow_factor","shadow_factor",
0,!0)];u=[B("color","color",[0,0,0],!0),B("specular","specular",[0,0,0],!0),B("normal","normal",[0,0,0],!0)];x=[T(b,"Color"),T(b,"Alpha"),T(b,"Normal")];A=[];w=V(b,"Color");w.Oa.splice(3);t.push(w);k.push(w);w=V(b,"Spec");w.Oa.splice(3);t.push(w);k.push(w);t.push(B("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));k.push(w);var N=V(b,"Normal");N.Oa.splice(3);t.push(N);k.push(N);"MATERIAL_EXT"==h?((w=V(b,"Emit"))||(w=B("Emit","Emit",0)),t.push(w),k.push(w),(w=V(b,"Translucency"))?(w.Oa=0,
w.name="Translucency",w.identifier="Translucency"):w=B("Translucency","Translucency",0),k.push(w),(w=V(b,"Translucency"))?(w.Oa=[0,0,0,0],w.name="TranslucencyParams",w.identifier="TranslucencyParams"):w=B("TranslucencyParams","TranslucencyParams",[0,0,0,0]),k.push(w),m=V(b,"Reflectivity"),w=V(b,"Ray Mirror"),m?(w=m,m="Reflectivity"):w?m="Ray Mirror":(w=m,m="Reflectivity"),w||(w=B(m,m,0)),k.push(w),u.push(w),(w=V(b,"SpecTra"))||(w=B("SpecTra","SpecTra",0)),k.push(w),u.push(w),(w=V(b,"Alpha"))||(w=
B("Alpha","Alpha",b.alpha)),k.push(w),u.push(w),x.push(T(b,"Diffuse")),x.push(T(b,"Spec")),n.push(["MATERIAL_EXT",1]),r.push(["MATERIAL_EXT",1])):(t.push(B("emit_intensity","emit_intensity",0)),u.push(B("reflect_factor","reflect_factor",0)),u.push(B("specular_alpha","specular_alpha",0)),u.push(B("alpha_in","alpha_in",0)),x.push(B("diffuse_out","diffuse_out",0)),x.push(B("spec_out","spec_out",0)),n.push(["MATERIAL_EXT",0]),r.push(["MATERIAL_EXT",0]));A.push(da(K("param_MATERIAL_alpha"),b.alpha));A.push(da(K("param_MATERIAL_spec_alpha"),
b.specular_alpha));m=x;N.Xb&&n.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&(n.push(["USE_MATERIAL_DIFFUSE",1]),r.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&r.push(["USE_MATERIAL_SPECULAR",1]);var w=[],v=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":N=b.specular_hardness;break;case "WARDISO":N=b.specular_slope;break;case "TOON":N=b.specular_toon_size;v=b.specular_toon_smooth;break;case "BLINN":N=b.specular_ior;v=b.specular_hardness;break;default:ga.error("unsupported specular shader: "+
b.specular_shader+' (material "'+b.material_name+'")'),N=b.specular_hardness}var z,C;switch(b.diffuse_shader){case "LAMBERT":C=z=0;break;case "OREN_NAYAR":z=b.roughness;C=0;break;case "FRESNEL":z=b.diffuse_fresnel;C=b.diffuse_fresnel_factor;break;case "MINNAERT":z=b.darkness;C=0;break;case "TOON":z=b.diffuse_toon_size;C=b.diffuse_toon_smooth;break;default:ga.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),C=z=0}w.push(da(K("param_MATERIAL_diffuse"),[z,C],
2));w.push(da(K("param_MATERIAL_spec"),[b.specular_intensity,N,v],3));n.push(["SHADELESS_MAT",b.use_shadeless?1:0]);N={name:b.name,value:{zj:b.specular_shader,Dk:b.diffuse_shader,Fd:b.use_shadeless}};n={name:b.name,value:{zj:b.specular_shader,Dk:b.diffuse_shader,Fd:b.use_shadeless},JE:{name:"material_begin",type:"MATERIAL_BEGIN",H:t,ya:p,R:w,data:N,Md:n,Hg:[]},KE:{name:"material_end",type:"MATERIAL_END",H:u,ya:x,R:A,data:N,Md:r,Hg:[]}};break;case "MATH":switch(b.operation){case "ADD":h="MATH_ADD";
break;case "SUBTRACT":h="MATH_SUBTRACT";break;case "MULTIPLY":h="MATH_MULTIPLY";break;case "DIVIDE":h="MATH_DIVIDE";break;case "SINE":h="MATH_SINE";break;case "COSINE":h="MATH_COSINE";break;case "TANGENT":h="MATH_TANGENT";break;case "ARCSINE":h="MATH_ARCSINE";break;case "ARCCOSINE":h="MATH_ARCCOSINE";break;case "ARCTANGENT":h="MATH_ARCTANGENT";break;case "POWER":h="MATH_POWER";break;case "LOGARITHM":h="MATH_LOGARITHM";break;case "MINIMUM":h="MATH_MINIMUM";break;case "MAXIMUM":h="MATH_MAXIMUM";break;
case "ROUND":h="MATH_ROUND";break;case "LESS_THAN":h="MATH_LESS_THAN";break;case "GREATER_THAN":h="MATH_GREATER_THAN";break;case "MODULO":h="MATH_MODULO";break;case "ABSOLUTE":h="MATH_ABSOLUTE";break;default:return ga.error("Unsupported MATH operation: "+b.operation),null}q.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);k=ha(b);m=ba(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":h="MIX_RGB_MIX";break;case "ADD":h="MIX_RGB_ADD";break;case "MULTIPLY":h="MIX_RGB_MULTIPLY";break;case "SUBTRACT":h=
"MIX_RGB_SUBTRACT";break;case "SCREEN":h="MIX_RGB_SCREEN";break;case "DIVIDE":h="MIX_RGB_DIVIDE";break;case "DIFFERENCE":h="MIX_RGB_DIFFERENCE";break;case "DARKEN":h="MIX_RGB_DARKEN";break;case "LIGHTEN":h="MIX_RGB_LIGHTEN";break;case "OVERLAY":h="MIX_RGB_OVERLAY";break;case "DODGE":h="MIX_RGB_DODGE";break;case "BURN":h="MIX_RGB_BURN";break;case "HUE":h="MIX_RGB_HUE";break;case "SATURATION":h="MIX_RGB_SATURATION";break;case "VALUE":h="MIX_RGB_VALUE";break;case "COLOR":h="MIX_RGB_COLOR";break;case "SOFT_LIGHT":h=
"MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":h="MIX_RGB_LINEAR_LIGHT";break;default:return ga.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}q.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);k=ha(b);m=ba(b);break;case "OUTPUT":k=ha(b);m=[];break;case "RGB":r=d+"%join%"+b.name;r={name:"-1",value:r};l.push(r);m.push(T(b,"Color"));break;case "SEPRGB":case "SEPHSV":k=ha(b);m=ba(b);break;case "TEXTURE":h=O(b);if("TEXTURE_EMPTY"==h)m.push(T(b,"Color")),m.push(T(b,"Normal")),m.push(T(b,"Value"));
else if("TEXTURE_ENVIRONMENT"==h)k.push(V(b,"Vector")),m.push(T(b,"Color")),m.push(T(b,"Value"));else{if("TEXTURE_NORMAL"==h&&"ENVIRONMENT_MAP"==b.texture.type)return ga.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),null;for(n=0;4>n;++n)n?(w=B("Vector"+n,"Vector"+n,[0,0,0]),"TEXTURE_COLOR"==h&&(r=B("Color"+n,"Color"+n,[0,0,0]),t=B("Value"+n,"Value"+n,0)),"TEXTURE_NORMAL"==h&&(r=B("Normal"+n,"Normal"+n,[0,0,0]),t=B("Value"+n,"Value"+n,0))):(w=V(b,"Vector"),"TEXTURE_COLOR"==h&&(r=T(b,"Color"),
t=T(b,"Value")),"TEXTURE_NORMAL"==h&&(r=T(b,"Normal"),t=T(b,"Value"))),k.push(w),m.push(r),m.push(t)}t=K("param_TEXTURE_texture");l.push(da(t));n={name:t,value:b.texture};break;case "VALTORGB":k=ha(b);m=ba(b);ga.warn("VALTORGB node is not fully supported.");break;case "VALUE":h="VALUE";r=d+"%join%"+b.name;r={name:"-1",value:r};l.push(r);m.push(T(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":h="VECT_MATH_ADD";break;case "SUBTRACT":h="VECT_MATH_SUBTRACT";break;case "AVERAGE":h="VECT_MATH_AVERAGE";
break;case "DOT_PRODUCT":h="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":h="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":h="VECT_MATH_NORMALIZE";break;default:return ga.error("Unsupported VECT_MATH operation: "+b.operation),null}k=ha(b);m=ba(b);break;default:k=ha(b),m=ba(b)}h={name:f,type:h,Hg:g,H:k,ya:m,R:l,data:n,Md:q};f=Q.Rk(a);Q.ri(a,Q.Rk(a),h);if(!(h="GEOMETRY"!=b.type&&"TEX_COORD"!=b.type)){a:{h=b.outputs;for(k=g=0;k<h.length;k++)if(h[k].is_linked&&g++>c){h=!0;break a}h=!1}h=!h}return h||
null!=D(a,b,++c,d,e)?f:null}function H(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,h=0;h<b.length;h++){var g=d[h],k=b[h];if(!g||g.default_value instanceof Array!=k)return ga.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(h=0;h<c.length;h++)if(b=e[h],d=c[h],!b||b.default_value instanceof Array!=d)return ga.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1;return!0}
function I(a,b,c){var e=a.node_group.node_tree,f={},h;for(h in e)if("links"==h||"nodes"==h){f[h]=[];for(var g=0;g<e[h].length;g++){f[h][g]={};for(var k in e[h][g])if("links"==h){f[h][g][k]={};for(var m in e[h][g][k])f[h][g][k][m]=P(e[h][g][k][m])}else f[h][g][k]=P(e[h][g][k])}}else f[h]=P(e[h]);e=a.node_tree_name;if("B4W_REPLACE"==e||"B4W_LEVELS_OF_QUALITY"==e)h=J("Group input","GROUP_INPUT",[],a.inputs),g=J("Group output","GROUP_OUTPUT",a.outputs,[]),k=null,k="B4W_REPLACE"==e||"B4W_LEVELS_OF_QUALITY"==
e&&(Z.quality==X.P_LOW||Z.dq)?{from_node:h,from_socket:h.outputs[1],to_node:g,to_socket:g.inputs[0]}:{from_node:h,from_socket:h.outputs[0],to_node:g,to_socket:g.inputs[0]},f.nodes=[h,g],f.links=[k];e=a.name;h=f.nodes;g=f.links;for(k=0;k<h.length;k++)h[k].name=R(h[k].type,e,h[k].name);for(k=0;k<g.length;k++)g[k].from_node.name=R(g[k].from_node.type,e,g[k].from_node.name),g[k].to_node.name=R(g[k].to_node.type,e,g[k].to_node.name);return{XE:d(f,a.node_group.uuid,!0,b,c),YE:f.links}}function P(a){var b=
typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?qa.mk(a):a}function K(a){pa[a]||(pa[a]=0);var b=a+pa[a],b=b.replace(/ /g,"_").replace(/\//g,"_");pa[a]++;return b}function y(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function F(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";
case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}function M(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";
default:return null}}}function O(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,f=0;f<b.length;f++){var h=b[f];if(h.is_linked)switch(h.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&ga.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==
a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function V(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return U(e)}return null}function T(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return U(e)}return null}function U(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=qa.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,Xb:d,Oa:a}}function B(a,b,c,d){return{name:a,identifier:b,Xb:d||!1,Oa:c}}function ha(a){for(var b=
[],c=0;c<a.inputs.length;c++){var d=U(a.inputs[c]);d.Oa.length&&d.Oa.splice(3);b.push(d)}return b}function ba(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=U(a.outputs[c]);b.push(d)}return b}function da(a,b,c){b=null===b||void 0===b?null:ua.t(b,c);return{name:a,value:b}}function W(a,b,c,d,e,f){var h=[],g=f.from_socket.identifier;f=f.to_socket.identifier;var k=d.ya;for(d=0;d<k.length;d++)if(k[d].identifier==g){h.push(d);break}e=e.H;for(d=0;d<e.length;d++)if(e[d].identifier==f){h.push(d);break}2==
h.length&&Q.oc(a,b,c,h);return!0}function R(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function Y(a){var b=[];Q.aa(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function ka(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.XE,f=c[d].data.YE;if(!e)return!1;Q.aa(e,function(b,c){Q.ri(a,Q.Rk(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);aa(c[d],b,a)}return!0}function ea(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function ma(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],h=null,g=0;g<b.length;g++)if(f.from_socket.identifier==b[g].to_socket.identifier){h=b[g];break}h?(f.from_node=h.from_node,f.from_socket=h.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function la(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function N(a,b,c,
d){for(var e=0;e<d.length;e++){for(var f=d[e],h,g=0;g<c.H.length;g++)if(f.from_socket.identifier==c.H[g].identifier){h=c.H[g].Oa;break}for(var g=f,m=b,l=h,n=k(g.to_node,m),q=0;q<n.length;q++)for(var r=Q.Ba(m,n[q]),t=0;t<r.H.length;t++){var p=r.H[t];if(p.identifier==g.to_socket.identifier){r=p.Oa instanceof Object?0:1;if((l instanceof Object?0:1)==r)p.Oa=l;else switch(r){case 0:p=p.Oa;p[0]=p[1]=p[2]=l;break;case 1:p.Oa=(l[0]+l[1]+l[2])/3}break}}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function aa(a,b,
c){for(var d=a.name,e=[],f=[],h=[],g=[],k=0;k<b.length;k++){var m=b[k];ea(m.from_node,d,m,e,h,g);ea(m.to_node,d,m,f,h,g)}f=ma(b,f,h);e=ma(b,g,e);la(b,f);N(b,c,a,f);if(e.length){var l;Q.aa(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(l=b)});N(b,c,l,e)}}var X=p("__config"),Q=p("__graph"),sa=p("__mat3"),ca=p("__mat4"),Ea=p("__objects"),ga=p("__print"),ua=p("__shaders"),Aa=p("__scenes"),qa=p("__util"),fa=p("__vec3"),pa={},S={},L={},Ia=0;new Float32Array(4);var Z=X.p;a.fB=d;a.Cp=
function(a,b,d){var e=Aa.get_active();a=f(a,"MAIN",e.uuid);if(a in S)return S[a];var e=Q.create(),h={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},g=D(e,h,0,b,null),h={name:"LIGHTING_END",type:"LIGHTING_END"},h=D(e,h,0,b,null);c(e,d,g,h,[[g,[8,10]],[g,[9,6]]],b);n(e);return S[a]=e};a.xm=function(a){var b=[],c={};pa={};var d=Q.ss(a);Q.aa(d,function(a,d){var e;e=[];for(var f=[],h=[],g=[],k=[],m=[],l=0;l<d.H.length;l++){var n=d.H[l];if(n.Xb)e.push(null),f.push(null);else{e.push(K("in_"+d.type+"_"+n.identifier));
var q=ua.t(n.Oa,0);Z.Pw&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier||0<=d.type.indexOf("LIGHTING_APPLY")||0<=d.type.indexOf("MATERIAL_END")||0<=d.type.indexOf("MATERIAL_BEGIN"))&&(n=q,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,
"$1UNITY_VALUE_NODES$3"),q=n=n.replace(/\s+/g,""));f.push(q)}}for(l=0;l<d.ya.length;l++)n=d.ya[l],n.Xb?h.push(null):h.push(K("out_"+d.type+"_"+n.identifier));for(l=0;l<d.R.length;l++)n=d.R[l],g.push(n.name),k.push(n.value);for(l=0;l<d.Hg.length;l++)m.push(d.Hg[l].name);e={id:d.type,H:e,Dq:f,ya:h,R:g,Cn:k,Hg:m,Md:JSON.parse(JSON.stringify(d.Md))};b.push(e);c[a]=e});Q.oe(d,function(a,b,e){var f=Q.Ba(d,a);Q.Ba(d,b);var h=f.ya[e[0]];a=c[a].ya;b=c[b].H;f=a[e[0]]||K("out_"+f.type+"_"+h.identifier);a[e[0]]=
f;b[e[1]]=f});return b};a.Ht=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in S)delete S[a];for(var b in L)delete L[b];Ia=0}};b4w.module.__animation=function(a,p){function d(a,b){var c=a.M[b];c&&c.bq&&c.Kk&&(c.Kk=!1,c.bq(a,b))}function b(a,b,c){c=a.M[c];c.type=30;var d=b.N,e=b.ja-d+1;c.start=d;c.length=e;c.jd=d;c.Xe=b.name;for(e=d=0;e<a.jc.length;e++){var f=a.jc[e];if(f==b)break;else d+=f.ja-f.N+1}c.Ox=d}function c(a,b,c){for(var d=a.J,e=0;e<d.length;e++)for(var f=d[e].T,h=0;h<f.length;h++){var g=f[h].Da;if(g&&g.name==b){var k=a.M[c];k.type=50;k.Xe=g.name;k.start=g.N;k.length=g.ja-k.start;g.cyclic||(k.length+=g.Pq)}}}function q(a){return a.replace(/_B4W_BAKED$/,
"")}function f(a,b){if(a.animation_data){var c=a.animation_data.action;c&&c.k.type==ga&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&f(e,b)}}function t(a){return V.is_mesh(a)&&a.f.jc?!0:!1}function l(a,b,c){var d=a.M;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.jd=b,g(a,0,c,!0))}else if(e=d[c])e.jd=b,g(a,0,c,!0)}function n(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function g(a,b,c,e){E(a,b,c,e);d(a,c);a.f.Ug&&(x(a,
b),m(a,b))}function z(a,b,c){var d=b.frame_range;if(d[0]>d[1])return B.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var e=b.k,f=a.M[c];f.Xe=b.name;f.Jo=d;f.et=e.ew;f.dt=e.rt;f.$g.set(e.$g);f.start=d[0];f.length=d[1]-d[0];f.jd=d[0];switch(e.type){case sa:if(V.is_armature(a)){f.type=10;var g=h(a,b);if(!g){for(var g=a.f.Jd,d=[],m=[],l=b.k.hr,n=0;n<l;n++){for(var q in g){var t=g[q],p=t.fo,x=b.k.ep[q];x?Y.copy(x.subarray(8*n,8*n+8),p):Y.identity(p);t.ho=!1}t=A(g);
d.push(t.trans);m.push(t.za)}g={trans:d,za:m};a.qi.push(b,g)}f.trans=g.trans;f.za=g.za;f=g;q=a.f;g=q.Wn;m=a.M[c];d=m.Tr;a:{l=q.Tw;for(n=0;n<l.length;n+=2)if(b==l[n]){l=l[n+1];break a}l=null}if(l)m.Tr=l;else{for(m=0;m<g.length;m++){for(var l=g[m].vi,n=[],t=[],p=f.trans,x=f.za,N=0;N<p.length;N++){var v=r(p[N],x[N],l);n.push(v.trans);t.push(v.za)}d.push({trans:n,za:t})}q.Tw.push(b,d)}q.Ug&&(b=q.jo,c>b[1]?(f=b[1],b[1]=c,b[0]=f):c>b[0]&&c<b[1]&&(b[0]=c),k(a))}break;case ca:V.is_speaker(a)&&(f.volume=e.R.volume||
null,f.pitch=e.R.pitch||null,f.type=40);break;case ua:V.is_lamp(a)&&(f.color=e.R.color||null,f.hf=e.R.energy||null,f.type=70);break;case ga:if("MESH"==a.type){f.type=60;q=h(a,b);if(!q){q=[];d=[];m=[];l=[];n=b.k;t=a.f.sn;p=a.f.tn;for(g in n.R)x=b.name+"%join%"+g,w(g,x,n,d,q,t),w(g,x,n,l,m,p);q={VH:q,values:d,GF:m,HF:l};a.qi.push(b,q)}f.Nv=q.VH;f.Pv=q.values;f.Mv=q.GF;f.Ov=q.HF}break;case Ea:if(q=e.R.tsr){f.type=20;g=h(a,b);if(!g){g=b.k.hr;d=[];m=[];for(l=0;l<g;l++)d.push(q.subarray(8*l,8*l+4)),m.push(q.subarray(8*
l+4,8*l+8));g={trans:d,za:m};a.qi.push(b,g)}f.trans=g.trans;f.za=g.za;T.jj(a)&&T.DH(a,f.trans[0],f.za[0])}else return B.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1}V.is_armature(a)&&e.type!=sa&&u(a,c);return!0}function h(a,b){for(var c=a.qi,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function k(a){var b=a.f.jo;if(-1!=b[0]&&-1!=b[1]){var c=a.M;a=c[b[1]].jd;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.jd;d=Math.floor(a);b.jd=d+e}}function u(a,b){var c=
a.f.jo,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.M;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function w(a,b,c,d,e,f){for(var h=0;h<f.length;h+=2)b==f[h]&&(e.push(f[h+1]),d.push(new Float32Array(c.R[a])))}function C(a){a=a.k;for(var b in a.R)if(-1!=b.indexOf("nodes"))return!0;return!1}function E(a,b,c,d){if((c=a.M[c])&&null!=c.type&&(c.play||d)){var e=a.f,f=c.jd,h=c.start,g=c.length,f=f+c.speed*b*W.Wb(),k=c.type,m=c.speed;if(0<=m&&f>=h+g||0>m&&f<h)switch(d||
(c.Kk=!0),c.behavior){case 10:f=0<=m?(f-h)%g+h:h+g-1E-6;break;case 20:f=0<=m?h:h+g-1E-6;c.play=!1;break;case 30:f=0<=m?h+g-1E-6:h,c.play=!1}c.jd=f;switch(k){case 10:if(!e.Ug){d=G(c);b=d[0];f=d[1];d=d[2];e.Qc=c.za[b];e.wd=c.za[f];e.Yc=c.trans[b];e.Ed=c.trans[f];e.Pd=d;d=e.Wn;c=c.Tr;for(h=0;h<d.length;h++)g=d[h],k=c[h],g.Qc=k.za[b],g.wd=k.za[f],g.Yc=k.trans[b],g.Ed=k.trans[f],g.Pd=e.Pd;R.n(a)}break;case 20:d=G(c);var e=qa,f=d[0],h=d[1],g=d[2],k=c.trans,m=k[f][1],l=k[f][2],n=k[h][1],q=k[h][2];e[0]=(1-
g)*k[f][0]+g*k[h][0];e[1]=(1-g)*m+g*n;e[2]=(1-g)*l+g*q;f=pa;l=d[0];h=d[1];g=d[2];k=c.za;m=S;m[0]=k[l][0];m[1]=k[l][1];m[2]=k[l][2];m[3]=k[l][3];l=L;l[0]=k[h][0];l[1]=k[h][1];l[2]=k[h][2];l[3]=k[h][3];ha.slerp(m,l,g,f);h=d[2];g=c.trans;d=(1-h)*g[d[0]][3]+h*g[d[1]][3];a.parent&&a.Hn&&(h=Y.create(),Y.set_sep(e,d,f,h),Y.multiply(a.Hn,h,h),e=Y.get_trans_view(h),f=Y.get_quat_view(h),d=Y.get_scale(h));c.ts&&(h=fa,R.get_translation(a,h),ka.smooth_v(e,h,b,c.ts,e));c.ur&&(h=S,R.get_rotation(a,h),ka.Yw(f,h,
b,c.ur,f));h=c.$g;h[0]&&R.set_translation_rel(a,e);h[1]&&R.set_rotation_rel(a,f);h[2]&&R.set_scale_rel(a,d);R.n(a);U.sync_transform(a);break;case 30:d=c.jd-c.start;0>d&&(d=0);d>=c.length&&(d=c.length);a=Math.floor(d);b=a+1;d-=a;10!=c.behavior&&b==c.length&&(b=--a,d=1);c=c.Ox;Aa[0]=a+c;Aa[1]=b+c;Aa[2]=d;d=Aa;e.Ds=d[0];e.Nx=d[2];break;case 40:d=G(c);b=d[0];e=d[1];d=d[2];c.volume&&da.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&da.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:T.fG(a,
c.Xe,10==c.behavior?(f-h)/W.Wb():f/W.Wb());break;case 60:d=G(c);b=d[0];e=d[1];d=d[2];k=c.Pv;m=c.Nv;f=c.Ov;h=c.Mv;for(c=0;c<m.length;c++)l=k[c],g=m[c],a.f.rf[g]=(1-d)*l[b]+d*l[e];for(c=0;c<h.length;c++)k=f[c],g=h[c],k=ea.lerp(k.subarray(3*b,3*b+3),k.subarray(3*e,3*e+3),d,qa),a.f.sd[3*g]=k[0],a.f.sd[3*g+1]=k[1],a.f.sd[3*g+2]=k[2];break;case 70:d=G(c);b=d[0];e=d[1];d=d[2];h=c.$g;(f=c.hf)&&h[0]&&la.Mr(a.La,(1-d)*f[b]+d*f[e]);(c=c.color)&&h[1]&&(qa[0]=(1-d)*c[3*b]+d*c[3*e],qa[1]=(1-d)*c[3*b+1]+d*c[3*e+
1],qa[2]=(1-d)*c[3*b+2]+d*c[3*e+2],la.Kw(a.La,qa));b=a.J;for(c=0;c<b.length;c++)N.rH(a,b[c].Ea);break;default:ka.W("Unknown animation type:"+k)}}}function G(a){var b=a.Jo[0],c=a.Jo[1]-b,b=a.jd-b;0>b&&(b=0);b>=c&&(b=c);b/=a.et;c=Math.floor(b);a=a.dt[c]?b-c:0;b=Math.ceil(c+a);Aa[0]=c;Aa[1]=b;Aa[2]=a;return Aa}function m(a,b){var c=a.f,d=c.Mf,e=c.jo,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var h=a.M[f];if(h.play||0==b){var g=G(h),k=g[0],m=g[1];c.Pd=g[2];var g=h.za[k],l=h.za[m],k=h.trans[k],m=h.trans[m]}else d=
1}else d=1;e=a.M[e];if(e.play||0==b){var f=G(e),n=f[0],q=f[1];c.Pd=f[2]}else if(-1!=f&&h.play)d=0;else return;f=e.za[n];h=e.za[q];n=e.trans[n];q=e.trans[q];if(1==d)c.Qc.set(f),c.wd.set(h),c.Yc.set(n),c.Ed.set(q);else if(0==d)c.Qc.set(g),c.wd.set(l),c.Yc.set(k),c.Ed.set(m);else{for(e=0;e<g.length;e+=4){for(var r=pa,t=S,p=0;4>p;p++)r[p]=g[e+p],t[p]=f[e+p];ha.slerp(r,t,d,r);for(p=0;4>p;p++)c.Qc[e+p]=r[p];for(p=0;4>p;p++)r[p]=l[e+p],t[p]=h[e+p];ha.slerp(r,t,d,r);for(p=0;4>p;p++)c.wd[e+p]=r[p]}ka.tt(k,
n,d,c.Yc);ka.tt(m,q,d,c.Ed)}R.n(a);ma.BH(a)}}function x(a,b){var c=a.f,d=c.Mf,e=c.Po;if(0!=e){var d=c.Oo-d,f=e*b;ka.sign(d)==ka.sign(e)&&Math.abs(f)<Math.abs(d)?c.Mf+=f:(c.Mf=c.Oo,c.Po=0)}}function A(a){var b=[],c=[],d=new Float32Array(4),e=new Float32Array(4),f;for(f in a){var h=a[f],g=d,k=e,m=h.um,l=m[m.length-1],n=l.vs;l.ho||Y.identity(n);for(l=m.length-1;0<=l;l--){var q=m[l],r=q.vs;if(q.ho)n=r;else{var t=q.Cg,p=q.fo;Y.invert(t,Ia);Y.multiply(p,Ia,Ia);Y.multiply(t,Ia,Ia);Y.multiply(n,Ia,r);n=r;
q.ho=!0}}m=q.vs;g[0]=m[0];g[1]=m[1];g[2]=m[2];g[3]=m[3];k[0]=m[4];k[1]=m[5];k[2]=m[6];k[3]=m[7];ha.normalize(k,k);h=h.Of;for(g=0;4>g;g++)k=4*h+g,b[k]=d[g],c[k]=e[g]}return{trans:b,za:c}}function r(a,b,c){var d=[],e=[];new Float32Array(4);new Float32Array(4);for(var f in c)for(var h=c[f],g=h.Of,h=h.Np,k=0;4>k;k++){var m=4*h+k,l=4*g+k;d[m]=a[l];e[m]=b[l]}d=new Float32Array(d);e=new Float32Array(e);return{trans:d,za:e}}function e(a){var b=a.k,c;if(b.ep)c=sa;else if(b.R)if("volume"in b.R||"pitch"in b.R)c=
ca;else if(C(a))c=ga;else{a:{if(a.k.R){a=a.fcurves;for(c in a)if("color"==c&&!a[c][3]){c=!0;break a}if("energy"==c){c=!0;break a}}c=!1}c=c?ua:Ea}else c=Q;b.type=c}function C(a){if(a=a.k.R)for(var b in a)if(-1!=b.indexOf("nodes"))return!0;return!1}function v(a,b){b[0]=b[1]=b[2]=0;for(var c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1)}function J(a,b){b[0]=b[1]=0;for(var c in a)"energy"==c?b[0]=1:"color"==c&&(b[1]=1)}function D(a,b,c,d,e,f,h){var g=a+(b-a)/2,k=H(g,d,
e,f,h)-c;return.02>Math.abs(k)?g:0<k?D(a,g,c,d,e,f,h):D(g,b,c,d,e,f,h)}function H(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function I(a,b){var c={type:null,Xe:null,Jo:null,et:0,dt:null,$g:new Int8Array(3),za:null,trans:null,Tr:[],play:!1,behavior:20,jd:0,start:0,length:0,ts:0,ur:0,Kk:!1,Ox:null,speed:1,volume:null,pitch:null,color:null,hf:null,Pv:[],Nv:[],Ov:[],Mv:[]};if(!a.M.length)for(var d=0;8>d;d++)a.M.push(null);a.M[b]=c;-1==Z.indexOf(a)&&Z.push(a)}function P(a,b){R.n(a);
U.sync_transform(a);g(a,0,b,!0)}function K(a,d,e){e=e||0;if(V.is_mesh(a)){var f=y(a,d);if(f)return I(a,e),b(a,f,e),P(a,e),!0;if((f=F(a,d))&&"EMITTER"==f.jr)return I(a,e),c(a,f.name,e),P(a,e),!0}if(f=ka.keysearch("name",d,ya)||ka.keysearch("name",d+"_B4W_BAKED",ya)){I(a,e);if(z(a,f,e))return P(a,e),!0;a.M[e]=null}B.error('Unsupported object: "'+a.name+'" or animation name: "'+d+'"');return!1}function y(a,b){for(var c=0;c<a.jc.length;c++){var d=a.jc[c];if(d.name===b)return d}return null}function F(a,
b){for(var c=a.J,d=0;d<c.length;d++)for(var e=c[d].T,f=0;f<e.length;f++){var h=e[f].Da;if(h&&h.name===b)return h}return null}function M(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}var O=p("__config"),V=p("__obj_util"),T=p("__particles"),U=p("__physics"),B=p("__print"),ha=p("__quat"),ba=p("__reformer"),da=p("__sfx"),W=p("__time"),R=p("__transform"),Y=p("__tsr"),ka=p("__util"),ea=p("__vec3"),ma=p("__armature"),la=p("__lights"),N=p("__scenes"),
aa=O.Vg,X=O.p;a.Fy=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.II=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var Q=a.lI=0,sa=a.jy=1,ca=a.mI=2,Ea=a.ly=3,ga=a.Ns=4,ua=a.ky=5,Aa=Array(3),qa=new Float32Array(3),fa=new Float32Array(3),pa=new Float32Array(4),
S=new Float32Array(4),L=new Float32Array(4),Ia=Y.create();new Float32Array(16);var Z=[],ya=[];a.Mu=function(){return ka.trunc((X.Hv-50)/4)};a.frame_to_sec=function(a){return a/W.Wb()};a.update=function(a){for(var b=0;b<Z.length;b++){for(var c=Z[b],e=0;8>e;e++)E(c,a,e);c.f.Ug&&(x(c,a),m(c,a))}for(b=0;b<Z.length;b++)for(c=Z[b],e=0;8>e&&c.M.length;e++)d(c,e)};a.bD=function(){return ya};a.get_anim_names=function(a){var b=[];if(t(a))for(var c=0;c<a.jc.length;c++)b.push(a.jc[c].name);for(var d=[],c=0;c<
ya.length;c++){var e=ya[c],f=e.k;f.type==Ea?d.push(e):f.type==sa&&"ARMATURE"==a.type?d.push(e):f.type==ca&&"SPEAKER"==a.type&&d.push(e)}if("MESH"==a.type)for(c=0;c<a.actions.length;c++)e=a.actions[c],e.k.type==ga&&d.push(e);for(c=0;c<d.length;c++)b.push(q(d[c].name));if(T.jj(a)&&T.Vv(a))for(a=a.J,c=0;c<a.length;c++)for(d=a[c].T,e=0;e<d.length;e++)(f=d[e].Da)&&b.push(f.name);return b};a.aL=q;a.get_anim_type=function(a,b){var c=a.M[b];return c?c.type:0};a.apply_def=function(a){for(var d=0,e=a.J,f=0;f<
e.length;f++)for(var h=e[f].T,g=0;g<h.length;g++){var k=h[g].Da;k&&"EMITTER"==k.jr&&(I(a,d),c(a,k.name,d),P(a,d),a.M[d].behavior=k.cyclic?10:a.em,d++)}e=a.actions.slice();for(f=0;f<e.length;f++)h=e[f],I(a,d),z(a,h,d)?(P(a,d),a.M[d].behavior=a.em,d++):a.M[d]=null;t(a)&&(I(a,d),b(a,a.jc[0],d),P(a,d),a.M[d].behavior=a.em)};a.jt=function(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:ka.W("Wrong animation behavior")}};a.gD=function(a){var b=[];
a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&f(d,b)}return b};a.play=function(a,b,c){n(a.M,c,function(a){a.play=!0;a.bq=b?b:null;a.Kk=!1});a.f.Ug&&k(a)};a.stop=function(a,b){n(a.M,b,function(a){a.play=!1;a.bq=null;a.Kk=!1})};a.is_play=function(a,b){var c=a.M;if(-1==b)for(var d=0;8>d;d++){if(c[d]&&c[d].play)return!0}else if(c=c[b])return c.play;return!1};a.set_frame=l;a.set_first_frame=function(a,b){b=b||0;n(a.M,b,function(c){l(a,c.start,b)})};a.Ju=function(a,b){var c=a.M[b];
return c&&c.jd?c.jd:0};a.is_cyclic=function(a,b){var c=a.M[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){n(a.M,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.M[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){n(a.M,d,function(a){a.ts=b||0;a.ur=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.M[c]=null;else a.M[b]=null;a.f.Ug&&u(a,b)};a.uH=g;a.Xv=function(a){if("ARMATURE"==a.type||a.im)return!0;for(var b=0;b<a.actions.length;b++){var c=
a.actions[b].k.type;if(c==Ea||c==sa||c==ca&&"SPEAKER"==a.type||c==ua&&"LAMP"==a.type||c==ga&&"MESH"==a.type)return!0}return T.jj(a)&&T.Vv(a)||"MESH"==a.type&&a.jc.length?!0:!1};a.xt=function(a,b){if("ARMATURE"==b.type||M(a))return!0;for(var c=0;c<b.actions.length;c++){var d=b.actions[c].k.type;if(d==Ea||d==sa||d==ca&&"SPEAKER"==b.type||d==ga&&"MESH"==b.type)return!0}return T.BA(a)&&T.AA(a)||"MESH"==b.type&&a.data.b4w_vertex_anim.length?!0:!1};a.is_animated=function(a){return Boolean(a.M.length)};
a.EA=A;a.xC=r;a.Mz=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);ha.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,e=0):(d=0,e=b);return d+e}function d(a,b,c,e,g){if(-1<c.search(f)){a=b;c=c.split('"')[1];var k=h}else 8==g?(c="tsr",k=h):k=1<g?new Float32Array(g):0;if(!a[c]){g=a;b=c;if("object"==typeof k&&k.length)for(var m=k.length,l=new Float32Array(e*m),
n=0;n<e;n++)for(var q=0;q<m;q++)l[n*m+q]=k[q];else if("number"==typeof k)for(l=new Float32Array(e),n=0;n<e;n++)l[n]=k;else ka.W("Wrong storage default value");g[b]=l}return a[c]}var f=new RegExp(/pose.bones\[\".+\"\]/g),h=Y.create(),g=a.k={type:Q,hr:0,ew:0,R:null,ep:null,rt:null,$g:new Int8Array(3)};g.ew=1/aa.oh;var k=a.fcurves,m={},l={},n=0,q;for(q in k){var r=k[q],t;for(t in r){var p=r[t],u=p.dd;ba.MA(p,a);p=p.num_channels;n||(n=u.length);for(var p=d(m,l,q,n,p),x=p.length/n,w=c(q,t|0),A=0;A<n;A++)p[A*
x+w]=u[A]}}if(ka.Sk(m)){for(var N in m)"tsr"==N&&b(m[N],n);g.R=m}if(ka.Sk(l)){for(var D in l)b(l[D],n);g.ep=l}g.hr=n;g.rt=a.Ez;"tsr"in m&&v(k,g.$g);("color"in m||"energy"in m)&&J(k,g.$g);e(a);ya.push(a)};a.eD=function(a,b){return(b-a)*aa.oh+1};a.iA=function(a,b,c,d,e,f){var h,g,k=new Float32Array(2),m=new Float32Array(2),l=new Float32Array(2),n=new Float32Array(2),q=b[1],r=b[2],t=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var p=0,u=0,x=null;e<=f;e++)if(e<q)for(var w=0;w<aa.oh;w++)c[p++]=
r;else if(e>t)for(w=0;w<aa.oh;w++)c[p++]=a;else{var A=b[u],N=3;0===A&&(N+=2);0===x&&(N+=2);var v=2===A?0:1;if(b[u+1]==b[u+N+1])x=A,u+=N;else{w=0;e==b[u+1]&&(v&&(d[p]=1),c[p]=b[u+2],p++,w++);if(e==t)for(;w<aa.oh;w++)c[p++]=a;else for(k[0]=b[u+1],k[1]=b[u+2],0!==A?(m[0]=0,m[1]=0):0===x?(m[0]=b[u+5],m[1]=b[u+6]):(m[0]=b[u+3],m[1]=b[u+4]),0!==A?(l[0]=0,l[1]=0):(l[0]=b[u+N+3],l[1]=b[u+N+4]),n[0]=b[u+N+1],n[1]=b[u+N+2];w<aa.oh;w++){var y=e+w/aa.oh;switch(A){case 0:h=k;g=m;var z=l,C=n,O=[],B=[],X=void 0,
E=void 0,F=void 0,X=void 0;O[0]=h[0]-g[0];O[1]=h[1]-g[1];B[0]=C[0]-z[0];B[1]=C[1]-z[1];F=C[0]-h[0];X=Math.abs(O[0]);E=Math.abs(B[0]);0!=X+E&&X+E>F&&(X=F/(X+E),g[0]=h[0]-X*O[0],g[1]=h[1]-X*O[1],z[0]=C[0]-X*B[0],z[1]=C[1]-X*B[1]);v&&(d[p]=1);c[p]=H(D(0,1,y,k[0],m[0],l[0],n[0]),k[1],m[1],l[1],n[1]);p++;break;case 1:g=k[0];z=k[1];h=C=(n[1]-z)/(n[0]-g);g=z-C*g;v&&(d[p]=1);c[p]=h*y+g;p++;break;case 2:v&&(d[p]=1);c[p]=b[u+2];p++;break;default:ka.W("Unknown keyframe interpolation mode: "+A)}}e+1==b[u+N+1]&&
(x=A,u+=N)}}};a.apply=K;a.eA=function(a,b,c){c=c||0;var d=ka.keysearch("uuid",b,ya);if(d){I(a,c);if(z(a,d,c)){P(a,c);return}a.M[c]=null}B.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.WH=function(a,b){var c=ka.keysearch("name",b,ya)||ka.keysearch("name",b+"_B4W_BAKED",ya);if(c){if(c.k.type==Q)return!1}else if(!(F(a,b)||V.is_mesh(a)&&y(a,b)))return!1;return!0};a.get_slot_num_by_anim=function(a,b){for(var c=a.M,d=0;d<c.length;d++){var e=c[d];if(e&&q(e.Xe)==q(b))return d}return-1};
a.cD=function(a,b){var c=a.M[b];return c&&c.Xe?q(c.Xe):null};a.remove=function(a){a.M.length=0;a=Z.indexOf(a);-1!=a&&Z.splice(a,1)};a.wF=function(a){for(var b=ya.length-1;0<=b;b--)ya[b].Fz==a&&ya.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.M.length)return K(a,b,0)?0:-1;for(var c=0;c<a.M.length;c++)if(!a.M[c])return K(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.f.Po=(b-a.f.Mf)/c;a.f.Oo=b};a.set_speed=function(a,b,c){n(a.M,c,function(a){a.speed=b})};a.get_speed=function(a,
b){return a.M[b].speed};a.get_anim_start_frame=function(a,b){return a.M[b].start};a.get_anim_length=function(a,b){return a.M[b].length};a.cleanup=function(){Z.length=0;ya.length=0};a.zC=function(a){var b=(a[0]||a[1]||a[2]).dd.length,c=pa,d=qa,e=Boolean(a[0]);e||(a[0]={dd:new Float32Array(b),num_channels:8});var f=Boolean(a[1]);f||(a[1]={dd:new Float32Array(b),num_channels:8});var h=Boolean(a[2]);h||(a[2]={dd:new Float32Array(b),num_channels:8});a[3]={dd:new Float32Array(b),num_channels:8};for(var g=
0;g<b;g++)d[0]=e?a[0].dd[g]:0,d[1]=f?a[1].dd[g]:0,d[2]=h?a[2].dd[g]:0,ka.euler_to_quat(d,c),a[0].dd[g]=c[3],a[1].dd[g]=c[0],a[2].dd[g]=c[1],a[3].dd[g]=c[2]};a.Gu=M};b4w.module.__time=function(a,p){var d=p("__config");p("__print");p("__util");var b=0,c=0,q=[],f=0,t=0,l=[],n=-1;a.Nw=function(a){b=a;c=performance.now();for(a=0;a<q.length;a++){var d=q[a];b>d.Yp&&(q.splice(a,1),a--,d.callback())}for(a=0;a<l.length;a++){var d=l[a],f=1-(d.Yp-b)/d.duration,f=Math.min(f,1);d.callback(d.from+f*(d.to-d.from));1==f&&(l.splice(a,1),a--)}};a.get_timeline=function(){return b};a.set_timeout=function(a,d){var h;f++;h=f;q.push({id:h,callback:a,Yp:b+(performance.now()-c+d)/1E3});
return h};a.clear_timeout=function(a){for(var b=0;b<q.length;b++)if(q[b].id==a){q.splice(b,1);break}};a.clear_animation=function(a){for(var b=l.length;b--;)if(l[b].id==a){l.splice(b,1);break}};a.animate=function(a,c,d,f){d/=1E3;var n;t++;n=t;l.push({id:n,callback:f,from:a,to:c,Yp:b+d,duration:d});f(a);return n};a.reset=function(){c=b=0;q.length=0;t=f=l.length=0};a.Wb=function(){return-1!==d.Vg.Sm?d.Vg.Sm:n};a.UF=function(a){n=a}};b4w.module.__transform=function(a,p){function d(a,b){g.Rd(a)?w.set_trans(b,g.Qd(a)):w.set_trans(b,a.f.h)}function b(a,b){var c=a.f;if(g.Rd(a)){w.set_quat(b,c.h);var d=g.Tm(a),d=w.invert(d,e);w.multiply(d,c.h,g.Qd(a))}else w.set_quat(b,c.h)}function c(a,b){g.Rd(a)?w.set_quat(b,g.Qd(a)):w.set_quat(b,a.f.h)}function q(a,b){g.Rd(a)?w.copy(b,g.Qd(a)):w.copy(b,a.f.h)}function f(a,b){g.Rd(a)?w.copy(g.Qd(a),b):w.copy(a.f.h,b);return b}function t(a){var b=a.f,c=a.J,d=a.type;"CAMERA"==d&&n.xs(a);g.oH(a,J);
"CAMERA"==d&&n.kH(a);var f=w.Ri(b.h,A),m=w.Ou(b.h,r);b.Zb&&b.Ab&&(l.fp(b.Zb,b.h,b.Ab),l.hp(b.fd,b.h,b.Ub),l.gp(b.Ze,b.h,b.Nf));switch(d){case "SPEAKER":u.zG(a,J);break;case "MESH":var q=a.im;q&&(w.invert(q.f.h,e),w.multiply(e,b.h,e),x.set(e[0],e[1],e[2],e[3],b.So),h.set(e[4],e[5],e[6],e[7],b.Ro));break;case "CAMERA":n.lH(a);if(k.ma()){var p=k.get_active();k.Ni(p)==a&&u.vE(p,f,m,J)}break;case "LAMP":z.sH(a)}for(p=0;p<c.length;p++){var v=c[p];if(v.fn){var q=v.Ea,V=q.k;switch(d){case "LAMP":k.mo(a,q);
break;case "CAMERA":k.OF(q);V.hc&&(V.hc.enable_csm&&k.Hr(q),k.AH(a,V.ib));break;case "MESH":b.Zb&&b.Ab&&(b.Uc&&k.Hr(q),V=v.Sf,null!=b.Kd&&V&&k.Cx(V,f));break;case "EMPTY":C.Dx(a)}v=v.Je;V=a.ql;if(V.length)for(var T=0;T<v.length;T++){var U=v[T].j;k.Fx(v[T],f,m);E.Gx(V,U.cc);n.hG(U,k.Ni(q));G.Om(U.re,U.Ok)}}}c=a.be;for(p=0;p<c.length;p++)t(c[p]);a=a.yp;for(p=0;p<a.length;p++)c=a[p],q=c[0],g.hH(q,c[1]);b.eq=!0}var l=p("__boundings"),n=p("__camera"),g=p("__constraints"),z=p("__lights");p("__mat3");p("__mat4");
p("__particles");var h=p("__quat"),k=p("__scenes"),u=p("__sfx"),w=p("__tsr"),C=p("__objects"),E=p("__obj_util"),G=p("__util"),m=p("__vec3"),x=p("__vec4"),A=new Float32Array(3),r=new Float32Array(4);new Float32Array(9);var e=w.create(),v=w.create(),J=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){J=a};a.set_translation=function(a,b){var c=a.f;if(g.Rd(a)){w.set_trans(b,c.h);var d=g.Tm(a),d=w.invert(d,e);w.multiply(d,c.h,g.Qd(a))}else w.set_trans(b,c.h)};a.set_translation_rel=d;a.get_translation=
function(a,b){var c=w.get_trans_view(a.f.h);m.copy(c,b);return b};a.get_translation_rel=function(a,b){if(g.Rd(a))m.copy(w.get_trans_view(g.Qd(a)),b);else{var c=w.get_trans_view(a.f.h);m.copy(c,b)}return b};a.set_rotation=b;a.set_rotation_rel=c;a.get_rotation=function(a,b){var c=w.get_quat_view(a.f.h);h.copy(c,b);return b};a.get_rotation_rel=function(a,b){if(g.Rd(a))h.copy(w.get_quat_view(g.Qd(a)),b);else{var c=w.get_quat_view(a.f.h);h.copy(c,b)}return b};a.set_rotation_euler=function(a,c){var d=G.euler_to_quat(c,
r);b(a,d)};a.set_rotation_euler_rel=function(a,b){var d=G.euler_to_quat(b,r);c(a,d)};a.set_scale=function(a,b){var c=a.f;if(g.Rd(a)){var c=g.Qd(a),d=w.get_scale(g.Tm(a));w.set_scale(b/d,c)}else w.set_scale(b,c.h)};a.set_scale_rel=function(a,b){var c=a.f;g.Rd(a)?w.set_scale(b,g.Qd(a)):w.set_scale(b,c.h)};a.get_scale=function(a){return w.get_scale(a.f.h)};a.get_scale_rel=function(a){return g.Rd(a)?w.get_scale(g.Qd(a)):w.get_scale(a.f.h)};a.set_tsr=function(a,b){w.copy(b,a.f.h);if(g.Rd(a)){var c=g.Tm(a),
c=w.invert(c,e);w.multiply(c,a.f.h,g.Qd(a))}};a.set_tsr_rel=q;a.get_tsr=function(a,b){return w.copy(a.f.h,b)};a.get_tsr_rel=f;a.get_object_size=function(a){var b=a.f;a=b.ti;var c=w.get_scale(b.h),b=c*(a.max_x-a.min_x),d=c*(a.max_y-a.min_y);a=c*(a.max_z-a.min_z);return.5*Math.sqrt(b*b+d*d+a*a)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(a=a.f,m.copy(a.Ub.I,c)):(a=a.f,b=a.ti,c[0]=(b.max_x+b.min_x)/2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,w.transform_vec3(c,a.h,c));
return c};a.move_local=function(a,b,c,h){var g=f(a,e),k=A;k[0]=b;k[1]=c;k[2]=h;w.transform_vec3(k,g,k);d(a,k)};a.Dr=function(a,b){var c=f(a,e),d=w.set_quat(b,w.identity(v));w.multiply(c,d,d);q(a,d)};a.n=t;a.distance=function(a,b){var c=w.get_trans_view(a.f.h),d=w.get_trans_view(b.f.h);return m.dist(c,d)};a.kj=function(a,b){var c=w.get_trans_view(a.f.h);return m.dist(c,b)};a.get_object_bounding_box=function(a){return{max_x:a.f.Ab.max_x,min_x:a.f.Ab.min_x,max_y:a.f.Ab.max_y,min_y:a.f.Ab.min_y,max_z:a.f.Ab.max_z,
min_z:a.f.Ab.min_z}}};b4w.module.__tsr=function(a,p){function d(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a}function b(){var a=new Float32Array(9);a[3]=1;a[7]=1;return a}function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3];return d}function q(a,b,c){var d=b[0],f=b[1],h=b[2],g=b[3],l=b[4],n=b[5],q=b[6];b=b[7];var e=a[0]*g,t=a[1]*g,p=a[2]*g;a=b*e+n*p-q*t;var g=b*t+q*e-l*p,z=b*p+l*t-n*e,e=-l*e-n*t-q*p;c[0]=a*b+e*-l+g*-q-z*-n;c[1]=g*b+e*-n+z*-l-a*-q;c[2]=z*b+e*-q+a*-n-g*-l;
c[0]+=d;c[1]+=f;c[2]+=h;return c}p("__mat3");var f=p("__mat4"),t=p("__quat"),l=p("__util"),n=p("__vec3"),g=new Float32Array(3),z=new Float32Array(4),h=new Float32Array(16);a.create=d;a.from_values=function(a,b,c,f,h,g,m,l){var n=d();n[0]=a;n[1]=b;n[2]=c;n[3]=f;n[4]=h;n[5]=g;n[6]=m;n[7]=l;return n};a.Bp=b;a.NJ=function(a,c,d,f,h,g,m,l){var n=b();n[0]=a;n[1]=c;n[2]=d;n[3]=f;n[4]=h;n[5]=g;n[6]=m;n[7]=l;return n};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];
b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.set_sep=c;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.Ri=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.get_scale=
function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4,8)};a.Ou=function(a,b){b[0]=a[4];b[1]=a[5];b[2]=a[6];b[3]=a[7];return b};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],f=a[1],h=a[2];z[0]=a[4];z[1]=a[5];z[2]=a[6];z[3]=a[7];t.invert(z,z);var g=z[0],l=z[1],n=z[2],q=z[3],d=d*c,f=f*c,e=h*c,h=q*d+l*e-n*f,p=q*f+n*d-g*e,J=q*e+g*f-l*d,d=-g*d-l*f-n*e;b[0]=-(h*q+d*-g+p*-n-J*-l);b[1]=-(p*q+d*-l+J*-g-h*-n);b[2]=-(J*q+d*-n+h*-l-p*-g);b[3]=c;b[4]=g;b[5]=l;b[6]=n;b[7]=q;
return b};a.to_mat4=function(a,b){var c=a[3];f.fromRotationTranslation(a.subarray(4,8),a.subarray(0,3),b);for(var d=0;12>d;d++)b[d]*=c;return b};a.from_mat4=function(a,b){var d=l.Fv(a,g),f=l.Ev(a),h=l.matrix_to_quat(a,z);c(d,f,h,b);return b};a.multiply=function(a,b,c){q(b,a,c);c[3]=a[3]*b[3];var d=a[4],f=a[5],h=a[6];a=a[7];var g=b[4],l=b[5],n=b[6];b=b[7];c[4]=d*b+a*g+f*n-h*l;c[5]=f*b+a*l+h*g-d*n;c[6]=h*b+a*n+d*l-f*g;c[7]=a*b-d*g-f*l-h*n;return c};a.WG=function(a,b,c){var d=b[3];b=f.fromRotationTranslation(b.subarray(4,
8),b.subarray(0,3),h);for(var g=0;12>g;g++)b[g]*=d;f.multiply(b,a,c);return c};a.transform_vec3=q;a.transform_vec3_inv=function(a,b,c){var d=b[3],f=a[0]-b[0],h=a[1]-b[1],g=a[2]-b[2];a=b[4];var l=b[5],n=b[6];b=b[7];var q=a*a+l*l+n*n+b*b,q=q?1/q:0;a=-a*q;l=-l*q;n=-n*q;b*=q;var q=b*f+l*g-n*h,e=b*h+n*f-a*g,t=b*g+a*h-l*f,f=-a*f-l*h-n*g;c[0]=q*b+f*-a+e*-n-t*-l;c[1]=e*b+f*-l+t*-a-q*-n;c[2]=t*b+f*-n+q*-l-e*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var f=a.length,
h=b[0],g=b[1],l=b[2],n=b[3],q=b[4],e=b[5],t=b[6];b=b[7];for(var p=0;p<f;p+=3){var z=a[p]*n,H=a[p+1]*n,I=a[p+2]*n,P=b*z+e*I-t*H,K=b*H+t*z-q*I,y=b*I+q*H-e*z,z=-q*z-e*H-t*I;c[d+p]=P*b+z*-q+K*-t-y*-e;c[d+p+1]=K*b+z*-e+y*-q-P*-t;c[d+p+2]=y*b+z*-t+P*-e-K*-q;c[d+p]+=h;c[d+p+1]+=g;c[d+p+2]+=l}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var f=a.length,h=b[3],g=b[4],l=b[5],n=b[6];b=b[7];for(var q=0;q<f;q+=3){var e=a[q]*h,t=a[q+1]*h,p=a[q+2]*h,z=b*e+l*p-n*t,H=b*t+n*e-g*p,I=b*p+g*t-l*e,e=-g*
e-l*t-n*p;c[d+q]=z*b+e*-g+H*-n-I*-l;c[d+q+1]=H*b+e*-l+I*-g-z*-n;c[d+q+2]=I*b+e*-n+z*-l-H*-g}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],f=b[4],h=b[5],g=b[6];b=b[7];var l=a[0]*d,n=a[1]*d,q=a[2]*d;a=b*l+h*q-g*n;var d=b*n+g*l-f*q,e=b*q+f*n-h*l,l=-f*l-h*n-g*q;c[0]=a*b+l*-f+d*-g-e*-h;c[1]=d*b+l*-h+e*-f-a*-g;c[2]=e*b+l*-g+a*-h-d*-f;return c};a.transform_tangents=function(a,b,c,d){d||(d=0);var f=a.length,h=b[3],g=b[4],l=b[5],n=b[6];b=b[7];for(var q=0;q<f;q+=4){var e=a[q]*h,t=a[q+1]*h,p=a[q+
2]*h,z=b*e+l*p-n*t,H=b*t+n*e-g*p,I=b*p+g*t-l*e,e=-g*e-l*t-n*p;c[d+q]=z*b+e*-g+H*-n-I*-l;c[d+q+1]=H*b+e*-l+I*-g-z*-n;c[d+q+2]=I*b+e*-n+z*-l-H*-g;c[d+q+3]=a[q+3]}return c};a.translate=function(a,b,c){var d=a[3],f=a[4],h=a[5],g=a[6],l=a[7],n=b[0]*d,q=b[1]*d,e=b[2]*d;b=l*n+h*e-g*q;var d=l*q+g*n-f*e,t=l*e+f*q-h*n,n=-f*n-h*q-g*e;c[0]=a[0]+b*l+n*-f+d*-g-t*-h;c[1]=a[1]+d*l+n*-h+t*-f-b*-g;c[2]=a[2]+t*l+n*-g+b*-h-d*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,
d){n.lerp(a.subarray(0,3),b.subarray(0,3),c,d.subarray(0,3));var f=a[3];d[3]=f+c*(b[3]-f);t.slerp(a.subarray(4,8),b.subarray(4,8),c,d.subarray(4,8));return d};a.FJ=function(a,b,c,d){var f=a.subarray(0,3),h=b.subarray(0,3),g=d.subarray(0,3);g[0]=h[0]*(c+1)-f[0]*c;g[1]=h[1]*(c+1)-f[1]*c;g[2]=h[2]*(c+1)-f[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4,8);b=b.subarray(4,8);f=d.subarray(4,8);f[0]=b[0]*(c+1)-a[0]*c;f[1]=b[1]*(c+1)-a[1]*c;f[2]=b[2]*(c+1)-a[2]*c;f[3]=b[3]*(c+1)-a[3]*c;t.normalize(f,f);return d};
a.RD=function(a,b,c,d,f){f[0]=a[0]+b*c[0];f[1]=a[1]+b*c[1];f[2]=a[2]+b*c[2];f[3]=a[3];c=d[0];var h=d[1];d=d[2];var g=a[4],l=a[5],n=a[6],q=a[7];f[4]=.5*(c*q+h*n-d*l);f[5]=.5*(h*q+d*g-c*n);f[6]=.5*(d*q+c*l-h*g);f[7]=.5*(-c*g-h*l-d*n);f[4]=a[4]+f[4]*b;f[5]=a[5]+f[5]*b;f[6]=a[6]+f[6]*b;f[7]=a[7]+f[7]*b;a=f[4];b=f[5];c=f[6];h=f[7];a=a*a+b*b+c*c+h*h;0<a&&(a=1/Math.sqrt(a),f[4]*=a,f[5]*=a,f[6]*=a,f[7]*=a)}};b4w.module.__util=function(a,p){function d(a){return 0<a?1:0>a?-1:0}function b(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function c(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function q(a,b){var c=b;switch(typeof a){case "number":return f(a,c);case "string":return t(a,c);case "boolean":return f(a|0,c);case "function":case "undefined":return f(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==
a.byteLength)for(d=0;d<a.length;d++)c=f(a[d],c);else if(d)for(d=0;d<a.length;d++)c=q(a[d],c);else for(var e in a)c=q(a[e],c)}else c=f(0,c)}return c}function f(a,b){var c=b;O[0]=a;c=(c<<5)-c+V[0];c&=c;c=(c<<5)-c+V[1];return c&c}function t(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),c&=c;return c}function l(a){return(34*a+1)*a%289}function n(a){return a-Math.floor(a)}function g(a){return z((34*a+5)*a)}function z(a){return a-289*Math.floor(a/289)}function h(a){return a-7*Math.floor(a/
7)}function k(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function u(a){return k(a,0,2*Math.PI)}function w(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!C(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!C(a[f],
b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function C(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return w(a,b);default:return!0}}function E(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=
c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var G=p("__mat3"),m=p("__mat4"),x=p("__print"),A=p("__tsr"),r=p("__quat"),e=p("__vec3"),v=p("__vec4"),J=0,D={},H=new Float32Array(3),I=new Float32Array(3),P=new Float32Array(4),K=new Float32Array(4),y=new Float32Array(9),F=new Float32Array(16),M=new Float32Array(16),O=new Float64Array(1),V=new Uint32Array(O.buffer),T=new Float32Array([0,0,0]),U=new Float32Array([0,0,0,1]),B=new Float32Array([0,0,0,1,0,0,0,1]),ha=new Float32Array([1,1,1]),ba=new Float32Array([1,
0,0]),da=new Float32Array([0,1,0]),W=new Float32Array([0,0,1]),R=new Float32Array([-1,0,0]),Y=new Float32Array([0,-1,0]),ka=new Float32Array([0,0,-1]),ea=Math.floor(44488.07041494893),ma=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,
0,0,1])];a.Ws=T;a.Vs=U;a.LI=B;a.Xs=ha;a.AXIS_X=ba;a.AXIS_Y=da;a.AXIS_Z=W;a.AXIS_MX=R;a.AXIS_MY=Y;a.AXIS_MZ=ka;a.oy=ma;a.pd=function(a){return"undefined"!=typeof a};a.keyfind=function(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var h=c[f];h[a]==b&&d.push(h)}return d};a.CC=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.YG=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.TA=function(){var a=new Uint16Array([255]);
return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.jA=function(a,b){var c=[],d={},e=b.length,f,h;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)h=a[f],h in d&&c.push(h);return c};a.sign=d;a.yK=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.xK=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var h=e[f];if(h[a]==b&&h[c]==d)return h}return null};a.sD=function(a,
b){for(var c=0;c<a.length;c++)if(a[c].uuid==b)return c;return-1};a.dA=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.mJ=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.TG=function(a,b,c,d){d||(d=new Float32Array(16));m.identity(d);d[12]=a;d[13]=b;d[14]=c};var la=1;a.uF=function(){la=(69069*la+5)%Math.pow(2,32);return Math.round(la/65536)%32768/32767};a.FG=function(a){la=a};a.Vd=function(a){var b=a[0]%ea*48271-3399*
Math.floor(a[0]/ea);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.dn=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),h=Math.sin(a[2]/2),g=Math.sin(a[0]/2);b[0]=f*h*e+c*d*g;b[1]=f*d*e+c*h*g;b[2]=c*h*e-f*d*g;b[3]=c*d*e-f*h*g;return b};a.pC=function(a){var b=G.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),h=Math.sin(a[1]);
a=Math.sin(a[2]);var g=c*e,k=c*a,m=f*e,l=f*a;b[0]=d*e;b[1]=d*a;b[2]=-h;b[3]=h*m-k;b[4]=h*l+g;b[5]=d*f;b[6]=h*g+l;b[7]=h*k-m;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],h=e*e,g=c*d+e*f;.499999<g?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>g?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*h),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*h),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));
e.transformQuat(b,a,c);return c};a.AJ=function(a,b,c){c||(c=new Float32Array(4));a=e.normalize(a,H);var d=e.dot(b,a);a=e.cross(b,a,I);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.UG=function(a,b,c,d){d||(d=new Float32Array(4));e.transformQuat(c,b,d);d[3]=-e.dot(a,d)};a.eC=function(a){var b=A.get_quat_view(a.f.h);switch(a.type){case "CAMERA":H[0]=0;H[1]=-1;H[2]=0;e.transformQuat(H,b,H);I[0]=0;I[1]=0;I[2]=-1;break;case "MESH":H[0]=
0;H[1]=0;H[2]=1;e.transformQuat(H,b,H);I[0]=0;I[1]=0;I[2]=1;break;case "EMPTY":H[0]=0,H[1]=1,H[2]=0,e.transformQuat(H,b,H),I[0]=0,I[1]=1,I[2]=0}H[1]=0;e.normalize(H,H);a=e.dot(H,I);return Math.acos(a)*(0<-H[0]*I[2]?-1:1)};a.tt=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.fL=function(){J++;return J.toString(16)};a.Oj=function(a){D[a]||(D[a]=0);var b=a+D[a];D[a]++;return b};a.ce=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),
a_normal:new Float32Array(0)}};a.Vb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,ea:0,Ca:null,B:[],X:b,na:[]}};a.ah=function(a){return JSON.parse(JSON.stringify(a))};a.xa=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.xa(b[d]);break;default:for(d in c=new c,
b)c[d]=a.xa(b[d])}return c};a.mk=function(a){var b=a instanceof Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));G.fromMat4(a,y);var c=y[0],d=y[3],e=y[6],f=y[1],h=y[4],g=y[7],k=y[2],m=y[5],l=y[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+h*h+g*g)||1,k=
Math.sqrt(k*k+m*m+l*l)||1;y[0]/=c;y[3]/=c;y[6]/=c;y[1]/=f;y[4]/=f;y[7]/=f;y[2]/=k;y[5]/=k;y[8]/=k;r.fromMat3(y,b);r.normalize(b,b);return b};a.Fv=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.Ev=function(a){P[0]=.577350269189626;P[1]=.577350269189626;P[2]=.577350269189626;P[3]=0;v.transformMat4(P,a,P);return v.length(P)};a.Om=function(a,c){var d=c.left,e=c.right,f=c.top,h=c.bottom,g=c.Ra,k=c.Cb;d[0]=a[3]+a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];d[3]=a[15]+a[12];
e[0]=a[3]-a[0];e[1]=a[7]-a[4];e[2]=a[11]-a[8];e[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];h[0]=a[3]+a[1];h[1]=a[7]+a[5];h[2]=a[11]+a[9];h[3]=a[15]+a[13];g[0]=a[3]+a[2];g[1]=a[7]+a[6];g[2]=a[11]+a[10];g[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];b(d);b(e);b(f);b(h);b(g);b(k)};a.AG=function(a,b,d){return d<-c(a,b.left)||d<-c(a,b.right)||d<-c(a,b.top)||d<-c(a,b.bottom)||d<-c(a,b.Ra)||d<-c(a,b.Cb)?!0:!1};a.mC=function(a,b,d,f,h){g=
e.dot(d,b.Cb);k=e.dot(f,b.Cb);m=e.dot(h,b.Cb);g=Math.sqrt(g*g+k*k+m*m);if(g<-c(a,b.Ra)||g<-c(a,b.Cb))return!0;var g=e.dot(d,b.left),k=e.dot(f,b.left),m=e.dot(h,b.left);if(Math.sqrt(g*g+k*k+m*m)<-c(a,b.left))return!0;g=e.dot(d,b.right);k=e.dot(f,b.right);m=e.dot(h,b.right);if(Math.sqrt(g*g+k*k+m*m)<-c(a,b.right))return!0;g=e.dot(d,b.top);k=e.dot(f,b.top);m=e.dot(h,b.top);if(Math.sqrt(g*g+k*k+m*m)<-c(a,b.top))return!0;g=e.dot(d,b.bottom);k=e.dot(f,b.bottom);m=e.dot(h,b.bottom);return Math.sqrt(g*g+
k*k+m*m)<-c(a,b.bottom)?!0:!1};a.sj=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var h=a[f],g=a[f+1],k=a[f+2];c[d+f]=b[0]*h+b[4]*g+b[8]*k+b[12];c[d+f+1]=b[1]*h+b[5]*g+b[9]*k+b[13];c[d+f+2]=b[2]*h+b[6]*g+b[10]*k+b[14]}};a.ZH=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var h=a[f],g=a[f+1],k=a[f+2];c[d+f]=b[0]*h+b[4]*g+b[8]*k;c[d+f+1]=b[1]*h+b[5]*g+b[9]*k;c[d+f+2]=b[2]*h+b[6]*g+b[10]*k}};a.QG=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var h=a[f],g=a[f+1],k=a[f+
2];c[d+f]=b[0]*h+b[4]*g+b[8]*k;c[d+f+1]=b[1]*h+b[5]*g+b[9]*k;c[d+f+2]=b[2]*h+b[6]*g+b[10]*k;c[d+f+3]=a[f+3]}};a.XH=function(a,b,c){c||(c=new Float32Array(3));P[0]=a[0];P[1]=a[1];P[2]=a[2];P[3]=0;v.transformMat4(P,b,P);c[0]=P[0];c[1]=P[1];c[2]=P[2]};a.IJ=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.YH=function(a){for(var b=
[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.om=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.om(b,c,d,f-1):b[f]<c?a.om(b,c,f+1,e):f};a.Rf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.nJ=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.OK=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=
a[15];return c};a.WG=function(a,b,c,d,e){e||(e=new Float32Array(16));b=m.fromRotationTranslation(c,d,F);m.multiply(b,a,e);return e};a.transform_vec3=function(a,b,c,d,f){f||(f=new Float32Array(3));c=m.fromRotationTranslation(c,d,F);1!==b&&(d=m.identity(M),b=e.set(b,b,b,H),m.scale(d,b,d),m.multiply(c,d,c));e.transformMat4(a,c,f);return f};a.dL=function(a,b,c,d,e){e||(e=new Float32Array(4));b=m.fromRotationTranslation(c,d,F);v.transformMat4(a,b,e);return e};a.qK=function(a,b,c,d,f){f||(f=new Float32Array(3));
b=m.fromRotationTranslation(c,d,F);m.invert(b,b);e.transformMat4(a,b,f);return f};a.cL=function(a,b,c){c||(c=new Float32Array(16));m.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.FK=function(b,c,d){a.Fv(b,c);c[3]=a.Ev(b);a.matrix_to_quat(b,d)};a.TI=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.IF=function(a,b,c,d){d||(d=new Float32Array(3));e.subtract(b,a,H);e.transformQuat(H,c,H);e.subtract(b,H,d)};a.PC=function(){H[0]=0;H[1]=0;
H[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);m.lookAt(H,[-1,0,0],[0,-1,0],a);m.scale(a,[-1,1,1],a);m.scale(a,[-1,1,-1],b);m.lookAt(H,[0,-1,0],[0,0,-1],c);m.scale(c,[1,1,-1],c);m.scale(c,[1,-1,-1],d);m.lookAt(H,[0,0,-1],[0,-1,0],e);m.scale(e,[-1,1,1],e);m.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.TC=function(){H[0]=0;H[1]=0;H[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),
d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);m.lookAt(H,[1,0,0],[0,-1,0],a);m.scale(a,[-1,1,-1],b);m.lookAt(H,[0,1,0],[0,0,1],c);m.scale(c,[1,-1,-1],d);m.lookAt(H,[0,0,1],[0,-1,0],e);m.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.At=function(a,b){return q(a,b)};a.hash_code=q;a.iK=t;a.IE=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=
function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.xd=function(a){return a*Math.PI/180};a.aC=function(a){return 180*a/Math.PI};a.Wr=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=
b>a?1:0,h=1-f,e=b+.211324865405187-f,g=a+.211324865405187-h,k=b+-.577350269189626,m=a+-.577350269189626,c=c%289,d=d%289,q=l(l(d)+c),h=l(l(d+h)+c+f),r=l(l(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+g*g),0),f=Math.max(.5-(k*k+m*m),0),t=2*n(.024390243902439*q)-1,p=2*n(.024390243902439*h)-1,u=2*n(.024390243902439*r)-1,q=Math.abs(t)-.5,h=Math.abs(p)-.5,r=Math.abs(u)-.5,t=t-Math.floor(t+.5),p=p-Math.floor(p+.5),u=u-Math.floor(u+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(t*t+q*q)),d=d*
d*d*d*(1.79284291400159-.85373472095314*(p*p+h*h)),f=f*f*f*f*(1.79284291400159-.85373472095314*(u*u+r*r));return 130*(c*(t*b+q*a)+d*(p*e+h*g)+f*(u*k+r*m))};a.Et=function(a){var b=1/7,c=b/2,d=z(Math.floor(a[0])),e=z(Math.floor(a[1])),f=n(a[0]);a=n(a[1]);var k=f-.5,m=f-1.5,f=a-.5;a-=1.5;var l=g(d),q=g(d+1),r=l,d=q,l=g(l+e),q=g(q+e),r=g(r+e+1),d=g(d+e+1),e=k+.7*(h(l)*b+c),t=m+.7*(h(q)*b+c),k=k+.7*(h(r)*b+c),m=m+.7*(h(d)*b+c),l=f+.7*(h(Math.floor(l*b))*b+c),f=f+.7*(h(Math.floor(q*b))*b+c),r=a+.7*(h(Math.floor(r*
b))*b+c),b=a+.7*(h(Math.floor(d*b))*b+c);return Math.min(e*e+l*l,t*t+f*f,k*k+r*r,m*m+b*b)};a.quat_project=function(a,b,c,d,f){f||(f=new Float32Array(4));a=e.transformQuat(b,a,H);b=c[0];var h=c[1];c=c[2];y[0]=h*h+c*c;y[1]=-h*b;y[2]=-c*b;y[3]=-b*h;y[4]=b*b+c*c;y[5]=-c*h;y[6]=-b*c;y[7]=-h*c;y[8]=b*b+h*h;e.transformMat3(a,y,a);e.normalize(a,a);r.rotationTo(d,a,f);return f};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=P,d=K,c=r.setAxisAngle([0,1,0],Math.PI,r.create()),d=r.setAxisAngle([1,
0,0],Math.PI/2,r.create());r.multiply(c,d,c);r.multiply(a,c,b);return b};a.cleanup=function(){J=0;D={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.Yw=function(a,b,c,d,e){e||(e=new Float32Array(a.length));r.slerp(a,b,Math.exp(-c/d),e)};a.rK=function(a){return"object"===typeof a&&a.buffer&&
a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=G.fromQuat(a,y);I[0]=0;I[1]=1;I[2]=0;H[0]=c[3];H[1]=c[4];H[2]=c[5];var d=e.cross(I,H,H);e.normalize(d,d);var f=c[7];!b&&0<f&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);I[0]=c[0];I[1]=c[1];I[2]=c[2];e.normalize(I,I);r.rotationTo(I,d,K);r.multiply(K,a,a)};a.Fu=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-
Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),h=b-1,g=a[e*b+c],k=a[e*b+Math.min(c+1,h)],m=a[Math.min(e+1,h)*b+c];a=a[Math.min(e+1,h)*b+Math.min(c+1,h)];return(g*(1-d)+k*d)*(1-f)+(m*(1-d)+a*d)*f};a.Th=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.Ew=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.rl=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.iq=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Sk=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];e.normalize(c,c)};a.VG=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],h=b[1],g=b[2];b=b[3];var k=h*a-g*e,m=g*d-f*a,l=f*e-h*d,n=h*l-g*m,g=g*k-
f*l,f=f*m-h*k;c[0]=d+2*k*b+2*n;c[1]=e+2*m*b+2*g;c[2]=a+2*l*b+2*f};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.W=function(a){a&&x.error.apply(x,arguments);throw"engine panic:\nThe engine tried to perform an invalid operation and halted.\nPlease copy the console contents above and submit it to the Blend4Web forum at\nhttps://www.blend4web.com/en/forums/forum/17/";};a.angle_wrap_periodic=k;a.angle_wrap_0_2pi=u;a.oq=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.jx=function(a,b){for(var c in a){var d=
!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=w(e,f)}if(!d)return!1}return!0};a.sr=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.zu=function(a){a+=1;132651<a&&x.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){P.set(a);P[3]=b;K.set(d);K[3]=0;a=v.dot(P,K);if(0==a)return null;K.set(c);K[3]=
1;a=-v.dot(P,K)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.wD=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],h=b[1]-a[1],g=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=h*a-b*g;d[1]=f*b-e*a;d[2]=e*g-h*f;return d};a.pJ=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.Gw=function(a,b,c){var d=e.dot(a,b);-.9999999>d?(e.cross(ba,a,H),1E-6>e.length(H)&&e.cross(da,a,H),e.normalize(H,H),r.setAxisAngle(H,Math.PI,c)):(e.cross(a,b,H),c.set(H),c[3]=1+d,r.normalize(c,c));return c};
a.Pf=function(a,b,c){if(b==c)return c-a;a=u(a);b=u(b);c=u(c);b=2*Math.PI-b;c=u(c+b);a=u(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));return a*a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.kA=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.vJ=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.Rx=function(a,b){for(var c=Math.max(a.length,b.length),e=
0;e<c;e++){var f=d((e>=a.length?0:a[e])-(e>=b.length?0:b[e]));if(f)return f}return 0};a.Gg=function(a){return a.join(".")};a.hx=function(a){return a.split(".").map(function(a){return a|0})};a.dx=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2)};a.Sq=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.bl=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=E(b[1]),b.join("://")):E(a)};a.kk=function(a){return 0!=
parseInt(a.toString(2).substr(1),2)}};b4w.module.__sfx=function(a,p){function d(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;E.warn("deprecated WebAudio implementation");return null}E.warn("WebAudio is not supported");return null}function b(a,b,d){var e=a.F;if("NONE"!=e.behavior){var h=e.loop,g=e.pitch;if(e.src&&(h||0<=d)){e.Wo=Math.floor(5E4*Math.random());var k=P.currentTime+b,k=Math.max(0,k);e.Bd=k;e.state=20;c(a);"POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior?(b=P.createBufferSource(),
b.buffer=e.src,b.playbackRate.value=g,x.pd(b.onended)&&(b.onended=function(){e.state=50}),h?(e.Rb&&e.Rb.disconnect(),b.loop=!0,b.start(k),e.duration=0):(h=b.buffer?b.buffer.duration:0,d>h?(h=k+d+e.md,b.loop=!0,b.start(k),b.stop(h),e.duration=d):(b.loop=!1,b.start(k),e.duration=h)),b.connect(e.Pc),e.Rb=b,f(e),t(e)):"BACKGROUND_MUSIC"==e.behavior&&(G.clear_timeout(e.$o),G.clear_timeout(e.ap),d=function(){var b=a.F,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.Rb=b.Rb||P.createMediaElementSource(c),b.Rb.connect(b.Pc),
20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==b?d():e.$o=G.set_timeout(d,1E3*b),e.duration=h?0:w(a));l(e,k)}}}function c(a){var b=a.F;if(!b.Pc){var c=m.get_trans_view(a.f.h);a=m.get_quat_view(a.f.h);if(e.vn){var d=P.createBiquadFilter();d.type="peaking"}else d=null;var f=P.createGain();switch(b.behavior){case "POSITIONAL":var h=P.createPanner();"string"!=typeof h.panningModel?(h.panningModel=h.EQUALPOWER,h.distanceModel=h.INVERSE_DISTANCE):(h.panningModel="equalpower",h.distanceModel=
"inverse");h.setPosition(c[0],c[1],c[2]);A.copy(c,b.Nq);c=v;x.quat_to_dir(a,x.AXIS_MY,c);h.setOrientation(c[0],c[1],c[2]);A.copy(c,b.direction);h.refDistance=b.dist_ref;h.maxDistance=b.dist_max;h.rolloffFactor=b.attenuation;h.coneInnerAngle=b.Rt;h.coneOuterAngle=b.St;h.coneOuterGain=b.Tt;var g=P.createGain();g.gain.value=u(b);d?(h.connect(d),d.connect(g)):h.connect(g);g.connect(f);b.Pc=h;if(b.ji){var k=P.createGain();f.connect(k);k.connect(P?K.wa.Pc:null)}else k=null,f.connect(P?K.wa.Pc:null);break;
case "BACKGROUND_SOUND":h=null;g=P.createGain();g.gain.value=u(b);d?(b.Pc=d,d.connect(g)):b.Pc=g;g.connect(f);b.ji?(k=P.createGain(),f.connect(k),k.connect(P?K.wa.Pc:null)):(k=null,f.connect(P?K.wa.Pc:null));break;case "BACKGROUND_MUSIC":k=h=null,g=P.createGain(),g.gain.value=u(b),d?(b.Pc=d,d.connect(g)):b.Pc=g,g.connect(f),f.connect(P?K.wa.Pc:null)}b.gl=h;b.Ee=d;b.Li=g;b.kh=f;b.tw=k}}function q(a){var c=a.F,d=c.duration,c=c.delay+c.hu*Math.random();b(a,c,d)}function f(a){a.ji&&a.tw.gain.cancelScheduledValues(a.Bd);
a.qj&&a.Rb.playbackRate.cancelScheduledValues(a.Bd);a.Pl=a.Bd}function t(a){if(a.ji||a.qj){var b=a.tw,c=a.Rb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Bd;F[0]=a.Wo;for(var f=0;5>f;){var h=a.pitch+a.qj*x.Vd(F);if(e>=a.Pl){if(a.ji){var g=1-x.clamp(a.ji,0,1)*Math.random();b.gain.setValueAtTime(g,e)}a.qj&&c.playbackRate.setValueAtTime(h,e);f++}e+=d/h}a.Pl=e-.001}}}function l(a,b){if(a.lh||a.md){var c=a.kh;c.gain.cancelScheduledValues(b);a.lh?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,
b+a.lh)):c.gain.setValueAtTime(1,b);a.md&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.md))}}function n(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.F;if(50==b.state)b.state=30;else if(20==b.state||40==b.state){var c=b.kh,d=P.currentTime;b.md&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.md));"BACKGROUND_MUSIC"==b.behavior?b.src&&(G.clear_timeout(b.$o),G.clear_timeout(b.ap),b.ap=G.set_timeout(function(){var b=
a.F.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.md)):(c=b.Rb,b.duration<c.buffer.duration?b.md&&20==b.state?c.stop(d+b.md):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.Bd=0,b.lr=0,b.ip=0);b.state=30}}function g(a){a=a.F;if(20==a.state){var b=P.currentTime;a.lr=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.Bd){F[0]=a.Wo;for(var d=a.Rb.buffer.duration,e=a.Bd;e<b;)c=a.pitch+a.qj*x.Vd(F),e+=d/c;c*=d/c-(e-b)}else c=0;a.ip=c;a.Rb.stop(0);a.Rb.disconnect();
f(a)}a.state=40}}function z(a){var b=a.F;if(40==b.state){var c=P.currentTime;b.Bd+=c-b.lr;"BACKGROUND_MUSIC"==b.behavior?b.src.play():(h(a),b.Pl=c,a=b.Rb,x.pd(a.onended)&&(a.onended=function(){b.state=50}),a.start(b.Bd,b.ip),t(b));l(b,b.Bd);b.state=20}}function h(a){a=a.F;var b=P.createBufferSource();b.loop=a.Rb.loop;b.buffer=a.Rb.buffer;b.playbackRate.value=a.Rb.playbackRate.value;a.gl?b.connect(a.gl):b.connect(a.Li);a.Rb=b}function k(a){a=a.F;return!a||20!=a.state&&40!=a.state&&30!=a.state&&50!=
a.state?!1:!0}function u(a){return a.muted?0:a.volume}function w(a){a=a.F;return(a=a.src)?a.duration:0}var C=p("__config"),E=p("__print"),G=p("__time"),m=p("__tsr"),x=p("__util"),A=p("__vec3"),r=C.p,e=C.F;a.Ms=10;a.Do=20;a.Ls=30;var v=new Float32Array(3),J=new Float32Array(3),D=new Float32Array(3),H=[],I=[],P=null,K=null,y=[],F=[1],M=null;a.FB=function(){return{fi:-1,kf:"",behavior:"NONE",hh:!1,muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,Rt:360,St:360,Tt:1,cyclic:!1,loop:!1,delay:0,
hu:0,ji:0,qj:0,lh:0,md:0,Bd:0,lr:0,ip:0,duration:0,Pl:0,Wo:1,src:null,state:10,Nq:new Float32Array(3),direction:new Float32Array(3),Zr:new Float32Array(3),$o:-1,ap:-1,jh:0}};a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(H.push("ogg"),H.push("ogv")),""!=a.canPlayType("audio/mpeg")&&H.push("mp3"),""!=a.canPlayType("audio/mp4")&&(H.push("mp4"),H.push("m4v")),""!=a.canPlayType("audio/webm")&&H.push("webm"));b.canPlayType&&
(""!=b.canPlayType("video/ogg")&&I.push("ogv"),""!=b.canPlayType("video/mp4")&&I.push("m4v"),""!=b.canPlayType("video/webm")&&I.push("webm"));(P=e.Hs?d():null)&&E.log("%cINIT WEBAUDIO: "+P.sampleRate+"Hz","color: #00a")};a.ot=function(a){var b={yh:new Float32Array(3),zv:new Float32Array(3),aj:new Float32Array(3)};a.wa=b;if(P){var c=P.createGain(),d=P.createGain();b.Li=c;b.kh=d;c.connect(d);d.connect(P.destination);if(a.b4w_enable_dynamic_compressor){var d=P.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;
d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.uk=d;b.Pc=d}else b.uk=null,b.Pc=c;c=P.listener;b.hh=r.Rp;b.hh||(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.jh=0}};a.RF=function(a){K=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<H.indexOf(a)?a:"ogg"==a&&-1<H.indexOf("mp4")?"mp4":"mp3"==a&&-1<H.indexOf("ogg")?"ogg":"mp4"==a&&-1<H.indexOf("ogg")?
"ogg":"ogv"==a&&-1<H.indexOf("m4v")?"m4v":"webm"==a&&-1<H.indexOf("m4v")?"m4v":"m4v"==a&&-1<H.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<I.indexOf(a)?a:"ogv"==a&&-1<I.indexOf("m4v")?"m4v":"webm"==a&&-1<I.indexOf("m4v")?"m4v":"m4v"==a&&-1<I.indexOf("webm")?"webm":""};a.bi=function(a,b){var c=a.data,d=b.F;d.fi=a.data.sound.uuid;d.kf=a.data.sound.filepath;switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":d.behavior=P?c.b4w_behavior:"NONE";break;
case "BACKGROUND_MUSIC":var e;P?(window.MediaElementAudioSourceNode?e=!0:(E.warn("MediaElementAudioSourceNode not found"),e=!1),e=e?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):e="NONE";d.behavior=e;break;default:throw"Wrong speaker behavior";}c.sound||(d.behavior="NONE");d.hh=c.b4w_disable_doppler||r.Rp;d.muted=c.muted;d.volume=c.volume;d.pitch=c.pitch;d.attenuation=c.attenuation;d.dist_ref=c.distance_reference;d.dist_max=c.distance_max||1E4;d.Rt=c.cone_angle_inner;d.St=c.cone_angle_outer;d.Tt=c.cone_volume_outer;
d.cyclic=c.b4w_cyclic_play;d.loop=c.b4w_loop;d.delay=c.b4w_delay;d.hu=c.b4w_delay_random;d.ji=c.b4w_volume_random;d.qj=c.b4w_pitch_random;d.lh=c.b4w_fade_in;d.md=c.b4w_fade_out;y.push(b)};a.$w=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.F.behavior){case "POSITIONAL":return a.Do;case "BACKGROUND_SOUND":return a.Do;case "BACKGROUND_MUSIC":return a.Ls;case "NONE":return a.Ms;default:throw"Wrong speaker behavior";}};a.CH=function(a,b){var c=a.F;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=
b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.gw=function(){var a=P.createBufferSource();a.buffer=P.createBuffer(1,22050,22050);a.connect(P.destination);a.start(0)};a.ZB=function(a,b,c){P?P.decodeAudioData(a,b,c):c()};a.xG=function(a){n(a);a.F=null;y.splice(y.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<y.length;a++){var b=y[a].F;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.Rb&&b.Rb.disconnect()}K&&K.wa&&(a=K.wa,a.yh[0]=0,a.yh[1]=0,a.yh[2]=0,a.aj[0]=0,a.aj[1]=
0,a.aj[2]=0);K=null;y.splice(0);M=null};a.update=function(a){if(P&&0!=y.length){for(var b=0;b<y.length;b++){var c=y[b],d=c.F,e=d.Rb,f=P.currentTime;!d.loop&&20==d.state&&d.duration&&d.Bd+d.duration<f&&("BACKGROUND_MUSIC"==d.behavior||e&&!x.pd(e.onended))&&(d.state=50);d.cyclic&&50==d.state&&q(c);20==d.state&&3>d.Pl-f&&t(d)}M&&M.Bf.length&&(-1==M.zb||a>M.ft+M.mu[M.zb])&&(b=M,-1<b.zb&&n(b.Bf[b.zb]),-1==b.zb&&b.random?c=Math.round(Math.random()*(b.Bf.length-1)):b.random?(c=1+Math.round(Math.random()*
(b.Bf.length-2)),c=(b.zb+c)%b.Bf.length):c=(b.zb+1)%b.Bf.length,q(b.Bf[c]),b.zb=c,b.ft=a)}};a.play=b;a.play_def=q;a.stop=n;a.is_playing=function(a){return 20==a.F.state};a.wG=g;a.yG=z;a.playrate=function(a,b){var c=a.F;c.pitch=b;!k(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.Rb.playbackRate.value=b,f(c),t(c))};a.get_playrate=function(a){return a.F.pitch};a.cyclic=function(a,b){a.F.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.F.cyclic};a.vE=function(a,b,c,d){if(P&&a.wa){var e=
v;e[0]=0;e[1]=-1;e[2]=0;A.transformQuat(e,c,e);J[0]=0;J[1]=0;J[2]=-1;A.transformQuat(J,c,J);c=P.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],J[0],J[1],J[2]);A.copy(e,a.wa.zv);!a.wa.hh&&d&&(D[0]=(b[0]-a.wa.yh[0])/d,D[1]=(b[1]-a.wa.yh[1])/d,D[2]=(b[2]-a.wa.yh[2])/d,x.smooth_v(D,a.wa.aj,d,.3,D),c.setVelocity(D[0],D[1],D[2]),A.copy(D,a.wa.aj));A.copy(b,a.wa.yh)}};a.listener_reset_speed=function(a,b){if(P&&K.wa&&!K.wa.hh){var c=v;b?A.copy(b,c):A.copy(K.wa.zv,c);A.scale(c,a,c);
P.listener.setVelocity(c[0],c[1],c[2]);A.copy(c,K.wa.aj)}};a.zG=function(a,b){var c=a.F;if(k(a)&&"POSITIONAL"==c.behavior){var d=m.get_trans_view(a.f.h),e=m.get_quat_view(a.f.h),f=c.gl;f.setPosition(d[0],d[1],d[2]);var h=v;x.quat_to_dir(e,x.AXIS_MY,h);f.setOrientation(h[0],h[1],h[2]);e=c.Nq;!c.hh&&b&&(J[0]=(d[0]-e[0])/b,J[1]=(d[1]-e[1])/b,J[2]=(d[2]-e[2])/b,x.smooth_v(J,c.Zr,b,.3,J),f.setVelocity(J[0],J[1],J[2]),A.copy(J,c.Zr));A.copy(d,e)}};a.speaker_reset_speed=function(a,b,c){var d=a.F;if(k(a)&&
"POSITIONAL"==d.behavior&&!d.hh){var e=v;c?A.copy(c,e):A.copy(d.direction,e);A.scale(e,b,e);d.gl.setVelocity(e[0],e[1],e[2]);A.copy(e,d.Zr);a=m.get_trans_view(a.f.h);A.copy(a,d.Nq)}};a.qq=function(a){return a.F.behavior};a.check_active_speakers=function(){for(var a=0;a<y.length;a++)if(k(y[a]))return!0;return!1};a.bG=function(a){var b=K.wa;b&&(b.volume=a,P&&(b.Li.gain.value=u(b)))};a.uD=function(){var a=K.wa;return a?a.volume:0};a.set_volume=function(a,b){var c=a.F;c.volume=b;k(a)&&(c.Li.gain.value=
u(c))};a.get_volume=function(a){return a.F.volume};a.mute=function(a,b){a.F.muted=Boolean(b);k(a)&&(a.F.Li.gain.value=u(a.F))};a.is_muted=function(a){return a.F.muted};a.VE=function(a){var b=K.wa;b&&(b.muted=Boolean(a),P&&(b.Li.gain.value=u(b)))};a.$D=function(){var a=K.wa;return a?a.muted:!1};a.get_speaker_objects=function(){return y};a.pause=function(){for(var a=0;a<y.length;a++)g(y[a])};a.resume=function(){for(var a=0;a<y.length;a++)z(y[a])};a.set_compressor_params=function(a,b){if(a.wa&&a.wa.uk){var c=
a.wa.uk;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.wa||!a.wa.uk)return null;a=a.wa.uk;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(k(a)){a=a.F;var d=a.kh,e=P.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.jh=c}};a.unduck=function(a){if(k(a)){a=
a.F;var b=a.kh,c=P.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.jh);a.jh=0}};a.iC=function(a,b){if(P){var c=K.wa,d=c.kh,e=P.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.jh=b}};a.$G=function(){if(P){var a=K.wa,b=a.kh,c=P.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.jh);a.jh=0}};a.apply_playlist=function(a,b,c){M={zb:-1,ft:0,random:c,Bf:[],mu:[]};for(c=0;c<a.length;c++){var d=
a[c],e=w(d);0==e?E.warn("Ignoring speaker with zero duration: "+d.name):(n(d),d.F.cyclic=!1,M.Bf.push(d),M.mu.push(e+b))}};a.get_duration=w;a.clear_playlist=function(){if(M)for(var a=M.Bf,b=0;b<a.length;b++)n(a[b]);M=null};a.get_positional_params=function(a){return(a=a.F)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.F;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=
b.attenuation;var d=c.gl;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.F;c&&c.Ee&&(c.Ee.frequency.value=b.freq,c.Ee.Q.value=b.Q,c.Ee.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.F)&&a.Ee?{freq:a.Ee.frequency.value,Q:a.Ee.Q.value,gain:a.Ee.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.F;if(!a||!a.Ee)return null;a.Ee.getFrequencyResponse(b,c,d)}};b4w.module.__vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new p(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var f=new p(3);f[0]=a;f[1]=c;f[2]=d;return f};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,f){f[0]=a;f[1]=c;f[2]=d;return f};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];
return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],
c[2]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,f){f[0]=a[0]+c[0]*d;f[1]=a[1]+c[1]*d;f[2]=a[2]+c[2]*d;return f};a.distance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1],t=c[2]-a[2];return Math.sqrt(d*d+f*f+t*t)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1],t=c[2]-a[2];return d*d+f*f+t*t};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;
a.squaredLength=function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],f=a[1],t=a[2],d=d*d+f*f+t*t;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var f=a[0],t=a[1];a=a[2];var l=c[0],n=c[1];c=c[2];
d[0]=t*c-a*n;d[1]=a*l-f*c;d[2]=f*n-t*l;return d};a.lerp=function(a,c,d,f){var t=a[0],l=a[1];a=a[2];f[0]=t+d*(c[0]-t);f[1]=l+d*(c[1]-l);f[2]=a+d*(c[2]-a);return f};a.random=function(a,c){a=a||1;var q=2*d()*Math.PI,f=2*d()-1,t=Math.sqrt(1-f*f)*a;c[0]=Math.cos(q)*t;c[1]=Math.sin(q)*t;c[2]=f*a;return c};a.transformMat4=function(a,c,d){var f=a[0],t=a[1];a=a[2];var l=c[3]*f+c[7]*t+c[11]*a+c[15],l=l||1;d[0]=(c[0]*f+c[4]*t+c[8]*a+c[12])/l;d[1]=(c[1]*f+c[5]*t+c[9]*a+c[13])/l;d[2]=(c[2]*f+c[6]*t+c[10]*a+c[14])/
l;return d};a.transformMat3=function(a,c,d){var f=a[0],t=a[1];a=a[2];d[0]=f*c[0]+t*c[3]+a*c[6];d[1]=f*c[1]+t*c[4]+a*c[7];d[2]=f*c[2]+t*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var f=a[0],t=a[1],l=a[2];a=c[0];var n=c[1],g=c[2];c=c[3];var p=c*f+n*l-g*t,h=c*t+g*f-a*l,k=c*l+a*t-n*f,f=-a*f-n*t-g*l;d[0]=p*c+f*-a+h*-g-k*-n;d[1]=h*c+f*-n+k*-a-p*-g;d[2]=k*c+f*-g+p*-n-h*-a;return d};a.rotateX=function(a,c,d,f){var t=[],l=[];t[0]=a[0]-c[0];t[1]=a[1]-c[1];t[2]=a[2]-c[2];l[0]=t[0];l[1]=t[1]*Math.cos(d)-
t[2]*Math.sin(d);l[2]=t[1]*Math.sin(d)+t[2]*Math.cos(d);f[0]=l[0]+c[0];f[1]=l[1]+c[1];f[2]=l[2]+c[2];return f};a.rotateY=function(a,c,d,f){var t=[],l=[];t[0]=a[0]-c[0];t[1]=a[1]-c[1];t[2]=a[2]-c[2];l[0]=t[2]*Math.sin(d)+t[0]*Math.cos(d);l[1]=t[1];l[2]=t[2]*Math.cos(d)-t[0]*Math.sin(d);f[0]=l[0]+c[0];f[1]=l[1]+c[1];f[2]=l[2]+c[2];return f};a.rotateZ=function(a,c,d,f){var t=[],l=[];t[0]=a[0]-c[0];t[1]=a[1]-c[1];t[2]=a[2]-c[2];l[0]=t[0]*Math.cos(d)-t[1]*Math.sin(d);l[1]=t[0]*Math.sin(d)+t[1]*Math.cos(d);
l[2]=t[2];f[0]=l[0]+c[0];f[1]=l[1]+c[1];f[2]=l[2]+c[2];return f};a.forEach=function(){var b=a.create();return function(a,d,f,t,l,n){d||(d=3);f||(f=0);for(t=t?Math.min(t*d+f,a.length):a.length;f<t;f+=d)b[0]=a[f],b[1]=a[f+1],b[2]=a[f+2],l(b,n,b),a[f]=b[0],a[f+1]=b[1],a[f+2]=b[2];return a}}();a.RI=function(b,c){var d=a.fromValues(b[0],b[1],b[2]),f=a.fromValues(c[0],c[1],c[2]);a.normalize(d,d);a.normalize(f,f);d=a.dot(d,f);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new p(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,f){var t=new p(4);t[0]=a;t[1]=c;t[2]=d;t[3]=f;return t};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,f,t){t[0]=a;t[1]=c;t[2]=d;t[3]=f;return t};a.add=function(a,c,d){d[0]=
a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);d[3]=
Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,f){f[0]=a[0]+c[0]*d;f[1]=a[1]+c[1]*d;f[2]=a[2]+c[2]*d;f[3]=a[3]+c[3]*d;return f};a.distance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1],t=c[2]-a[2],l=c[3]-a[3];return Math.sqrt(d*d+f*f+t*t+l*l)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],f=c[1]-a[1],t=c[2]-a[2],l=c[3]-a[3];return d*d+f*f+t*t+l*l};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],f=a[2];a=a[3];return Math.sqrt(c*c+d*d+f*f+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],f=a[2];a=a[3];return c*c+d*d+f*f+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],f=a[1],t=a[2],l=a[3],d=d*d+f*f+t*t+l*l;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,f){var t=a[0],l=a[1],n=a[2];a=a[3];f[0]=t+d*(c[0]-t);f[1]=l+d*(c[1]-l);f[2]=n+d*(c[2]-n);f[3]=a+d*(c[3]-a);return f};a.random=function(b,c){b=b||1;c[0]=d();c[1]=d();c[2]=d();c[3]=d();a.normalize(c,c);a.scale(c,b,c);return c};a.transformMat4=function(a,c,d){var f=a[0],
t=a[1],l=a[2];a=a[3];d[0]=c[0]*f+c[4]*t+c[8]*l+c[12]*a;d[1]=c[1]*f+c[5]*t+c[9]*l+c[13]*a;d[2]=c[2]*f+c[6]*t+c[10]*l+c[14]*a;d[3]=c[3]*f+c[7]*t+c[11]*l+c[15]*a;return d};a.transformQuat=function(a,c,d){var f=a[0],t=a[1],l=a[2],n=c[0],g=c[1],p=c[2];c=c[3];var h=c*f+g*l-p*t,k=c*t+p*f-n*l,u=c*l+n*t-g*f,f=-n*f-g*t-p*l;d[0]=h*c+f*-n+k*-p-u*-g;d[1]=k*c+f*-g+u*-n-h*-p;d[2]=u*c+f*-p+h*-g-k*-n;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,d,f,t,l,n){d||(d=4);f||(f=0);for(t=t?Math.min(t*
d+f,a.length):a.length;f<t;f+=d)b[0]=a[f],b[1]=a[f+1],b[2]=a[f+2],b[3]=a[f+3],l(b,n,b),a[f]=b[0],a[f+1]=b[1],a[f+2]=b[2],a[f+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,p){var d=p("__vec3"),b=p("__vec4"),c=p("__mat3"),q="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new q(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=d.create(),c=d.fromValues(1,0,0),l=d.fromValues(0,1,0);return function(n,g,q){var h=d.dot(n,g);if(-.9999999>h)return d.cross(c,n,b),1E-6>d.length(b)&&d.cross(l,n,b),d.normalize(b,b),a.setAxisAngle(b,Math.PI,q),q;if(.9999999<h)return q[0]=0,q[1]=0,q[2]=0,q[3]=1,q;d.cross(n,
g,b);q[0]=b[0];q[1]=b[1];q[2]=b[2];q[3]=1+h;return a.normalize(q,q)}}();a.setAxes=function(){var b=c.create();return function(c,d,n,g){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=n[0];b[4]=n[1];b[7]=n[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,g),g)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=b.add;a.multiply=function(a,b,c){var d=a[0],g=a[1],q=a[2];a=a[3];var h=b[0],k=b[1],p=b[2];b=b[3];c[0]=d*b+a*h+g*p-q*k;c[1]=g*b+a*k+q*h-d*p;c[2]=q*b+a*p+d*k-g*h;c[3]=a*b-d*h-g*k-q*p;return c};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],g=a[1],q=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*h;c[1]=g*b+q*h;c[2]=q*b-g*h;c[3]=a*b-d*h;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],g=a[1],q=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);c[0]=d*
b-q*h;c[1]=g*b+a*h;c[2]=q*b+d*h;c[3]=a*b-g*h;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],g=a[1],q=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);c[0]=d*b+g*h;c[1]=g*b-d*h;c[2]=q*b+a*h;c[3]=a*b-q*h;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],g=a[2];b[0]=c;b[1]=d;b[2]=g;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-g*g));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,c,d){var g=a[0],q=a[1],h=a[2];a=a[3];var k=b[0],p=b[1],w=b[2];b=b[3];var C,E,G;E=g*k+q*p+h*w+a*b;0>E&&(E=-E,k=-k,p=-p,
w=-w,b=-b);1E-6<1-E?(C=Math.acos(E),G=Math.sin(C),E=Math.sin((1-c)*C)/G,c=Math.sin(c*C)/G):E=1-c;d[0]=E*g+c*k;d[1]=E*q+c*p;d[2]=E*h+c*w;d[3]=E*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],g=a[2],q=a[3],h=c*c+d*d+g*g+q*q,h=h?1/h:0;b[0]=-c*h;b[1]=-d*h;b[2]=-g*h;b[3]=q*h;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var g=(d+1)%3,q=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*g+g]-a[3*q+q]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*g+q]-a[3*q+g])*c;b[g]=(a[3*g+d]+a[3*d+g])*c;b[q]=(a[3*q+d]+a[3*d+q])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new p(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var c=a[1],q=a[2],f=a[5];b[1]=a[3];b[2]=a[6];b[3]=c;b[5]=a[7];b[6]=q;b[7]=f}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var c=a[0],q=a[1],f=a[2],p=a[3],l=a[4],n=a[5],g=a[6],z=a[7],h=a[8],k=h*l-n*z,u=-h*p+n*g,w=
z*p-l*g,C=c*k+q*u+f*w;if(!C)return null;C=1/C;b[0]=k*C;b[1]=(-h*q+f*z)*C;b[2]=(n*q-f*l)*C;b[3]=u*C;b[4]=(h*c-f*g)*C;b[5]=(-n*c+f*p)*C;b[6]=w*C;b[7]=(-z*c+q*g)*C;b[8]=(l*c-q*p)*C;return b};a.adjoint=function(a,b){var c=a[0],q=a[1],f=a[2],p=a[3],l=a[4],n=a[5],g=a[6],z=a[7],h=a[8];b[0]=l*h-n*z;b[1]=f*z-q*h;b[2]=q*n-f*l;b[3]=n*g-p*h;b[4]=c*h-f*g;b[5]=f*p-c*n;b[6]=p*z-l*g;b[7]=q*g-c*z;b[8]=c*l-q*p;return b};a.determinant=function(a){var b=a[3],c=a[4],q=a[5],f=a[6],p=a[7],l=a[8];return a[0]*(l*c-q*p)+a[1]*
(-l*b+q*f)+a[2]*(p*b-c*f)};a.multiply=function(a,b,c){var q=a[0],f=a[1],p=a[2],l=a[3],n=a[4],g=a[5],z=a[6],h=a[7];a=a[8];var k=b[0],u=b[1],w=b[2],C=b[3],E=b[4],G=b[5],m=b[6],x=b[7];b=b[8];c[0]=k*q+u*l+w*z;c[1]=k*f+u*n+w*h;c[2]=k*p+u*g+w*a;c[3]=C*q+E*l+G*z;c[4]=C*f+E*n+G*h;c[5]=C*p+E*g+G*a;c[6]=m*q+x*l+b*z;c[7]=m*f+x*n+b*h;c[8]=m*p+x*g+b*a;return c};a.mul=a.multiply;a.translate=function(a,b,c){var q=a[0],f=a[1],p=a[2],l=a[3],n=a[4],g=a[5],z=a[6],h=a[7];a=a[8];var k=b[0];b=b[1];c[0]=q;c[1]=f;c[2]=p;
c[3]=l;c[4]=n;c[5]=g;c[6]=k*q+b*l+z;c[7]=k*f+b*n+h;c[8]=k*p+b*g+a;return c};a.rotate=function(a,b,c){var q=a[0],f=a[1],p=a[2],l=a[3],n=a[4],g=a[5],z=a[6],h=a[7];a=a[8];var k=Math.sin(b);b=Math.cos(b);c[0]=b*q+k*l;c[1]=b*f+k*n;c[2]=b*p+k*g;c[3]=b*l-k*q;c[4]=b*n-k*f;c[5]=b*g-k*p;c[6]=z;c[7]=h;c[8]=a;return c};a.scale=function(a,b,c){var q=b[0];b=b[1];c[0]=q*a[0];c[1]=q*a[1];c[2]=q*a[2];c[3]=b*a[3];c[4]=b*a[4];c[5]=b*a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.KC=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.IC=function(a,b){var c=Math.sin(a),q=Math.cos(a);b[0]=q;b[1]=c;b[2]=0;b[3]=-c;b[4]=q;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.JC=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var c=a[0],q=a[1],f=a[2],p=a[3],l=c+c,n=q+q,g=f+f,c=c*l,z=q*l,q=q*n,h=f*l,k=
f*n,f=f*g,l=p*l,n=p*n,p=p*g;b[0]=1-q-f;b[3]=z-p;b[6]=h+n;b[1]=z+p;b[4]=1-c-f;b[7]=k-l;b[2]=h-n;b[5]=k+l;b[8]=1-c-q;return b};a.normalFromMat4=function(a,b){var c=a[0],q=a[1],f=a[2],p=a[3],l=a[4],n=a[5],g=a[6],z=a[7],h=a[8],k=a[9],u=a[10],w=a[11],C=a[12],E=a[13],G=a[14],m=a[15],x=c*n-q*l,A=c*g-f*l,r=c*z-p*l,e=q*g-f*n,v=q*z-p*n,J=f*z-p*g,D=h*E-k*C,H=h*G-u*C,h=h*m-w*C,I=k*G-u*E,k=k*m-w*E,u=u*m-w*G,w=x*u-A*k+r*I+e*h-v*H+J*D;if(!w)return null;w=1/w;b[0]=(n*u-g*k+z*I)*w;b[1]=(g*h-l*u-z*H)*w;b[2]=(l*k-n*
h+z*D)*w;b[3]=(f*k-q*u-p*I)*w;b[4]=(c*u-f*h+p*H)*w;b[5]=(q*h-c*k-p*D)*w;b[6]=(E*J-G*v+m*e)*w;b[7]=(G*r-C*J-m*A)*w;b[8]=(C*v-E*r+m*x)*w;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.HC=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new p(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];
b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var c=a[1],q=a[2],f=a[3],p=a[6],l=a[7],n=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=c;b[6]=a[9];b[7]=a[13];b[8]=q;b[9]=p;b[11]=a[14];b[12]=f;b[13]=
l;b[14]=n}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var c=a[0],q=a[1],f=a[2],p=a[3],l=a[4],n=a[5],g=a[6],z=a[7],h=a[8],k=a[9],u=a[10],w=a[11],C=a[12],E=a[13],G=a[14],m=a[15],x=c*n-q*l,A=c*g-f*l,r=c*z-p*l,e=q*g-f*n,v=q*z-p*n,J=f*z-p*g,D=h*E-k*C,H=h*G-u*C,I=h*m-w*C,P=k*G-u*E,K=k*m-w*E,y=u*m-w*G,F=x*y-A*K+r*P+e*I-v*H+J*D;if(!F)return null;
F=1/F;b[0]=(n*y-g*K+z*P)*F;b[1]=(f*K-q*y-p*P)*F;b[2]=(E*J-G*v+m*e)*F;b[3]=(u*v-k*J-w*e)*F;b[4]=(g*I-l*y-z*H)*F;b[5]=(c*y-f*I+p*H)*F;b[6]=(G*r-C*J-m*A)*F;b[7]=(h*J-u*r+w*A)*F;b[8]=(l*K-n*I+z*D)*F;b[9]=(q*I-c*K-p*D)*F;b[10]=(C*v-E*r+m*x)*F;b[11]=(k*r-h*v-w*x)*F;b[12]=(n*H-l*P-g*D)*F;b[13]=(c*P-q*H+f*D)*F;b[14]=(E*A-C*e-G*x)*F;b[15]=(h*e-k*A+u*x)*F;return b};a.adjoint=function(a,b){var c=a[0],q=a[1],f=a[2],p=a[3],l=a[4],n=a[5],g=a[6],z=a[7],h=a[8],k=a[9],u=a[10],w=a[11],C=a[12],E=a[13],G=a[14],m=a[15];
b[0]=n*(u*m-w*G)-k*(g*m-z*G)+E*(g*w-z*u);b[1]=-(q*(u*m-w*G)-k*(f*m-p*G)+E*(f*w-p*u));b[2]=q*(g*m-z*G)-n*(f*m-p*G)+E*(f*z-p*g);b[3]=-(q*(g*w-z*u)-n*(f*w-p*u)+k*(f*z-p*g));b[4]=-(l*(u*m-w*G)-h*(g*m-z*G)+C*(g*w-z*u));b[5]=c*(u*m-w*G)-h*(f*m-p*G)+C*(f*w-p*u);b[6]=-(c*(g*m-z*G)-l*(f*m-p*G)+C*(f*z-p*g));b[7]=c*(g*w-z*u)-l*(f*w-p*u)+h*(f*z-p*g);b[8]=l*(k*m-w*E)-h*(n*m-z*E)+C*(n*w-z*k);b[9]=-(c*(k*m-w*E)-h*(q*m-p*E)+C*(q*w-p*k));b[10]=c*(n*m-z*E)-l*(q*m-p*E)+C*(q*z-p*n);b[11]=-(c*(n*w-z*k)-l*(q*w-p*k)+h*
(q*z-p*n));b[12]=-(l*(k*G-u*E)-h*(n*G-g*E)+C*(n*u-g*k));b[13]=c*(k*G-u*E)-h*(q*G-f*E)+C*(q*u-f*k);b[14]=-(c*(n*G-g*E)-l*(q*G-f*E)+C*(q*g-f*n));b[15]=c*(n*u-g*k)-l*(q*u-f*k)+h*(q*g-f*n);return b};a.determinant=function(a){var b=a[0],c=a[1],q=a[2],f=a[3],p=a[4],l=a[5],n=a[6],g=a[7],z=a[8],h=a[9],k=a[10],u=a[11],w=a[12],C=a[13],E=a[14];a=a[15];return(b*l-c*p)*(k*a-u*E)-(b*n-q*p)*(h*a-u*C)+(b*g-f*p)*(h*E-k*C)+(c*n-q*l)*(z*a-u*w)-(c*g-f*l)*(z*E-k*w)+(q*g-f*n)*(z*C-h*w)};a.multiply=function(a,b,c){var q=
a[0],f=a[1],p=a[2],l=a[3],n=a[4],g=a[5],z=a[6],h=a[7],k=a[8],u=a[9],w=a[10],C=a[11],E=a[12],G=a[13],m=a[14];a=a[15];var x=b[0],A=b[1],r=b[2],e=b[3];c[0]=x*q+A*n+r*k+e*E;c[1]=x*f+A*g+r*u+e*G;c[2]=x*p+A*z+r*w+e*m;c[3]=x*l+A*h+r*C+e*a;x=b[4];A=b[5];r=b[6];e=b[7];c[4]=x*q+A*n+r*k+e*E;c[5]=x*f+A*g+r*u+e*G;c[6]=x*p+A*z+r*w+e*m;c[7]=x*l+A*h+r*C+e*a;x=b[8];A=b[9];r=b[10];e=b[11];c[8]=x*q+A*n+r*k+e*E;c[9]=x*f+A*g+r*u+e*G;c[10]=x*p+A*z+r*w+e*m;c[11]=x*l+A*h+r*C+e*a;x=b[12];A=b[13];r=b[14];e=b[15];c[12]=x*q+
A*n+r*k+e*E;c[13]=x*f+A*g+r*u+e*G;c[14]=x*p+A*z+r*w+e*m;c[15]=x*l+A*h+r*C+e*a;return c};a.mul=a.multiply;a.translate=function(a,b,c){var q=b[0],f=b[1];b=b[2];var p,l,n,g,z,h,k,u,w,C,E,G;a===c?(c[12]=a[0]*q+a[4]*f+a[8]*b+a[12],c[13]=a[1]*q+a[5]*f+a[9]*b+a[13],c[14]=a[2]*q+a[6]*f+a[10]*b+a[14],c[15]=a[3]*q+a[7]*f+a[11]*b+a[15]):(p=a[0],l=a[1],n=a[2],g=a[3],z=a[4],h=a[5],k=a[6],u=a[7],w=a[8],C=a[9],E=a[10],G=a[11],c[0]=p,c[1]=l,c[2]=n,c[3]=g,c[4]=z,c[5]=h,c[6]=k,c[7]=u,c[8]=w,c[9]=C,c[10]=E,c[11]=G,
c[12]=p*q+z*f+w*b+a[12],c[13]=l*q+h*f+C*b+a[13],c[14]=n*q+k*f+E*b+a[14],c[15]=g*q+u*f+G*b+a[15]);return c};a.scale=function(a,b,c){var q=b[0],f=b[1];b=b[2];c[0]=a[0]*q;c[1]=a[1]*q;c[2]=a[2]*q;c[3]=a[3]*q;c[4]=a[4]*f;c[5]=a[5]*f;c[6]=a[6]*f;c[7]=a[7]*f;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.rotate=function(a,b,c,q){var f=c[0],p=c[1];c=c[2];var l=Math.sqrt(f*f+p*p+c*c),n,g,z,h,k,u,w,C,E,G,m,x,A,r,e,v,J,D,H,I;if(1E-7>Math.abs(l))return null;
l=1/l;f*=l;p*=l;c*=l;n=Math.sin(b);g=Math.cos(b);z=1-g;b=a[0];l=a[1];h=a[2];k=a[3];u=a[4];w=a[5];C=a[6];E=a[7];G=a[8];m=a[9];x=a[10];A=a[11];r=f*f*z+g;e=p*f*z+c*n;v=c*f*z-p*n;J=f*p*z-c*n;D=p*p*z+g;H=c*p*z+f*n;I=f*c*z+p*n;f=p*c*z-f*n;p=c*c*z+g;q[0]=b*r+u*e+G*v;q[1]=l*r+w*e+m*v;q[2]=h*r+C*e+x*v;q[3]=k*r+E*e+A*v;q[4]=b*J+u*D+G*H;q[5]=l*J+w*D+m*H;q[6]=h*J+C*D+x*H;q[7]=k*J+E*D+A*H;q[8]=b*I+u*f+G*p;q[9]=l*I+w*f+m*p;q[10]=h*I+C*f+x*p;q[11]=k*I+E*f+A*p;a!==q&&(q[12]=a[12],q[13]=a[13],q[14]=a[14],q[15]=a[15]);
return q};a.rotateX=function(a,b,c){var q=Math.sin(b);b=Math.cos(b);var f=a[4],p=a[5],l=a[6],n=a[7],g=a[8],z=a[9],h=a[10],k=a[11];a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[4]=f*b+g*q;c[5]=p*b+z*q;c[6]=l*b+h*q;c[7]=n*b+k*q;c[8]=g*b-f*q;c[9]=z*b-p*q;c[10]=h*b-l*q;c[11]=k*b-n*q;return c};a.rotateY=function(a,b,c){var q=Math.sin(b);b=Math.cos(b);var f=a[0],p=a[1],l=a[2],n=a[3],g=a[8],z=a[9],h=a[10],k=a[11];a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],
c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=f*b-g*q;c[1]=p*b-z*q;c[2]=l*b-h*q;c[3]=n*b-k*q;c[8]=f*q+g*b;c[9]=p*q+z*b;c[10]=l*q+h*b;c[11]=n*q+k*b;return c};a.rotateZ=function(a,b,c){var q=Math.sin(b);b=Math.cos(b);var f=a[0],p=a[1],l=a[2],n=a[3],g=a[4],z=a[5],h=a[6],k=a[7];a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=f*b+g*q;c[1]=p*b+z*q;c[2]=l*b+h*q;c[3]=n*b+k*q;c[4]=g*b-f*q;c[5]=z*b-p*q;c[6]=h*b-l*q;c[7]=k*b-n*q;return c};
a.KC=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.JC=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.IC=function(a,b,c){var q=b[0],f=b[1];b=b[2];var p=Math.sqrt(q*q+f*f+b*b),l;if(1E-7>Math.abs(p))return null;p=1/p;q*=p;f*=p;b*=p;p=Math.sin(a);a=Math.cos(a);l=1-a;c[0]=q*q*l+a;c[1]=f*q*l+b*
p;c[2]=b*q*l-f*p;c[3]=0;c[4]=q*f*l-b*p;c[5]=f*f*l+a;c[6]=b*f*l+q*p;c[7]=0;c[8]=q*b*l+f*p;c[9]=f*b*l-q*p;c[10]=b*b*l+a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.KJ=function(a,b){var c=Math.sin(a),p=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=p;b[6]=c;b[7]=0;b[8]=0;b[9]=-c;b[10]=p;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.LJ=function(a,b){var c=Math.sin(a),p=Math.cos(a);b[0]=p;b[1]=0;b[2]=-c;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=c;b[9]=0;b[10]=p;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.MJ=function(a,b){var c=Math.sin(a),p=Math.cos(a);b[0]=p;b[1]=c;b[2]=0;b[3]=0;b[4]=-c;b[5]=p;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,c){var p=a[0],f=a[1],t=a[2],l=a[3],n=p+p,g=f+f,z=t+t;a=p*n;var h=p*g,p=p*z,k=f*g,f=f*z,t=t*z,n=l*n,g=l*g,l=l*z;c[0]=1-(k+t);c[1]=h+l;c[2]=p-g;c[3]=0;c[4]=h-l;c[5]=1-(a+t);c[6]=f+n;c[7]=0;c[8]=p+g;c[9]=f-n;c[10]=1-(a+k);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];
c[15]=1;return c};a.fromQuat=function(a,b){var c=a[0],p=a[1],f=a[2],t=a[3],l=c+c,n=p+p,g=f+f,c=c*l,z=p*l,p=p*n,h=f*l,k=f*n,f=f*g,l=t*l,n=t*n,t=t*g;b[0]=1-p-f;b[1]=z+t;b[2]=h-n;b[3]=0;b[4]=z-t;b[5]=1-c-f;b[6]=k+l;b[7]=0;b[8]=h+n;b[9]=k-l;b[10]=1-c-p;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,c,p,f,t,l){var n=1/(b-a),g=1/(p-c),z=1/(f-t);l[0]=2*f*n;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=2*f*g;l[6]=0;l[7]=0;l[8]=(b+a)*n;l[9]=(p+c)*g;l[10]=(t+f)*z;l[11]=-1;l[12]=0;l[13]=0;l[14]=
t*f*2*z;l[15]=0;return l};a.perspective=function(a,b,c,p,f){a=1/Math.tan(a/2);var t=1/(c-p);f[0]=a/b;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(p+c)*t;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*p*c*t;f[15]=0;return f};a.LK=function(a,b,c,p){var f=Math.tan(a.upDegrees*Math.PI/180),t=Math.tan(a.downDegrees*Math.PI/180),l=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var n=2/(l+a),g=2/(f+t);p[0]=n;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=g;p[6]=0;p[7]=0;p[8]=-((l-
a)*n*.5);p[9]=(f-t)*g*.5;p[10]=c/(b-c);p[11]=-1;p[12]=0;p[13]=0;p[14]=c*b/(b-c);p[15]=0;return p};a.ortho=function(a,b,c,p,f,t,l){var n=1/(a-b),g=1/(c-p),z=1/(f-t);l[0]=-2*n;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=-2*g;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=2*z;l[11]=0;l[12]=(a+b)*n;l[13]=(p+c)*g;l[14]=(t+f)*z;l[15]=1;return l};a.lookAt=function(d,b,c,p){var f,t,l,n,g,z,h,k,u=d[0],w=d[1];d=d[2];l=c[0];n=c[1];t=c[2];h=b[0];c=b[1];f=b[2];if(1E-7>Math.abs(u-h)&&1E-7>Math.abs(w-c)&&1E-7>Math.abs(d-f))return a.identity(p);
b=u-h;c=w-c;h=d-f;k=1/Math.sqrt(b*b+c*c+h*h);b*=k;c*=k;h*=k;f=n*h-t*c;t=t*b-l*h;l=l*c-n*b;(k=Math.sqrt(f*f+t*t+l*l))?(k=1/k,f*=k,t*=k,l*=k):l=t=f=0;n=c*l-h*t;g=h*f-b*l;z=b*t-c*f;(k=Math.sqrt(n*n+g*g+z*z))?(k=1/k,n*=k,g*=k,z*=k):z=g=n=0;p[0]=f;p[1]=n;p[2]=b;p[3]=0;p[4]=t;p[5]=g;p[6]=c;p[7]=0;p[8]=l;p[9]=z;p[10]=h;p[11]=0;p[12]=-(f*u+t*w+l*d);p[13]=-(n*u+g*w+z*d);p[14]=-(b*u+c*w+h*d);p[15]=1;return p};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+
a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.HC=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a){function p(a,f){var n=a[0],g=a[1],p=a[2],h=a[3],n=b(n,g,p,h,f[0],7,-680876936),h=b(h,n,g,p,f[1],12,-389564586),p=b(p,h,n,g,f[2],17,606105819),g=b(g,p,h,n,f[3],22,-1044525330),n=b(n,g,p,h,f[4],7,-176418897),h=b(h,n,g,p,f[5],12,1200080426),p=b(p,h,n,g,f[6],17,-1473231341),g=b(g,p,h,n,f[7],22,-45705983),n=b(n,g,p,h,f[8],7,1770035416),h=b(h,n,g,p,f[9],12,-1958414417),p=b(p,h,n,g,f[10],17,-42063),g=b(g,p,h,n,f[11],22,-1990404162),n=b(n,g,p,h,f[12],7,1804603682),h=b(h,n,g,p,
f[13],12,-40341101),p=b(p,h,n,g,f[14],17,-1502002290),g=b(g,p,h,n,f[15],22,1236535329),n=c(n,g,p,h,f[1],5,-165796510),h=c(h,n,g,p,f[6],9,-1069501632),p=c(p,h,n,g,f[11],14,643717713),g=c(g,p,h,n,f[0],20,-373897302),n=c(n,g,p,h,f[5],5,-701558691),h=c(h,n,g,p,f[10],9,38016083),p=c(p,h,n,g,f[15],14,-660478335),g=c(g,p,h,n,f[4],20,-405537848),n=c(n,g,p,h,f[9],5,568446438),h=c(h,n,g,p,f[14],9,-1019803690),p=c(p,h,n,g,f[3],14,-187363961),g=c(g,p,h,n,f[8],20,1163531501),n=c(n,g,p,h,f[13],5,-1444681467),h=
c(h,n,g,p,f[2],9,-51403784),p=c(p,h,n,g,f[7],14,1735328473),g=c(g,p,h,n,f[12],20,-1926607734),n=d(g^p^h,n,g,f[5],4,-378558),h=d(n^g^p,h,n,f[8],11,-2022574463),p=d(h^n^g,p,h,f[11],16,1839030562),g=d(p^h^n,g,p,f[14],23,-35309556),n=d(g^p^h,n,g,f[1],4,-1530992060),h=d(n^g^p,h,n,f[4],11,1272893353),p=d(h^n^g,p,h,f[7],16,-155497632),g=d(p^h^n,g,p,f[10],23,-1094730640),n=d(g^p^h,n,g,f[13],4,681279174),h=d(n^g^p,h,n,f[0],11,-358537222),p=d(h^n^g,p,h,f[3],16,-722521979),g=d(p^h^n,g,p,f[6],23,76029189),n=
d(g^p^h,n,g,f[9],4,-640364487),h=d(n^g^p,h,n,f[12],11,-421815835),p=d(h^n^g,p,h,f[15],16,530742520),g=d(p^h^n,g,p,f[2],23,-995338651),n=q(n,g,p,h,f[0],6,-198630844),h=q(h,n,g,p,f[7],10,1126891415),p=q(p,h,n,g,f[14],15,-1416354905),g=q(g,p,h,n,f[5],21,-57434055),n=q(n,g,p,h,f[12],6,1700485571),h=q(h,n,g,p,f[3],10,-1894986606),p=q(p,h,n,g,f[10],15,-1051523),g=q(g,p,h,n,f[1],21,-2054922799),n=q(n,g,p,h,f[8],6,1873313359),h=q(h,n,g,p,f[15],10,-30611744),p=q(p,h,n,g,f[6],15,-1560198380),g=q(g,p,h,n,f[13],
21,1309151649),n=q(n,g,p,h,f[4],6,-145523070),h=q(h,n,g,p,f[11],10,-1120210379),p=q(p,h,n,g,f[2],15,718787259),g=q(g,p,h,n,f[9],21,-343485551);a[0]=n+a[0]&4294967295;a[1]=g+a[1]&4294967295;a[2]=p+a[2]&4294967295;a[3]=h+a[3]&4294967295}function d(a,b,c,d,f,h){b=(b+a&4294967295)+(d+h&4294967295)&4294967295;return(b<<f|b>>>32-f)+c&4294967295}function b(a,b,c,f,p,h,k){return d(b&c|~b&f,a,b,p,h,k)}function c(a,b,c,f,p,h,k){return d(b&f|c&~f,a,b,p,h,k)}function q(a,b,c,f,p,h,k){return d(c^(b|~f),a,b,p,
h,k)}var f="0123456789abcdef".split("");a.dv=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var q=b.substring(d-64,d),h=[],k=void 0,k=0;64>k;k+=4)h[k>>2]=q.charCodeAt(k)+(q.charCodeAt(k+1)<<8)+(q.charCodeAt(k+2)<<16)+(q.charCodeAt(k+3)<<24);p(a,h)}b=b.substring(d-64);q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)q[d>>2]|=b.charCodeAt(d)<<(d%4<<3);q[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,q),d=0;16>d;d++)q[d]=0;q[14]=8*
c;p(a,q);for(b=0;b<a.length;b++){c=a[b];d="";for(q=0;4>q;q++)d+=f[c>>8*q+4&15]+f[c>>8*q&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"include",file:"math.glslv"},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_proj_matrix ; void main ( ) { gl_Position = u_view_proj_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",
name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",
b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"std_enums.glsl"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"pack.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"color_util.glslf"},
{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_sampler ; uniform float u_alpha_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_OUTLINE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_color_id",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION",
"sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bC ; varying vec4 bD ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec4 bI ; varying vec4 bJ ; varying vec4 bK ; varying vec4 bL ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { mat4 qN ; float qO , qP ; vec4 qQ ; vec3 qR , qS , qT , qU ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"qR = u_camera_eye_frag - bC ; qR = normalize ( qR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW",
"REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"qN = O ( u_view_tsr_frag ) ; qM ( qR , qN , qS , qT , qU , qQ , qO ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"qM ( qR , mat4 ( 0.0 ) , qS , qT , qU , qQ , qO ) ;".split(" ")}]}}]},{type:"textline",b:["qO","=","qO",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:"qO = ( texture2D ( u_sampler , bM ) ) . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"qP = u_alpha_factor * qO ; qP += ( 1.0 - step ( 0.0 , qP ) ) ; qO = mix ( qP , 1.0 , u_diffuse_color . a ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"qO = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( qO < 0.5 ) discard ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},
{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",
c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",b:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bC ; varying vec4 bD ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:["varying","float","bH",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 tv ; float tw , tx , ty ; vec3 tz , tA , tB , tC , tD , tE ; mat4 tF , tG , tH ; tF = O ( u_view_tsr ) ; tz = a_position ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["tA","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"tB = vec3 ( a_tangent ) ; tC = a_tangent [ 3 ] * cross ( tA , tB ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"tB = vec3 ( 0.0 ) ; tC = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tA = vec3 ( 0.0 ) ; tB = vec3 ( 0.0 ) ; tC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"tz = mix ( tz , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"tA = mix ( tA , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"tD = vec3 ( a_tangent ) ; tE = a_tangent_next [ 3 ] * cross ( a_normal_next , tD ) ; tB = mix ( tB , tD , u_va_frame_factor ) ; tC = mix ( tC , tE , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sB ( tz , tB , tC , tA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["tC","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"tG = O ( u_model_tsr ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",
a:[{type:"textline",b:"tB = ( tG * vec4 ( tC , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tH = ru ( u_camera_eye , tB , tF , tG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tH = ro ( u_camera_eye , tB , tF ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tH = tH * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , tB ) ;".split(" ")}]}}]},{type:"textline",b:"c tI = rB ( tz - tC , tC , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tH ) ; tI . b = tB ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c tI = rB ( tz , tC , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tp ( tI . a , tI . b , tA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["tA","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"tp ( tI . a , tI . b , tA ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bC = tI . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"bE = tI . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"tw = ( dot ( cross ( tI . e , tI . c ) , tI . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( tI . c , tw ) ;".split(" ")}]}}]},{type:"textline",b:"bD = tF * vec4 ( tI . a , 1.0 ) ; tv = u_proj_matrix * bD ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"tv . xy += u_subpixel_jitter * tv . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tw = tv . x ; tx = tv . y ; ty = tv . w ; bG . x = ( tw + ty ) / 2.0 ; bG . y = ( tx + ty ) / 2.0 ; bG . z = ty ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["tu","(",")",";"]}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * tF * vec4 ( tI . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",
b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",
b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"condition",
a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},
{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_colormap0 ; uniform float u_alpha_factor ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bC",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3",
"NUM_CAST_LAMPS",3,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { mat4 tv ; float tw , tx ; vec4 ty ; vec3 tz , tA , tB , tC ;".split(" ")},{type:"condition",a:[{type:"if",
c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"tz = u_camera_eye_frag - bC ; tz = normalize ( tz ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tv = O ( u_view_tsr_frag ) ; qM ( tz , tv , tA , tB , tC , ty , tw ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"qM ( tz , mat4 ( 0.0 ) , tA , tB , tC , ty , tw ) ;".split(" ")}]}}]},{type:"textline",b:["tw","=","tw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"tw = ( texture2D ( u_colormap0 , bM ) ) . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tx = u_alpha_factor * tw ; tx += ( 1.0 - step ( 0.0 , tx ) ) ; tw = mix ( tx , 1.0 , u_diffuse_color . a ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"tw = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( tw < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = dr ( bD . z ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor . a *= clamp ( bF . r , 0.999999999 , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",
name:"MAX_BONES",b:["0"]},{type:"var",name:"NUM_CAST_LAMPS",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",
";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3",
"a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_shadow_cast_billboard_view_tsr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",
d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_offset",";"]},{type:"condition",a:[{type:"if",c:["MAC_OS_SHADOW_HACK"],group:{type:"group",a:[{type:"textline",b:"uniform mat3 u_v_light_tsr [ NUM_CAST_LAMPS ] ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_v_light_ts [ NUM_CAST_LAMPS ] ; uniform vec4 u_v_light_r [ NUM_CAST_LAMPS ] ;".split(" ")}]}}]},{type:"textline",b:["uniform","mat4","u_p_light_matrix0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",
2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bC",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",
"ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec2 um ; vec4 un , uo ; float up ; vec3 uq , ur , us , ut , uu , uv ; mat4 uw , ux , uy , uz ; uw = O ( u_view_tsr ) ; uq = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",
d:6}],group:{type:"group",a:[{type:"textline",b:["ur","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ur = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"us = vec3 ( a_tangent ) ; ut = a_tangent [ 3 ] * cross ( ur , us ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"us = vec3 ( 0.0 ) ; ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"uq = mix ( uq , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"ur = mix ( ur , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"uu = vec3 ( a_tangent ) ; uv = a_tangent_next [ 3 ] * cross ( a_normal_next , uu ) ; us = mix ( us , uu , u_va_frame_factor ) ; ut = mix ( ut , uv , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sB ( uq , us , ut , ur ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",
{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["ut","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c uA = t_ ( uq , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , ut , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , uw ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"ux = O ( u_model_tsr ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"us = ( ux * vec4 ( ut , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD",{type:"logic_negative_expr",d:1},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uy = O ( u_shadow_cast_billboard_view_tsr ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["uy","=","uw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uz = ru ( u_camera_eye , us , uy , ux ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uz = ro ( u_camera_eye , us , uy ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"uz = uz * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , us ) ;".split(" ")}]}}]},{type:"textline",b:"c uA = rB ( uq - ut , ut , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , uz ) ; uA . b = us ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c uA = rB ( uq , ut , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , ux ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["ur","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ur = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"tp ( uA . a , uA . b , ur ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bC = uA . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"bE = uA . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"up = ( dot ( cross ( uA . e , uA . c ) , uA . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( uA . c , up ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"un = uw * vec4 ( uA . a , 1.0 ) ; uo = u_proj_matrix * un ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"uo . xy += u_subpixel_jitter * uo . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bG = L ( uo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["tu","(",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"ul ( uA . a , uA . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["bD","=","un",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"um = ( u_proj_matrix * uw [ 3 ] ) . xy ; up = SHADOW_TEX_RES / 2.0 ; um = floor ( um * up + 0.5 ) / up - um ; uo . xy += um ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","uo",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( um , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , um ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",b:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec4 un ; vec3 uo ; mat4 up , uq , ur ; up = O ( u_view_tsr ) ; uq = O ( u_model_tsr ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"uo = ( uq * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; ur = ro ( u_camera_eye , uo , up ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ur = ur * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"c us = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur ) ; us . b = uo ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c us = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , uq ) ;".split(" ")}]}}]},{type:"textline",b:"un = u_proj_matrix * up * vec4 ( us . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"um = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["um","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["um","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","un",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},
{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 un ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 bM ; varying float uo ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const int up = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"const int up = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float ur ( float uq ) { return uq - floor ( uq * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void uA ( inout float us , in float ut [ up ] , in float uu ) { float uv , uw , ux , uy ; for ( int uz = 0 ; uz < NUM_RINGS ; uz ++ ) { uv = 40.0 * ut [ uz ] ; uw = 300.0 * ( ur ( uv ) - 0.005 ) ; ux = uv ; uy = abs ( ux * ( u_halo_size * uw - uu ) ) ; us += 1.0 - min ( uy , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void uJ ( inout float uB , in float uC [ up ] , in float uD ) { float uE , uF , uG , uH ; for ( int uI = 0 ; uI < NUM_LINES ; uI ++ ) { uE = uC [ uI ] ; uF = uE ; uG = 1000.0 * ( ur ( uE ) - 0.005 ) ; uH = 20.0 * abs ( uF * bM . x + uG * bM . y ) ; uB += 1.0 - min ( uH , 1.0 ) ; } uB *= uD ; }".split(" ")}]}}]},{type:"textline",b:"void uQ ( inout float uK , in vec2 uL ) { float uM , uN , uO , uP ; uN = atan ( uL . y , uL . x ) ; uN *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; uO = cos ( uN ) ; uP = sin ( uN ) ; uN = ( uO * uL . x + uP * uL . y ) * ( uO * uL . y - uP * uL . x ) ; uM = abs ( uN ) ; if ( uM < 1.0 ) { uM = ( 0.01 * u_halo_size ) / ( uM ) ; uK *= sqrt ( min ( uM , 1.0 ) ) ; } } void main ( ) { vec3 uR ; float uS , uT , uU , uV ; uS = ( bM . x * bM . x + bM . y * bM . y ) ; uT = sqrt ( uS ) ; uS = max ( 1.0 - uS , 0.0 ) ; uS = pow ( uS , u_halo_hardness ) ; uU = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float uW [ up ] ; for ( int uX = 0 ; uX < up ; uX ++ ) { uW [ uX ] = fract ( uo / ( float ( uX ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"uV = 0.0 ; uA ( uV , uW , uT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"uT = 0.0 ; uJ ( uT , uW , uS ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"uQ ( uS , bM ) ;".split(" ")}]}}]},{type:"textline",b:"uS *= uU ; uR = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"uV *= uS ; uR += u_halo_rings_color * uV ; uS += uV ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"uT *= uU ; uR += u_halo_lines_color * uT ; uS += uT ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"uS *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uT = u_halo_stars_blend * ( un . y - u_halo_stars_height ) ; uS *= clamp ( uT , 0.0 , 1.0 ) ; uS *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"bu ( uR ) ; bx ( uR , uS ) ; gl_FragColor = vec4 ( uR , uS ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform PRECISION float u_halo_size ; varying vec2 bM ; varying float uo ;".split(" ")},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","un",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 up , uq ; vec3 ur ; mat4 us , ut , uu ; us = O ( u_view_tsr ) ; ut = O ( u_model_tsr ) ; ur = ( ut * vec4 ( a_position , 1.0 ) ) . xyz ; bM = a_halo_bb_vertex * 2.0 ; uo = fract ( ur . x + ur . y + ur . z ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ut = qT ( ur , us ) ; uu = us ; uu [ 3 ] [ 0 ] = 0.0 ; uu [ 3 ] [ 1 ] = 0.0 ; uu [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ut = qT ( ur , us ) ;".split(" ")}]}}]},{type:"textline",b:"up = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; up = ut * up ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",
b:"uq = u_proj_matrix * uu * up ; uq . z = 0.99999 * uq . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["un","=","up",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uq = u_proj_matrix * us * up ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","uq",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { float up ; vec3 uq ; uq = u_diffuse_color . xyz ; up = u_diffuse_color . a ; bu ( uq ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"bx ( uq , up ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uq , up ) ; }".split(" ")}]};a["line.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",
b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_direction ; uniform mat3 u_model_tsr ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_line_width ;".split(" ")},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"void main ( ) { mat2 up ; float uq ; vec2 ur , us ; vec4 ut ; mat4 uu , uv ; uu = O ( u_view_tsr ) ; uv = O ( u_model_tsr ) ; c uw = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , normalize ( a_direction ) , uv ) ; ut = u_proj_matrix * uu * vec4 ( uw . a , 1.0 ) ; ut . xyz /= ut . w ; ur = ( u_proj_matrix * uu * vec4 ( uw . e , 0.0 ) ) . xy ; uq = M_PI / 2.0 ; up = mat2 ( cos ( uq ) , sin ( uq ) , - sin ( uq ) , cos ( uq ) ) ; ur = up * normalize ( ur ) ; us = ( u_line_width / u_height ) * vec2 ( u_proj_matrix [ 0 ] [ 0 ] / u_proj_matrix [ 1 ] [ 1 ] , 1.0 ) ; gl_Position = vec4 ( ut . xy + ur . xy * us / 2.0 , ut . z , 1.0 ) ; gl_Position *= ut . w ; }".split(" ")}]};
a["main.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",
name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",
";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3",
"u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",d:2},
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:4}],group:{type:"group",
a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","bC",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",
d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",
d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bL",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"include",file:"mirror.glslf"},
{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"nodes.glslf"},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec2 vb ; mat4 vc ; vec4 vd ; vec3 ve , vf , vg , vh , vi ; float vj , vk , vl ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},
{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vj = length ( bD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vk = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["ve","=","u_sun_intensity",
";"]}]}}]},{type:"textline",b:"vf = normalize ( u_camera_eye_frag - bC ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vc = O ( u_view_tsr_frag ) ; qM ( vf , vc , vg , vh , vi , vd , vl ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"qM ( vf , mat4 ( 0.0 ) , vg , vh , vi , vd , vl ) ;".split(" ")}]}}]},{type:"textline",
b:"vg = vg ; vl = vl ; vi = vi ; vd = vd ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"vg = max ( vg - sqrt ( 0.01 * - min ( vk , 0.0 ) ) , 0.5 * vg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"bp ( vg , vk , u_time , vd , vi , u_sun_direction , ve , u_sun_quaternion , bC , vj ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( vl < 0.5 ) discard ; vl = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["vl","=","1.0",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"va ( vg , length ( bD ) , vf , vk ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"va ( vg , length ( bD ) , vf , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vb = texture2DProj ( u_shadow_mask , bG ) . rg ; vk = vb . g ; vg = vec3 ( vk ) ;".split(" ")}]}}]},
{type:"textline",b:["bu","(","vg",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},"NODES_GLOW",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bx ( vg , vl ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( vg , vl ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"NUM_CAST_LAMPS",
b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND",
"MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",
b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",
a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",b:["uniform","mat4","u_proj_matrix",
";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_offset",";"]},{type:"condition",a:[{type:"if",c:["MAC_OS_SHADOW_HACK"],group:{type:"group",a:[{type:"textline",b:"uniform mat3 u_v_light_tsr [ NUM_CAST_LAMPS ] ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_v_light_ts [ NUM_CAST_LAMPS ] ; uniform vec4 u_v_light_r [ NUM_CAST_LAMPS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","mat4","u_p_light_matrix0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:["varying","vec3","bC",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},"SHADOW_USAGE",
"SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",
b:["varying","vec3","vb",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","vc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 vd , ve ; float vf ; vec3 vg , vh , vi , vj , vk , vl , vm ; mat4 vn , vo , vp ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["vn","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vn = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",b:"vo = O ( u_model_tsr ) ; vg = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",
d:1},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["vh","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vh = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vi = vec3 ( a_tangent ) ; vj = a_tangent [ 3 ] * cross ( vh , vi ) ;".split(" ")}]}},
{type:"elif",c:["NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vk = ( vo * vec4 ( a_position , 1.0 ) ) . xyz ; vl = normalize ( ( vo * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vk = vk - u_camera_eye ; vj = cross ( vk , vl ) ; vi = cross ( vl , vj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vi = vec3 ( 0.0 ) ; vj = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"vg = mix ( vg , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"vh = mix ( vh , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vl = vec3 ( a_tangent ) ; vk = a_tangent_next [ 3 ] * cross ( a_normal_next , vl ) ; vi = mix ( vi , vl , u_va_frame_factor ) ; vj = mix ( vj , vk , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sB ( vg , vi , vj , vh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["vk","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vk = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c vq = t_ ( vg , vi , vj , vh , vk , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , vn ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",
a:[{type:"textline",b:"vl = ( vo * vec4 ( vk , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vp = ru ( u_camera_eye , vl , vn , vo ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vp = ro ( u_camera_eye , vl , vn ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vm = ( vo * vec4 ( vk , 1.0 ) ) . xyz ; vp = vp * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vm ) ;".split(" ")}]}}]},{type:"textline",b:"c vq = rB ( vg - vk , vk , vi , vj , vh , vp ) ; vq . b = vl ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c vq = rB ( vg , vk , vi , vj , vh , vo ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"vf = ( dot ( cross ( vq . e , vq . c ) , vq . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( vq . c , vf ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tp ( vq . a , vq . b , vh ) ;".split(" ")}]}}]},{type:"textline",b:"bC = vq . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"bE = vq . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vb = u_camera_eye - vq . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vc = vq . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["vc","=","a_color",";"]}]}}]}]}}]},{type:"textline",b:"vd = vn * vec4 ( vq . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},"SHADOW_USAGE",
"SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["bD","=","vd",";"]}]}}]},{type:"textline",b:"ve = u_proj_matrix * vd ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"ve . xy += u_subpixel_jitter * ve . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"bG = L ( ve ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ul ( vq . a , vq . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",
{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bH = - vd . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["tu","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","ve",";","}"]}]};a["main_stack.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",
name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",
name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4",
"u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3","NUM_CAST_LAMPS",
3,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",
";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 bC ; varying vec3 bE ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",
{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},{type:"textline",b:["varying","vec3","vb",";"]},{type:"condition",
a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","vc",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1","NUM_CAST_LAMPS",
1,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"bL",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",
file:"fog.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec4 xi , xj , xk , xl ; mat4 xm ; mat3 xn ; vec2 xo , xp , xq , xr ; vec3 xs , xt , xu , xv , xw , xx , xy , xz , xA ; float xB , xC , xD , xE , xF ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE",
"SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"xB = length ( bD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"xC = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["xs","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["xo","=","bM",";"]}]}}]},{type:"textline",b:"xt = normalize ( bE ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["INVERT_FRONTFACING"],group:{type:"group",a:[{type:"textline",b:["if","(","!","gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",b:"xt = xt ; else xt = - xt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"xu = cross ( xt , bF . xyz ) * bF . w ; xn = mat3 ( bF . xyz , xu , xt ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xm = O ( u_view_tsr_frag ) ; xp = normalize ( xm * vec4 ( bE , 0.0 ) ) . st ; xp = xp * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( xB < PARALLAX_LOD_DIST ) { xD = clamp ( 0.5 * ( PARALLAX_LOD_DIST - xB ) , 0.0 , 1.0 ) ; xD = u_parallax_scale * xD ; xu = normalize ( vb * xn ) ; xE = 1.0 / PARALLAX_STEPS ; xq = xu . xy * xD / ( PARALLAX_STEPS * xu . z ) ; xD = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["xr","=","xp",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["xr","=","xo",";"]}]}}]},{type:"textline",b:"xF = texture2D ( u_normalmap0 , xr ) . a ; for ( float xG = 1.0 ; xG <= PARALLAX_STEPS ; xG ++ ) { if ( xF < xD ) { xD -= xE ; xr -= xq ; xF = texture2D ( u_normalmap0 , xr ) . a ; } } xq = xr + xq ; xE = texture2D ( u_normalmap0 , xq ) . a - ( xD + xE ) ; xD = xF - xD ; xE = xD / ( xD - xE ) ; xr = xE * xq + ( 1.0 - xE ) * xr ;".split(" ")},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xo += xr - xp ;".split(" ")}]}}]},{type:"textline",b:["xp","=","xr",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xp += xr - xo ;".split(" ")}]}}]},{type:"textline",b:["xo","=","xr",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xi = texture2D ( u_normalmap0 , xp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xi = texture2D ( u_normalmap0 , xo ) ;".split(" ")}]}}]},{type:"textline",b:"xu = xi . rgb - 0.5 ; xu = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , xu , u_normal_factor ) ; xu = xn * xu ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["xu","=","xt",";"]}]}}]},{type:"textline",b:"xu = normalize ( xu ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xp = normalize ( xm * vec4 ( xu , 0.0 ) ) . st ; xp = xp * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"xt = normalize ( vb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"xv = vc ; br ( xv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xi = vec4 ( xv , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["xi","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["xE","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"xj = texture2D ( u_colormap0 , xp ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xj = texture2D ( u_colormap0 , xo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"br ( xj . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:[";"]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xk = texture2D ( u_colormap1 , xp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xk = texture2D ( u_colormap1 , xo ) ;".split(" ")}]}}]},{type:"textline",b:"br ( xk . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"xl = texture2D ( u_stencil0 , xp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xl = texture2D ( u_stencil0 , xo ) ;".split(" ")}]}}]},{type:"textline",b:"xj = mix ( xj , xk , xl . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xi . rgb = mix ( xi . rgb , xj . rgb , u_diffuse_color_factor ) ; xD = u_alpha_factor * xj . a ; xD += ( 1.0 - step ( 0.0 , xD ) ) ; xi . a = mix ( xD , 1.0 , u_diffuse_color . a ) ; xE = xj . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xi . rgb *= mix ( vec3 ( 1.0 ) , xj . rgb , u_diffuse_color_factor ) ; xi . a = xj . a ; xE = xj . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"xv = u_diffuse_intensity * xi . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["xw","=","xv",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xx = u_environment_energy * dS ( xu ) ; xx = u_ambient * xx ; xj = du ( xv ) ; xy = u_emit * xi . rgb ; xz = u_specular_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"xA = vec3 ( xE ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xA = texture2D ( u_specmap0 , xp ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xA = texture2D ( u_specmap0 , xo ) . rgb ;".split(" ")}]}}]},
{type:"textline",b:"br ( xA . rgb ) ; xz = mix ( xz , xA , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"xE = u_specular_params [ 0 ] ; xo = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; xz = xE * xz ; xh ( xy , xx , xv , xz , bC , xu , xt , xo , u_diffuse_params , xj , 0.0 , vec4 ( 0.0 ) , xw , xA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"dP ( xw , xt , xu , u_reflect_factor , xm ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"dP ( xw , xt , xu , u_reflect_factor , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:"dP ( xw , xt , xu , 0.0 , xm ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"dP ( xw , xt , xu , 0.0 , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["xw","+=","xA",";"]}]}}]},{type:"textline",b:"xE = xi . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"xw = max ( xw - sqrt ( 0.01 * - min ( xC , 0.0 ) ) , 0.5 * xw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"bp ( xw , xC , u_time , xj , xu , u_sun_direction , xs , u_sun_quaternion , bC , xB ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( xE < 0.5 ) discard ; xE = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"xD = max ( max ( xA . r , xA . g ) , xA . b ) * u_specular_alpha ; xE = xi . a * ( 1.0 - xD ) + xD ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["xE","=","1.0",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"xw = mix ( ef ( bG , xu . xz * u_refr_bump ) , xw , xE ) ; xE = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"va ( xw , xB , xt , xC ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"va ( xw , xB , xt , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["bu","(","xw",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bx ( xw , xE ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( xw , xE ) ; }".split(" ")}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],
group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec2 u_texel_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"varying float xi ; varying vec3 vc ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"varying vec4 bD ; varying vec3 bG ; varying float xj ;".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 xk ; vec3 xl ; float xm , xn , xo ; vec2 xp , xq ; xp = gl_PointCoord - 0.5 ; xm = 2.0 * length ( xp ) ; xm = smoothstep ( u_p_alpha_start , u_p_alpha_end , xm ) ; xm = u_diffuse_color . a * xi * ( 1.0 - xm ) ; xl = vc * u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],
group:{type:"group",a:[{type:"textline",b:"xq = bG . xy / bG . z ; xp = vec2 ( xp . x , - xp . y ) * xj * u_texel_size ; xp = vec2 ( xq + xp ) ; xk = texture2D ( u_scene_depth , xp ) ; xn = Z ( xk ) ; xo = - bD . z / u_view_max_depth ; xo = xn - xo ; xo = u_view_max_depth / SOFT_STRENGTH * xo ; xm = xm * min ( xo , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["bu","(","xl",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"bx ( xl , xm ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( xl , xm ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform",
"mat3","u_model_tsr",";"]}]}}]},{type:"textline",b:"varying float xi ; varying vec3 vc ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"varying vec4 bD ; varying vec3 bG ; varying float xj ;".split(" ")}]}}]},{type:"include",file:"math.glslv"},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { float xY , xZ , x_ , ya ; vec4 yb , yc ; mat4 yd ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",
a:[{type:"textline",b:["yd","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"yd = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",b:"xk ye ; ye = xX ( ) ; yb = yd * vec4 ( ye . b , 1.0 ) ; yc = u_proj_matrix * yb ; gl_Position = yc ; xi = ye . c ; vc = ye . d ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["bD","=","yb",";"]}]}}]},{type:"textline",b:"xY = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; xY = ye . a * xY ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"xZ = yc . x ; x_ = yc . y ; ya = yc . w ; bG . x = ( xZ + ya ) / 2.0 ; bG . y = ( x_ + ya ) / 2.0 ; bG . z = ya ; xj = xY ;".split(" ")}]}}]},{type:"textline",b:["gl_PointSize","=","xY",";","}"]}]};a["particles_texture.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},
{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",
b:["0"]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT",
"SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float xi ; varying vec3 vc ; varying vec2 bM ; varying vec3 bC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1},"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","vb",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec2 xY ; float xZ , x_ , ya ; vec3 yb , yc , yd , ye , yf , yg , yh , yi ; vec4 yj , yk ; yj = u_diffuse_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"yk = texture2D ( u_sampler , bM ) ; br ( yk . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"yj . rgb = mix ( yj . rgb , yk . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"yj . rgb *= mix ( vec3 ( 1.0 ) , yk . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"yj . a = yk . a ;".split(" ")}]}}]},{type:"textline",b:"yj . rgb *= vc ; yb = u_diffuse_intensity * yj . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1},"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"yc = normalize ( vb ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"yd = u_emit * yj . rgb ; ye = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logic_negative_expr",d:1},"SKY_COLOR",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"yf = u_environment_energy * dS ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"yf = u_environment_energy * dS ( ye ) ;".split(" ")}]}}]},{type:"textline",b:"yf = u_ambient * yf ; xZ = u_specular_params [ 0 ] ; xY = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; yg = xZ * u_specular_color ; xh ( yd , yf , yb , yg , bC , ye , yc , xY , u_diffuse_params , vec4 ( 1.0 ) , 0.0 , vec4 ( 0.0 ) , yh , yi ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["yh","=","yb",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"va ( yh , length ( bD ) , yc , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"xZ = yj . a * xi ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"x_ = - bD . z / u_view_max_depth ; yj = texture2DProj ( u_scene_depth , bG ) ; ya = Z ( yj ) ; x_ = ya - x_ ; x_ = u_view_max_depth / SOFT_STRENGTH * x_ ; xZ = xZ * min ( x_ , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["bu","(","yh",")",";"]},{type:"condition",
a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bx ( yh , xZ ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( yh , xZ ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ; uniform vec3 u_wind ; uniform float u_p_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform",
"mat3","u_model_tsr",";"]}]}}]},{type:"textline",b:"varying float xi ; varying vec3 vc ; varying vec2 bM ; varying vec3 vb ; varying vec3 bC ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"include",
file:"particles.glslv"},{type:"textline",b:"float x_ ( vec2 xY , vec2 xZ ) { return ( atan ( xZ . y , xZ . x ) - atan ( xY . y , xY . x ) ) ; } void main ( ) { vec4 ya , yb , yc ; float yd , ye , yf ; mat4 yg , yh ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["yg","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"yg = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",b:"xk yi ; yi = xX ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { yd = yi . e ; yh = qT ( yi . b , yg ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { yd = yi . e ; yh = w ( ) ; yh [ 3 ] = vec4 ( yi . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { yd = yi . e ; yh = A ( radians ( 90.0 ) ) ; yh [ 3 ] = vec4 ( yi . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { yd = x_ ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + yi . e ; yh = y ( radians ( - 90.0 ) ) ; yh [ 3 ] = vec4 ( yi . b , 1.0 ) ; } ya = vec4 ( a_p_bb_vertex * 2.0 * yi . a * u_p_size , 0.0 , 1.0 ) ; ya = yh * C ( yd ) * ya ; yb = yg * ya ; yc = u_proj_matrix * yb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"yd = yc . x ; ye = yc . y ; yf = yc . w ; bG . x = ( yd + yf ) / 2.0 ; bG . y = ( ye + yf ) / 2.0 ; bG . z = yf ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = yc ; xi = yi . c ; vc = yi . d ; bM = a_p_bb_vertex + 0.5 ; bC = ya . xyz ; vb = u_camera_eye - ya . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["bD","=","yb",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 xY ; const float xZ = 0.99 ; const float x_ = 1.8 ; const int ya = 8 ; float yg ( vec3 yb , vec3 yc ) { float yd , ye , yf ; yd = dot ( yc , yc ) ; ye = 2.0 * dot ( yc , yb ) ; yf = dot ( yb , yb ) - 1.0 ; yd = ye * ye - 4.0 * yd * yf ; yd = sqrt ( yd ) ; yd = ( - ye - yd ) / 2.0 ; yd = yf / yd ; return yd ; } float yn ( float yh , float yi ) { float yj , yk , yl , ym ; yj = 3.0 * ( 1.0 - yi * yi ) ; yk = 2.0 * ( 2.0 + yi * yi ) ; yl = 1.0 + yh * yh ; ym = pow ( 1.0 + yi * yi - 2.0 * yi * yh , 1.5 ) ; ym = max ( ym , 0.00001 ) ; return ( yj / yk ) * ( yl / ym ) ; } float yt ( vec3 yo , vec3 yp , float yq ) { vec3 yr ; float ys ; ys = dot ( yp , - yo ) ; if ( ys < 0.0 ) { return 1.0 ; } yr = yo + ys * yp ; if ( length ( yr ) < yq ) { return 0.0 ; } else if ( length ( yr ) >= yq ) { yr = normalize ( yr ) * yq - yo ; ys = acos ( dot ( normalize ( yr ) , yp ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( ys * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 yx ( float yu , vec3 yv , float yw ) { return yv - yv * pow ( u_sky_color , vec3 ( yw / yu ) ) ; } void main ( ) { float yy , yz , yA , yB , yC , yD , yE , yF , yG ; vec3 yH , yI , yJ , yK , yL , yM , yN ; yH = normalize ( xY ) ; yI = u_sun_direction ; yy = dot ( yH , yI ) ; yz = yn ( yy , - 0.01 ) * u_rayleigh_brightness * yI . y ; yA = yn ( yy - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - yI . y ) ; yy = smoothstep ( 0.0 , 100.0 , yn ( yy , 0.9995 ) ) * u_spot_brightness ; yJ = vec3 ( 0.0 , xZ , 0.0 ) ; yB = yg ( yJ , yH ) ; yC = yB / float ( ya ) ; yD = yt ( yJ , yH , xZ - 0.3 ) ; yK = vec3 ( 0.0 , 0.0 , 0.0 ) ; yL = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int yO = 0 ; yO < ya ; yO ++ ) { yE = yC * float ( yO ) ; yM = yJ + yH * yE ; yF = yt ( yM , yI , xZ - 0.2 ) ; yG = yg ( yM , yI ) ; yN = yx ( yG , vec3 ( x_ ) , u_scatter_strength ) * yF ; yK += yx ( sqrt ( yE ) , u_sky_color * yN , u_rayleigh_strength ) ; yL += yx ( yE , yN , u_mie_strength ) ; } yK = yK * yD * pow ( yB , u_rayleigh_collection_power ) / float ( ya ) ; yL = ( yL * yD * pow ( yB , u_mie_collection_power ) ) / float ( ya ) ; yK = vec3 ( yy * yL + yA * yL + yz * yK ) ; bu ( yK ) ; gl_FragColor = vec4 ( yK , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 xY ; void main ( ) { vec4 xZ , x_ ; xZ = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; x_ = u_cube_view_matrix * xZ ; xY = x_ . xyz ; gl_Position = xZ ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 bM ; void main ( ) { vec4 xZ ; xZ = texture2D ( u_sampler , bM ) ; bu ( xZ . rgb ) ; bx ( xZ . rgb , xZ . a ) ; gl_FragColor = xZ ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"include",file:"math.glslv"},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 bM ; void main ( ) { vec2 xZ ; float x_ ; vec4 ya ; vec3 yb ; mat4 yc ; yc = O ( u_view_tsr ) ; bM = a_texcoord ; yb = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; ya = u_proj_matrix * yc * vec4 ( yb , 0.0 ) ; ya . x /= ya . w ; ya . y /= ya . w ; ya += 99999.0 * step ( ya . z , 0.0 ) ; ya += 100.0 * ( step ( 1.0 , abs ( ya . x ) ) + step ( 1.0 , abs ( ya . y ) ) ) ; ya . x = - a_lf_dist * ya . x ; ya . y = - a_lf_dist * ya . y ; x_ = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; xZ = vec2 ( a_lf_bb_vertex . x / x_ , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float yd = 1.9 ; xZ *= ( 1.0 + yd * length ( ya . xy ) ) ; } gl_Position = vec4 ( ya . xy + xZ , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",a:[{type:"if",c:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",b:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 Ac ( vec3 zY , vec3 zZ , float z_ , float Aa ) { float Ab ; Ab = z_ * Aa ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ym ( zZ , zY , Ab ) ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yq ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yu ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yz ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"return yE ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yJ ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yN ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"return yR ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yV ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yZ ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","HUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ze ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",
c:["BLENDTYPE","SATURATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zk ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","VALUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zq ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","COLOR",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zw ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"return zB ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zF ( zZ , zY , Ab ) ;".split(" ")}]}}]},{type:"textline",b:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float Ak ( float Ad , float Ae , float Af , float Ag ) { float Ah ; vec3 Ai , Aj ; Ai = vec3 ( Ad ) , Aj = vec3 ( Ae ) ; Ah = Af * Ag ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ym ( Aj , Ai , Ah ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yq ( Ai , Aj , Ah ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yu ( Ai , Aj , Ah ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"return zL ( Ad , Ae , Ah , Ag ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zR ( Ad , Ae , Ah , Ag ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zX ( Ad , Ae , Ah , Ag ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yN ( Ai , Aj , Ah ) . x ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yR ( Ai , Aj , Ah ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yV ( Ai , Aj , Ah ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yZ ( Ai , Aj , Ah ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zB ( Aj , Ai , Ah ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zF ( Aj , Ai , Ah ) . x ;".split(" ")}]}}]},{type:"textline",b:["return","0.0",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"REFLECTION_PASS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","xY",";"]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",
d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 Al ; float Am , An , Ao ; vec3 Ap , Aq , Ar , As , At ; Aq = normalize ( xY ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:"Ap = textureCube ( u_sky , Aq ) . rgb ;".split(" ")}]}},{type:"elif",c:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",
d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Ap = u_horizon_color ; bu ( Ap ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"textline",b:"Ar = vec3 ( bM , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ar = vec3 ( xY . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["Am","=","0.0",";"]},{type:"condition",a:[{type:"if",
c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"Am = abs ( bM . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Am = ( bM . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"An = acos ( Aq . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",
a:[{type:"textline",b:"Am = abs ( An * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Am = 1.0 - An * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",b:"As = u_horizon_color ; At = u_zenith_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYTEX"],group:{type:"group",a:[{type:"textline",b:"An = 1.0 ; Al = textureCube ( u_sky , Aq ) ; br ( Al . rgb ) ; An = Al . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",
a:[{type:"textline",b:"An = bB ( Al ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MTEX_NEGATIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Al = vec4 ( vec3 ( 1.0 ) - Al . rgb , Al . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"An = 1.0 - An ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"Al = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"An = Al . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ"],group:{type:"group",a:[{type:"textline",b:"As = Ac ( Al . rgb , As , An , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["Ao","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( Ar , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"Ao = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENDOWN"],
group:{type:"group",a:[{type:"textline",b:"else Ao = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"Ao = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"Ao = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( Ao != 0.0 ) At = Ac ( Al . rgb , At , An , Ao ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["WOMAP_BLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"An = dot ( Al . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"textline",b:"Am = Ak ( u_sky_tex_dvar , Am , An , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"Ap = mix ( As , At , Am ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["Ap","=","As",";"]}]}}]},{type:"textline",b:["bu","(","Ap",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bu ( As ) ; bu ( At ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"Ap = mix ( As , At , Am ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["Ap","=","As",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",
{type:"logic_negative_expr",d:1},"REFLECTION_PASS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"br ( Ap ) ; Am = u_camera_eye_frag . y - WATER_LEVEL ; Am = min ( - Am * 0.03 , 0.8 ) ; An = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; As = vec3 ( 0.0 ) ; Al = u_underwater_fog_color_density ; Al . rgb = mix ( Al . rgb , As , min ( - Aq . y + Am , 1.0 ) ) * An ; Am = clamp ( sign ( Aq . y - 0.05 * Am ) , 0.0 , 1.0 ) ; Ap = mix ( Al . rgb , Ap , Am ) ; bu ( Ap ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( Ap , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 xY ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 zY , zZ ; zY = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; zZ = u_sky_vp_inverse * zY ; xY = zZ . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bM = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","zY",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",
b:["0.0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2",
"u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float zY = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 vb ; varying vec3 bC ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",
{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bF ; varying vec3 zZ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","z_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Aa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ab",";"]}]}}]},{type:"include",
file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",b:"vec3 An ( in vec2 Ac , in vec3 Ad , in vec3 Ae , in vec3 Af , out float Ag ) { float Ah , Ai , Aj ; vec2 Ak ; vec3 Al , Am ; Ag = 0.0 ; Al = reflect ( - Ae , Ad ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ak = Ac . xy + Ad . xz * REFL_BUMP / bH ; Ag = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Am = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"Am = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"} else { Am = texture2D ( u_plane_reflection , Ak ) . rgb ; br ( Am ) ; }".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ag = u_mirror_factor ; Am = Af * textureCube ( u_mirrormap , Al ) . rgb ; br ( Am ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ag = u_reflect_factor ; Am = Af * vec3 ( 0.3 , 0.5 , 1.0 ) ; br ( Am ) ;".split(" ")}]}}]},
{type:"textline",b:"Al = normalize ( Al + Ae ) ; Ah = 1.0 - dot ( Ae , Al ) ; Ai = u_fresnel_params [ 3 ] ; Aj = u_fresnel_params [ 2 ] ; Aj = Ai + ( 1.0 - Ai ) * pow ( Ah , Aj ) ; Ag = min ( Ag * Aj , 1.0 ) ; return Am ; }".split(" ")},{type:"include",file:"lighting_nodes.glslf"},{type:"textline",b:"void main ( ) { vec4 Ao ; vec2 Ap , Aq , Ar ; float As , At , Au , Av , Aw , Ax ; vec3 Ay , Az , AA , AB , AC , AD , AE , AF , AG ; mat3 AH ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AH = mat3 ( bF , zZ , bE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"Ay = normalize ( bE ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ay = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","FOAM",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"As = bC . y - WATER_LEVEL ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"Ap = vec2 ( z_ . x , - z_ . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ap = vec2 ( bC . x , - bC . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["Ap","=","bM",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Az = vec3 ( 0.0 ) ; AA = texture2D ( u_normalmap0 , Ap * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Az += AA ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"AB = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],
group:{type:"group",a:[{type:"textline",b:["AB","+=","AA",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AA = texture2D ( u_normalmap0 , Ap * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Az += AA ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",
b:["AB","+=","AA",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AA = texture2D ( u_normalmap0 , Ap * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Az += AA ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["AB","+=","AA",";"]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AA = texture2D ( u_normalmap0 , Ap * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Az += AA ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["AB","+=","AA",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"AB = AH * AB ; if ( ! f ( AB , vec3 ( 0.0 ) ) ) AB = normalize ( AB ) ; AB = mix ( Ay , AB , 0.2 ) ; AB = normalize ( AB ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"Ay = mix ( Ay , normalize ( AH * Az ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Ay = mix ( Ay , normalize ( AH * Az ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"Ay = normalize ( Ay ) ;".split(" ")}]}}]},{type:"textline",b:"Az = normalize ( vb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Aq = bG . xy / bG . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"At = bH * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"Au = u_diffuse_color . a ; Ao = texture2DProj ( u_scene_depth , bG ) ; Av = Z ( Ao ) ; Aw = max ( Av - bH , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"Ar = Aq + Ay . xz * u_refr_bump / bH ; Av = dY ( Av , Ar , Aq ) ; Av = max ( Av - bH , 0.0 ) ; Av = u_view_max_depth / ABSORB * Av ; if ( u_cam_water_depth < 0.0 ) Ax = 0.0 ; else Ax = min ( Au * Av , 1.0 ) ; Av = u_view_max_depth / ABSORB * Aw ; Au = min ( 15.0 * Au * u_view_max_depth * Aw , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"Av = u_view_max_depth / ABSORB * Aw ; if ( u_cam_water_depth > 0.0 ) Au = min ( Au * Av , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"Au *= min ( 5.0 * At , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Au = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"Ax = 1.0 - Au ; Ar = Aq + Ay . xz * u_refr_bump / bH ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"AA = texture2D ( u_refractmap , Ar ) . rgb ; br ( AA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Av = pow ( min ( Aa . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; AC = mix ( u_shallow_water_col , u_diffuse_color . rgb , Av ) ; Av = pow ( min ( Aa . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; AC = mix ( u_shore_water_col , AC , Av ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"AC = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"Aw = max ( 1.0 - u_view_max_depth * Aw , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Aw = 1.0 - Au ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:"As = max ( As / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"AD = normalize ( vec3 ( Aa . r , 0.0 , Aa . g ) ) ; AD = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , AD , 0.8 ) ) ; Av = 1.25 * max ( dot ( AB , AD ) - 0.2 , 0.0 ) ; Av += max ( dot ( AB , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; Aw += Av * ( 1.0 - Aa . b ) ; As *= ( 1.0 - 0.95 * pow ( Aa . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"Aw += As ; Aw = min ( u_foam_factor * Aw , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"Ao = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + Ap * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"As = u_specular_params [ 0 ] ; Ap = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; AB = As * u_specular_color ; AD = u_environment_energy * dS ( Ay ) ; AD = u_ambient * AD ; AD = AD + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"AE = An ( Aq , Ay , Az , AD , As ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AE = An ( vec2 ( 0.0 ) , Ay , Az , AD , As ) ;".split(" ")}]}}]},{type:"textline",b:"AC = u_diffuse_intensity * AC ; xh ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , AC , AB , bC , Ay , Az , Ap , u_diffuse_params , vec4 ( 1.0 ) , 0.0 , vec4 ( 0.0 ) , AF , AG ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"Av = max ( dot ( u_sun_direction , - bE ) + SSS_WIDTH , 0.0 ) * max ( dot ( - Az , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; Av = clamp ( SSS_STRENGTH * Av , 0.0 , 1.0 ) ; AF = mix ( AF , u_shallow_water_col , Av ) ; AF = mix ( AF , u_shore_water_col , Av ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"AF = mix ( AA , AF , Ax ) ;".split(" ")}]}}]},{type:"textline",b:"AF = mix ( AF , AE , As ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"As = mix ( Ao . g , Ao . r , max ( 4.0 * ( Aw - 0.75 ) , 0.0 ) ) ; As = mix ( Ao . b , As , max ( 2.0 * Aw - 1.0 , 0.0 ) ) ; As = mix ( 0.0 , As , Aw ) ; AF = mix ( AF , AD , As ) ;".split(" ")}]}}]},{type:"textline",
b:["AF","+=","AG",";"]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { uU ( AF , At , u_cam_water_depth ) ; } else { va ( AF , At , Az , 1.0 ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"va ( AF , At , Az , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["bu","(","AF",")",";"]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Au = max ( Au , AG . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["Au","+=","As",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"bx ( AF , Au ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",
":","enable"]},{type:"textline",b:"AG = fwidth ( Ab ) ; AG = smoothstep ( vec3 ( 0.0 ) , AG * zY , Ab ) ; As = min ( min ( AG . x , AG . y ) , AG . z ) ; As = clamp ( As , 0.0 , 1.0 ) ; AF = mix ( u_wireframe_edge_color , AF , As ) ; Au = mix ( 1.0 , Au , As ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( AF , Au ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",
b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",
b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"DYNAMIC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH",{type:"logic_negative_expr",d:1},"NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",b:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 vb ; varying vec3 bC ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"varying vec3 bF ; varying vec3 zZ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","z_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Aa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",
{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ab",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 Ag ( in vec2 zY ) { float Ac ; vec4 Ad ; vec2 Ae ; Ae = 0.5 + vec2 ( ( zY . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( zY . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; Ad = texture2D ( u_shore_dist_map , Ae ) ; const vec2 Af = vec2 ( 1.0 / 255.0 , 1.0 ) ; Ac = dot ( Ad . ba , Af ) ; Ae = normalize ( Ad . rg * 2.0 - 1.0 ) ; return vec3 ( Ae , Ac ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void As ( inout vec3 Ah , in float Ai , in vec3 Aj ) { vec2 Ak , Al , Am ; float An , Ao , Ap , Aq , Ar ; An = aU ( DST_NOISE_SCALE_0 * ( Ah . xz + DST_NOISE_FREQ_0 * Ai ) ) * aU ( DST_NOISE_SCALE_1 * ( Ah . zx - DST_NOISE_FREQ_1 * Ai ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"Ao = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; Ap = Aj . b ; Aq = sqrt ( Ap ) ; Ao = max ( Ap , DIR_MIN_SHR_FAC ) * sin ( Aq / Ao + DIR_FREQ * Ai ) ; Ar = max ( aU ( DIR_NOISE_SCALE * ( Ah . xz + DIR_NOISE_FREQ * Ai ) ) , DIR_MIN_NOISE_FAC ) ; Ao *= Ar ; Aq = WAVES_HEIGHT * mix ( Ao , An , max ( Aq , DST_MIN_FAC ) ) ; Ak = Aj . rg ; Ao = WAVES_HOR_FAC * Ao * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - Ap ) , 0.0 ) ; Ak = Ao * Ak ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Aq = WAVES_HEIGHT * An ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"Al = 2.0 * ( Ah . xz - 0.1 * Ai ) ; Am = 1.3 * ( Ah . zx + 0.03 * Ai ) ; An = ay ( 0.5 * Al ) . x + ay ( 0.5 * Am ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Ah . xz += Ak ; An *= Ap ;".split(" ")}]}}]},{type:"textline",b:"Aq += SMALL_WAVES_FAC * An ;".split(" ")}]}}]},{type:"textline",
b:"Ah . y += Aq ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 At , Au ; vec2 Av ; float Aw , Ax , Ay ; vec3 Az , AA , AB , AC ; mat4 AD , AE ; AD = O ( u_view_tsr ) ; AE = O ( u_model_tsr ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) Ab = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ab = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ab = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["Az","=","a_position",";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"Aw = abs ( Az . y ) ; Av = u_camera_eye . xz - mod ( u_camera_eye . xz , Aw ) ; Az . y = WATER_LEVEL ; Az . xz += Av ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["bM","=","a_texcoord",";"]}]}}]},{type:"textline",b:"c AF = rB ( Az , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , AE ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Aa = Ag ( AF . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"Ax = length ( u_wind ) ; Ay = u_time ; Ay *= Ax ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"Aw = Aw ; Az = AF . a + vec3 ( Aw , 0.0 , 0.0 ) ; AA = AF . a + vec3 ( 0.0 , 0.0 , Aw ) ; if ( a_position . y < 0.0 ) { AF . a . y = WATER_LEVEL - 1.0 ; Az . y = AF . a . y ; AA . y = AF . a . y ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"z_ = AF . a ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Az = AF . a + vec3 ( 0.05 , 0.0 , 0.0 ) ; AA = AF . a + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"AB = Ag ( Az . xz ) ; AC = Ag ( AA . xz ) ; As ( Az , Ay , AB ) ; As ( AA , Ay , AC ) ; As ( AF . a , Ay , Aa ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"As ( Az , Ay , vec3 ( 0.0 ) ) ; As ( AA , Ay , vec3 ( 0.0 ) ) ; As ( AF . a , Ay , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"Az = normalize ( Az - AF . a ) ; AA = normalize ( AA - AF . a ) ; bE = normalize ( cross ( AA , Az ) ) ; Ay = dot ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; Ay = clamp ( 0.8 - Ay , 0.0 , 1.0 ) ; bE = mix ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) , Ay ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"AA = a_tangent ; bE = a_normal ;".split(" ")}]}}]},{type:"textline",b:"bF = AA ; zZ = cross ( bE , bF ) ;".split(" ")}]}}]},{type:"textline",b:"bC = AF . a ; vb = u_camera_eye - AF . a ; At = AD * vec4 ( AF . a , 1.0 ) ; Au = u_proj_matrix * At ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"Ay = Au . x ; Aw = Au . y ; Ax = Au . w ; bG . x = ( Ay + Ax ) / 2.0 ; bG . y = ( Aw + Ax ) / 2.0 ; bG . z = Ax ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"bH = - At . z / u_view_max_depth ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","Au",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_NONE",b:["0"]},{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["1"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["2"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["3"]},{type:"define",name:"WM_DEBUG_SPHERES",b:["4"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 Ab ; const float zY = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 Ac = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 Ac = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 Ad = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 Ae = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 Af = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"void main ( ) { float Ag , Ah ; vec3 Ai , Aj ; Ai = vec3 ( 0.0 ) ; Ag = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"Aj = sign ( Ab - vec3 ( 0.02 * zY ) ) ; if ( Aj . x < 0.0 || Aj . y < 0.0 || Aj . z < 0.0 ) { Ai = Ac ; Ag = 1.0 ; } else discard ;".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Aj = sign ( Ab - vec3 ( 0.02 * zY ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( Aj . x < 0.0 || Aj . y < 0.0 || Aj . z < 0.0 ) Ai = u_wireframe_edge_color ; else Ai = Af ; Ag = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( Aj . x < 0.0 || Aj . y < 0.0 || Aj . z < 0.0 ) Ag = 1.0 ; else Ag = 0.0 ; Ai = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( Aj . x < 0.0 || Aj . y < 0.0 || Aj . z < 0.0 ) Ai = u_wireframe_edge_color ; else if ( gl_FrontFacing ) Ai = Ad ; else Ai = Ae ; Ag = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY",1,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"Aj = fwidth ( Ab ) ; Aj = smoothstep ( vec3 ( 0.0 ) , Aj * zY , Ab ) ; Ah = min ( min ( Aj . x , Aj . y ) , Aj . z ) ; Ah = clamp ( Ah , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { Ai = vec3 ( mix ( u_wireframe_edge_color , Af , Ah ) ) ; Ag = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { Ai = u_wireframe_edge_color ; Ag = mix ( 1.0 , 0.0 , Ah ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) Ai = mix ( u_wireframe_edge_color , Ad , Ah ) ; else Ai = mix ( u_wireframe_edge_color , Ae , Ah ) ; Ag = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["bu","(","Ai",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"bx ( Ai , Ag ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( Ai , Ag ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",
";"]}]}}]},{type:"textline",b:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["varying","vec3","Ab",";"]},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec3 zY , Ac , Ad , Ae , Af ; mat4 Ag , Ah , Ai ; Ag = O ( u_view_tsr ) ; Ah = O ( u_model_tsr ) ; if ( a_polyindex == 0.0 ) Ab = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ab = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ab = vec3 ( 0.0 , 0.0 , 1.0 ) ; zY = a_position ; Ac = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"c Aj = rB ( zY , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ah ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"zY = mix ( zY , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"Ad = vec3 ( 0.0 ) ; Ae = vec3 ( 0.0 ) ; sB ( zY , Ad , Ae , Ac ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["Ae","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ae = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c Aj = t_ ( zY , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ae , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , Ag ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"Ad = ( Ah * vec4 ( Ae , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ai = ru ( u_camera_eye , Ad , Ag , Ah ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ai = ro ( u_camera_eye , Ad , Ag ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Af = ( Ah * vec4 ( Ae , 1.0 ) ) . xyz ; Ai = Ai * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , Af ) ;".split(" ")}]}}]},{type:"textline",b:"c Aj = rB ( zY - Ae , Ae , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ai ) ; Aj . b = Ad ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c Aj = rB ( zY , Ae , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ah ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tp ( Aj . a , Aj . b , Ac ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * Ag * vec4 ( Aj . a , 1.0 ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"define",
name:"AA_METHOD_FXAA_LIGHT",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["2"]},{type:"define",name:"AA_QUALITY_LOW",b:["0"]},{type:"define",name:"AA_QUALITY_MEDIUM",b:["1"]},{type:"define",name:"AA_QUALITY_HIGH",b:["2"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",
name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"vec4 Ae ( float zY , float Ac ) { vec2 Ad ; Ad = bM + vec2 ( zY , Ac ) * u_texel_size ; return texture2D ( u_color , Ad ) ; } vec4 Ar ( ) { vec2 Af ; float Ag , Ah , Ai , Aj , Ak , Al ; vec4 Am , An , Ao , Ap , Aq ; Am = Ae ( - 1.0 , - 1.0 ) ; An = Ae ( 1.0 , - 1.0 ) ; Ao = Ae ( - 1.0 , 1.0 ) ; Ap = Ae ( 1.0 , 1.0 ) ; Aq = Ae ( 0.0 , 0.0 ) ; Ag = bB ( Aq ) ; Ah = bB ( Am ) ; Ai = bB ( An ) ; Aj = bB ( Ao ) ; Ak = bB ( Ap ) ; Al = min ( Ag , min ( min ( Ah , Ai ) , min ( Aj , Ak ) ) ) ; Ag = max ( Ag , max ( max ( Ah , Ai ) , max ( Aj , Ak ) ) ) ; Af . x = - ( ( Ah + Ai ) - ( Aj + Ak ) ) ; Af . y = ( ( Ah + Aj ) - ( Ai + Ak ) ) ; Ak = max ( ( Ah + Ai + Aj + Ak ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; Ak = 1.0 / ( min ( abs ( Af . x ) , abs ( Af . y ) ) + Ak ) ; Af = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , Af * Ak ) ) * u_texel_size ; Ap = 0.5 * ( texture2D ( u_color , bM + Af * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , bM + Af * ( 2.0 / 3.0 - 0.5 ) ) ) ; Ao = Ap * 0.5 + 0.25 * ( texture2D ( u_color , bM + Af * - 0.5 ) + texture2D ( u_color , bM + Af * 0.5 ) ) ; Ak = bB ( Ao ) ; if ( ( Ak < Al ) || ( Ak > Ag ) ) return Ap ; else return Ao ; }".split(" ")}]}},
{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_GREEN_AS_LUMA",b:["1"]},{type:"define",name:"FXAA_BLEND4WEB",b:["1"]},{type:"include",file:"fxaa.glslf"},{type:"condition",a:[{type:"if",c:["AA_QUALITY","AA_QUALITY_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PRESET",b:["39"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["1.00"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",
b:["0.063"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["0.0312"]}]}},{type:"elif",c:["AA_QUALITY","AA_QUALITY_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PRESET",b:["20"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["0.65"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["0.0625"]}]}},{type:"elif",c:["AA_QUALITY","AA_QUALITY_LOW",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"define",name:"FXAA_QUALITY_PRESET",b:["12"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["0.50"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["0.0833"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec2 Bi ;".split(" ")},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = Ar ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD",
"AA_METHOD_FXAA_QUALITY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Bi = u_texel_size ; gl_FragColor = Bh ( bM , u_color , Bi , FXAA_QUALITY_SUBPIX , FXAA_QUALITY_EDGE_THRESHOLD , FXAA_QUALITY_EDGE_THRESHOLD_MIN ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 bM ; void main ( ) { vec4 zY ; vec2 Ac , Ad ; Ac = vec2 ( 0.0 , 0.0 ) ; Ad = u_texel_size ; zY = texture2D ( u_color , bM ) ; gl_FragColor = zY * 0.0875447373698 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0858112354248 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0808139781061 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0731235112908 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0635705267419 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0530985673112 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0426125984122 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0328565115809 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * zY , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 bM ; void main ( ) { vec4 zY , Ac ; zY = texture2D ( u_main , bM ) ; Ac = texture2D ( u_bloom , bM ) ; zY = zY ; zY += Ac ; gl_FragColor = vec4 ( zY . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},
{type:"define",name:"PI_4",b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 bM ; void main ( ) { float zY ; vec3 Ac ; vec4 Ad ; Ad = texture2D ( u_color , bM ) ; Ac = Ad . rgb ; if ( u_brightness < 0.0 ) Ac = Ac * ( 1.0 + u_brightness ) ; else Ac = Ac + ( ( 1.0 - Ac ) * u_brightness ) ; Ac = ( Ac - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; Ac *= u_exposure ; zY = bB ( vec4 ( Ac , 0.0 ) ) ; Ac = mix ( vec3 ( zY ) , Ac , u_saturation ) ; gl_FragColor = vec4 ( Ac , Ad . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { gl_FragColor = V ( clamp ( Bo ( u_depth , bM , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]=
{type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { float zY , Ac ; vec4 Ad , Ae ; Ad = texture2D ( u_sharp , bM ) ; if ( u_dof_dist > 0.0 ) { zY = Bo ( u_depth , bM , u_camera_range ) ; zY *= u_view_max_depth ; if ( zY < u_dof_dist ) Ac = ( u_dof_dist - zY ) / u_dof_front ; else Ac = ( zY - u_dof_dist ) / u_dof_rear ; Ac = clamp ( Ac , 0.0 , 1.0 ) ; Ae = texture2D ( u_blurred , bM ) ; gl_FragColor = mix ( Ad , Ae , Ac ) ; } else gl_FragColor = Ad ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 bM ; void main ( ) { float zY ; vec4 Ac , Ad , Ae ; Ac = texture2D ( u_src_color , bM ) ; Ad = texture2D ( u_glow_mask_small , bM ) ; Ae = texture2D ( u_glow_mask_large , bM ) ; gl_FragColor = Ac ; if ( Ae . a != 0.0 ) { zY = u_glow_mask_large_coeff * Ae . a ; zY = clamp ( zY , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Ae . rgb / Ae . a , zY ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , zY ) ; } if ( Ad . a != 0.0 ) { zY = u_glow_mask_small_coeff * Ad . a ; zY = clamp ( zY , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Ad . rgb / Ad . a , zY ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , zY ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float Bp ; varying vec2 Bq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 bM ; varying vec4 Br ; void main ( ) { vec4 Bs ; int Bt ; float Bu , Bv , Bw , Bx ; vec2 By , Bz , BA ; By = ( Br . xy - bM ) ; Bu = length ( By ) ; By = u_radial_blur_step * By / Bu ; Bv = Bu / u_radial_blur_step ; By *= min ( Bv , STEPS_PER_PASS ) / STEPS_PER_PASS ; Bv = max ( Bv , STEPS_PER_PASS ) ; Bz = bM ; Bw = 0.0 ; const int BB = int ( STEPS_PER_PASS ) ; Bt = int ( Bv + 0.5 ) ; for ( int BC = 0 ; BC < BB ; BC += 1 ) { if ( BC <= Bt ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"Bv = Bo ( u_input , Bz , u_camera_range ) ; Bw += max ( ( 1.0 - pow ( Bu , 0.3 ) ) * step ( 0.9 , Bv ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Bs = texture2D ( u_input , Bz ) ; Bw += Z ( Bs ) ;".split(" ")}]}}]},{type:"textline",b:"} Bz += By ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"BA = bM + Bq ; Bx = ay ( vec2 ( 2.5 * ( BA . x ) , 2.5 * ( BA . y ) + 1.0 * u_time ) ) . x + 0.75 * ay ( vec2 ( 5.0 * ( BA . x ) - 0.66 * u_time , 5.0 * ( BA . y ) + 0.66 * u_time ) ) . x + 0.5 * aU ( vec2 ( 7.5 * ( BA . x ) + 0.33 * u_time , 7.5 * ( BA . y ) - 0.33 * u_time ) ) ; Bx *= clamp ( 1.2 - sqrt ( 0.2 * Bu ) , 0.0 , 1.0 ) * Bp ; Bw = max ( Bx , Bw ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = V ( Bw / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float Bp ; varying vec2 Bq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 bM ; varying vec4 Br ; void main ( ) { float zY , Ac ; vec3 Ad ; bM = a_bb_vertex + 0.5 ; Ad = normalize ( u_sun_direction ) ; Br = u_view_proj_matrix * vec4 ( Ad , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { Bp = 1.0 ; Ad = vec3 ( 0.0 , 1.0 , 0.0 ) ; Ad = i ( u_camera_quat , Ad ) ; Ad = normalize ( Ad ) ; zY = dot ( Ad , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; Ac = atan ( Ad . x , Ad . z ) ; Bq = vec2 ( - Ac , acos ( zY ) ) ; } else { Bp = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"Br . xy = 0.5 * ( Br . xy / Br . w + 1.0 ) ; Br += 99999.0 * step ( Br . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 bM ; void main ( ) { float zY ; vec3 Ac ; vec4 Ad ; Ad = texture2D ( u_main , bM ) ; Ac = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; br ( Ad . rgb ) ; zY = Z ( texture2D ( u_god_rays , bM ) ) ; Ac = Ad . rgb + u_god_rays_intensity * vec3 ( zY ) * Ac ; bu ( Ac ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SAFARI_CANVAS_ALPHA_HACK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( Ac , max ( 0.01 , Ad . a ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( Ac , Ad . a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 bM ; void main ( ) { float zY ; vec4 Ac ; Ac = texture2D ( u_input , bM ) ; zY = dot ( Ac . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( zY ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float zY , Ac , Ad , Ae ; Ac = 0.0 ; Ad = 0.025 ; Ae = 0.025 ; for ( int Af = 0 ; Af < 20 ; Af += 1 ) { Ae = 0.025 ; for ( int Ag = 0 ; Ag < 20 ; Ag += 1 ) { zY = max ( texture2D ( u_input , vec2 ( Ad , Ae ) ) . r , 0.01 ) ; Ac += log ( zY ) ; Ae += 0.05 ; } Ad += 0.05 ; } Ac = exp ( Ac / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( Ac ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 bM ; varying float Bs ; void main ( ) { vec4 Bt ; float Bu , Bv ; Bu = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; Bv = texture2D ( u_luminance , bM ) . r ; Bt = texture2D ( u_main , bM ) ; Bu = Bv / Bu ; Bv = u_bloom_edge_lum ; gl_FragColor = Bt * max ( Bu - Bv , 0.0 ) * Bs ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 bM ; varying float Bs ; const vec3 zY = vec3 ( 0.0 , 1.0 , 0.0 ) ; void Aj ( in vec4 Ac , in vec3 Ad , out vec3 Ae ) { float Af , Ag , Ah , Ai ; Af = Ac . w * Ad . x + Ac . y * Ad . z - Ac . z * Ad . y ; Ag = Ac . w * Ad . y + Ac . z * Ad . x - Ac . x * Ad . z ; Ah = Ac . w * Ad . z + Ac . x * Ad . y - Ac . y * Ad . x ; Ai = - Ac . x * Ad . x - Ac . y * Ad . y - Ac . z * Ad . z ; Ae . x = Af * Ac . w - Ai * Ac . x - Ag * Ac . z + Ah * Ac . y ; Ae . y = Ag * Ac . w - Ai * Ac . y - Ah * Ac . x + Af * Ac . z ; Ae . z = Ah * Ac . w - Ai * Ac . z - Af * Ac . y + Ag * Ac . x ; } void main ( ) { vec3 Ak ; bM = 2.0 * a_position ; Aj ( u_camera_quat , zY , Ak ) ; Bs = dot ( - Ak , u_sun_direction ) * u_bloom_key ; Bs *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 bM ; float zY = 0.0042 ; void main ( ) { vec4 Ac , Ad , Ae , Af ; Ac = texture2D ( u_mb_tex_curr , bM ) ; Ad = texture2D ( u_mb_tex_accum , bM ) ; if ( length ( Ac - Ad ) > u_motion_blur_decay_threshold ) { Ae = ( 1.0 - u_motion_blur_exp ) * Ac + u_motion_blur_exp * Ad ; Ae = Ae - Ad ; Af = Ac - Ad ; Ae = min ( max ( abs ( Ae ) , vec4 ( zY ) ) , abs ( Af ) ) * sign ( Ae ) ; gl_FragColor = Ad + Ae ; } else { gl_FragColor = Ac ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 bM ; void main ( ) { vec3 zY ; float Ac ; vec4 Ad , Ae , Af ; Ad = texture2D ( u_outline_src , bM ) ; gl_FragColor = Ad ; if ( u_draw_outline != 0.0 ) { Ae = texture2D ( u_outline_mask , bM ) ; Af = texture2D ( u_outline_mask_blurred , bM ) ; Ac = Af . a - Ae . a ; if ( Ac != 0.0 ) { Ac = smoothstep ( 0.0 , 1.0 , Af . a ) ; if ( Ae . a == 0.0 ) { zY = u_outline_color ; bu ( zY ) ; Ae = vec4 ( clamp ( zY , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( Ad , Ae , Ac ) ; } } } }".split(" ")}]};
a["postprocessing/performance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_color ; varying vec2 bM ; void main ( ) { vec4 zY ; zY = vec4 ( 0.0 ) ; for ( int Ac = 0 ; Ac < 100 ; Ac ++ ) zY += 0.001 * texture2D ( u_color , bM + vec2 ( 0.001 * vec2 ( Ac ) ) ) ; gl_FragColor = zY ; }".split(" ")}]};a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",
b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"define",name:"FLIP_CUBEMAP_COORDS",b:["7"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"uniform int u_tex_number ; uniform vec2 u_delta ;".split(" ")}]}}]},{type:"textline",b:"varying vec2 bM ; void main ( ) { float zY , Ac , Ad , Ae ; vec2 Af , Ag ; vec4 Ah ;".split(" ")},{type:"condition",a:[{type:"if",c:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , bM ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"Ah = texture2D ( u_color , bM ) ; gl_FragColor . rgb = vec3 ( ( Ah . r + Ah . g + Ah . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_BLUR",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Af = vec2 ( 0.0 , 0.0 ) ; Ag = u_texel_size ; Ah = texture2D ( u_color , bM ) ; gl_FragColor = Ah * 0.2270270270 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * 0.1945945946 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * 0.1945945946 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * 0.1216216216 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * 0.1216216216 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * 0.0540540541 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * 0.0540540541 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * 0.0162162162 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Af = vec2 ( 0.0 , 0.0 ) ; Ag = u_texel_size ; Ah = texture2D ( u_color , bM ) ; gl_FragColor = Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.152507 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.141763 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.141763 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.113861 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.113861 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.079019 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.079019 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.047383 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.047383 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.024549 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.024549 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.01099 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.01099 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.00425 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.00425 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.00142 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ag = u_texel_size ; Ah = texture2D ( u_color , bM ) ; gl_FragColor = Ah ; if ( Ah . a == 0.0 ) { Ah = texture2D ( u_color , bM + Ag ) ; if ( Ah . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Ah . a ) ; else { Ah = texture2D ( u_color , bM - Ag ) ; if ( Ah . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Ah . a ) ; } }".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zY = u_delta [ 0 ] ; Ac = u_delta [ 1 ] ; Ad = 1.0 / 3.0 ; Ae = 0.5 ; Ag = vec2 ( Ad , Ae ) ; if ( u_tex_number == 0 ) { Af = bM * Ag + vec2 ( 2.0 * Ad , 0.0 ) ; Af [ 0 ] = min ( Af [ 0 ] , 1.0 - zY ) ; Af [ 1 ] = min ( Af [ 1 ] , 0.5 - Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * Ad - Af [ 0 ] , Af [ 1 ] ) ) ; } else if ( u_tex_number == 1 ) { Af = bM * Ag ; Af [ 0 ] = max ( Af [ 0 ] , zY ) ; Af [ 1 ] = min ( Af [ 1 ] , 0.5 - Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( Ad - Af [ 0 ] , Af [ 1 ] ) ) ; } else if ( u_tex_number == 2 ) { Af = bM * Ag + vec2 ( Ad , Ae ) ; Af [ 0 ] = max ( Af [ 0 ] , Ad + zY ) ; Af [ 0 ] = min ( Af [ 0 ] , 2.0 * Ad - zY ) ; Af [ 1 ] = min ( Af [ 1 ] , 1.0 - Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( Af [ 0 ] , 3.0 * Ae - Af [ 1 ] ) ) ; } else if ( u_tex_number == 3 ) { Af = bM * Ag + vec2 ( 0.0 , Ae ) ; Af [ 0 ] = min ( Af [ 0 ] , Ad - zY ) ; Af [ 1 ] = min ( Af [ 1 ] , 1.0 - Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( Af [ 0 ] , 3.0 * Ae - Af [ 1 ] ) ) ; } else if ( u_tex_number == 4 ) { Af = bM * Ag + vec2 ( Ad , 0.0 ) ; Af [ 0 ] = max ( Af [ 0 ] , Ad + zY ) ; Af [ 0 ] = min ( Af [ 0 ] , 2.0 * Ad - zY ) ; Af [ 1 ] = min ( Af [ 1 ] , 0.5 - Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( 1.0 - Af [ 0 ] , Af [ 1 ] ) ) ; } else { Ag = bM * Ag + vec2 ( 2.0 * Ad , Ae ) ; Ag [ 0 ] = min ( Ag [ 0 ] , 1.0 - zY ) ; Ag [ 1 ] = max ( Ag [ 1 ] , 0.5 + Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * Ad - Ag [ 0 ] , Ag [ 1 ] ) ) ; }".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 bM ; void main ( ) { bM = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",
name:"SMAA_EDGE_DETECTION",b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2},"SMAA_PREDICATION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","Bt",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 Bu ; varying vec4 Bv ; varying vec4 Bw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","Bx",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",
b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",
name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},
{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},
{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 BD ( vec2 By , sampler2D Bz ) { float BA , BB , BC ; BA = texture2D ( Bz , By ) . r ; BB = texture2D ( Bz , Bu . xy ) . r ; BC = texture2D ( Bz , Bu . zw ) . r ; return vec3 ( BA , BB , BC ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 BI ( vec2 BE , sampler2D BF ) { vec2 BG ; vec3 BH ; BH = BD ( BE , BF ) ; BG = abs ( BH . xx - BH . yz ) ; BG = step ( SMAA_PREDICATION_THRESHOLD , BG ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * BG ) ; }".split(" ")}]}}]},
{type:"textline",b:"void BM ( bvec2 BJ , inout vec2 BK , vec2 BL ) { if ( BJ . x ) BK . x = BL . x ; if ( BJ . y ) BK . y = BL . y ; } void BM ( bvec4 BN , inout vec4 BO , vec4 BP ) { BM ( BN . xy , BO . xy , BP . xy ) ; BM ( BN . zw , BO . zw , BP . zw ) ; } vec2 BR ( vec2 BQ ) { return sign ( BQ ) * floor ( abs ( BQ ) + .5 ) ; } vec4 BR ( vec4 BS ) { return sign ( BS ) * floor ( abs ( BS ) + .5 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 Ce ( vec2 BT , sampler2D BU".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","BV"]}]}}]},{type:"textline",b:") { vec4 BW ; float BX , BY , BZ , B_ , Ca ; vec3 Cb ; vec2 Cc , Cd ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"Cc = BI ( BT , BV ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Cc = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"Cb = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; BX = dot ( texture2D ( BU , BT ) . rgb , Cb ) ; BY = dot ( texture2D ( BU , Bu . xy ) . rgb , Cb ) ; BZ = dot ( texture2D ( BU , Bu . zw ) . rgb , Cb ) ; BW . xy = abs ( BX - vec2 ( BY , BZ ) ) ; Cc = step ( Cc , BW . xy ) ; if ( dot ( Cc , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; B_ = dot ( texture2D ( BU , Bv . xy ) . rgb , Cb ) ; Ca = dot ( texture2D ( BU , Bv . zw ) . rgb , Cb ) ; BW . zw = abs ( BX - vec2 ( B_ , Ca ) ) ; Cd = max ( BW . xy , BW . zw ) ; Ca = dot ( texture2D ( BU , Bw . xy ) . rgb , Cb ) ; B_ = dot ( texture2D ( BU , Bw . zw ) . rgb , Cb ) ; BW . zw = abs ( vec2 ( BY , BZ ) - vec2 ( Ca , B_ ) ) ; Cd = max ( Cd . xy , BW . zw ) ; B_ = max ( Cd . x , Cd . y ) ; Cc . xy *= step ( B_ , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * BW . xy ) ; return Cc ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec2 Cg ( vec2 Cf ) { Cf . r = Cf . r * abs ( 5.0 * Cf . r - 5.0 * 0.75 ) ; return BR ( Cf ) ; } vec4 Cg ( vec4 Ch ) { Ch . rb = Ch . rb * abs ( 5.0 * Ch . rb - 5.0 * 0.75 ) ; return BR ( Ch ) ; } vec2 Cp ( sampler2D Ci , vec2 Cj , vec2 Ck , out vec2 Cl ) { vec3 Cm ; vec4 Cn ; Cn = vec4 ( Cj , - 1.0 , 1.0 ) ; Cm = vec3 ( u_texel_size , 1.0 ) ; for ( int Co = 0 ; Co < SMAA_MAX_SEARCH_STEPS_DIAG ; Co ++ ) { if ( Cn . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Cn . w > 0.9 ) { Cn . xyz += Cm * vec3 ( Ck , 1.0 ) ; Cl = texture2D ( Ci , Cn . xy , 0.0 ) . rg ; Cn . w = dot ( Cl , vec2 ( 0.5 , 0.5 ) ) ; } } return Cn . zw ; } vec2 Cx ( sampler2D Cq , vec2 Cr , vec2 Cs , out vec2 Ct ) { vec3 Cu ; vec4 Cv ; Cv = vec4 ( Cr , - 1.0 , 1.0 ) ; Cv . x += 0.25 * u_texel_size . x ; Cu = vec3 ( u_texel_size , 1.0 ) ; for ( int Cw = 0 ; Cw < SMAA_MAX_SEARCH_STEPS_DIAG ; Cw ++ ) { if ( Cv . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Cv . w > 0.9 ) { Cv . xyz = Cu * vec3 ( Cs , 1.0 ) + Cv . xyz ; Ct = texture2D ( Cq , Cv . xy , 0.0 ) . rg ; Ct = Cg ( Ct ) ; Cv . w = dot ( Ct , vec2 ( 0.5 , 0.5 ) ) ; } } return Cv . zw ; } vec2 CD ( sampler2D Cy , vec2 Cz , vec2 CA , float CB ) { vec2 CC ; CC = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * CA + Cz ; CC = SMAA_AREATEX_PIXEL_SIZE * CC + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; CC . x += 0.5 ; CC . y += SMAA_AREATEX_SUBTEX_SIZE * CB ; return texture2D ( Cy , CC , 0.0 ) . rg ; } vec2 CP ( sampler2D CE , sampler2D CF , vec2 CG , vec2 CH , vec4 CI ) { vec4 CJ , CK , CL ; vec2 CM , CN , CO ; CM = vec2 ( 0.0 , 0.0 ) ; if ( CH . r > 0.0 ) { CJ . xz = Cp ( CE , CG , vec2 ( - 1.0 , 1.0 ) , CN ) ; CJ . x += float ( CN . y > 0.9 ) ; } else CJ . xz = vec2 ( 0.0 , 0.0 ) ; CJ . yw = Cp ( CE , CG , vec2 ( 1.0 , - 1.0 ) , CN ) ; if ( CJ . x + CJ . y > 2.0 ) { CK = vec4 ( - CJ . x + 0.25 , CJ . x , CJ . y , - CJ . y - 0.25 ) * u_texel_size . xyxy + CG . xyxy ; CL . xy = texture2D ( CE , CK . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; CL . zw = texture2D ( CE , CK . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; CL . yxwz = Cg ( CL . xyzw ) ; CO = vec2 ( 2.0 , 2.0 ) * CL . xz + CL . yw ; BM ( bvec2 ( step ( 0.9 , CJ . zw ) ) , CO , vec2 ( 0.0 , 0.0 ) ) ; CM += CD ( CF , CJ . xy , CO , CI . z ) ; } CJ . xz = Cx ( CE , CG , vec2 ( - 1 , - 1 ) , CN ) ; if ( texture2D ( CE , CG + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { CJ . yw = Cx ( CE , CG , vec2 ( 1 , 1 ) , CN ) ; CJ . y += float ( CN . y > 0.9 ) ; } else CJ . yw = vec2 ( 0.0 , 0.0 ) ; if ( CJ . x + CJ . y > 2.0 ) { CL = vec4 ( - CJ . x , - CJ . x , CJ . y , CJ . y ) * u_texel_size . xyxy + CG . xyxy ; CK . x = texture2D ( CE , CL . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; CK . y = texture2D ( CE , CL . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; CK . zw = texture2D ( CE , CL . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; CN = vec2 ( 2.0 , 2.0 ) * CK . xz + CK . yw ; BM ( bvec2 ( step ( 0.9 , CJ . zw ) ) , CN , vec2 ( 0 , 0 ) ) ; CM += CD ( CF , CJ . xy , CN , CI . w ) . gr ; } return CM ; }".split(" ")}]}}]},
{type:"textline",b:"float CV ( sampler2D CQ , vec2 CR , float CS ) { vec2 CT , CU ; CT = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; CU = SMAA_SEARCHTEX_SIZE * vec2 ( CS , 1.0 ) ; CT += vec2 ( - 1.0 , 1.0 ) ; CU += vec2 ( 0.5 , - 0.5 ) ; CT *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; CU *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( CQ , CT * CR + CU , 0.0 ) . r ; } float Dc ( sampler2D CW , sampler2D CX , vec2 CY , float CZ ) { float C_ ; vec2 Da ; Da = vec2 ( 0.0 , 1.0 ) ; for ( int Db = 0 ; Db < SMAA_MAX_SEARCH_STEPS ; Db ++ ) { if ( CY . x > CZ && Da . g > 0.8281 && Da . r == 0.0 ) { Da = texture2D ( CW , CY , 0.0 ) . rg ; CY = - vec2 ( 2.0 , 0.0 ) * u_texel_size + CY ; } } C_ = - ( 255.0 / 127.0 ) * CV ( CX , Da , 0.0 ) + 3.25 ; return u_texel_size . x * C_ + CY . x ; } float Dk ( sampler2D Dd , sampler2D De , vec2 Df , float Dg ) { float Dh ; vec2 Di ; Di = vec2 ( 0.0 , 1.0 ) ; for ( int Dj = 0 ; Dj < SMAA_MAX_SEARCH_STEPS ; Dj ++ ) { if ( Df . x < Dg && Di . g > 0.8281 && Di . r == 0.0 ) { Di = texture2D ( Dd , Df , 0.0 ) . rg ; Df = vec2 ( 2.0 , 0.0 ) * u_texel_size + Df ; } } Dh = - ( 255.0 / 127.0 ) * CV ( De , Di , 0.5 ) + 3.25 ; return - u_texel_size . x * Dh + Df . x ; } float Ds ( sampler2D Dl , sampler2D Dm , vec2 Dn , float Do ) { float Dp ; vec2 Dq ; Dq = vec2 ( 1.0 , 0.0 ) ; for ( int Dr = 0 ; Dr < SMAA_MAX_SEARCH_STEPS ; Dr ++ ) { if ( Dn . y > Do && Dq . r > 0.8281 && Dq . g == 0.0 ) { Dq = texture2D ( Dl , Dn , 0.0 ) . rg ; Dn = - vec2 ( 0.0 , 2.0 ) * u_texel_size + Dn ; } } Dp = - ( 255.0 / 127.0 ) * CV ( Dm , Dq . gr , 0.0 ) + 3.25 ; return u_texel_size . y * Dp + Dn . y ; } float DA ( sampler2D Dt , sampler2D Du , vec2 Dv , float Dw ) { float Dx ; vec2 Dy ; Dy = vec2 ( 1.0 , 0.0 ) ; for ( int Dz = 0 ; Dz < SMAA_MAX_SEARCH_STEPS ; Dz ++ ) { if ( Dv . y < Dw && Dy . r > 0.8281 && Dy . g == 0.0 ) { Dy = texture2D ( Dt , Dv , 0.0 ) . rg ; Dv = vec2 ( 0.0 , 2.0 ) * u_texel_size + Dv ; } } Dx = - ( 255.0 / 127.0 ) * CV ( Du , Dy . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * Dx + Dv . y ; } vec2 DH ( sampler2D DB , vec2 DC , float DD , float DE , float DF ) { vec2 DG ; DG = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * BR ( 4.0 * vec2 ( DD , DE ) ) + DC ; DG = SMAA_AREATEX_PIXEL_SIZE * DG + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; DG . y = SMAA_AREATEX_SUBTEX_SIZE * DF + DG . y ; return texture2D ( DB , DG , 0.0 ) . rg ; } void DO ( sampler2D DI , inout vec2 DJ , vec4 DK , vec2 DL ) { vec2 DM , DN ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"DM = step ( DL . xy , DL . yx ) ; DN = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * DM ; DN /= DM . x + DM . y ; DM = vec2 ( 1.0 , 1.0 ) ; DM . x -= DN . x * texture2D ( DI , DK . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; DM . x -= DN . y * texture2D ( DI , DK . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; DM . y -= DN . x * texture2D ( DI , DK . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; DM . y -= DN . y * texture2D ( DI , DK . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; DJ *= clamp ( DM , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void DV ( sampler2D DP , inout vec2 DQ , vec4 DR , vec2 DS ) { vec2 DT , DU ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"DT = step ( DS . xy , DS . yx ) ; DU = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * DT ; DU /= DT . x + DT . y ; DT = vec2 ( 1.0 , 1.0 ) ; DT . x -= DU . x * texture2D ( DP , DR . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; DT . x -= DU . y * texture2D ( DP , DR . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; DT . y -= DU . x * texture2D ( DP , DR . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; DT . y -= DU . y * texture2D ( DP , DR . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; DQ *= clamp ( DT , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Ei ( vec2 DW , vec2 DX , sampler2D DY , sampler2D DZ , sampler2D D_ , vec4 Ea ) { float Eb , Ec ; vec3 Ed ; vec2 Ee , Ef , Eg ; vec4 Eh ; Eh = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; Ee = texture2D ( DY , DW ) . rg ; if ( Ee . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"Eh . rg = CP ( DY , DZ , DW , Ee , Ea ) ; if ( Eh . r == - Eh . g ) {".split(" ")}]}}]},{type:"textline",b:"; Ed . x = Dc ( DY , D_ , Bu . xy , Bw . x ) ; Ed . y = Bv . y ; Ef . x = Ed . x ; Eb = texture2D ( DY , Ed . xy , 0.0 ) . r ; Ed . z = Dk ( DY , D_ , Bu . zw , Bw . y ) ; Ef . y = Ed . z ; Ef = abs ( BR ( Ef / u_texel_size . xx - DX . xx ) ) ; Eg = sqrt ( Ef ) ; Ec = texture2D ( DY , Ed . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; Eh . rg = DH ( DZ , Eg , Eb , Ec , Ea . y ) ; Ed . y = DW . y ; DO ( DY , Eh . rg , Ed . xyzy , Ef ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"} else Ee . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( Ee . r > 0.0 ) { ; Ed . y = Ds ( DY , D_ , Bv . xy , Bw . z ) ; Ed . x = Bu . x ; Ee . x = Ed . y ; Ec = texture2D ( DY , Ed . xy , 0.0 ) . g ; Ed . z = DA ( DY , D_ , Bv . zw , Bw . w ) ; Ee . y = Ed . z ; Ee = abs ( BR ( Ee / u_texel_size . yy - DX . yy ) ) ; Ef = sqrt ( Ee ) ; Eb = texture2D ( DY , Ed . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; Eh . ba = DH ( DZ , Ef , Ec , Eb , Ea . x ) ; Ed . x = DW . x ; DV ( DY , Eh . ba , Ed . xyxz , Ee ) ; } return Eh ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Eu ( vec2 Ej , sampler2D Ek , sampler2D El".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Em"]}]}}]},{type:"textline",b:") { bool En ; vec2 Eo , Ep , Eq ; vec4 Er , Es , Et ; Er . x = texture2D ( El , Bt . xy ) . a ; Er . y = texture2D ( El , Bt . zw ) . g ; Er . wz = texture2D ( El , Ej ) . xz ; if ( dot ( Er , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { Es = texture2D ( Ek , Ej , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"Et = texture2D ( Em , bM ) ; Eo = 2.0 * ag ( Et ) - 1.0 ; Es . a = sqrt ( 2.0 * length ( Eo ) ) ;".split(" ")}]}}]},{type:"textline",b:"return Es ; } else { En = max ( Er . x , Er . z ) > max ( Er . y , Er . w ) ; Es = vec4 ( 0.0 , Er . y , 0.0 , Er . w ) ; Eo = Er . yw ; BM ( bvec4 ( En , En , En , En ) , Es , vec4 ( Er . x , 0.0 , Er . z , 0.0 ) ) ; BM ( bvec2 ( En , En ) , Eo , Er . xz ) ; Eo /= dot ( Eo , vec2 ( 1.0 , 1.0 ) ) ; Es = Es * vec4 ( u_texel_size , - u_texel_size ) + Ej . xyxy ; Er = Eo . x * texture2D ( Ek , Es . xy , 0.0 ) ; Er += Eo . y * texture2D ( Ek , Es . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"Et = texture2D ( Em , Es . xy ) ; Ep = 2.0 * ag ( Et ) - 1.0 ; Eq = Eo . x * Ep ; Et = texture2D ( Em , Es . zw ) ; Ep = 2.0 * ag ( Et ) - 1.0 ; Eq += Eo . y * Ep ; Er . a = sqrt ( 2.0 * length ( Eq ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","Er",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"vec4 EE ( vec2 Ev , sampler2D Ew , sampler2D Ex".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Ey"]}]}}]},{type:"textline",b:") { float Ez ; vec2 EA ; vec4 EB , EC , ED ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"EB = texture2D ( Ey , bM ) ; EA = 2.0 * ag ( EB ) - 1.0 ; EB = texture2D ( Ew , Ev ) ; EC = texture2D ( Ex , Ev - EA ) ; Ez = abs ( EB . a * EB . a - EC . a * EC . a ) / 2.0 ; Ez = 0.5 * clamp ( 1.0 - sqrt ( Ez ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; ED = mix ( EB , EC , Ez ) ; ED . a = 1.0 ; return ED ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"EB = texture2D ( Ew , Ev ) ; EC = texture2D ( Ex , Ev ) ; return mix ( EB , EC , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"void main ( ) { vec4 EF ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EF = vec4 ( Ce ( bM , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",
a:[{type:"textline",b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EF = Ei ( bM , Bx , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EF = Eu ( bM , u_color , u_blend".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EF = vec4 ( EE ( bM , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"EF = texture2D ( u_color , bM ) ;".split(" ")}]}}]},{type:"textline",b:["gl_FragColor","=","EF",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",
b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","Bt",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 Bu ; varying vec4 Bv ; varying vec4 Bw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","Bx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD",
"AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void Ac ( vec2 zY ) { Bu = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + zY . xyxy ; Bv = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + zY . xyxy ; Bw = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + zY . xyxy ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void Af ( vec2 Ad , out vec2 Ae ) { Ae = Ad / u_texel_size ; Bu = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + Ad . xyxy ; Bv = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + Ad . xyxy ; Bw = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( Bu . xz , Bv . yw ) ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void Ah ( vec2 Ag ) { Bt = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Ag . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { bM = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["Ac","(","bM",")",";"]}]}},{type:"elif",c:["SMAA_PASS",
"SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Af ( bM , Bx ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["Ah","(","bM",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",
b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 bM ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float Ac ( in vec2 zY ) { return Bo ( u_depth , zY , u_camera_range ) ; } void main ( ) { float Ad , Ae , Af , Ag , Ah , Ai ; vec3 Aj , Ak , Al , Am ; Aj = texture2D ( u_color , bM ) . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( Aj , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"Ak = normalize ( 2.0 * texture2D ( u_ssao_special_tex , bM * 0.25 / u_texel_size ) . rgb - 1.0 ) ; Ad = Ac ( bM ) ; Ae = Ad * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float An = 8.0 ; const int Ao = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float An = 16.0 ; const int Ao = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float An = 24.0 ; const int Ao = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float An = 32.0 ; const int Ao = 4 ;".split(" ")}]}}]},
{type:"textline",b:"Af = u_ssao_radius_increase * 0.001 ; const float Ap = 1.0 + 2.4 / An ; Ag = 0.0 ; for ( int Aq = 0 ; Aq < Ao ; Aq ++ ) for ( int Ar = - 1 ; Ar <= 1 ; Ar += 2 ) for ( int By = - 1 ; By <= 1 ; By += 2 ) for ( int Bz = - 1 ; Bz <= 1 ; Bz += 2 ) { Al = reflect ( normalize ( vec3 ( Ar , By , Bz ) ) , Ak ) * ( Af *= Ap ) ; Am = vec3 ( bM , Ae ) ; Am += vec3 ( Al . xy , Al . z * Ae * 2.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",
b:"Am . z -= 1.4 * ( Am . z - Ae ) * step ( Ae , Am . z ) ;".split(" ")}]}}]},{type:"textline",b:"Ah = Ac ( Am . xy ) * ( u_camera_range . y - u_camera_range . x ) ; Ai = clamp ( ( Ae - Ah ) / Ah , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"Ag += mix ( 1.0 , Ai , step ( Ah , Am . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ag += mix ( step ( Am . z , Ah ) , 0.5 , Ai ) ;".split(" ")}]}}]},
{type:"textline",b:"} Ag = Ag / An ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"Ag = clamp ( Ag * Ag + 0.6 * Ag , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ag = clamp ( Ag * Ag + Ag , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"Ad = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * Ad ) ; Ag = mix ( 1.0 , Ag , Ad ) ; gl_FragColor = vec4 ( Aj , Ag ) ; }".split(" ")}]};a["postprocessing/ssao_blur.glslf"]=
{type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float Ac ( in vec2 zY ) { return Bo ( u_depth , zY , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec2 Ad , Ae ; float Af , Ag , Ah , Ai , Aj , Ak , Al ; Af = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"Ag = Ac ( bM ) ; Ah = 0.0 ; Ai = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"Ad = vec2 ( - 2.0 ) ; for ( int Am = 0 ; Am < 4 ; ++ Am ) { for ( int An = 0 ; An < 4 ; ++ An ) { Ae = ( Ad + vec2 ( float ( Am ) , float ( An ) ) ) * u_texel_size ; Aj = texture2D ( u_ssao_mask , bM + Ae ) . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"Ak = Ac ( bM + Ae ) ; Al = 1.0 - clamp ( abs ( Ak - Ag ) * Ai , 0.0 , 1.0 ) ; Af += Aj * Al ; Ah += Al ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["Af","+=","Aj",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . rgb , Af / Ah ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . rgb , Af / 16.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/stereo.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 bM ;".split(" ")},{type:"condition",a:[{type:"if",c:["ANAGLYPH",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","int","u_enable_hmd_stereo",";"]},{type:"condition",a:[{type:"if",c:["DISABLE_DISTORTION_CORRECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_distortion_params ; uniform vec4 u_chromatic_aberration_coefs ; void Ak ( vec2 zY , vec2 Ac , sampler2D Ad ) { vec4 Ae ; float Af ; vec2 Ag , Ah , Ai , Aj ; Ag = ( zY - Ac ) * 2.0 ; Af = Ag . x * Ag . x + Ag . y * Ag . y ; Ag = Ag * ( 1.0 + u_distortion_params [ 0 ] * Af + u_distortion_params [ 1 ] * Af * Af ) ; Ag = Ag * 0.5 * u_distortion_params [ 2 ] ; if ( length ( u_chromatic_aberration_coefs ) > 0.0 ) { Ah = Ag * ( 1.0 + u_chromatic_aberration_coefs [ 0 ] + Af * u_chromatic_aberration_coefs [ 1 ] ) + Ac ; Ai = Ag + Ac ; Aj = Ag * ( 1.0 + u_chromatic_aberration_coefs [ 2 ] + Af * u_chromatic_aberration_coefs [ 3 ] ) + Ac ; if ( clamp ( Aj , 0.0 , 1.0 ) != Aj ) { gl_FragColor = vec4 ( 0.0 ) ; } else { Ae = texture2D ( Ad , Ai ) ; gl_FragColor [ 0 ] = texture2D ( Ad , Ah ) . x ; gl_FragColor [ 1 ] = Ae . y ; gl_FragColor [ 2 ] = texture2D ( Ad , Aj ) . z ; gl_FragColor [ 3 ] = Ae . w ; } } else { Ag += Ac ; if ( clamp ( Ag , 0.0 , 1.0 ) != Ag ) { gl_FragColor = vec4 ( 0.0 ) ; } else { gl_FragColor = texture2D ( Ad , Ag ) ; } } }".split(" ")}]}}]}]}}]},
{type:"textline",b:"void main ( ) { vec2 Al , Am ; mat3 An , Ao ; vec3 Ap , Aq ; vec4 Ar , By ;".split(" ")},{type:"condition",a:[{type:"if",c:["ANAGLYPH"],group:{type:"group",a:[{type:"textline",b:"Ar = texture2D ( u_sampler_left , bM ) ; By = texture2D ( u_sampler_right , bM ) ; Ap = vec3 ( Ar [ 0 ] , Ar [ 1 ] , Ar [ 2 ] ) ; br ( Ap ) ; Aq = vec3 ( By [ 0 ] , By [ 1 ] , By [ 2 ] ) ; br ( Aq ) ; An = mat3 ( 0.437 , - 0.062 , - 0.048 , 0.449 , - 0.062 , - 0.050 , 0.164 , - 0.024 , - 0.017 ) ; Ao = mat3 ( - 0.011 , 0.377 , - 0.026 , - 0.032 , 0.761 , - 0.093 , - 0.007 , 0.009 , 1.234 ) ; Aq = clamp ( An * Ap , 0.0 , 1.0 ) + clamp ( Ao * Aq , 0.0 , 1.0 ) ; bu ( Aq ) ; gl_FragColor = vec4 ( Aq , Ar [ 3 ] + By [ 3 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"if ( u_enable_hmd_stereo != 0 ) { if ( bM [ 0 ] < 0.5 ) { Al = vec2 ( 2.0 * bM [ 0 ] , bM [ 1 ] ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_DISTORTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_sampler_left , Al ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Am = vec2 ( 0.5 + u_distortion_params [ 3 ] * 0.5 , 0.5 ) ; Ak ( Al , Am , u_sampler_left ) ;".split(" ")}]}}]},
{type:"textline",b:"} else { Am = vec2 ( 2.0 * ( bM [ 0 ] - 0.5 ) , bM [ 1 ] ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_DISTORTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_sampler_right , Am ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Al = vec2 ( 0.5 - u_distortion_params [ 3 ] * 0.5 , 0.5 ) ; Ak ( Am , Al , u_sampler_right ) ;".split(" ")}]}}]},{type:"textline",b:"} } else { gl_FragColor = texture2D ( u_sampler_left , bM ) ; }".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 bM ; void main ( ) { vec2 zY ; vec4 Ac , Ad ; float Ae ; Ae = texture2D ( u_depth , bM ) . x ; Ac = vec4 ( bM * 2.0 - 1.0 , 2.0 * Ae - 1.0 , 1.0 ) ; Ad = u_view_proj_inverse * Ac ; Ad = Ad / Ad . w ; Ad = u_view_proj_prev * Ad ; Ad /= Ad . w ; zY = ( Ac . xy - Ad . xy ) / 4.0 + 0.5 ; zY = clamp ( zY , 0.0 , 1.0 ) ; gl_FragColor = V ( zY ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float a = 0.0 ; float b = 1.0 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( vec3 d , vec3 e ) { return any ( lessThan ( abs ( d - e ) , vec3 ( EPSILON ) ) ) ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } vec4 k ( in vec4 j ) { return vec4 ( - j . xyz , j . w ) / dot ( j , j ) ; } vec3 p ( vec4 l , vec4 m , vec4 n ) { vec3 o ; o = n . xyz * l . w ; o = i ( m , o ) ; o += l . xyz * n . w ; return o ; } vec3 v ( vec4 q , vec4 r , vec4 s ) { vec4 t ; vec3 u ; u = s . xyz - q . xyz * s . w ; t = k ( r ) ; u = i ( t , u ) ; u /= q . w ; return u ; } mat4 w ( ) { return mat4 ( b , a , a , a , a , b , a , a , a , a , b , a , a , a , a , b ) ; } mat4 y ( float x ) { return mat4 ( b , a , a , a , a , cos ( x ) , sin ( x ) , a , a , - sin ( x ) , cos ( x ) , a , a , a , a , b ) ; } mat4 A ( float z ) { return mat4 ( cos ( z ) , a , - sin ( z ) , a , a , b , a , a , sin ( z ) , a , cos ( z ) , a , a , a , a , b ) ; } mat4 C ( float B ) { return mat4 ( cos ( B ) , sin ( B ) , a , a , - sin ( B ) , cos ( B ) , a , a , a , a , b , a , a , a , a , b ) ; } c E ( in c D ) { return c ( D . a , D . b , normalize ( D . c ) , normalize ( D . d ) , normalize ( D . e ) , D . f ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"vec3 L ( vec4 F ) { vec3 G ; float H , I , J ; H = F . x ; I = F . y ; J = F . w ; G . x = ( H + J ) / 2.0 ; G . y = ( I + J ) / 2.0 ; G . z = J ; return G ; }".split(" ")}]}}]},{type:"textline",b:"mat4 O ( mat3 M ) { mat4 N ; N [ 0 ] [ 0 ] = ( b - ( M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 1 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 2 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 3 ] = a ; N [ 1 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) - M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 1 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 2 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 3 ] = a ; N [ 2 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 1 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 2 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 3 ] = a ; N [ 3 ] [ 0 ] = M [ 0 ] [ 0 ] ; N [ 3 ] [ 1 ] = M [ 0 ] [ 1 ] ; N [ 3 ] [ 2 ] = M [ 0 ] [ 2 ] ; N [ 3 ] [ 3 ] = 1.0 ; return N ; }".split(" ")}]};
a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},
{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"NO_SHADOWS",b:["1"]},{type:"define",name:"SHADOW_CASTING",b:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",b:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",b:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",b:["5"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"SPECULAR_BLINN",b:["4"]},{type:"define",name:"SPECULAR_TOON",
b:["5"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",b:["4"]},{type:"define",name:"DIFFUSE_TOON",b:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]},{type:"define",name:"MIX",b:["0"]},{type:"define",
name:"ADD",b:["1"]},{type:"define",name:"SUBTRACT",b:["2"]},{type:"define",name:"MULTIPLY",b:["3"]},{type:"define",name:"SCREEN",b:["4"]},{type:"define",name:"OVERLAY",b:["5"]},{type:"define",name:"DIFFERENCE",b:["6"]},{type:"define",name:"DIVIDE",b:["7"]},{type:"define",name:"DARKEN",b:["8"]},{type:"define",name:"LIGHTEN",b:["9"]},{type:"define",name:"HUE",b:["10"]},{type:"define",name:"SATURATION",b:["11"]},{type:"define",name:"VALUE",b:["12"]},{type:"define",name:"COLOR",b:["13"]},{type:"define",
name:"SOFT_LIGHT",b:["14"]},{type:"define",name:"LINEAR_LIGHT",b:["15"]},{type:"define",name:"REFL_NONE",b:["0"]},{type:"define",name:"REFL_MIRRORMAP",b:["1"]},{type:"define",name:"REFL_PLANE",b:["2"]},{type:"define",name:"REFL_CUBE",b:["3"]},{type:"define",name:"INVERSE_QUADRATIC",b:["0"]},{type:"define",name:"LINEAR",b:["1"]},{type:"define",name:"QUADRATIC",b:["2"]},{type:"define",name:"HEMI",b:["1"]},{type:"define",name:"SPOT",b:["2"]},{type:"define",name:"POINT",b:["3"]},{type:"define",name:"SUN",
b:["4"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float P = 255.0 ; float Q = 0.0 ; float R = 1.0 ; vec4 V ( const in float S ) { vec4 T , U ; T = vec4 ( P * P * P , P * P , P , R ) ; U = vec4 ( Q , R / P , R / P , R / P ) ; T = fract ( S * T ) ; T -= T . xxyz * U ; return T ; } float Z ( const in vec4 W ) { vec4 X ; float Y ; X = vec4 ( R / ( P * P * P ) , R / ( P * P ) , R / P , R ) ; Y = dot ( W , X ) ; return Y ; } vec4 V ( const in vec2 _ ) { vec4 aa ; vec2 ab , ac ; ab = vec2 ( P , R ) ; ac = vec2 ( Q , R / P ) ; aa = fract ( _ . xxyy * ab . xyxy ) ; aa -= aa . xxzz * ac . xyxy ; if ( _ . r == R ) aa . rg = vec2 ( Q , R ) ; if ( _ . g == R ) aa . ba = vec2 ( Q , R ) ; return aa ; } vec2 ag ( const in vec4 ad ) { vec2 ae , af ; af = vec2 ( R / P , R ) ; ae . r = dot ( ad . rg , af ) ; ae . g = dot ( ad . ba , af ) ; return ae ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float ah = 0.0 ; float ai = 1.0 ; vec4 ak ( vec4 aj ) { return aj - floor ( aj * ( ai / 289.0 ) ) * 289.0 ; } vec3 ak ( vec3 al ) { return al - floor ( al * ( ai / 289.0 ) ) * 289.0 ; } vec2 ak ( vec2 am ) { return am - floor ( am * ( ai / 289.0 ) ) * 289.0 ; } vec4 ao ( vec4 an ) { return an - floor ( an * ( ai / 7.0 ) ) * 7.0 ; } vec4 aq ( vec4 ap ) { return ak ( ( 34.0 * ap + 5.0 ) * ap ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 ay ( vec2 ar ) { vec4 as , at , au , av ; vec2 aw , ax ; aw = ak ( floor ( ar ) ) ; ax = fract ( ar ) ; as = ax . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; at = ax . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; au = aq ( aw . x + vec4 ( ah , ai , ah , ai ) ) ; au = aq ( au + aw . y + vec4 ( ah , ah , ai , ai ) ) ; av = ao ( au ) * K + K2 ; au = ao ( floor ( au * K ) ) * K + K2 ; av = as + JITTER * av ; au = at + JITTER * au ; au = av * av + au * au ;".split(" ")},
{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"textline",b:"au . xy = min ( au . xy , au . zw ) ; au . x = min ( au . x , au . y ) ; return au . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"au . xy = ( au . x < au . y ) ? au . xy : au . yx ; au . xz = ( au . x < au . z ) ? au . xz : au . zx ; au . xw = ( au . x < au . w ) ? au . xw : au . wx ; au . y = min ( au . y , au . z ) ; au . y = min ( au . y , au . w ) ; return sqrt ( au . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aH ( vec2 az , float aA ) { vec4 aB , aC , aD , aE ; vec2 aF , aG ; aF = ak ( floor ( az ) ) ; aG = fract ( az ) ; aB = aG . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; aC = aG . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; aD = aq ( aF . x + vec4 ( ah , ai , ah , ai ) ) ; aD = aq ( aD + aF . y + vec4 ( ah , ah , ai , ai ) ) ; aE = ao ( aD ) * K + K2 ; aD = ao ( floor ( aD * K ) ) * K + K2 ; aE = aB + JITTER * aE ; aD = aC + JITTER * aD ; aC = aE * aE + aD * aD ; aE += aA ; aD += aA ; aB = aE * aE + aD * aD ; aE += aA ; aD += aA ; aD = aE * aE + aD * aD ; aC . xy = min ( aC . xy , aC . zw ) ; aC . x = min ( aC . x , aC . y ) ; aB . xy = min ( aB . xy , aB . zw ) ; aB . x = min ( aB . x , aB . y ) ; aD . xy = min ( aD . xy , aD . zw ) ; aD . x = min ( aD . x , aD . y ) ; return vec3 ( aC . x , aB . x , aD . x ) ; } vec3 aJ ( vec3 aI ) { return ak ( ( ( aI * 34.0 ) + ai ) * aI ) ; } float aU ( vec2 aK ) { vec3 aL , aM , aN , aO ; vec4 aP ; vec2 aQ , aR , aS ; const vec4 aT = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; aQ = floor ( aK + dot ( aK , aT . yy ) ) ; aR = aK - aQ + dot ( aQ , aT . xx ) ; aS = ( aR . x > aR . y ) ? vec2 ( ai , ah ) : vec2 ( ah , ai ) ; aP = aR . xyxy + aT . xxzz ; aP . xy -= aS ; aQ = ak ( aQ ) ; aL = aJ ( aJ ( aQ . y + vec3 ( ah , aS . y , ai ) ) + aQ . x + vec3 ( ah , aS . x , ai ) ) ; aM = max ( 0.5 - vec3 ( dot ( aR , aR ) , dot ( aP . xy , aP . xy ) , dot ( aP . zw , aP . zw ) ) , ah ) ; aM = aM * aM ; aM = aM * aM ; aL = 2.0 * fract ( aL * aT . www ) - ai ; aN = abs ( aL ) - 0.5 ; aO = floor ( aL + 0.5 ) ; aO = aL - aO ; aM *= 1.79284291400159 - 0.85373472095314 * ( aO * aO + aN * aN ) ; aL . x = aO . x * aR . x + aN . x * aR . y ; aL . yz = aO . yz * aP . xz + aN . yz * aP . yw ; return 130.0 * dot ( aM , aL ) ; } vec2 aY ( vec2 aV ) { float aW , aX ; aW = dot ( aV , vec2 ( 12.9898 , 78.233 ) ) ; aX = dot ( aV , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; aW = fract ( sin ( aW ) * 43758.5453 ) * 2.0 - ai ; aX = fract ( sin ( aX ) * 43758.5453 ) * 2.0 - ai ; return vec2 ( aW , aX ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"var",name:"SUN_NUM",b:["0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void bp ( inout vec3 aZ , float a_ , float ba , vec4 bb , vec3 bc , vec3 bd , vec3 be , vec4 bf , vec3 bg , float bh ) { float bi , bj , bk ; vec2 bl , bm ; vec3 bn ; vec4 bo ; if ( bh > CAUSTICS_VIEW_DISTANCE ) return ; bo = bf ; bn = bg + bc ; bn . xz = 10.0 * sin ( 0.1 * bn . xz ) ; bn = bn + 2.0 * cross ( - bo . xyz , cross ( - bo . xyz , bn ) + bo . w * bn ) ; bl = bn . xz ; bn = bd ; bi = max ( dot ( bc , bn ) , 0.0 ) ; bj = 0.025 ; bm = CAUST_SPEED * ba ; bl . s += 0.25 * sin ( dot ( bg + ba , vec3 ( 1.0 ) ) ) ; bl . t += 0.35 * ( - sin ( dot ( bg - ba , vec3 ( - 0.7 ) ) ) ) ; bl . st += 0.15 * cos ( 4.0 * a_ - bm . x ) + 1.5 * sin ( a_ - 0.3 * bm . y ) ; bk = CAUST_SCALE * ( 1.0 + max ( 0.1 * a_ , 0.0 ) ) ; bn = aH ( ( bl / bk ) , bj ) ; bn *= CAUST_BRIGHT ; bn *= bn ; bj = min ( 0.25 * a_ , - a_ ) + 1.0 ; bj = max ( bj , 0.0 ) ; bi = bb [ SUN_NUM ] * bi ; bk = max ( sign ( a_ ) , 0.0 ) ; bi = bi + max ( 0.5 * sign ( - bc . y ) * bk , 0.0 ) ; bi = min ( bi , 1.0 ) ; aZ += be * bn * bj * bi ; }".split(" ")}]};
a["include/color_util.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void br ( inout vec3 bq ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"bq = max ( vec3 ( 0.0 ) , bq ) ; bq = pow ( bq , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void br ( inout float bs ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"bs = pow ( max ( 0.0 , bs ) , 2.2 ) ;".split(" ")}]}}]},{type:"textline",b:"} void bu ( inout vec3 bt ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"bt = max ( vec3 ( 0.0 ) , bt ) ; bt = pow ( bt , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void bx ( inout vec3 bv , in float bw ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"bv = bv * bw ;".split(" ")}]}}]},
{type:"textline",b:"} float bB ( vec4 by ) { float bz ; vec3 bA ; bA = vec3 ( 0.299 , 0.587 , 0.114 ) ; bz = dot ( by . rgb , bA ) ; return bz ; }".split(" ")}]};a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float bN = 0.1 ; const float bO = 0.1 ; const float bP = - 0.01 ; const float bQ = 0.05 ; vec4 bR = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 bS = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 bT = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 bU = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 bV = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 bW = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 bX = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 bY = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool ca ( vec2 bZ , float b_ ) { return all ( lessThanEqual ( bZ , vec2 ( 1.0 + b_ ) ) ) && all ( greaterThanEqual ( bZ , vec2 ( 0.0 - b_ ) ) ) ; } float cj ( float cb , float cc , mat2 cd , vec3 ce , float cf , PRECISION sampler2D cg ) { vec2 ch , ci ; ci . x = cb ; ci . y = cc ; ci = cd * ci ; ch = ce . xy + ci * cf / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"if ( ! ca ( ch , bP ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",b:"return step ( ce . z , texture2D ( cg , ch ) . r ) ; } float cs ( vec3 ck , PRECISION sampler2D cl , float cm ) { mat2 cn ; float co , cp , cq ; co = 0.0 ; ck . z = clamp ( ck . z , 0.0 , 1.0 ) ; cp = aY ( ck . xy ) . x * M_PI ; cq = cos ( cp ) ; cp = sin ( cp ) ; cn = mat2 ( cq , cp , - cp , cq ) ; for ( int cr = 0 ; cr < 4 ; cr ++ ) { co += cj ( bR [ cr ] , bV [ cr ] , cn , ck , cm , cl ) ; co += cj ( bS [ cr ] , bW [ cr ] , cn , ck , cm , cl ) ; co += cj ( bT [ cr ] , bX [ cr ] , cn , ck , cm , cl ) ; co += cj ( bU [ cr ] , bY [ cr ] , cn , ck , cm , cl ) ; } return clamp ( co / 16.0 , 0.0 , 1.0 ) ; } float cH ( vec3 ct , PRECISION sampler2D cu , vec3 cv , PRECISION sampler2D cw , float cx , float cy , float cz ) { mat2 cA ; float cB , cC , cD , cE ; ct . z = clamp ( ct . z , 0.0 , 1.0 ) ; cv . z = clamp ( cv . z , 0.0 , 1.0 ) ; cB = 0.0 ; cC = 0.0 ; cD = aY ( ct . xy ) . x * M_PI ; cE = cos ( cD ) ; cD = sin ( cD ) ; cA = mat2 ( cE , cD , - cD , cE ) ; for ( int cF = 0 ; cF < 4 ; cF ++ ) { cB += cj ( bR [ cF ] , bV [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bS [ cF ] , bW [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bT [ cF ] , bX [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bU [ cF ] , bY [ cF ] , cA , ct , cx , cu ) ; } for ( int cG = 0 ; cG < 4 ; cG ++ ) { cC += cj ( bR [ cG ] , bV [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bS [ cG ] , bW [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bT [ cG ] , bX [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bU [ cG ] , bY [ cG ] , cA , cv , cy , cw ) ; } cB = mix ( cB , cC , cz ) ; cB /= 16.0 ; return clamp ( cB , 0.0 , 1.0 ) ; } float cL ( vec2 cI ) { float cJ , cK ; cJ = min ( cI . x , cI . y ) ; cK = min ( 1.0 - cI . x , 1.0 - cI . y ) ; return min ( cJ , cK ) ; } float cO ( float cM , float cN ) { if ( cN >= 0.0 && cN <= bO ) cM = ( cM - 1.0 ) / bO * cN + 1.0 ; return cM ; } float cZ ( vec3 cP , vec3 cQ , PRECISION sampler2D cR , PRECISION sampler2D cS , float cT , float cU , float cV , float cW ) { float cX , cY ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"cY = cL ( cP . xy ) ; if ( - cW > cV && cY >= 0.0 && cY <= bN && ca ( cQ . xy , 0.0 ) ) { cY = 1.0 - cY / bN ; cX = cH ( cP , cR , cQ , cS , cT , cU , cY ) ; } else".split(" ")}]}}]},{type:"textline",b:"cX = cs ( cP , cR , cT ) ; return cX ; } float dg ( vec3 c_ , PRECISION sampler2D da , float db , float dc , float dd ) { float de , df ; de = cs ( c_ , da , db ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - dd > dc ) { df = cL ( c_ . xy ) ; de = cO ( de , df ) ; }".split(" ")}]}}]},{type:"textline",b:"return de ; } vec4 dr ( float dh ) { vec3 di , dj , dk , dl ; float dm , dn , dp , dq ; dm = 1.0 ; di = bI . xyz / bI . w ; if ( bI . w < 0.0 ) di . z = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"dj = bJ . xyz / bJ . w ; if ( bJ . w < 0.0 ) dj . z = 0.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dk = bK . xyz / bK . w ; if ( bK . w < 0.0 ) dk . z = 0.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dl = bL . xyz / bL . w ; if ( bL . w < 0.0 ) dl . z = 0.0 ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ca ( di . xy , 0.0 ) ) { dm = cZ ( di , dj , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , dh ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"if ( ca ( di . xy , bQ ) ) { dm = dg ( di , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , dh ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( ca ( dj . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"dm = cZ ( dj , dk , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , dh ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"dm = dg ( dj , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , dh ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( ca ( dk . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"dm = cZ ( dk , dl , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , dh ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"dm = dg ( dk , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , dh ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( ca ( dl . xy , 0.0 ) ) dm = dg ( dl , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , dh ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_CAST_LAMPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dn = cs ( dj , u_shadow_map1 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["dn","=","0.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_CAST_LAMPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dp = cs ( dk , u_shadow_map2 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["dp","=","0.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_CAST_LAMPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dq = cs ( dl , u_shadow_map3 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["dq","=","1.0",";"]}]}}]},{type:"textline",b:"return vec4 ( dm , dn , dp , dq ) ; }".split(" ")}]}}]},{type:"textline",b:"vec4 du ( inout vec3 ds ) { vec4 dt ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dt = texture2DProj ( u_shadow_mask , bG ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_CAST_LAMPS",3,{type:"l_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"ds *= dt . a ;".split(" ")}]}}]},{type:"textline",b:["return","dt",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dt = dr ( bD . z ) ; return dt ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec4 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float dB ( in vec3 dv , vec3 dw , float dx , float dy ) { float dz ; vec3 dA ; dA = normalize ( dw + dv ) ; dz = 1.0 - dot ( dv , dA ) ; dz = dy + ( 1.0 - dy ) * pow ( dz , dx ) ; return dz ; } void dP ( inout vec3 dC , vec3 dD , vec3 dE , float dF , mat4 dG ) { vec2 dH , dI ; float dJ , dK , dL ; vec3 dM , dN , dO ; dM = reflect ( - dD , dE ) ; dJ = u_fresnel_params [ 2 ] ; dK = u_fresnel_params [ 3 ] ; dL = 1.0 ; if ( dJ != 0.0 ) dL = dB ( dD , dM , dJ , dK ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dN = textureCube ( u_cube_reflection , dM ) . xyz ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_PASS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"dO = u_refl_plane . xyz * dot ( dE , u_refl_plane . xyz ) ; dO = dE - dO ; dH = ( dG * vec4 ( dO , 0.0 ) ) . xy ; dI = bG . xy / bG . z ; dI += dH * REFL_BUMP ; dN = texture2D ( u_plane_reflection , dI ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"dN = vec3 ( 1.0 ) ; dF = 0.0 ;".split(" ")}]}}]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dN = textureCube ( u_mirrormap , dM ) . xyz ; dF = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",b:"br ( dN . rgb ) ; dC = mix ( dC , dN , dF * dL ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",a:[{type:"textline",b:"vec3 dS ( vec3 dQ ) { float dR ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , dQ ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"dR = 0.5 * dQ . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , dR ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"float dY ( in float dT , inout vec2 dU , in vec2 dV ) { float dW ; vec4 dX ; dX = texture2D ( u_scene_depth , dU ) ; dW = Z ( dX ) ; if ( dW < bH ) { dU = dV ; return dT ; } else { return dW ; } return dT ; }".split(" ")}]}}]},
{type:"textline",b:"vec3 ef ( in vec3 dZ , in vec2 d_ ) { vec3 ea ; float eb ; vec4 ec ; vec2 ed , ee ; ed = dZ . xy / dZ . z ; ee = ed + d_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"ec = texture2DProj ( u_scene_depth , dZ ) ; eb = Z ( ec ) ; dY ( eb , ee , ed ) ;".split(" ")}]}}]},{type:"textline",b:"ea = texture2D ( u_refractmap , ee ) . rgb ; br ( ea ) ; return ea ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]={type:"group",
a:[{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",
b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","eg",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float eh = 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"vec3 el ( in vec3 ei , in float ej ) { vec3 ek ; ek = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"ek = ef ( bG , ei . xz * ej ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ek = texture2D ( u_refractmap , bG . xy / bG . z ) . rgb ; br ( ek ) ;".split(" ")}]}}]},{type:"textline",b:["return","ek",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 eq ( vec3 em ) { float en , eo ; vec4 ep ; ep = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; ep = mix ( vec4 ( em . bg , ep . wz ) , vec4 ( em . gb , ep . xy ) , step ( em . b , em . g ) ) ; ep = mix ( vec4 ( ep . xyw , em . r ) , vec4 ( em . r , ep . yzx ) , step ( ep . x , em . r ) ) ; en = ep . x - min ( ep . w , ep . y ) ; eo = 1.0e-10 ; return vec3 ( abs ( ep . z + ( ep . w - ep . y ) / ( 6.0 * en + eo ) ) , en / ( ep . x + eo ) , ep . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 eu ( vec3 er ) { vec3 es ; vec4 et ; et = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; es = abs ( fract ( vec3 ( er . r , er . r , er . r ) + et . xyz ) * 6.0 - et . www ) ; return er . b * mix ( et . xxx , clamp ( es - et . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , er . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec3 ew ( vec2 ev ) { return vec3 ( ev * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec2 ey ( vec3 ex ) { return vec2 ( ex . xy * eh + vec2 ( eh , eh ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",i:[{type:"node_out",name:"fm",qualifier:["vec3"],e:!0},{type:"node_out",name:"fn",qualifier:["float"],e:!0},{type:"node_out",name:"fo",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fm"],g:[{type:"textline",b:"fm = normalize ( fd . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fn"],g:[{type:"textline",b:"fn = abs ( fd . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fo"],
g:[{type:"textline",b:"fo = length ( fd . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",i:[{type:"node_in",name:"fp",qualifier:["float"],e:!1},{type:"node_in",name:"fq",qualifier:["float"],e:!1},{type:"node_in",name:"fr",qualifier:["float"],e:!1},{type:"node_out",name:"fs",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fs = vec3 ( fp , fq , fr ) ;".split(" ")}]},{type:"node",name:"COMBHSV",i:[{type:"node_in",name:"ft",qualifier:["float"],e:!1},{type:"node_in",name:"fu",qualifier:["float"],
e:!1},{type:"node_in",name:"fv",qualifier:["float"],e:!1},{type:"node_out",name:"fw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fw = eu ( vec3 ( ft , fu , fv ) ) ;".split(" ")}]},{type:"node",name:"EMPTY_UV",i:[{type:"node_out",name:"fx",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fx = vec3 ( - UNITY_VALUE_NODES , - UNITY_VALUE_NODES , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"EMPTY_VC",i:[{type:"node_out",name:"fy",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fy = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_UV",i:[{type:"node_out",name:"fz",qualifier:["vec3"],e:!1},{type:"node_param",name:"ez",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"fz = ew ( ez ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",i:[{type:"node_out",name:"fA",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fA = 2.0 * eg - vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",i:[{type:"node_out",name:"fB",qualifier:["vec3"],e:!1},{type:"node_param",name:"eA",qualifier:["varying",
"vec3"]}],g:[{type:"textline",b:"fB = eA ; br ( fB ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC1",i:[{type:"node_out",name:"fC",qualifier:["float"],e:!1},{type:"node_param",name:"eB",qualifier:["varying","float"]}],g:[{type:"textline",b:"fC = eB ; br ( fC ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC2",i:[{type:"node_out",name:"fD",qualifier:["float"],e:!1},{type:"node_out",name:"fE",qualifier:["float"],e:!1},{type:"node_param",name:"eC",qualifier:["varying","vec2"]}],g:[{type:"textline",
b:"fD = eC [ 0 ] ; fE = eC [ 1 ] ; br ( fD ) ; br ( fE ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",i:[{type:"node_out",name:"fF",qualifier:["float"],e:!1},{type:"node_out",name:"fG",qualifier:["float"],e:!1},{type:"node_out",name:"fH",qualifier:["float"],e:!1},{type:"node_param",name:"eD",qualifier:["varying","vec3"]}],g:[{type:"textline",b:"fF = eD [ 0 ] ; fG = eD [ 1 ] ; fH = eD [ 2 ] ; br ( fF ) ; br ( fG ) ; br ( fH ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",i:[{type:"node_out",
name:"fI",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["fI","=","fg",";"]}]},{type:"node",name:"GEOMETRY_FB",i:[{type:"node_out",name:"fJ",qualifier:["float"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["INVERT_FRONTFACING"],g:[{type:"textline",b:"fJ = ( gl_FrontFacing ) ? ZERO_VALUE_NODES : UNITY_VALUE_NODES ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"fJ = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}]}]},{type:"node",name:"GEOMETRY_VW",i:[{type:"node_out",
name:"fK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["fK","=","eM",";"]}]},{type:"node",name:"GEOMETRY_LO",i:[{type:"node_out",name:"fL",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fL [ 0 ] = fd [ 0 ] ; fL [ 1 ] = fd [ 1 ] ; fL [ 2 ] = fd [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",i:[{type:"node_out",name:"fM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fM = vec3 ( fh . r , - fh . b , fh . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",i:[{type:"node_out",name:"fN",
qualifier:["vec3"],e:!1},{type:"node_out",name:"fO",qualifier:["vec3"],e:!1},{type:"node_out",name:"fP",qualifier:["vec3"],e:!1},{type:"node_out",name:"fQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"fR",qualifier:["vec3"],e:!1},{type:"node_out",name:"fS",qualifier:["vec3"],e:!1},{type:"node_out",name:"fT",qualifier:["float"],e:!1},{type:"node_out",name:"fU",qualifier:["float"],e:!1}],g:[{type:"textline",b:"fN = vec3 ( ZERO_VALUE_NODES ) ; fO = vec3 ( ZERO_VALUE_NODES ) ; fP = vec3 ( ZERO_VALUE_NODES ) ; fQ = vec3 ( ZERO_VALUE_NODES ) ; fR = vec3 ( ZERO_VALUE_NODES ) ; fS = vec3 ( ZERO_VALUE_NODES ) ; fT = ZERO_VALUE_NODES ; fU = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"HUE_SAT",i:[{type:"node_in",name:"fV",qualifier:["float"],e:!1},{type:"node_in",name:"fW",qualifier:["float"],e:!1},{type:"node_in",name:"fX",qualifier:["float"],e:!1},{type:"node_in",name:"fY",qualifier:["float"],e:!1},{type:"node_in",name:"fZ",qualifier:["vec3"],e:!1},{type:"node_out",name:"f_",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fj = eq ( fZ ) ; fj [ 0 ] += ( fV - eh ) ; if ( fj [ 0 ] > UNITY_VALUE_NODES ) fj [ 0 ] -= UNITY_VALUE_NODES ; else if ( fj [ 0 ] < ZERO_VALUE_NODES ) fj [ 0 ] += UNITY_VALUE_NODES ; fj *= vec3 ( UNITY_VALUE_NODES , fW , fX ) ; fj = mix ( vec3 ( UNITY_VALUE_NODES ) , mix ( vec3 ( ZERO_VALUE_NODES ) , fj , step ( vec3 ( ZERO_VALUE_NODES ) , fj ) ) , step ( fj , vec3 ( UNITY_VALUE_NODES ) ) ) ; f_ = mix ( fZ , eu ( fj ) , fY ) ;".split(" ")}]},
{type:"node",name:"INVERT",i:[{type:"node_in",name:"ga",qualifier:["float"],e:!1},{type:"node_in",name:"gb",qualifier:["vec3"],e:!1},{type:"node_out",name:"gc",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"gc = mix ( gb , vec3 ( UNITY_VALUE_NODES ) - gb , ga ) ;".split(" ")}]},{type:"node",name:"LAMP",i:[{type:"node_out",name:"gd",qualifier:["vec3"],e:!0},{type:"node_out",name:"ge",qualifier:["vec3"],e:!1},{type:"node_out",name:"gf",qualifier:["float"],e:!1},{type:"node_out",name:"gg",qualifier:["float"],
e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gd"],g:[{type:"textline",b:"gd = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",b:"fe = u_lamp_light_factors [ LAMP_INDEX ] ; fj = u_lamp_light_directions [ LAMP_INDEX ] ; fk = u_lamp_light_positions [ LAMP_INDEX ] ; eX = fe . z ; if ( eX != - UNITY_VALUE_NODES ) {".split(" ")},{type:"textline",b:"ge = fk - bC ; gf = length ( ge ) ; ge = normalize ( ge ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_gg"],g:[{type:"textline",b:"gg = eX / ( eX + gf * gf ) ; eX = fe . x ; eY = fe . y ; if ( eX > - UNITY_VALUE_NODES ) { eZ = dot ( ge , fj ) ; eZ *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( eZ - eX ) / eY ) ; gg *= eZ ; }".split(" ")}]}]},{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ge"],g:[{type:"textline",b:["ge","=","fj",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gf"],g:[{type:"textline",b:"gf = length ( fk - bC ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gg"],g:[{type:"textline",b:["gg","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",i:[{type:"node_in",name:"gh",qualifier:["vec3"],e:!1},{type:"node_out",name:"gi",qualifier:["vec3"],e:!0},{type:"node_out",name:"gj",qualifier:["float"],e:!0},{type:"node_param",name:"eE",qualifier:["vec3"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gi"],g:[{type:"textline",b:["gi","=","eE",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_gj"],g:[{type:"textline",b:"gj = - dot ( gh , eE ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",i:[{type:"node_in",name:"gk",qualifier:["vec3"],e:!1},{type:"node_out",name:"gl",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"gl = - ( eN * vec4 ( gk , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",i:[{type:"node_in",name:"gm",qualifier:["vec3"],e:!1},{type:"node_in",name:"gn",qualifier:["float"],e:!1},{type:"node_in",name:"go",
qualifier:["float"],e:!1},{type:"node_in",name:"gp",qualifier:["float"],e:!1},{type:"node_in",name:"gq",qualifier:["vec3"],e:!1},{type:"node_in",name:"gr",qualifier:["vec3"],e:!1},{type:"node_out",name:"gs",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gs","=","gm",";"]},{type:"textline",b:"gn ; go ; gp ; gq ; gr ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",i:[{type:"node_in",name:"gt",qualifier:["vec3"],e:!1},{type:"node_in",name:"gu",qualifier:["float"],e:!1},{type:"node_in",name:"gv",
qualifier:["vec3"],e:!1},{type:"node_out",name:"gw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gw","=","gt",";"]},{type:"textline",b:["gu",";","gv",";"]}]},{type:"node",name:"BSDF_GLASS",i:[{type:"node_in",name:"gx",qualifier:["vec3"],e:!1},{type:"node_in",name:"gy",qualifier:["float"],e:!1},{type:"node_in",name:"gz",qualifier:["float"],e:!1},{type:"node_in",name:"gA",qualifier:["vec3"],e:!1},{type:"node_out",name:"gB",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gB","=","gx",";"]},{type:"textline",
b:"gy ; gz ; gA ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",i:[{type:"node_in",name:"gC",qualifier:["vec3"],e:!1},{type:"node_in",name:"gD",qualifier:["float"],e:!1},{type:"node_in",name:"gE",qualifier:["vec3"],e:!1},{type:"node_out",name:"gF",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gF","=","gC",";"]},{type:"textline",b:["gD",";","gE",";"]}]},{type:"node",name:"BSDF_HAIR",i:[{type:"node_in",name:"gG",qualifier:["vec3"],e:!1},{type:"node_in",name:"gH",qualifier:["float"],e:!1},{type:"node_in",
name:"gI",qualifier:["float"],e:!1},{type:"node_in",name:"gJ",qualifier:["float"],e:!1},{type:"node_out",name:"gK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gK","=","gG",";"]},{type:"textline",b:"gH ; gI ; gJ ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",i:[{type:"node_in",name:"gL",qualifier:["vec3"],e:!1},{type:"node_out",name:"gM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gM","=","gL",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",i:[{type:"node_in",name:"gN",qualifier:["vec3"],
e:!1},{type:"node_in",name:"gO",qualifier:["vec3"],e:!1},{type:"node_out",name:"gP",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gP","=","gN",";"]},{type:"textline",b:["gO",";"]}]},{type:"node",name:"BSDF_REFRACTION",i:[{type:"node_in",name:"gQ",qualifier:["vec3"],e:!1},{type:"node_in",name:"gR",qualifier:["float"],e:!1},{type:"node_in",name:"gS",qualifier:["float"],e:!1},{type:"node_in",name:"gT",qualifier:["vec3"],e:!1},{type:"node_out",name:"gU",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"gU [ 0 ] = gU [ 1 ] = gU [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"gQ ; gR ; gS ; gT ;".split(" ")}]},{type:"node",name:"BSDF_TOON",i:[{type:"node_in",name:"gV",qualifier:["vec3"],e:!1},{type:"node_in",name:"gW",qualifier:["float"],e:!1},{type:"node_in",name:"gX",qualifier:["float"],e:!1},{type:"node_in",name:"gY",qualifier:["vec3"],e:!1},{type:"node_out",name:"gZ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gZ","=","gV",";"]},{type:"textline",b:"gW ; gX ; gY ;".split(" ")}]},
{type:"node",name:"BSDF_VELVET",i:[{type:"node_in",name:"g_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ha",qualifier:["float"],e:!1},{type:"node_in",name:"hb",qualifier:["vec3"],e:!1},{type:"node_out",name:"hc",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hc","=","g_",";"]},{type:"textline",b:["ha",";","hb",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",i:[{type:"node_in",name:"hd",qualifier:["vec3"],e:!1},{type:"node_in",name:"he",qualifier:["float"],e:!1},{type:"node_in",name:"hf",
qualifier:["vec3"],e:!1},{type:"node_in",name:"hg",qualifier:["float"],e:!1},{type:"node_in",name:"hh",qualifier:["float"],e:!1},{type:"node_in",name:"hi",qualifier:["vec3"],e:!1},{type:"node_out",name:"hj",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hj [ 0 ] = hj [ 1 ] = hj [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"hd ; hf ; hg ; hh ; hi ; he ;".split(" ")}]},{type:"node",name:"EMISSION",i:[{type:"node_in",name:"hk",qualifier:["vec3"],e:!1},{type:"node_in",name:"hl",qualifier:["float"],
e:!1},{type:"node_out",name:"hm",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hm","=","hk",";"]},{type:"textline",b:["hl",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",i:[{type:"node_in",name:"hn",qualifier:["vec3"],e:!1},{type:"node_out",name:"ho",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ho [ 0 ] = ho [ 1 ] = ho [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hn",";"]}]},{type:"node",name:"HOLDOUT",i:[{type:"node_out",name:"hp",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"hp [ 0 ] = hp [ 1 ] = hp [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",i:[{type:"node_in",name:"hq",qualifier:["vec3"],e:!1},{type:"node_in",name:"hr",qualifier:["float"],e:!1},{type:"node_out",name:"hs",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hs [ 0 ] = hs [ 1 ] = hs [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hq",";","hr",";"]}]},{type:"node",name:"VOLUME_SCATTER",i:[{type:"node_in",name:"ht",qualifier:["vec3"],e:!1},{type:"node_in",
name:"hu",qualifier:["float"],e:!1},{type:"node_in",name:"hv",qualifier:["float"],e:!1},{type:"node_out",name:"hw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hw [ 0 ] = hw [ 1 ] = hw [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"ht ; hu ; hv ;".split(" ")}]},{type:"node",name:"BUMP",i:[{type:"node_in",name:"hx",qualifier:["float"],e:!1},{type:"node_in",name:"hy",qualifier:["float"],e:!1},{type:"node_in",name:"hz",qualifier:["float"],e:!1},{type:"node_in",name:"hA",qualifier:["vec3"],
e:!1},{type:"node_out",name:"hB",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hB","=","hA",";"]},{type:"textline",b:"hx ; hy ; hz ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",i:[{type:"node_in",name:"hC",qualifier:["float"],e:!1},{type:"node_in",name:"hD",qualifier:["vec3"],e:!1},{type:"node_out",name:"hE",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hE","=","hD",";"]},{type:"textline",b:["hC",";"]}]},{type:"node",name:"VECT_TRANSFORM",i:[{type:"node_in",name:"hF",qualifier:["vec3"],
e:!1},{type:"node_out",name:"hG",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hG [ 0 ] = hG [ 1 ] = hG [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hF",";"]}]},{type:"node",name:"BLACKBODY",i:[{type:"node_in",name:"hH",qualifier:["float"],e:!1},{type:"node_out",name:"hI",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hI [ 0 ] = hI [ 1 ] = hI [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hH",";"]}]},{type:"node",name:"WAVELENGTH",i:[{type:"node_in",name:"hJ",qualifier:["float"],
e:!1},{type:"node_out",name:"hK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hK [ 0 ] = hK [ 1 ] = hK [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hJ",";"]}]},{type:"node",name:"SEPXYZ",i:[{type:"node_in",name:"hL",qualifier:["vec3"],e:!1},{type:"node_out",name:"hM",qualifier:["float"],e:!1},{type:"node_out",name:"hN",qualifier:["float"],e:!1},{type:"node_out",name:"hO",qualifier:["float"],e:!1}],g:[{type:"textline",b:"hM = hL [ 0 ] ; hN = hL [ 1 ] ; hO = hL [ 2 ] ;".split(" ")}]},
{type:"node",name:"COMBXYZ",i:[{type:"node_in",name:"hP",qualifier:["float"],e:!1},{type:"node_in",name:"hQ",qualifier:["float"],e:!1},{type:"node_in",name:"hR",qualifier:["float"],e:!1},{type:"node_out",name:"hS",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hS [ 0 ] = hP ; hS [ 1 ] = hQ ; hS [ 2 ] = hR ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",i:[{type:"node_in",name:"hT",qualifier:["vec3"],e:!1},{type:"node_in",name:"hU",qualifier:["float"],e:!1},{type:"node_in",name:"hV",qualifier:["float"],
e:!1},{type:"node_out",name:"hW",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = hU - hV * eh ; hW = max ( ( UNITY_VALUE_NODES + hV ) * hT + eZ , vec3 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",i:[{type:"node_in",name:"hX",qualifier:["float"],e:!1},{type:"node_in",name:"hY",qualifier:["float"],e:!1},{type:"node_out",name:"hZ",qualifier:["float"],e:!1},{type:"node_out",name:"h_",qualifier:["float"],e:!1},{type:"node_out",name:"ia",qualifier:["float"],e:!1}],g:[{type:"textline",
b:"hZ = h_ = ia = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hX",";","hY",";"]}]},{type:"node",name:"TEX_IMAGE",i:[{type:"node_in",name:"ib",qualifier:["vec3"],e:!1},{type:"node_out",name:"ic",qualifier:["vec3"],e:!1},{type:"node_out",name:"id",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ic [ 0 ] = ic [ 1 ] = ic [ 2 ] = ZERO_VALUE_NODES ; id = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["ib",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",i:[{type:"node_in",name:"ie",qualifier:["vec3"],
e:!1},{type:"node_out",name:"ig",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ig [ 0 ] = ig [ 1 ] = ig [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ie",";"]}]},{type:"node",name:"TEX_SKY",i:[{type:"node_in",name:"ih",qualifier:["vec3"],e:!1},{type:"node_out",name:"ii",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ii [ 0 ] = ii [ 1 ] = ii [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ih",";"]}]},{type:"node",name:"TEX_NOISE",i:[{type:"node_in",name:"ij",qualifier:["vec3"],
e:!1},{type:"node_in",name:"ik",qualifier:["float"],e:!1},{type:"node_in",name:"il",qualifier:["float"],e:!1},{type:"node_in",name:"im",qualifier:["float"],e:!1},{type:"node_out",name:"io",qualifier:["vec3"],e:!1},{type:"node_out",name:"ip",qualifier:["float"],e:!1}],g:[{type:"textline",b:"io [ 0 ] = io [ 1 ] = io [ 2 ] = ZERO_VALUE_NODES ; ip = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"ij ; ik ; il ; im ;".split(" ")}]},{type:"node",name:"TEX_WAVE",i:[{type:"node_in",name:"iq",qualifier:["vec3"],
e:!1},{type:"node_in",name:"ir",qualifier:["float"],e:!1},{type:"node_in",name:"is",qualifier:["float"],e:!1},{type:"node_in",name:"it",qualifier:["float"],e:!1},{type:"node_in",name:"iu",qualifier:["float"],e:!1},{type:"node_out",name:"iv",qualifier:["vec3"],e:!1},{type:"node_out",name:"iw",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iv [ 0 ] = iv [ 1 ] = iv [ 2 ] = ZERO_VALUE_NODES ; iw = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iq ; ir ; is ; it ; iu ;".split(" ")}]},{type:"node",
name:"TEX_VORONOI",i:[{type:"node_in",name:"ix",qualifier:["vec3"],e:!1},{type:"node_in",name:"iy",qualifier:["float"],e:!1},{type:"node_out",name:"iz",qualifier:["vec3"],e:!1},{type:"node_out",name:"iA",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iz [ 0 ] = iz [ 1 ] = iz [ 2 ] = ZERO_VALUE_NODES ; iA = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["ix",";","iy",";"]}]},{type:"node",name:"TEX_MUSGRAVE",i:[{type:"node_in",name:"iB",qualifier:["vec3"],e:!1},{type:"node_in",name:"iC",qualifier:["float"],
e:!1},{type:"node_in",name:"iD",qualifier:["float"],e:!1},{type:"node_in",name:"iE",qualifier:["float"],e:!1},{type:"node_in",name:"iF",qualifier:["float"],e:!1},{type:"node_in",name:"iG",qualifier:["float"],e:!1},{type:"node_in",name:"iH",qualifier:["float"],e:!1},{type:"node_out",name:"iI",qualifier:["vec3"],e:!1},{type:"node_out",name:"iJ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iI [ 0 ] = iI [ 1 ] = iI [ 2 ] = ZERO_VALUE_NODES ; iJ = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",
b:"iB ; iC ; iD ; iE ; iF ; iG ; iH ;".split(" ")}]},{type:"node",name:"TEX_GRADIENT",i:[{type:"node_in",name:"iK",qualifier:["vec3"],e:!1},{type:"node_out",name:"iL",qualifier:["vec3"],e:!1},{type:"node_out",name:"iM",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iL [ 0 ] = iL [ 1 ] = iL [ 2 ] = ZERO_VALUE_NODES ; iM = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["iK",";"]}]},{type:"node",name:"TEX_MAGIC",i:[{type:"node_in",name:"iN",qualifier:["vec3"],e:!1},{type:"node_in",name:"iO",
qualifier:["float"],e:!1},{type:"node_in",name:"iP",qualifier:["float"],e:!1},{type:"node_out",name:"iQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"iR",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iQ [ 0 ] = iQ [ 1 ] = iQ [ 2 ] = ZERO_VALUE_NODES ; iR = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iN ; iO ; iP ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",i:[{type:"node_in",name:"iS",qualifier:["vec3"],e:!1},{type:"node_in",name:"iT",qualifier:["vec3"],e:!1},{type:"node_in",name:"iU",
qualifier:["vec3"],e:!1},{type:"node_in",name:"iV",qualifier:["float"],e:!1},{type:"node_out",name:"iW",qualifier:["vec3"],e:!1},{type:"node_out",name:"iX",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iW [ 0 ] = iW [ 1 ] = iW [ 2 ] = ZERO_VALUE_NODES ; iX = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iS ; iT ; iU ; iV ;".split(" ")}]},{type:"node",name:"TEX_BRICK",i:[{type:"node_in",name:"iY",qualifier:["vec3"],e:!1},{type:"node_in",name:"iZ",qualifier:["vec3"],e:!1},{type:"node_in",
name:"i_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ja",qualifier:["vec3"],e:!1},{type:"node_in",name:"jb",qualifier:["float"],e:!1},{type:"node_in",name:"jc",qualifier:["float"],e:!1},{type:"node_in",name:"jd",qualifier:["float"],e:!1},{type:"node_in",name:"je",qualifier:["float"],e:!1},{type:"node_in",name:"jf",qualifier:["float"],e:!1},{type:"node_out",name:"jg",qualifier:["vec3"],e:!1},{type:"node_out",name:"jh",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jg [ 0 ] = jg [ 1 ] = jg [ 2 ] = ZERO_VALUE_NODES ; jh = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",b:"iY ; iZ ; i_ ; ja ; jb ; jc ; jd ; je ; jf ;".split(" ")}]},{type:"node",name:"ADD_SHADER",i:[{type:"node_in",name:"ji",qualifier:["vec3"],e:!1},{type:"node_in",name:"jj",qualifier:["vec3"],e:!1},{type:"node_out",name:"jk",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jk = clamp ( ji + jj , vec3 ( ZERO_VALUE_NODES ) , vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",i:[{type:"node_in",name:"jl",qualifier:["float"],e:!1},{type:"node_in",name:"jm",
qualifier:["vec3"],e:!1},{type:"node_in",name:"jn",qualifier:["vec3"],e:!1},{type:"node_out",name:"jo",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( jl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; jo = eZ * jm + ( UNITY_VALUE_NODES - eZ ) * jn ;".split(" ")}]},{type:"node",name:"UV_MERGED",i:[{type:"node_out",name:"jp",qualifier:["vec3"],e:!1},{type:"node_out",name:"jq",qualifier:["vec3"],e:!1},{type:"node_param",name:"eF",qualifier:["varying","vec2"]}],g:[{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_jp"],g:[{type:"textline",b:"jp = ew ( eF ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jq"],g:[{type:"textline",b:"jq = vec3 ( eF , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",i:[{type:"node_out",name:"jr",qualifier:["vec3"],e:!1},{type:"node_param",name:"eG",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"jr = vec3 ( eG , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",i:[{type:"node_out",name:"js",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:["js","=","fi",";"]}]},{type:"node",name:"TEX_COORD_GE",i:[{type:"node_out",name:"jt",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["jt","=","eg",";"]}]},{type:"node",name:"TEX_COORD_OB",i:[{type:"node_out",name:"ju",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ju [ 0 ] = ju [ 1 ] = ju [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",i:[{type:"node_out",name:"jv",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jv [ 0 ] = fd [ 0 ] ; jv [ 1 ] = fd [ 1 ] ; jv [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"TEX_COORD_WI",i:[{type:"node_out",name:"jw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jw [ 0 ] = jw [ 1 ] = jw [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",i:[{type:"node_out",name:"jx",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jx [ 0 ] = jx [ 1 ] = jx [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",i:[{type:"node_out",name:"jy",qualifier:["vec3"],e:!1},{type:"node_param",name:"eH",qualifier:["varying","vec2"]}],
g:[{type:"textline",b:"jy = vec3 ( eH , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",i:[{type:"node_out",name:"jz",qualifier:["float"],e:!1},{type:"node_out",name:"jA",qualifier:["float"],e:!1},{type:"node_out",name:"jB",qualifier:["float"],e:!1},{type:"node_out",name:"jC",qualifier:["vec3"],e:!1},{type:"node_out",name:"jD",qualifier:["float"],e:!1},{type:"node_out",name:"jE",qualifier:["vec3"],e:!1},{type:"node_out",name:"jF",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"jz = ZERO_VALUE_NODES ; jA = ZERO_VALUE_NODES ; jB = ZERO_VALUE_NODES ; jC = vec3 ( ZERO_VALUE_NODES ) ; jD = ZERO_VALUE_NODES ; jE = jC ; jF = jC ;".split(" ")}]},{type:"node",name:"HAIR_INFO",i:[{type:"node_out",name:"jG",qualifier:["float"],e:!1},{type:"node_out",name:"jH",qualifier:["float"],e:!1},{type:"node_out",name:"jI",qualifier:["float"],e:!1},{type:"node_out",name:"jJ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jG = ZERO_VALUE_NODES ; jH = ZERO_VALUE_NODES ; jI = ZERO_VALUE_NODES ; jJ = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"OBJECT_INFO",i:[{type:"node_out",name:"jK",qualifier:["vec3"],e:!1},{type:"node_out",name:"jL",qualifier:["float"],e:!1},{type:"node_out",name:"jM",qualifier:["float"],e:!1},{type:"node_out",name:"jN",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jL = ZERO_VALUE_NODES ; jM = ZERO_VALUE_NODES ; jN = ZERO_VALUE_NODES ; jK = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",i:[{type:"node_in",name:"jO",qualifier:["float"],e:!1},{type:"node_out",name:"jP",
qualifier:["float"],e:!1}],g:[{type:"textline",b:["jP","=","jO",";"]}]},{type:"node",name:"TANGENT",i:[{type:"node_out",name:"jQ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jQ = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",i:[{type:"node_in",name:"jR",qualifier:["float"],e:!1},{type:"node_in",name:"jS",qualifier:["vec3"],e:!1},{type:"node_out",name:"jT",qualifier:["float"],e:!1},{type:"node_out",name:"jU",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jT = jU = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["jS",";","jR",";"]}]},{type:"node",name:"LIGHT_PATH",i:[{type:"node_out",name:"jV",qualifier:["float"],e:!1},{type:"node_out",name:"jW",qualifier:["float"],e:!1},{type:"node_out",name:"jX",qualifier:["float"],e:!1},{type:"node_out",name:"jY",qualifier:["float"],e:!1},{type:"node_out",name:"jZ",qualifier:["float"],e:!1},{type:"node_out",name:"j_",qualifier:["float"],e:!1},{type:"node_out",name:"ka",qualifier:["float"],e:!1},{type:"node_out",name:"kb",qualifier:["float"],e:!1},{type:"node_out",
name:"kc",qualifier:["float"],e:!1},{type:"node_out",name:"kd",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jV = jW = jX = ZERO_VALUE_NODES ; jY = jZ = j_ = ZERO_VALUE_NODES ; ka = ka = kc = kd = ZERO_VALUE_NODES ; kb = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"ATTRIBUTE",i:[{type:"node_out",name:"ke",qualifier:["vec3"],e:!1},{type:"node_out",name:"kf",qualifier:["vec3"],e:!1},{type:"node_out",name:"kg",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ke = kf = vec3 ( ZERO_VALUE_NODES ) ; kg = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"SCRIPT",i:[],g:[]},{type:"node",name:"CURVE_VEC",i:[{type:"node_in",name:"kh",qualifier:["float"],e:!1},{type:"node_in",name:"ki",qualifier:["vec3"],e:!1},{type:"node_out",name:"kj",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["kj","=","ki",";"]},{type:"textline",b:["kh",";"]}]},{type:"node",name:"CURVE_RGB",i:[{type:"node_in",name:"kk",qualifier:["float"],e:!1},{type:"node_in",name:"kl",qualifier:["vec3"],e:!1},{type:"node_out",name:"km",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:["km","=","kl",";"]},{type:"textline",b:["kk",";"]}]},{type:"node",name:"VALTORGB",i:[{type:"node_in",name:"kn",qualifier:["float"],e:!1},{type:"node_out",name:"ko",qualifier:["vec3"],e:!1},{type:"node_out",name:"kp",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ko [ 0 ] = ko [ 1 ] = ko [ 2 ] = clamp ( kn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; kp = ko [ 0 ] ;".split(" ")}]},{type:"node",name:"MAPPING",i:[{type:"node_in",name:"kq",qualifier:["vec3"],e:!1},{type:"node_out",name:"kr",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:["kr","=","kq",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",g:[{type:"textline",b:"kr = ( MAPPING_TRS_MATRIX * vec4 ( kr , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",g:[{type:"textline",b:"kr = kr * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",g:[{type:"textline",b:"kr = kr + MAPPING_TRANSLATION ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",g:[{type:"textline",b:"kr = max ( kr , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",g:[{type:"textline",b:"kr = min ( kr , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],g:[{type:"textline",b:"kr = normalize ( kr ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",i:[{type:"node_in",name:"ks",qualifier:["float"],
e:!1},{type:"node_in",name:"kt",qualifier:["float"],e:!1},{type:"node_out",name:"ku",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ku = ks + kt ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ku = clamp ( ku , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",i:[{type:"node_in",name:"kv",qualifier:["float"],e:!1},{type:"node_in",name:"kw",qualifier:["float"],e:!1},{type:"node_out",name:"kx",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"kx = kv - kw ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kx = clamp ( kx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",i:[{type:"node_in",name:"ky",qualifier:["float"],e:!1},{type:"node_in",name:"kz",qualifier:["float"],e:!1},{type:"node_out",name:"kA",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kA = ky * kz ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kA = clamp ( kA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",i:[{type:"node_in",name:"kB",qualifier:["float"],e:!1},{type:"node_in",name:"kC",qualifier:["float"],e:!1},{type:"node_out",name:"kD",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kD = ( kC != ZERO_VALUE_NODES ) ? kB / kC : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kD = clamp ( kD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SINE",i:[{type:"node_in",name:"kE",qualifier:["float"],e:!1},{type:"node_in",name:"kF",qualifier:["float"],e:!1},{type:"node_out",name:"kG",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kG = sin ( kE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kG = clamp ( kG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kF",";"]}]},{type:"node",name:"MATH_COSINE",i:[{type:"node_in",name:"kH",
qualifier:["float"],e:!1},{type:"node_in",name:"kI",qualifier:["float"],e:!1},{type:"node_out",name:"kJ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kJ = cos ( kH ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kJ = clamp ( kJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kI",";"]}]},{type:"node",name:"MATH_TANGENT",i:[{type:"node_in",name:"kK",qualifier:["float"],e:!1},{type:"node_in",name:"kL",qualifier:["float"],
e:!1},{type:"node_out",name:"kM",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kM = tan ( kK ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kM = clamp ( kM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kL",";"]}]},{type:"node",name:"MATH_ARCSINE",i:[{type:"node_in",name:"kN",qualifier:["float"],e:!1},{type:"node_in",name:"kO",qualifier:["float"],e:!1},{type:"node_out",name:"kP",qualifier:["float"],e:!1}],
g:[{type:"textline",b:"kP = ( kN <= UNITY_VALUE_NODES && kN >= - UNITY_VALUE_NODES ) ? asin ( kN ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kP = clamp ( kP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kO",";"]}]},{type:"node",name:"MATH_ARCCOSINE",i:[{type:"node_in",name:"kQ",qualifier:["float"],e:!1},{type:"node_in",name:"kR",qualifier:["float"],e:!1},{type:"node_out",name:"kS",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"kS = ( kQ <= UNITY_VALUE_NODES && kQ >= - UNITY_VALUE_NODES ) ? acos ( kQ ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kS = clamp ( kS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kR",";"]}]},{type:"node",name:"MATH_ARCTANGENT",i:[{type:"node_in",name:"kT",qualifier:["float"],e:!1},{type:"node_in",name:"kU",qualifier:["float"],e:!1},{type:"node_out",name:"kV",
qualifier:["float"],e:!1}],g:[{type:"textline",b:"kV = atan ( kT ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kV = clamp ( kV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kU",";"]}]},{type:"node",name:"MATH_POWER",i:[{type:"node_in",name:"kW",qualifier:["float"],e:!1},{type:"node_in",name:"kX",qualifier:["float"],e:!1},{type:"node_out",name:"kY",qualifier:["float"],e:!1}],g:[{type:"textline",b:"if ( kW < ZERO_VALUE_NODES && kX != floor ( kX ) ) kY = ZERO_VALUE_NODES ; else if ( kX == ZERO_VALUE_NODES )".split(" ")},
{type:"textline",b:"kY = UNITY_VALUE_NODES ; else if ( kW < ZERO_VALUE_NODES ) kY = mix ( UNITY_VALUE_NODES , - UNITY_VALUE_NODES , sign ( mod ( - kX , 2.0 ) ) ) * pow ( - kW , kX ) ; else if ( kW == ZERO_VALUE_NODES ) kY = ZERO_VALUE_NODES ; else kY = pow ( kW , kX ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kY = clamp ( kY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",i:[{type:"node_in",
name:"kZ",qualifier:["float"],e:!1},{type:"node_in",name:"k_",qualifier:["float"],e:!1},{type:"node_out",name:"la",qualifier:["float"],e:!1}],g:[{type:"textline",b:"la = ( kZ > ZERO_VALUE_NODES && k_ > ZERO_VALUE_NODES ) ? log2 ( kZ ) / log2 ( k_ ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"la = clamp ( la , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",i:[{type:"node_in",name:"lb",
qualifier:["float"],e:!1},{type:"node_in",name:"lc",qualifier:["float"],e:!1},{type:"node_out",name:"ld",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ld = min ( lb , lc ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ld = clamp ( ld , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MAXIMUM",i:[{type:"node_in",name:"le",qualifier:["float"],e:!1},{type:"node_in",name:"lf",qualifier:["float"],e:!1},{type:"node_out",
name:"lg",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lg = max ( le , lf ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lg = clamp ( lg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",i:[{type:"node_in",name:"lh",qualifier:["float"],e:!1},{type:"node_in",name:"li",qualifier:["float"],e:!1},{type:"node_out",name:"lj",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lj = floor ( lh + eh ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lj = clamp ( lj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["li",";"]}]},{type:"node",name:"MATH_LESS_THAN",i:[{type:"node_in",name:"lk",qualifier:["float"],e:!1},{type:"node_in",name:"ll",qualifier:["float"],e:!1},{type:"node_out",name:"lm",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lm = ( lk < ll ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lm = clamp ( lm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",i:[{type:"node_in",name:"ln",qualifier:["float"],e:!1},{type:"node_in",name:"lo",qualifier:["float"],e:!1},{type:"node_out",name:"lp",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lp = ( ln > lo ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",
b:"lp = clamp ( lp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",i:[{type:"node_in",name:"lq",qualifier:["float"],e:!1},{type:"node_in",name:"lr",qualifier:["float"],e:!1},{type:"node_out",name:"ls",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ls = abs ( lr ) > 0.000001 ? mod ( lq , lr ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ls = clamp ( ls , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ABSOLUTE",i:[{type:"node_in",name:"lt",qualifier:["float"],e:!1},{type:"node_in",name:"lu",qualifier:["float"],e:!1},{type:"node_out",name:"lv",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lv = abs ( lt ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lv = clamp ( lv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["lu",";"]}]},{type:"node",name:"MIX_RGB_MIX",i:[{type:"node_in",name:"lw",
qualifier:["float"],e:!1},{type:"node_in",name:"lx",qualifier:["vec3"],e:!1},{type:"node_in",name:"ly",qualifier:["vec3"],e:!1},{type:"node_out",name:"lz",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lz = mix ( lx , ly , eZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lz = clamp ( lz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",
i:[{type:"node_in",name:"lA",qualifier:["float"],e:!1},{type:"node_in",name:"lB",qualifier:["vec3"],e:!1},{type:"node_in",name:"lC",qualifier:["vec3"],e:!1},{type:"node_out",name:"lD",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lD = mix ( lB , lB + lC , eZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lD = clamp ( lD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",i:[{type:"node_in",name:"lE",qualifier:["float"],e:!1},{type:"node_in",name:"lF",qualifier:["vec3"],e:!1},{type:"node_in",name:"lG",qualifier:["vec3"],e:!1},{type:"node_out",name:"lH",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lH = mix ( lF , lF * lG , eZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lH = clamp ( lH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",i:[{type:"node_in",name:"lI",qualifier:["float"],e:!1},{type:"node_in",name:"lJ",qualifier:["vec3"],e:!1},{type:"node_in",name:"lK",qualifier:["vec3"],e:!1},{type:"node_out",name:"lL",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lL = mix ( lJ , lJ - lK , eZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lL = clamp ( lL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",i:[{type:"node_in",name:"lM",qualifier:["float"],e:!1},{type:"node_in",name:"lN",qualifier:["vec3"],e:!1},{type:"node_in",name:"lO",qualifier:["vec3"],e:!1},{type:"node_out",name:"lP",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; lP = vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( eY ) + eZ * ( vec3 ( UNITY_VALUE_NODES ) - lO ) ) * ( vec3 ( UNITY_VALUE_NODES ) - lN ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lP = clamp ( lP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",i:[{type:"node_in",name:"lQ",qualifier:["float"],e:!1},{type:"node_in",name:"lR",qualifier:["vec3"],e:!1},{type:"node_in",name:"lS",qualifier:["vec3"],e:!1},{type:"node_out",name:"lT",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; lS += step ( lS , vec3 ( ZERO_VALUE_NODES ) ) ; lT = eY * lR + eZ * lR / lS ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lT = clamp ( lT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",i:[{type:"node_in",name:"lU",qualifier:["float"],e:!1},{type:"node_in",name:"lV",qualifier:["vec3"],e:!1},{type:"node_in",name:"lW",qualifier:["vec3"],e:!1},{type:"node_out",name:"lX",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lX = mix ( lV , abs ( lV - lW ) , eZ ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lX = clamp ( lX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",i:[{type:"node_in",name:"lY",qualifier:["float"],e:!1},{type:"node_in",name:"lZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"l_",qualifier:["vec3"],e:!1},{type:"node_out",name:"ma",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ma = min ( lZ . rgb , l_ . rgb * eZ ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"ma = clamp ( ma , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",i:[{type:"node_in",name:"mb",qualifier:["float"],e:!1},{type:"node_in",name:"mc",qualifier:["vec3"],e:!1},{type:"node_in",name:"md",qualifier:["vec3"],e:!1},{type:"node_out",name:"me",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; me = max ( mc . rgb , md . rgb * eZ ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"me = clamp ( me , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",i:[{type:"node_in",name:"mf",qualifier:["float"],e:!1},{type:"node_in",name:"mg",qualifier:["vec3"],e:!1},{type:"node_in",name:"mh",qualifier:["vec3"],e:!1},{type:"node_out",name:"mi",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES - eZ ) ; mi = mix ( mg * ( fk + 2.0 * eZ * mh ) , vec3 ( UNITY_VALUE_NODES ) - ( fk + 2.0 * eZ * ( vec3 ( UNITY_VALUE_NODES ) - mh ) ) * ( vec3 ( UNITY_VALUE_NODES ) - mg ) , step ( eh , mg ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mi = clamp ( mi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",i:[{type:"node_in",name:"mj",qualifier:["float"],e:!1},{type:"node_in",name:"mk",qualifier:["vec3"],e:!1},{type:"node_in",name:"ml",qualifier:["vec3"],e:!1},{type:"node_out",name:"mm",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES ) - eZ * ml ; fj = clamp ( mk / fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mm = mix ( mix ( fj , vec3 ( UNITY_VALUE_NODES ) , step ( fk , vec3 ( ZERO_VALUE_NODES ) ) ) , mk , step ( mk , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mm = clamp ( mm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",i:[{type:"node_in",name:"mn",qualifier:["float"],e:!1},{type:"node_in",name:"mo",qualifier:["vec3"],e:!1},{type:"node_in",name:"mp",qualifier:["vec3"],e:!1},{type:"node_out",name:"mq",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES - eZ ) ; fk = fk + eZ * mp ; fj = clamp ( vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( UNITY_VALUE_NODES ) - mo ) / fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mq = mix ( fj , vec3 ( ZERO_VALUE_NODES ) , step ( fk , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mq = clamp ( mq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",i:[{type:"node_in",name:"mr",qualifier:["float"],e:!1},{type:"node_in",name:"ms",qualifier:["vec3"],e:!1},{type:"node_in",name:"mt",qualifier:["vec3"],e:!1},{type:"node_out",name:"mu",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mu = ms ; fj = eq ( mt ) ; if ( fj . y != ZERO_VALUE_NODES ) { fk = eq ( mu ) ; fk . x = fj . x ; fl = eu ( fk ) ; mu = mix ( mu , fl , eZ ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mu = clamp ( mu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",i:[{type:"node_in",name:"mv",qualifier:["float"],e:!1},{type:"node_in",name:"mw",qualifier:["vec3"],e:!1},{type:"node_in",name:"mx",qualifier:["vec3"],e:!1},{type:"node_out",name:"my",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; my = mw ; fl = eq ( my ) ; if ( fl . y != ZERO_VALUE_NODES ) { fk = eq ( mx ) ; fl . y = eY * fl . y + eZ * fk . y ; my = eu ( fl ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"my = clamp ( my , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",i:[{type:"node_in",name:"mz",qualifier:["float"],e:!1},{type:"node_in",name:"mA",qualifier:["vec3"],e:!1},{type:"node_in",name:"mB",qualifier:["vec3"],e:!1},{type:"node_out",name:"mC",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; fl = eq ( mA ) ; fk = eq ( mB ) ; fl . z = eY * fl . z + eZ * fk . z ; mC = eu ( fl ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mC = clamp ( mC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",i:[{type:"node_in",name:"mD",qualifier:["float"],e:!1},{type:"node_in",name:"mE",qualifier:["vec3"],e:!1},{type:"node_in",name:"mF",qualifier:["vec3"],e:!1},{type:"node_out",name:"mG",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mG = mE ; fk = eq ( mF ) ; if ( fk . y != ZERO_VALUE_NODES ) { fl = eq ( mG ) ; fl . x = fk . x ; fl . y = fk . y ; fj = eu ( fl ) ; mG = mix ( mG , fj , eZ ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mG = clamp ( mG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",i:[{type:"node_in",name:"mH",qualifier:["float"],e:!1},{type:"node_in",name:"mI",qualifier:["vec3"],e:!1},{type:"node_in",name:"mJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"mK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; fj = mJ + mI - mJ * mI ; mK = mI * ( vec3 ( eY ) + vec3 ( eZ ) * ( ( vec3 ( UNITY_VALUE_NODES ) - mI ) * mJ + fj ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mK = clamp ( mK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",i:[{type:"node_in",name:"mL",qualifier:["float"],e:!1},{type:"node_in",name:"mM",qualifier:["vec3"],e:!1},{type:"node_in",name:"mN",qualifier:["vec3"],e:!1},{type:"node_out",name:"mO",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mO = mM + eZ * ( 2.0 * mN - vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mO = clamp ( mO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",i:[{type:"node_in",name:"mP",qualifier:["vec3"],e:!1},{type:"node_in",name:"mQ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"eO = mP ; eS = mQ ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",i:[{type:"node_in",name:"mR",qualifier:["vec3"],e:!1},{type:"node_in",name:"mS",qualifier:["vec3"],e:!1},{type:"node_in",
name:"mT",qualifier:["float"],e:!1},{type:"node_in",name:"mU",qualifier:["vec3"],e:!0},{type:"node_in",name:"mV",qualifier:["float"],e:!0},{type:"node_out",name:"mW",qualifier:["vec3"],e:!1},{type:"node_out",name:"mX",qualifier:["vec3"],e:!1},{type:"node_out",name:"mY",qualifier:["vec3"],e:!1},{type:"node_out",name:"mZ",qualifier:["vec3"],e:!1},{type:"node_out",name:"m_",qualifier:["vec3"],e:!1},{type:"node_out",name:"na",qualifier:["vec2"],e:!1},{type:"node_out",name:"nb",qualifier:["vec2"],e:!1},
{type:"node_out",name:"nc",qualifier:["vec4"],e:!1},{type:"node_param",name:"eI",qualifier:["const","vec2"]},{type:"node_param",name:"eJ",qualifier:["const","vec3"]}],g:[{type:"textline",b:"mY = clamp ( mR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"mZ = eJ [ 0 ] * clamp ( mS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],g:[{type:"textline",b:"m_ = normalize ( mU ) ;".split(" ")}]},{type:"node_else",
g:[{type:"textline",b:["m_","=","fi",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1}],g:[{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT"],g:[{type:"textline",b:"mW = mV * mY ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"mW = eV * mY ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:["mY","*=","mT",";"]}]}]},{type:"textline",b:"mX = eW * u_environment_energy * dS ( m_ ) ; nc = du ( mY ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],g:[{type:"textline",b:"na = vec2 ( eI [ 0 ] , eI [ 1 ] ) ;".split(" ")},{type:"textline",b:"nb = vec2 ( eJ [ 1 ] , eJ [ 2 ] ) ;".split(" ")}]}]},{type:"textline",b:["eR","=","nc",";"]}]},{type:"node_else",g:[{type:"textline",b:"mW = vec3 ( ZERO_VALUE_NODES ) ; mX = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATERIAL_END",i:[{type:"node_in",name:"nd",qualifier:["vec4"],e:!1},{type:"node_in",name:"ne",
qualifier:["vec3"],e:!1},{type:"node_in",name:"nf",qualifier:["vec3"],e:!1},{type:"node_in",name:"ng",qualifier:["float"],e:!0},{type:"node_in",name:"nh",qualifier:["float"],e:!0},{type:"node_in",name:"ni",qualifier:["float"],e:!0},{type:"node_out",name:"nj",qualifier:["vec3"],e:!0},{type:"node_out",name:"nk",qualifier:["float"],e:!0},{type:"node_out",name:"nl",qualifier:["vec3"],e:!0},{type:"node_out",name:"nm",qualifier:["vec3"],e:!0},{type:"node_out",name:"nn",qualifier:["vec3"],e:!0},{type:"node_param",
name:"eK",qualifier:["float"]},{type:"node_param",name:"eL",qualifier:["float"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nj"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:"nj = nd . rgb ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"nj = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",d:2},{type:"logical_and_expr",
d:2}],g:[{type:"node_condition",a:[{type:"node_if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],g:[{type:"textline",b:"dP ( nj , eM , nf , ng , eN ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"dP ( nj , eM , nf , ng , mat4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:["nj","+=","ne",";"]}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nl"],g:[{type:"textline",b:["nl",
"=","nf",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nm"],g:[{type:"textline",b:"nm = nd . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nn"],g:[{type:"textline",b:["nn","=","ne",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nk"],g:[{type:"textline",b:"nk = clamp ( ni , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
g:[{type:"textline",b:"eZ = max ( max ( ne . r , ne . g ) , ne . b ) * nh ; nk = clamp ( ni * ( UNITY_VALUE_NODES - eZ ) + eZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nk"],g:[{type:"textline",b:"nk = clamp ( eK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"eZ = max ( max ( ne . r , ne . g ) , ne . b ) * eL ; nk = eK * ( UNITY_VALUE_NODES - eZ ) + eZ ;".split(" ")}]}]}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:["eP","=","ne",";"]}]},{type:"node_else",g:[{type:"textline",b:"eP = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["eQ","=","nf",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",i:[{type:"node_in",name:"no",qualifier:["vec3"],e:!1},{type:"node_in",name:"np",qualifier:["vec3"],e:!1},{type:"node_in",name:"nq",qualifier:["vec3"],e:!1},{type:"node_out",name:"nr",qualifier:["vec4"],e:!1},{type:"node_out",
name:"ns",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"nr = vec4 ( no + nq * np , ZERO_VALUE_NODES ) ; ns = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",i:[{type:"node_in",name:"nt",qualifier:["vec4"],e:!1},{type:"node_out",name:"nu",qualifier:["vec3"],e:!1},{type:"node_out",name:"nv",qualifier:["vec2"],e:!1},{type:"node_out",name:"nw",qualifier:["vec3"],e:!1},{type:"node_out",name:"nx",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nv = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","HEMI",{type:"equal_expr",d:2}],g:[{type:"textline",b:["nx","=","eh",";"]}]},{type:"node_else",g:[{type:"textline",b:["nx","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",b:"nw = u_light_color_intensities [ LAMP_IND ] ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_SHADOW_MAP_IND",1,{type:"negative_expr",d:1},{type:"non_equal_expr",d:2}],g:[{type:"textline",b:"nw *= nt [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2},"LAMP_TYPE","POINT",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],g:[{type:"textline",b:"fj = u_light_positions [ LAMP_IND ] ; nu = fj - fh ;".split(" ")},{type:"textline",b:"eZ = length ( nu ) ; nw *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + eZ * eZ ) ; nu = normalize ( nu ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2}],g:[{type:"textline",b:"fj = u_light_directions [ LAMP_IND ] ; eZ = dot ( nu , fj ) ; eZ *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( eZ - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; nw *= eZ ;".split(" ")}]}]}]},
{type:"node_else",g:[{type:"textline",b:"nu = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",i:[{type:"node_in",name:"ny",qualifier:["vec3"],e:!1},{type:"node_in",name:"nz",qualifier:["vec2"],e:!1},{type:"node_in",name:"nA",qualifier:["vec3"],e:!1},{type:"node_in",name:"nB",qualifier:["float"],e:!1},{type:"node_in",name:"nC",qualifier:["vec2"],e:!1},{type:"node_out",name:"nD",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nD = ZERO_VALUE_NODES ; if ( nz . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nB ) * dot ( nA , ny ) + nB ; if ( nC [ 0 ] == ZERO_VALUE_NODES ) { nD = UNITY_VALUE_NODES ; } else { eZ = UNITY_VALUE_NODES + abs ( eZ ) ; eZ = nC [ 1 ] + ( UNITY_VALUE_NODES - nC [ 1 ] ) * pow ( eZ , nC [ 0 ] ) ; nD = clamp ( eZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } nD = max ( nD , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",i:[{type:"node_in",name:"nE",qualifier:["vec3"],e:!1},{type:"node_in",name:"nF",qualifier:["vec2"],e:!1},{type:"node_in",name:"nG",qualifier:["vec3"],e:!1},{type:"node_in",name:"nH",qualifier:["float"],e:!1},{type:"node_out",name:"nI",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nI = ZERO_VALUE_NODES ; if ( nF . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nH ) * dot ( nG , nE ) + nH ; nI = max ( eZ , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",i:[{type:"node_in",name:"nJ",qualifier:["vec3"],e:!1},{type:"node_in",name:"nK",qualifier:["vec2"],e:!1},{type:"node_in",name:"nL",qualifier:["vec3"],e:!1},{type:"node_in",name:"nM",qualifier:["float"],e:!1},{type:"node_in",name:"nN",qualifier:["vec2"],e:!1},{type:"node_out",name:"nO",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nO = ZERO_VALUE_NODES ; if ( nK . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nM ) * dot ( nL , nJ ) + nM ; if ( nN [ 0 ] > ZERO_VALUE_NODES ) { eY = max ( dot ( nL , eM ) , ZERO_VALUE_NODES ) ; eX = nN [ 0 ] * nN [ 0 ] ; e_ = UNITY_VALUE_NODES - eh * ( eX / ( eX + 0.33 ) ) ; fj = nJ - eZ * nL ; fl = eM - eY * nL ;".split(" ")},
{type:"textline",b:"if ( length ( fj ) == ZERO_VALUE_NODES || length ( fl ) == ZERO_VALUE_NODES || abs ( eZ ) > UNITY_VALUE_NODES || abs ( eY ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",b:"nO = eZ * e_ ; else { fa = acos ( eZ ) ; eY = acos ( eY ) ; fj = normalize ( fj ) ; fl = normalize ( fl ) ; fb = max ( fa , eY ) ; fc = min ( fa , eY ) ; fc *= 0.95 ; eY = max ( dot ( fj , fl ) , ZERO_VALUE_NODES ) ; eX = 0.45 * ( eX / ( eX + 0.09 ) ) ; nO = eZ * ( e_ + ( eX * eY * sin ( fb ) * tan ( fc ) ) ) ; } } else nO = eZ ; nO = max ( nO , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",i:[{type:"node_in",name:"nP",qualifier:["vec3"],e:!1},{type:"node_in",name:"nQ",qualifier:["vec2"],e:!1},{type:"node_in",name:"nR",qualifier:["vec3"],e:!1},{type:"node_in",name:"nS",qualifier:["float"],e:!1},{type:"node_in",name:"nT",qualifier:["vec2"],e:!1},{type:"node_out",name:"nU",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nU = ZERO_VALUE_NODES ; if ( nQ . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nS ) * dot ( nR , nP ) + nS ; fc = max ( dot ( nR , eM ) , ZERO_VALUE_NODES ) ; if ( nT [ 0 ] <= UNITY_VALUE_NODES ) nU = eZ * pow ( max ( fc * eZ , 0.1 ) , nT [ 0 ] - UNITY_VALUE_NODES ) ; else nU = eZ * pow ( 1.0001 - fc , nT [ 0 ] - UNITY_VALUE_NODES ) ; nU = max ( nU , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",i:[{type:"node_in",name:"nV",qualifier:["vec3"],e:!1},{type:"node_in",name:"nW",qualifier:["vec2"],e:!1},{type:"node_in",name:"nX",qualifier:["vec3"],e:!1},{type:"node_in",name:"nY",qualifier:["float"],e:!1},{type:"node_in",name:"nZ",qualifier:["vec2"],e:!1},{type:"node_out",name:"n_",qualifier:["float"],e:!1}],g:[{type:"textline",b:"n_ = ZERO_VALUE_NODES ; if ( nW . r != ZERO_VALUE_NODES ) { fc = ( UNITY_VALUE_NODES - nY ) * dot ( nX , nV ) + nY ; fc = acos ( fc ) ; if ( fc < nZ [ 0 ] ) n_ = UNITY_VALUE_NODES ; else if ( fc > ( nZ [ 0 ] + nZ [ 1 ] ) || nZ [ 1 ] == ZERO_VALUE_NODES ) n_ = ZERO_VALUE_NODES ; else n_ = UNITY_VALUE_NODES - ( ( fc - nZ [ 0 ] ) / nZ [ 1 ] ) ; n_ = max ( n_ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",i:[{type:"node_in",name:"oa",qualifier:["vec3"],e:!1},{type:"node_in",name:"ob",qualifier:["vec2"],e:!1},{type:"node_in",name:"oc",qualifier:["vec3"],e:!1},{type:"node_in",name:"od",qualifier:["float"],e:!1},{type:"node_in",name:"oe",qualifier:["vec2"],e:!1},{type:"node_out",name:"of",qualifier:["float"],e:!1}],g:[{type:"textline",b:"of = ZERO_VALUE_NODES ; if ( ob . g == UNITY_VALUE_NODES ) { fl = normalize ( oa + eM ) ; of = ( UNITY_VALUE_NODES - od ) * max ( dot ( oc , fl ) , ZERO_VALUE_NODES ) + od ; of = pow ( of , oe [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",i:[{type:"node_in",name:"og",qualifier:["vec3"],e:!1},{type:"node_in",name:"oh",qualifier:["vec2"],e:!1},{type:"node_in",name:"oi",qualifier:["vec3"],e:!1},{type:"node_in",name:"oj",qualifier:["vec2"],e:!1},{type:"node_out",name:"ok",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ok = ZERO_VALUE_NODES ; if ( oh . g == UNITY_VALUE_NODES ) { fl = normalize ( og + eM ) ; fc = max ( dot ( oi , fl ) , 0.001 ) ;".split(" ")},{type:"textline",b:"eZ = max ( dot ( oi , eM ) , 0.01 ) ; fb = max ( dot ( oi , og ) , 0.01 ) ; fc = tan ( acos ( fc ) ) ; eY = max ( oj [ 0 ] , 0.001 ) ; ok = fb * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * eY * eY ) ) * ( exp ( - ( fc * fc ) / ( eY * eY ) ) / ( sqrt ( eZ * fb ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",i:[{type:"node_in",name:"ol",qualifier:["vec3"],e:!1},{type:"node_in",name:"om",qualifier:["vec2"],e:!1},{type:"node_in",name:"on",qualifier:["vec3"],e:!1},{type:"node_in",name:"oo",qualifier:["vec2"],e:!1},{type:"node_out",name:"op",qualifier:["float"],e:!1}],g:[{type:"textline",b:"op = ZERO_VALUE_NODES ; if ( om . g == UNITY_VALUE_NODES ) { fl = normalize ( ol + eM ) ; fb = acos ( dot ( fl , on ) ) ; if ( fb < oo [ 0 ] ) op = UNITY_VALUE_NODES ; else if ( fb >= oo [ 0 ] + oo [ 1 ] || oo [ 1 ] == ZERO_VALUE_NODES ) op = ZERO_VALUE_NODES ; else op = UNITY_VALUE_NODES - ( fb - oo [ 0 ] ) / oo [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",i:[{type:"node_in",name:"oq",qualifier:["vec3"],e:!1},{type:"node_in",name:"or",qualifier:["vec2"],e:!1},{type:"node_in",name:"os",qualifier:["vec3"],e:!1},{type:"node_in",name:"ot",qualifier:["float"],e:!1},{type:"node_in",name:"ou",qualifier:["vec2"],e:!1},{type:"node_out",name:"ov",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ov = ZERO_VALUE_NODES ; if ( or . g == UNITY_VALUE_NODES ) { if ( ou [ 0 ] < UNITY_VALUE_NODES || ou [ 1 ] == ZERO_VALUE_NODES ) ov = ZERO_VALUE_NODES ; else { if ( ou [ 1 ] < 100.0 ) ou [ 1 ] = sqrt ( UNITY_VALUE_NODES / ou [ 1 ] ) ; else ou [ 1 ] = 10.0 / ou [ 1 ] ; fl = normalize ( eM + oq ) ; fb = ( UNITY_VALUE_NODES - ot ) * max ( dot ( os , fl ) , ZERO_VALUE_NODES ) + ot ; if ( fb < ZERO_VALUE_NODES ) ov = ZERO_VALUE_NODES ; else { eZ = max ( dot ( os , eM ) , 0.01 ) ; eY = dot ( os , oq ) ; if ( eY <= 0.01 ) ov = ZERO_VALUE_NODES ; else { fc = max ( dot ( eM , fl ) , 0.01 ) ; eX = UNITY_VALUE_NODES ; eZ = ( 2.0 * fb * eZ ) / fc ; eY = ( 2.0 * fb * eY ) / fc ; eY = min ( min ( eX , eZ ) , eY ) ; eZ = sqrt ( pow ( ou [ 0 ] , 2.0 ) + pow ( fc , 2.0 ) - UNITY_VALUE_NODES ) ; fc = pow ( eZ - fc , 2.0 ) / pow ( eZ + fc , 2.0 ) * ( UNITY_VALUE_NODES + pow ( fc * ( eZ + fc ) - UNITY_VALUE_NODES , 2.0 ) / pow ( fc * ( eZ - fc ) + UNITY_VALUE_NODES , 2.0 ) ) ; fb = acos ( fb ) ; ov = max ( fc * eY * exp ( - pow ( fb , 2.0 ) / ( 2.0 * pow ( ou [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",i:[{type:"node_in",name:"ow",qualifier:["vec4"],e:!1},{type:"node_in",name:"ox",qualifier:["vec3"],e:!1},{type:"node_in",name:"oy",qualifier:["float"],e:!1},{type:"node_in",name:"oz",qualifier:["float"],e:!1},{type:"node_in",name:"oA",qualifier:["vec3"],e:!1},{type:"node_in",name:"oB",qualifier:["vec3"],e:!1},{type:"node_in",name:"oC",qualifier:["vec4"],e:!1},{type:"node_in",name:"oD",qualifier:["vec3"],e:!1},{type:"node_in",name:"oE",qualifier:["vec3"],e:!1},{type:"node_in",
name:"oF",qualifier:["vec3"],e:!1},{type:"node_in",name:"oG",qualifier:["float"],e:!1},{type:"node_out",name:"oH",qualifier:["vec4"],e:!1},{type:"node_out",name:"oI",qualifier:["vec3"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_NODE_B4W_TRANSLUCENCY"],g:[{type:"textline",b:"if ( dot ( oA , oB ) * dot ( eM , oB ) < ZERO_VALUE_NODES ) { fb = oC . x ; eY = oC . y ; fc = oC . z ; eZ = oC . w ;".split(" ")},{type:"textline",b:"eX = clamp ( abs ( dot ( oA , oB ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; e_ = clamp ( dot ( eM , - oA ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = pow ( e_ , eY ) ;".split(" ")},
{type:"textline",b:"oH = ow + oG * vec4 ( oF * eX * pow ( oD , vec3 ( fb ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"oH += fc * mix ( vec4 ( oD , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , eZ ) * oG * vec4 ( oF * eX * vec3 ( eY ) , UNITY_VALUE_NODES ) ; oI = ox ; } else {".split(" ")},{type:"textline",b:"oI = ox + oF * oE * oz ; oH = ow + vec4 ( oF * oD * oy , oz ) ; }".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"oI = ox + oF * oE * oz ; oH = ow + vec4 ( oF * oD * oy , oz ) ;".split(" ")}]}]}]},
{type:"node",name:"RGB",i:[{type:"node_out",name:"oJ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"oJ = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",i:[{type:"node_in",name:"oK",qualifier:["vec3"],e:!1},{type:"node_out",name:"oL",qualifier:["float"],e:!1}],g:[{type:"textline",b:"oL = dot ( oK , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",i:[{type:"node_in",name:"oM",qualifier:["vec3"],e:!1},{type:"node_out",name:"oN",qualifier:["float"],e:!0},
{type:"node_out",name:"oO",qualifier:["float"],e:!0},{type:"node_out",name:"oP",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oN"],g:[{type:"textline",b:"oN = oM . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oO"],g:[{type:"textline",b:"oO = oM . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oP"],g:[{type:"textline",b:"oP = oM . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",i:[{type:"node_in",name:"oQ",
qualifier:["vec3"],e:!1},{type:"node_out",name:"oR",qualifier:["float"],e:!0},{type:"node_out",name:"oS",qualifier:["float"],e:!0},{type:"node_out",name:"oT",qualifier:["float"],e:!0}],g:[{type:"textline",b:"fl = eq ( oQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oR"],g:[{type:"textline",b:"oR = fl . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oS"],g:[{type:"textline",b:"oS = fl . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_oT"],g:[{type:"textline",b:"oT = fl . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",i:[{type:"node_in",name:"oU",qualifier:["float"],e:!1},{type:"node_in",name:"oV",qualifier:["float"],e:!1},{type:"node_in",name:"oW",qualifier:["float"],e:!1},{type:"node_out",name:"oX",qualifier:["float"],e:!1}],g:[{type:"textline",b:"oX = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( oU - oW ) * oV ) ) ;".split(" ")}]},{type:"node",name:"GAMMA",i:[{type:"node_in",name:"oY",qualifier:["vec3"],
e:!1},{type:"node_in",name:"oZ",qualifier:["float"],e:!1},{type:"node_out",name:"o_",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"o_ = oY ; if ( o_ . x > ZERO_VALUE_NODES ) o_ . x = pow ( oY . x , oZ ) ; if ( o_ . y > ZERO_VALUE_NODES ) o_ . y = pow ( oY . y , oZ ) ; if ( o_ . z > ZERO_VALUE_NODES ) o_ . z = pow ( oY . z , oZ ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",i:[{type:"node_in",name:"pa",qualifier:["vec3"],e:!1},{type:"node_out",name:"pb",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"pb = max ( vec3 ( ZERO_VALUE_NODES ) , pa ) ; pb = pow ( pb , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",i:[{type:"node_in",name:"pc",qualifier:["vec3"],e:!1},{type:"node_out",name:"pd",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"pd = max ( vec3 ( ZERO_VALUE_NODES ) , pc ) ; pd = pow ( pd , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",i:[{type:"node_out",name:"pe",qualifier:["vec3"],e:!1},{type:"node_out",name:"pf",qualifier:["vec3"],
e:!1},{type:"node_out",name:"pg",qualifier:["float"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pg"],g:[{type:"textline",b:"pe [ 2 ] = pe [ 1 ] = pe [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pg"],g:[{type:"textline",b:"pf [ 2 ] = pf [ 1 ] = pf [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pg"],g:[{type:"textline",b:["pg","=","ZERO_VALUE_NODES",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",
i:[{type:"node_in",name:"ph",qualifier:["vec3"],e:!1},{type:"node_out",name:"pi",qualifier:["vec3"],e:!0},{type:"node_out",name:"pj",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],g:[{type:"textline",b:"fe = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , ph ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pi"],g:[{type:"textline",b:"pi = fe . xyz ; br ( pi ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_pj"],g:[{type:"textline",b:"pj = fe . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",i:[{type:"node_in",name:"pk",qualifier:["vec3"],e:!0},{type:"node_in",name:"pl",qualifier:["vec3"],e:!0},{type:"node_in",name:"pm",qualifier:["vec3"],e:!0},{type:"node_in",name:"pn",qualifier:["vec3"],e:!0},{type:"node_out",name:"po",qualifier:["vec3"],e:!0},{type:"node_out",name:"pp",qualifier:["float"],e:!0},{type:"node_out",name:"pq",qualifier:["vec3"],e:!0},{type:"node_out",
name:"pr",qualifier:["float"],e:!0},{type:"node_out",name:"ps",qualifier:["vec3"],e:!0},{type:"node_out",name:"pt",qualifier:["float"],e:!0},{type:"node_out",name:"pu",qualifier:["vec3"],e:!0},{type:"node_out",name:"pv",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pk ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_po"],g:[{type:"textline",
b:"po = fe . xyz ; br ( po ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pp"],g:[{type:"textline",b:"pp = fe . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pl ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pq"],g:[{type:"textline",b:"pq = fe . xyz ; br ( pq ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pr"],
g:[{type:"textline",b:"pr = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pm ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ps"],g:[{type:"textline",b:"ps = fe . xyz ; br ( ps ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pt"],g:[{type:"textline",b:"pt = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],
g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pn ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pu"],g:[{type:"textline",b:"pu = fe . xyz ; br ( pu ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pv"],g:[{type:"textline",b:"pv = fe . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",i:[{type:"node_in",name:"pw",qualifier:["vec3"],e:!0},{type:"node_in",name:"px",qualifier:["vec3"],e:!0},{type:"node_in",
name:"py",qualifier:["vec3"],e:!0},{type:"node_in",name:"pz",qualifier:["vec3"],e:!0},{type:"node_out",name:"pA",qualifier:["vec3"],e:!0},{type:"node_out",name:"pB",qualifier:["float"],e:!0},{type:"node_out",name:"pC",qualifier:["vec3"],e:!0},{type:"node_out",name:"pD",qualifier:["float"],e:!0},{type:"node_out",name:"pE",qualifier:["vec3"],e:!0},{type:"node_out",name:"pF",qualifier:["float"],e:!0},{type:"node_out",name:"pG",qualifier:["vec3"],e:!0},{type:"node_out",name:"pH",qualifier:["float"],e:!0},
{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pw ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pA"],g:[{type:"textline",b:"pA = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pB"],g:[{type:"textline",b:"pB = fe . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],
g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( px ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pC"],g:[{type:"textline",b:"pC = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pD"],g:[{type:"textline",b:"pD = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( py ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pE"],g:[{type:"textline",b:"pE = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pF"],g:[{type:"textline",b:"pF = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pz ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pG"],g:[{type:"textline",b:"pG = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pH"],g:[{type:"textline",b:"pH = fe . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",i:[{type:"node_out",name:"pI",qualifier:["float"],e:!1}],g:[{type:"textline",b:"pI = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",i:[{type:"node_in",name:"pJ",qualifier:["vec3"],e:!1},{type:"node_in",name:"pK",qualifier:["vec3"],e:!1},{type:"node_out",name:"pL",qualifier:["vec3"],e:!1},{type:"node_out",name:"pM",qualifier:["float"],
e:!0}],g:[{type:"textline",b:"pL = pJ + pK ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pM"],g:[{type:"textline",b:"pM = ( abs ( pL [ 0 ] ) + abs ( pL [ 1 ] ) + abs ( pL [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",i:[{type:"node_in",name:"pN",qualifier:["vec3"],e:!1},{type:"node_in",name:"pO",qualifier:["vec3"],e:!1},{type:"node_out",name:"pP",qualifier:["vec3"],e:!1},{type:"node_out",name:"pQ",qualifier:["float"],e:!0}],g:[{type:"textline",
b:"pP = pN - pO ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pQ"],g:[{type:"textline",b:"pQ = ( abs ( pP [ 0 ] ) + abs ( pP [ 1 ] ) + abs ( pP [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",i:[{type:"node_in",name:"pR",qualifier:["vec3"],e:!1},{type:"node_in",name:"pS",qualifier:["vec3"],e:!1},{type:"node_out",name:"pT",qualifier:["vec3"],e:!1},{type:"node_out",name:"pU",qualifier:["float"],e:!0}],g:[{type:"textline",b:"pT = pR + pS ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pU"],g:[{type:"textline",b:"pU = length ( pT ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pT"],g:[{type:"textline",b:"pT = normalize ( pT ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",i:[{type:"node_in",name:"pV",qualifier:["vec3"],e:!1},{type:"node_in",name:"pW",qualifier:["vec3"],e:!1},{type:"node_out",name:"pX",qualifier:["vec3"],e:!1},{type:"node_out",name:"pY",qualifier:["float"],e:!0}],g:[{type:"textline",
b:"pX = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pY"],g:[{type:"textline",b:"pY = dot ( pV , pW ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",i:[{type:"node_in",name:"pZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"p_",qualifier:["vec3"],e:!1},{type:"node_out",name:"qa",qualifier:["vec3"],e:!1},{type:"node_out",name:"qb",qualifier:["float"],e:!0}],g:[{type:"textline",b:"qa = cross ( pZ , p_ ) ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_qb"],g:[{type:"textline",b:"qb = length ( qa ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",i:[{type:"node_in",name:"qc",qualifier:["vec3"],e:!1},{type:"node_in",name:"qd",qualifier:["vec3"],e:!1},{type:"node_out",name:"qe",qualifier:["vec3"],e:!1},{type:"node_out",name:"qf",qualifier:["float"],e:!0}],g:[{type:"textline",b:"qe = normalize ( qc ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qf"],g:[{type:"textline",b:"qf = length ( qc ) ;".split(" ")}]}]},
{type:"textline",b:["qd",";"]}]},{type:"node",name:"B4W_REFLECT",i:[{type:"node_in",name:"qg",qualifier:["vec3"],e:!1},{type:"node_in",name:"qh",qualifier:["vec3"],e:!1},{type:"node_out",name:"qi",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qi = reflect ( - qg , qh ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",i:[{type:"node_in",name:"qj",qualifier:["vec3"],e:!1},{type:"node_in",name:"qk",qualifier:["float"],e:!1},{type:"node_in",name:"ql",qualifier:["const","float"],e:!1},{type:"node_in",
name:"qm",qualifier:["const","float"],e:!1},{type:"node_out",name:"qn",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"eY = length ( fd ) ; if ( eY < qm ) { eT = ey ( qj ) ; eY = clamp ( eh * ( qm - eY ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = qk * eY ;".split(" ")},{type:"textline",b:"fl = normalize ( eM * ff ) ;".split(" ")},{type:"textline",b:"eX = UNITY_VALUE_NODES / ql ;".split(" ")},{type:"textline",
b:"eU = fl . xy * eY / ( ql * fl . z ) ; eY = UNITY_VALUE_NODES ; eZ = texture2D ( node_B4W_PARALLAX_var_texture , eT ) . a ;".split(" ")},{type:"textline",b:"for ( float qo = 1.0 ; qo <= ql ; qo ++ ) { if ( eZ < eY ) { eY -= eX ; eT -= eU ; eZ = texture2D ( node_B4W_PARALLAX_var_texture , eT ) . a ; } }".split(" ")},{type:"textline",b:"eU = eT + eU ; eX = texture2D ( node_B4W_PARALLAX_var_texture , eU ) . a - ( eY + eX ) ; eY = eZ - eY ; eX = eY / ( eY - eX ) ;".split(" ")},{type:"textline",b:"eT = eX * eU + ( UNITY_VALUE_NODES - eX ) * eT ; qn = ew ( eT ) ; } else qn = qj ;".split(" ")}]},
{type:"node",name:"B4W_CLAMP",i:[{type:"node_in",name:"qp",qualifier:["vec3"],e:!1},{type:"node_out",name:"qq",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qq = clamp ( qp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",i:[{type:"node_in",name:"qr",qualifier:["vec3"],e:!1},{type:"node_in",name:"qs",qualifier:["float"],e:!1},{type:"node_out",name:"qt",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qt = el ( qr , qs ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",i:[{type:"node_in",name:"qu",qualifier:["float"],e:!1},{type:"node_in",name:"qv",qualifier:["float"],e:!1},{type:"node_in",name:"qw",qualifier:["float"],e:!1},{type:"node_in",name:"qx",qualifier:["float"],e:!1},{type:"node_in",name:"qy",qualifier:["float"],e:!1},{type:"node_out",name:"qz",qualifier:["float"],e:!0},{type:"node_out",name:"qA",qualifier:["vec4"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qz"],g:[{type:"textline",b:["qz","=","qu",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qA"],g:[{type:"textline",b:"qA = vec4 ( qv , qw , qx , qy ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",i:[{type:"node_out",name:"qB",qualifier:["float"],e:!1}],g:[{type:"textline",b:["qB","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",i:[{type:"node_in",name:"qC",qualifier:["float"],e:!1},{type:"node_in",name:"qD",qualifier:["float"],e:!1},{type:"node_in",name:"qE",qualifier:["float"],e:!1},{type:"node_out",name:"qF",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"qF = smoothstep ( qD , qE , qC ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",i:[{type:"node_in",name:"qG",qualifier:["vec3"],e:!1},{type:"node_in",name:"qH",qualifier:["float"],e:!1}],g:[{type:"textline",b:"eO = qG ; eS = qH ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",i:[{type:"node_in",name:"qI",qualifier:["vec3"],e:!1},{type:"node_out",name:"qJ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"qJ = ( qI . r + qI . g + qI . b ) / 3.0 ;".split(" ")}]},
{type:"node",name:"B4W_SCALTOVEC",i:[{type:"node_in",name:"qK",qualifier:["float"],e:!1},{type:"node_out",name:"qL",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qL [ 0 ] = qK ; qL [ 1 ] = qK ; qL [ 2 ] = qK ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:"void qM ( in vec3 eM , in mat4 eN , out vec3 eO , out vec3 eP , out vec3 eQ , out vec4 eR , out float eS ) { vec2 eT , eU ; float eV , eW , eX , eY , eZ , e_ , fa , fb , fc ; vec4 fd , fe ; mat3 ff ; vec3 fg , fh , fi , fj , fk , fl ; eO = vec3 ( ZERO_VALUE_NODES ) ; eP = vec3 ( ZERO_VALUE_NODES ) ; eQ = vec3 ( ZERO_VALUE_NODES ) ; eR = vec4 ( ZERO_VALUE_NODES ) ; eS = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"fg = normalize ( bE ) ; fh = fg ;".split(" ")},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["INVERT_FRONTFACING"],group:{type:"group",a:[{type:"textline",b:["if","(","!",
"gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",b:"fh = fh ; else fh = - fh ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:["fi","=","fh",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["fi","=","fg",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["fg","=",
"fh",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"fj = cross ( fh , bF . xyz ) * bF . w ; ff = mat3 ( bF . xyz , fj , fh ) ; ff = ff ;".split(" ")}]}}]},{type:"textline",b:"fh = bC ; fd = bD ; eV = u_emit ; eW = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI",
"/","4.0",")"]},{type:"textline",b:"const vec3 qN = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 qT ( vec3 qO , mat4 qP ) { vec3 qQ , qR , qS ; qQ = vec3 ( qP [ 0 ] [ 0 ] , qP [ 1 ] [ 0 ] , qP [ 2 ] [ 0 ] ) ; qR = vec3 ( qP [ 0 ] [ 1 ] , qP [ 1 ] [ 1 ] , qP [ 2 ] [ 1 ] ) ; qS = vec3 ( qP [ 0 ] [ 2 ] , qP [ 1 ] [ 2 ] , qP [ 2 ] [ 2 ] ) ; qR = cross ( qS , qQ ) ; qQ = normalize ( qQ ) ; qR = normalize ( qR ) ; qS = normalize ( qS ) ; return mat4 ( vec4 ( qQ , 0.0 ) , vec4 ( qR , 0.0 ) , vec4 ( qS , 0.0 ) , vec4 ( qO , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 qZ ( vec3 qU , vec3 qV ) { vec3 qW , qX , qY ; qW = qU - qV ; qW . y = 0.0 ; qX = cross ( qN , qW ) ; qY = cross ( qW , qX ) ; qX = normalize ( qX ) ; qY = normalize ( qY ) ; qW = normalize ( qW ) ; return mat4 ( vec4 ( qX , 0.0 ) , vec4 ( qY , 0.0 ) , vec4 ( qW , 0.0 ) , vec4 ( qV , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 rg ( in vec3 q_ , float ra , float rb , float rc , vec3 rd ) { float re , rf ; re = fract ( length ( rd ) / 0.17 ) ; rf = rc + re / 10.0 ; re = re ; if ( rc != 0.0 ) re /= rc ; q_ *= 1.0 + 0.5 * sin ( ra ) ; re = length ( q_ ) * rb * sin ( 2.0 * 3.14 * ra * rf + re ) ; return C ( re ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 ro ( in vec3 rh , in vec3 ri , in mat4 rj ) { vec3 rk ; float rl , rm ; mat4 rn ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"rn = qT ( ri , rj ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",
b:"rl = fract ( ( ri . x * 1.43 + ri . y * 0.123 + ri . z * 6.1 ) ) ; rl = 2.0 * M_PI * rl ; rk = normalize ( vec3 ( rj [ 0 ] [ 2 ] , 0.0 , rj [ 2 ] [ 2 ] ) ) ; rm = acos ( rk [ 2 ] ) ; if ( rk [ 0 ] < 0.0 ) rm = 2.0 * M_PI - rm ; rm = rm - rl ; if ( rm < 0.0 ) rm = 2.0 * M_PI + rm ; rl = rl ; if ( rm <= MAX_BILLBOARD_ANGLE ) rl += rm ; else if ( rm <= M_PI - MAX_BILLBOARD_ANGLE ) rl += MAX_BILLBOARD_ANGLE * ( 2.0 * rm - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( rm <= M_PI + MAX_BILLBOARD_ANGLE ) rl += rm - M_PI ; else if ( rm <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) rl += MAX_BILLBOARD_ANGLE * ( 2.0 * rm - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else rl += rm - 2.0 * M_PI ; rn = A ( rl ) ; rn [ 3 ] = vec4 ( ri , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"rn = qZ ( rh , ri ) ;".split(" ")}]}}]},{type:"textline",b:["return","rn",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 ru ( in vec3 rp , in vec3 rq , in mat4 rr , mat4 rs ) { mat4 rt ; rt = ro ( rp , rq , rr ) ; rs [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; rt = rt * rs ; return rt ; }".split(" ")}]}}]},
{type:"textline",b:"c rB ( in vec3 rv , in vec3 rw , in vec3 rx , in vec3 ry , in vec3 rz , in mat4 rA ) { rv = ( rA * vec4 ( rv , 1.0 ) ) . xyz ; rw = ( rA * vec4 ( rw , 1.0 ) ) . xyz ; rx = ( rA * vec4 ( rx , 0.0 ) ) . xyz ; ry = ( rA * vec4 ( ry , 0.0 ) ) . xyz ; rz = ( rA * vec4 ( rz , 0.0 ) ) . xyz ; return E ( c ( rv , rw , rx , ry , rz , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 rE ( vec2 rC , vec3 rD ) { return ( rC + 0.5 ) * rD . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 rL ( in vec4 rF , in vec4 rG , in float rH ) { float rI , rJ , rK ; rI = rF [ 0 ] * rG [ 0 ] + rF [ 1 ] * rG [ 1 ] + rF [ 2 ] * rG [ 2 ] + rF [ 3 ] * rG [ 3 ] ; if ( rI < 0.0 ) { rG *= - 1.0 ; rI = - rI ; } if ( abs ( rI ) >= 1.0 ) return rF ; rJ = acos ( rI ) ; rI = sqrt ( 1.0 - rI * rI ) ; if ( abs ( rI ) < 0.001 ) return vec4 ( rF * 0.5 + rG * 0.5 ) ; rK = sin ( ( 1.0 - rH ) * rJ ) / rI ; rI = sin ( rH * rJ ) / rI ; return rF * rK + rG * rI ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 rX ( in vec3 rM , in vec4 rN , in vec4 rO , in vec4 rP , in vec4 rQ , in float rR ) { vec4 rS , rT ; vec3 rU , rV , rW ; rU = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rM , 1.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"rS = rL ( rN , rO , rR ) ; rT = mix ( rP , rQ , rR ) ; rV = i ( rS , rU ) ; rV = rV * rT . w + rT . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"rW = i ( rN , rU ) ; rU = i ( rO , rU ) ; rW = rW * rP . w + rP . xyz ; rU = rU * rQ . w + rQ . xyz ; rV = mix ( rW , rU , rR ) ;".split(" ")}]}}]},{type:"textline",b:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rV , 1.0 ) ) ; } vec3 sf ( in vec3 rY , in vec4 rZ , in vec4 r_ , in float sa ) { vec4 sb ; vec3 sc , sd , se ; sc = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rY , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],
group:{type:"group",a:[{type:"textline",b:"sb = rL ( rZ , r_ , sa ) ; sd = i ( sb , sc ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"se = i ( rZ , sc ) ; sc = i ( r_ , sc ) ; sd = mix ( se , sc , sa ) ;".split(" ")}]}}]},{type:"textline",b:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sd , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 rX ( in vec3 sg , in vec4 sh , in vec4 si ) { vec3 sj ; sj = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sg , 1.0 ) ) ; sj = i ( sh , sj ) ; sj = sj * si . w + si . xyz ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sj , 1.0 ) ) ; } vec3 sf ( in vec3 sk , in vec4 sl ) { vec3 sm ; sm = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sk , 0.0 ) ) ; sm = i ( sl , sm ) ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sm , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void sB ( inout vec3 sn , inout vec3 so , inout vec3 sp , inout vec3 sq ) { int sr , ss ; vec4 st ; vec3 su , sv , sw , sx ; float sy , sz ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["sy","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { su = vec3 ( 0.0 , 0.0 , 0.0 ) ; sv = vec3 ( 0.0 , 0.0 , 0.0 ) ; sw = vec3 ( 0.0 , 0.0 , 0.0 ) ; sx = vec3 ( 0.0 , 0.0 , 0.0 ) ; st = a_influence ; for ( int sA = 0 ; sA < 4 ; sA ++ ) { sr = int ( st [ sA ] ) ; sz = fract ( st [ sA ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"su += sz * rX ( sn , u_quatsb [ sr ] , u_quatsa [ sr ] , u_transb [ sr ] , u_transa [ sr ] , sy ) ; sv += sz * sf ( so , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ; sw += sz * sf ( sp , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ; sx += sz * sf ( sq , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"su += sz * rX ( sn , u_quatsb [ sr ] , u_transb [ sr ] ) ; sx += sz * sf ( sq , u_quatsb [ sr ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"sv += sz * sf ( so , u_quatsb [ sr ] ) ; sw += sz * sf ( sp , u_quatsb [ sr ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} sn = su ; sq = sx ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"so = sv ; sp = sw ;".split(" ")}]}}]},{type:"textline",b:"} if ( ! ( a_influence . y > 0.0 ) ) { ss = int ( a_influence [ 0 ] - 1.0 ) ; if ( ss > - 1 ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"sn = rX ( sn , u_quatsb [ ss ] , u_quatsa [ ss ] , u_transb [ ss ] , u_transa [ ss ] , sy ) ; so = sf ( so , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ; sp = sf ( sp , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ; sq = sf ( sq , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"sn = rX ( sn , u_quatsb [ ss ] , u_transb [ ss ] ) ; sq = sf ( sq , u_quatsb [ ss ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"so = sf ( so , u_quatsb [ ss ] ) ; sp = sf ( sp , u_quatsb [ ss ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void sM ( inout vec3 sC , in vec3 sD , in float sE , in float sF , in float sG , in vec3 sH , in float sI ) { vec3 sJ ; float sK , sL ; sK = length ( sD ) ; sL = sF * ( 1.0 + 0.1 * fract ( sK ) ) ; sK = sE * sI * ( 1.0 + sin ( 2.0 * 3.14 * sG * sL + sK ) ) ; sL = ( sC . y - sD . y ) * abs ( sK ) ; sL += 1.0 ; sL *= sL ; sL = sL * sL - sL ; sJ = sC ; sJ . xz += sH . xz * sL * sign ( sK ) ; sJ = sJ - sD ; if ( all ( equal ( sJ , vec3 ( 0.0 ) ) ) ) sC = sD ; else { sK = length ( sC - sD ) ; sC = sD + normalize ( sJ ) * sK ; } }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 sO ( vec4 sN ) { return sN * sN * ( 3.0 - 2.0 * sN ) ; } vec4 sQ ( vec4 sP ) { return abs ( fract ( sP + 0.5 ) * 2.0 - 1.0 ) ; } vec4 sS ( vec4 sR ) { return sO ( sQ ( sR ) ) ; } void ti ( inout vec3 sT , in float sU , in vec3 sV , in vec3 sW , in vec3 sX , in float sY , in float sZ , in float s_ , in vec3 ta ) { vec3 tb ; vec4 tc ; vec2 td , te ; float tf , tg , th ; tf = dot ( sX , vec3 ( 1.0 ) ) ; tg = tf + ta . g ; th = dot ( sT , vec3 ( ta . g ) ) ; td = ( sU + vec2 ( th , tg ) ) ; tc = ( ( fract ( ( td . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( sW ) * sY ; tc = sS ( tc ) ; te = tc . xz + tc . yw ; te . y = 0.5 - te . y ; tb = te . xyx * ta . rbr * vec3 ( sZ * sV . x , s_ , sZ * sV . z ) ; sT += tb ; }".split(" ")}]}}]},
{type:"textline",b:"void tp ( inout vec3 tj , inout vec3 tk , in vec3 tl ) { vec3 tm , tn , to ; tm = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"tn = tk ; to = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tn = tj ; to = tk ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"ti ( tn , u_time , tl , tm , to , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"sM ( tn , to , au_wind_bending_amp , au_wind_bending_freq , u_time , tm , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"sM ( tn , to , au_wind_bending_amp , au_wind_bending_freq , u_time , tm , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"tj += tn - tk ; tk = tn ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tj = tn ; tk = to ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_orco_tex_coord ; varying vec3 eg ;".split(" ")}]}}]},
{type:"node",name:"TEX_COORD_UV",i:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eG",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eG","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",i:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eF",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eF","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",
name:"UVMAP",i:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eH",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eH","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",i:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"ez",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["ez","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",i:[{type:"node_param",
name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"tq",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["tq","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",i:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"tr",qualifier:["varying","float"]}],g:[{type:"textline",b:["tr","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",
i:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"ts",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["ts","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",i:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"tt",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["tt","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},
{type:"nodes_global"},{type:"textline",b:["void","tu","(",")","{"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["eg","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 tz ( vec3 tv , float tw , vec2 tx ) { vec2 ty ; ty = vec2 ( ( tv . x - tx . x ) / tw , - ( tv . z - tx . y ) / tw ) ; return fract ( ty ) ; } vec2 tD ( vec2 tA , float tB , vec2 tC ) { return vec2 ( tA . x * tB , - tA . y * tB ) + tC ; } c tE ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c t_ ( vec3 tF , vec3 tG , vec3 tH , vec3 tI , vec3 tJ , PRECISION sampler2D tK , sampler2D tL , vec3 tM , float tN , vec3 tO , vec4 tP , mat4 tQ ) { mat4 tR ; vec4 tS ; vec2 tT , tU , tV ; float tW , tX ; vec3 tY ; tY = i ( tP , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; tW = - tY . x ; tX = - tY . z ; tT = vec2 ( tO . x + tN * ( - 1.0 - tW ) / 2.0 , tO . z + tN * ( 1.0 - tX ) / 2.0 ) ; tU = tz ( tJ , tN , tT ) ; tX = tN / 2.0 ; tV = abs ( tD ( tU - vec2 ( 0.5 ) , tN , vec2 ( 0.0 ) ) ) ; tX = tX * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( tV ) > tX ) return tE ( ) ; tX = tN / tM . z ; tV = ( tU - vec2 ( 0.5 ) ) * tX + vec2 ( 0.5 ) ; tY = tY * ( tN / tM . z - 1.0 ) / 2.0 ; tV . x += tY . x ; tV . y -= tY . z ; tS = texture2D ( tL , tV ) ; tX = tS . r ; if ( tX < u_scale_threshold ) return tE ( ) ; tW = tM . y - tM . x ; tW = tM . y - texture2D ( tK , tV ) . r * tW ; tV = tF . xz - tJ . xz ; tJ . xz = tD ( tU , tN , tT ) ; tJ . y = tW ; tF . xz = tJ . xz + tV ; tF . y *= tX ; tF . y += tW ; tY = tS . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"tF -= tJ ; tR = ro ( tO , tJ , tQ ) ; c tZ = rB ( tF , tJ , tG , tH , tI , tR ) ; tZ . b = tJ ; tZ . f = tY ; return E ( tZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return E ( c ( tF , tJ , tG , tH , tI , tY ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 ug ( mat4 ua , vec4 ub , mat4 uc ) { vec4 ud ; float ue ; vec2 uf ; uf = ( ua * uc [ 3 ] ) . xy ; ue = SHADOW_TEX_RES / 2.0 ; uf = floor ( uf * ue + 0.5 ) / ue - uf ; ud = ua * ub ; ud . xy += uf ; ud . xyz = 0.5 * ( ud . xyz + ud . w ) ; return ud ; } void ul ( vec3 uh , vec3 ui ) { vec4 uj ; mat4 uk ;".split(" ")},
{type:"condition",a:[{type:"if",c:["MAC_OS_SHADOW_HACK"],group:{type:"group",a:[{type:"textline",b:"uk = O ( u_v_light_tsr [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uk = O ( mat3 ( u_v_light_ts [ 0 ] , u_v_light_r [ 0 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"uj = uk * vec4 ( uh + u_normal_offset * ui , 1.0 ) ; bI = ug ( u_p_light_matrix0 , uj , uk ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_CAST_LAMPS",1,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["MAC_OS_SHADOW_HACK"],group:{type:"group",a:[{type:"textline",b:"uk = O ( u_v_light_tsr [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uk = O ( mat3 ( u_v_light_ts [ 1 ] , u_v_light_r [ 1 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"uj = uk * vec4 ( uh + u_normal_offset * ui , 1.0 ) ; bJ = ug ( u_p_light_matrix1 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_CAST_LAMPS",2,{type:"g_expr",d:2}],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAC_OS_SHADOW_HACK"],group:{type:"group",a:[{type:"textline",b:"uk = O ( u_v_light_tsr [ 2 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uk = O ( mat3 ( u_v_light_ts [ 2 ] , u_v_light_r [ 2 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"uj = uk * vec4 ( uh + u_normal_offset * ui , 1.0 ) ; bK = ug ( u_p_light_matrix2 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_CAST_LAMPS",3,{type:"g_expr",
d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAC_OS_SHADOW_HACK"],group:{type:"group",a:[{type:"textline",b:"uk = O ( u_v_light_tsr [ 3 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uk = O ( mat3 ( u_v_light_ts [ 3 ] , u_v_light_r [ 3 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"uj = uk * vec4 ( uh + u_normal_offset * ui , 1.0 ) ; bL = ug ( u_p_light_matrix3 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:"bJ = ug ( u_p_light_matrix1 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"bK = ug ( u_p_light_matrix2 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"bL = ug ( u_p_light_matrix3 , uj , uk ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",
b:["0.0"]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:"void uv ( inout vec3 up , in float uq , in float ur , in vec4 us ) { float ut , uu ; ut = clamp ( ( uq - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOG_TYPE","QUADRATIC",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["ut","*=","ut",";"]}]}},{type:"elif",c:["FOG_TYPE","LINEAR",{type:"equal_expr",d:2}],group:{type:"group",
a:[]}},{type:"elif",c:["FOG_TYPE","INVERSE_QUADRATIC",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ut = sqrt ( ut ) ;".split(" ")}]}}]},{type:"textline",b:"if ( u_fog_params . w > 0.0 ) { if ( ur > u_fog_params . w ) ut = 0.0 ; else if ( ur > 0.0 ) { uu = ( u_fog_params . w - ur ) / u_fog_params . w ; ut *= uu * uu ; } } us . a = 1.0 - ( 1.0 - ut ) * ( 1.0 - u_fog_params . x ) ; up = mix ( up , us . rgb , us . a ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],
group:{type:"group",a:[{type:"textline",b:"vec3 uB ( in mat4 uw , in vec3 ux ) { vec3 uy , uz , uA ; uy = mix ( uw [ 0 ] . rgb , uw [ 1 ] . rgb , max ( sign ( ux . x ) , 0.0 ) ) ; uz = mix ( uw [ 2 ] . rgb , uw [ 3 ] . rgb , max ( sign ( ux . z ) , 0.0 ) ) ; uA = vec3 ( uw [ 0 ] . a , uw [ 1 ] . a , uw [ 2 ] . a ) ; uz = mix ( uy , uz , abs ( ux . z ) ) ; uz = mix ( uz , uA , abs ( ux . y ) ) ; br ( uz ) ; return uz ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",
a:[{type:"textline",b:"void uD ( inout float uC ) { uC -= 0.5 ; uC = 4.0 * ( uC * uC * uC ) + 0.5 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void uO ( inout vec3 uE , in float uF , in vec3 uG , in float uH , in vec4 uI , in float uJ ) { vec3 uK , uL ; float uM , uN ; uM = max ( uG . y , 0.0 ) ; uN = max ( uF - max ( uH / uM , 0.0 ) , 0.0 ) ; uN = uI . w * uN ; uK = vec3 ( 0.0 , 0.02 , 0.05 ) ; uL = uI . rgb ; uN = min ( uN , 1.0 ) ; uD ( uN ) ; uN *= clamp ( 2.0 - uJ , 0.0 , 1.0 ) ; uK = mix ( uL , uK , min ( uM , 1.0 ) ) ; uH = clamp ( - uH * 0.03 , 0.0 , 0.8 ) ; uK *= 1.0 - uH ; uE = mix ( uE , uK , uN ) ; }".split(" ")}]}}]},
{type:"textline",b:"void uU ( inout vec3 uP , in float uQ , in float uR ) { vec3 uS ; float uT ; uT = u_underwater_fog_color_density . w * uQ ; uT = clamp ( uT , 0.0 , 1.0 ) ; uD ( uT ) ; uR = clamp ( - uR * 0.03 , 0.0 , 0.8 ) ; uS = mix ( u_underwater_fog_color_density . rgb , vec3 ( 0.0 ) , uR ) ; uP = mix ( uP , uS , uT ) ; }".split(" ")}]}}]},{type:"textline",b:"void va ( inout vec3 uV , float uW , vec3 uX , float uY ) { vec4 uZ ; vec3 u_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_FOG"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"u_ = uB ( u_cube_fog , uX ) ; uZ = vec4 ( u_ , u_fog_color_density . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uZ","=","u_fog_color_density",";"]}]}}]},{type:"textline",b:"uv ( uV , uW , bC . y , uZ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uO ( uV , uW , uX , u_cam_water_depth , u_underwater_fog_color_density , uY ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[]}}]},{type:"textline",b:["}"]}]};a["include/lighting_nodes.glslf"]={type:"group",a:[{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float vd = 0.5 ;".split(" ")},
{type:"node",name:"LIGHTING_BEGIN",i:[{type:"node_out",name:"vB",qualifier:["vec3"],e:!1},{type:"node_out",name:"vC",qualifier:["vec3"],e:!1},{type:"node_out",name:"vD",qualifier:["vec3"],e:!1},{type:"node_out",name:"vE",qualifier:["vec3"],e:!0},{type:"node_out",name:"vF",qualifier:["vec3"],e:!0},{type:"node_out",name:"vG",qualifier:["vec2"],e:!0},{type:"node_out",name:"vH",qualifier:["vec2"],e:!0},{type:"node_out",name:"vI",qualifier:["vec4"],e:!0},{type:"node_out",name:"vJ",qualifier:["float"],
e:!0},{type:"node_out",name:"vK",qualifier:["vec4"],e:!0}],g:[{type:"textline",b:"vB = ve ; vC = vf ; vD = vg ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vE"],g:[{type:"textline",b:["vE","=","vh",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vF"],g:[{type:"textline",b:["vF","=","vj",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vH"],g:[{type:"textline",b:["vH","=","vl",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vG"],
g:[{type:"textline",b:["vG","=","vm",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vI"],g:[{type:"textline",b:["vI","=","vn",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vJ"],g:[{type:"textline",b:["vJ","=","vo",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vK"],g:[{type:"textline",b:["vK","=","vp",";"]}]}]}]},{type:"node",name:"LIGHTING_AMBIENT",i:[{type:"node_in",name:"vL",qualifier:["vec3"],e:!1},{type:"node_in",name:"vM",qualifier:["vec3"],
e:!1},{type:"node_in",name:"vN",qualifier:["vec3"],e:!1},{type:"node_out",name:"vO",qualifier:["vec4"],e:!1},{type:"node_out",name:"vP",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"vO = vec4 ( vL + vN * vM , ZERO_VALUE_NODES ) ; vP = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",i:[{type:"node_in",name:"vQ",qualifier:["vec4"],e:!1},{type:"node_out",name:"vR",qualifier:["vec3"],e:!1},{type:"node_out",name:"vS",qualifier:["vec2"],e:!1},{type:"node_out",name:"vT",qualifier:["vec3"],
e:!1},{type:"node_out",name:"vU",qualifier:["float"],e:!1}],g:[{type:"textline",b:"vS = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","HEMI",{type:"equal_expr",d:2}],g:[{type:"textline",b:["vU","=","vd",";"]}]},{type:"node_else",g:[{type:"textline",b:["vU","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",b:"vT = u_light_color_intensities [ LAMP_IND ] ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_SHADOW_MAP_IND",
1,{type:"negative_expr",d:1},{type:"non_equal_expr",d:2}],g:[{type:"textline",b:"vT *= vQ [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2},"LAMP_TYPE","POINT",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],g:[{type:"textline",b:"vz = u_light_positions [ LAMP_IND ] ; vR = vz - vi ;".split(" ")},{type:"textline",b:"vs = length ( vR ) ; vT *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + vs * vs ) ; vR = normalize ( vR ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2}],g:[{type:"textline",b:"vz = u_light_directions [ LAMP_IND ] ; vs = dot ( vR , vz ) ; vs *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( vs - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; vT *= vs ;".split(" ")}]}]}]},{type:"node_else",g:[{type:"textline",b:"vR = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",i:[{type:"node_in",name:"vV",qualifier:["vec3"],e:!1},{type:"node_in",
name:"vW",qualifier:["vec2"],e:!1},{type:"node_in",name:"vX",qualifier:["vec3"],e:!1},{type:"node_in",name:"vY",qualifier:["float"],e:!1},{type:"node_in",name:"vZ",qualifier:["vec2"],e:!1},{type:"node_out",name:"v_",qualifier:["float"],e:!1}],g:[{type:"textline",b:"v_ = ZERO_VALUE_NODES ; if ( vW . r != ZERO_VALUE_NODES ) { vs = ( UNITY_VALUE_NODES - vY ) * dot ( vX , vV ) + vY ; if ( vZ [ 0 ] == ZERO_VALUE_NODES ) { v_ = UNITY_VALUE_NODES ; } else { vs = UNITY_VALUE_NODES + abs ( vs ) ; vs = vZ [ 1 ] + ( UNITY_VALUE_NODES - vZ [ 1 ] ) * pow ( vs , vZ [ 0 ] ) ; v_ = clamp ( vs , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } v_ = max ( v_ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",i:[{type:"node_in",name:"wa",qualifier:["vec3"],e:!1},{type:"node_in",name:"wb",qualifier:["vec2"],e:!1},{type:"node_in",name:"wc",qualifier:["vec3"],e:!1},{type:"node_in",name:"wd",qualifier:["float"],e:!1},{type:"node_out",name:"we",qualifier:["float"],e:!1}],g:[{type:"textline",b:"we = ZERO_VALUE_NODES ; if ( wb . r != ZERO_VALUE_NODES ) { vs = ( UNITY_VALUE_NODES - wd ) * dot ( wc , wa ) + wd ; we = max ( vs , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",i:[{type:"node_in",name:"wf",qualifier:["vec3"],e:!1},{type:"node_in",name:"wg",qualifier:["vec2"],e:!1},{type:"node_in",name:"wh",qualifier:["vec3"],e:!1},{type:"node_in",name:"wi",qualifier:["float"],e:!1},{type:"node_in",name:"wj",qualifier:["vec2"],e:!1},{type:"node_out",name:"wk",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wk = ZERO_VALUE_NODES ; if ( wg . r != ZERO_VALUE_NODES ) { vs = ( UNITY_VALUE_NODES - wi ) * dot ( wh , wf ) + wi ; if ( wj [ 0 ] > ZERO_VALUE_NODES ) { vt = max ( dot ( wh , vk ) , ZERO_VALUE_NODES ) ; vu = wj [ 0 ] * wj [ 0 ] ; vv = UNITY_VALUE_NODES - vd * ( vu / ( vu + 0.33 ) ) ; vz = wf - vs * wh ; vA = vk - vt * wh ;".split(" ")},
{type:"textline",b:"if ( length ( vz ) == ZERO_VALUE_NODES || length ( vA ) == ZERO_VALUE_NODES || abs ( vs ) > UNITY_VALUE_NODES || abs ( vt ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",b:"wk = vs * vv ; else { vw = acos ( vs ) ; vt = acos ( vt ) ; vz = normalize ( vz ) ; vA = normalize ( vA ) ; vx = max ( vw , vt ) ; vy = min ( vw , vt ) ; vy *= 0.95 ; vt = max ( dot ( vz , vA ) , ZERO_VALUE_NODES ) ; vu = 0.45 * ( vu / ( vu + 0.09 ) ) ; wk = vs * ( vv + ( vu * vt * sin ( vx ) * tan ( vy ) ) ) ; } } else wk = vs ; wk = max ( wk , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",i:[{type:"node_in",name:"wl",qualifier:["vec3"],e:!1},{type:"node_in",name:"wm",qualifier:["vec2"],e:!1},{type:"node_in",name:"wn",qualifier:["vec3"],e:!1},{type:"node_in",name:"wo",qualifier:["float"],e:!1},{type:"node_in",name:"wp",qualifier:["vec2"],e:!1},{type:"node_out",name:"wq",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wq = ZERO_VALUE_NODES ; if ( wm . r != ZERO_VALUE_NODES ) { vs = ( UNITY_VALUE_NODES - wo ) * dot ( wn , wl ) + wo ; vy = max ( dot ( wn , vk ) , ZERO_VALUE_NODES ) ; if ( wp [ 0 ] <= UNITY_VALUE_NODES ) wq = vs * pow ( max ( vy * vs , 0.1 ) , wp [ 0 ] - UNITY_VALUE_NODES ) ; else wq = vs * pow ( 1.0001 - vy , wp [ 0 ] - UNITY_VALUE_NODES ) ; wq = max ( wq , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",i:[{type:"node_in",name:"wr",qualifier:["vec3"],e:!1},{type:"node_in",name:"ws",qualifier:["vec2"],e:!1},{type:"node_in",name:"wt",qualifier:["vec3"],e:!1},{type:"node_in",name:"wu",qualifier:["float"],e:!1},{type:"node_in",name:"wv",qualifier:["vec2"],e:!1},{type:"node_out",name:"ww",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ww = ZERO_VALUE_NODES ; if ( ws . r != ZERO_VALUE_NODES ) { vy = ( UNITY_VALUE_NODES - wu ) * dot ( wt , wr ) + wu ; vy = acos ( vy ) ; if ( vy < wv [ 0 ] ) ww = UNITY_VALUE_NODES ; else if ( vy > ( wv [ 0 ] + wv [ 1 ] ) || wv [ 1 ] == ZERO_VALUE_NODES ) ww = ZERO_VALUE_NODES ; else ww = UNITY_VALUE_NODES - ( ( vy - wv [ 0 ] ) / wv [ 1 ] ) ; ww = max ( ww , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",i:[{type:"node_in",name:"wx",qualifier:["vec3"],e:!1},{type:"node_in",name:"wy",qualifier:["vec2"],e:!1},{type:"node_in",name:"wz",qualifier:["vec3"],e:!1},{type:"node_in",name:"wA",qualifier:["float"],e:!1},{type:"node_in",name:"wB",qualifier:["vec2"],e:!1},{type:"node_out",name:"wC",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wC = ZERO_VALUE_NODES ; if ( wy . g != ZERO_VALUE_NODES ) { vA = normalize ( wx + vk ) ; wC = ( UNITY_VALUE_NODES - wA ) * max ( dot ( wz , vA ) , ZERO_VALUE_NODES ) + wA ; wC = pow ( wC , wB [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",i:[{type:"node_in",name:"wD",qualifier:["vec3"],e:!1},{type:"node_in",name:"wE",qualifier:["vec2"],e:!1},{type:"node_in",name:"wF",qualifier:["vec3"],e:!1},{type:"node_in",name:"wG",qualifier:["vec2"],e:!1},{type:"node_out",name:"wH",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wH = ZERO_VALUE_NODES ; if ( wE . g != ZERO_VALUE_NODES ) { vA = normalize ( wD + vk ) ; vy = max ( dot ( wF , vA ) , 0.001 ) ;".split(" ")},{type:"textline",b:"vs = max ( dot ( wF , vk ) , 0.01 ) ; vx = max ( dot ( wF , wD ) , 0.01 ) ; vy = tan ( acos ( vy ) ) ; vt = max ( wG [ 0 ] , 0.001 ) ; wH = vx * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * vt * vt ) ) * ( exp ( - ( vy * vy ) / ( vt * vt ) ) / ( sqrt ( vs * vx ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",i:[{type:"node_in",name:"wI",qualifier:["vec3"],e:!1},{type:"node_in",name:"wJ",qualifier:["vec2"],e:!1},{type:"node_in",name:"wK",qualifier:["vec3"],e:!1},{type:"node_in",name:"wL",qualifier:["vec2"],e:!1},{type:"node_out",name:"wM",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wM = ZERO_VALUE_NODES ; if ( wJ . g != ZERO_VALUE_NODES ) { vA = normalize ( wI + vk ) ; vx = acos ( dot ( vA , wK ) ) ; if ( vx < wL [ 0 ] ) wM = UNITY_VALUE_NODES ; else if ( vx >= wL [ 0 ] + wL [ 1 ] || wL [ 1 ] == ZERO_VALUE_NODES ) wM = ZERO_VALUE_NODES ; else wM = UNITY_VALUE_NODES - ( vx - wL [ 0 ] ) / wL [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",i:[{type:"node_in",name:"wN",qualifier:["vec3"],e:!1},{type:"node_in",name:"wO",qualifier:["vec2"],e:!1},{type:"node_in",name:"wP",qualifier:["vec3"],e:!1},{type:"node_in",name:"wQ",qualifier:["float"],e:!1},{type:"node_in",name:"wR",qualifier:["vec2"],e:!1},{type:"node_out",name:"wS",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wS = ZERO_VALUE_NODES ; if ( wO . g != ZERO_VALUE_NODES ) { if ( wR [ 0 ] < 1.0 || wR [ 1 ] == ZERO_VALUE_NODES ) wS = ZERO_VALUE_NODES ; else { if ( wR [ 1 ] < 100.0 ) wR [ 1 ] = sqrt ( 1.0 / wR [ 1 ] ) ; else wR [ 1 ] = 10.0 / wR [ 1 ] ; vA = normalize ( vk + wN ) ; vx = ( UNITY_VALUE_NODES - wQ ) * max ( dot ( wP , vA ) , ZERO_VALUE_NODES ) + wQ ; if ( vx < ZERO_VALUE_NODES ) wS = ZERO_VALUE_NODES ; else { vs = max ( dot ( wP , vk ) , 0.01 ) ; vt = dot ( wP , wN ) ; if ( vt <= 0.01 ) wS = ZERO_VALUE_NODES ; else { vy = max ( dot ( vk , vA ) , 0.01 ) ; vu = UNITY_VALUE_NODES ; vs = ( 2.0 * vx * vs ) / vy ; vt = ( 2.0 * vx * vt ) / vy ; vt = min ( min ( vu , vs ) , vt ) ; vs = sqrt ( pow ( wR [ 0 ] , 2.0 ) + pow ( vy , 2.0 ) - UNITY_VALUE_NODES ) ; vy = pow ( vs - vy , 2.0 ) / pow ( vs + vy , 2.0 ) * ( UNITY_VALUE_NODES + pow ( vy * ( vs + vy ) - UNITY_VALUE_NODES , 2.0 ) / pow ( vy * ( vs - vy ) + UNITY_VALUE_NODES , 2.0 ) ) ; vx = acos ( vx ) ; wS = max ( vy * vt * exp ( - pow ( vx , 2.0 ) / ( 2.0 * pow ( wR [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",i:[{type:"node_in",name:"wT",qualifier:["vec4"],e:!1},{type:"node_in",name:"wU",qualifier:["vec3"],e:!1},{type:"node_in",name:"wV",qualifier:["float"],e:!1},{type:"node_in",name:"wW",qualifier:["float"],e:!1},{type:"node_in",name:"wX",qualifier:["vec3"],e:!1},{type:"node_in",name:"wY",qualifier:["vec3"],e:!1},{type:"node_in",name:"wZ",qualifier:["vec4"],e:!1},{type:"node_in",name:"w_",qualifier:["vec3"],e:!1},{type:"node_in",name:"xa",qualifier:["vec3"],e:!1},{type:"node_in",
name:"xb",qualifier:["vec3"],e:!1},{type:"node_in",name:"xc",qualifier:["float"],e:!1},{type:"node_out",name:"xd",qualifier:["vec4"],e:!1},{type:"node_out",name:"xe",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"xe = wU + xb * xa * wW ; xd = wT + vec4 ( xb * w_ * wV , wW ) ;".split(" ")}]},{type:"node",name:"LIGHTING_END",i:[{type:"node_in",name:"xf",qualifier:["vec4"],e:!1},{type:"node_in",name:"xg",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"vq = xf . rgb ; vr = xg ;".split(" ")}]},{type:"nodes_global"},
{type:"textline",b:"void xh ( vec3 ve , vec3 vf , vec3 vg , vec3 vh , vec3 vi , vec3 vj , vec3 vk , vec2 vl , vec2 vm , vec4 vn , float vo , vec4 vp , out vec3 vq , out vec3 vr ) { float vs , vt , vu , vv , vw , vx , vy ; vec3 vz , vA ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct xk { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void xq ( inout float xl , float xm , vec2 xn , vec2 xo ) { float xp ; xp = xo . x - xn . x ; xp = ( xm - xn . x ) / xp ; xl = mix ( xl , xo . y , clamp ( xp , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void xw ( inout vec3 xr , float xs , vec4 xt , vec4 xu ) { float xv ; xv = xu . x - xt . x ; xv = ( xs - xt . x ) / xv ; xr = mix ( xr , xu . yzw , clamp ( xv , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float xC ( float xx , float xy , vec2 xz [ SIZE_RAMP_LENGTH ] ) { float xA , xB ; xA = xx / xy ; xB = xz [ 0 ] . y ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xq ( xB , xA , xz [ 0 ] , xz [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",2,{type:"g_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"xq ( xB , xA , xz [ 1 ] , xz [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xq ( xB , xA , xz [ 2 ] , xz [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","xB",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 xI ( float xD , float xE , vec4 xF [ COLOR_RAMP_LENGTH ] ) { vec3 xG ; float xH ; xH = xD / xE ; xG = xF [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xw ( xG , xH , xF [ 0 ] , xF [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xw ( xG , xH , xF [ 1 ] , xF [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xw ( xG , xH , xF [ 2 ] , xF [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",b:["return","xG",";","}"]}]}}]},{type:"textline",b:"float xQ ( float xJ , float xK , float xL , float xM ) { float xN , xO , xP ; xN = max ( 0.01 , min ( xK , xL ) ) ; xO = max ( 0.01 , min ( xK , xM ) ) ; xP = xK - xO ; xO = clamp ( xJ / xN , 0.0 , 1.0 ) - step ( xP , xJ ) * ( xJ - xP ) / xO ; return xO ; } xk xX ( ) { mat4 xR ; vec3 xS , xT ; float xU , xV ; xk xW ; if ( u_p_cyclic == 1 ) { xU = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( xU < 0.0 ) xU += u_p_length ; } if ( u_p_cyclic != 1 ) { xU = u_p_time - a_p_delay ; } if ( xU < 0.0 || xU >= a_p_lifetime ) { xW . a = 0.0001 ; xW . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( xU < 0.0 || xU >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"xS = a_position ; xT = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xR = O ( u_model_tsr ) ; xS = ( xR * vec4 ( a_position , 1.0 ) ) . xyz ; xT = ( xR * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"xS += u_p_nfactor * xU * xT ; xS += a_p_vels . xyz * xU ; xS . y -= u_p_gravity * xU * xU / 2.0 ; xV = max ( u_p_mass , EPSILON ) ; xS += ( u_p_wind_fac * u_wind / xV ) * xU * xU / 2.0 ; xW . b = xS ; xW . e = a_p_vels . w * xU ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xW . a = xC ( xU , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xW . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xW . d = xI ( xU , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"xW . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"xW . c = xQ ( xU , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return xW ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",a:[{type:"textline",b:"float xZ = 0.0 ; float x_ = 1.0 ; vec3 ye ( vec3 ya ) { float yb , yc ; vec4 yd ; yd = vec4 ( xZ , - x_ / 3.0 , 2.0 / 3.0 , - x_ ) ; yd = mix ( vec4 ( ya . bg , yd . wz ) , vec4 ( ya . gb , yd . xy ) , step ( ya . b , ya . g ) ) ; yd = mix ( vec4 ( yd . xyw , ya . r ) , vec4 ( ya . r , yd . yzx ) , step ( yd . x , ya . r ) ) ; yb = yd . x - min ( yd . w , yd . y ) ; yc = 1.0e-10 ; return vec3 ( abs ( yd . z + ( yd . w - yd . y ) / ( 6.0 * yb + yc ) ) , yb / ( yd . x + yc ) , yd . x ) ; } vec3 yi ( vec3 yf ) { vec3 yg ; vec4 yh ; yh = vec4 ( x_ , 2.0 / 3.0 , x_ / 3.0 , 3.0 ) ; yg = abs ( fract ( vec3 ( yf . r , yf . r , yf . r ) + yh . xyz ) * 6.0 - yh . www ) ; return yf . b * mix ( yh . xxx , clamp ( yg - yh . xxx , xZ , x_ ) , yf . g ) ; } vec3 ym ( vec3 yj , vec3 yk , float yl ) { return mix ( yj , yk , yl ) ; } vec3 yq ( vec3 yn , vec3 yo , float yp ) { return yp * yn + yo ; } vec3 yu ( vec3 yr , vec3 ys , float yt ) { return ys - yt * yr ; } vec3 yz ( vec3 yv , vec3 yw , float yx ) { float yy ; yy = x_ - yx ; return ( vec3 ( yy ) + yx * yv ) * yw ; } vec3 yE ( vec3 yA , vec3 yB , float yC ) { vec3 yD ; yD = vec3 ( x_ - yC ) ; return vec3 ( x_ ) - ( yD + yC * ( vec3 ( x_ ) - yA ) ) * ( vec3 ( x_ ) - yB ) ; } vec3 yJ ( vec3 yF , vec3 yG , float yH ) { vec3 yI ; yI = vec3 ( x_ - yH ) ; return mix ( yG * ( yI + 2.0 * yH * yF ) , vec3 ( x_ ) - ( yI + 2.0 * yH * ( vec3 ( x_ ) - yF ) ) * ( vec3 ( x_ ) - yG ) , step ( 0.5 , yG ) ) ; } vec3 yN ( vec3 yK , vec3 yL , float yM ) { return mix ( yL , abs ( yK - yL ) , yM ) ; } vec3 yR ( vec3 yO , vec3 yP , float yQ ) { return mix ( yP , yP / ( yO + step ( yO , vec3 ( xZ ) ) ) , yQ ) ; } vec3 yV ( vec3 yS , vec3 yT , float yU ) { return mix ( yT , min ( yS , yT ) , yU ) ; } vec3 yZ ( vec3 yW , vec3 yX , float yY ) { return max ( yY * yW , yX ) ; } vec3 ze ( vec3 y_ , vec3 za , float zb ) { vec3 zc , zd ; zc = ye ( za ) ; if ( zc . y != xZ ) { zd = ye ( y_ ) ; zd = yi ( vec3 ( zc . x , zd . yz ) ) ; return mix ( y_ , zd , zb ) ; } return y_ ; } vec3 zk ( vec3 zf , vec3 zg , float zh ) { vec3 zi , zj ; zi = ye ( zf ) ; if ( zi . y != xZ ) { zj = ye ( zg ) ; return yi ( vec3 ( zi . x , mix ( zi . y , zj . y , zh ) , zi . z ) ) ; } return zf ; } vec3 zq ( vec3 zl , vec3 zm , float zn ) { vec3 zo , zp ; zo = ye ( zl ) ; zp = ye ( zm ) ; return yi ( vec3 ( zo . xy , mix ( zo . z , zp . z , zn ) ) ) ; } vec3 zw ( vec3 zr , vec3 zs , float zt ) { vec3 zu , zv ; zu = ye ( zs ) ; if ( zu . y != xZ ) { zv = ye ( zr ) ; zv = yi ( vec3 ( zu . xy , zv . z ) ) ; return mix ( zr , zv , zt ) ; } return zr ; } vec3 zB ( vec3 zx , vec3 zy , float zz ) { vec3 zA ; zA = vec3 ( x_ ) - ( vec3 ( x_ ) - zy ) * ( vec3 ( x_ ) - zx ) ; return mix ( zx , ( ( vec3 ( x_ ) - zx ) * zy * zx ) + zx * zA , zz ) ; } vec3 zF ( vec3 zC , vec3 zD , float zE ) { return zC + zE * ( 2.0 * zD - x_ ) ; } float zL ( float zG , float zH , float zI , float zJ ) { float zK ; zK = x_ - zJ ; return ( zK + zI * zG ) * zH ; } float zR ( float zM , float zN , float zO , float zP ) { float zQ ; zQ = x_ - zP ; return x_ - ( zQ + zO * ( x_ - zM ) ) * ( x_ - zN ) ; } float zX ( float zS , float zT , float zU , float zV ) { float zW ; zW = x_ - zV ; return mix ( zT * ( zW + 2.0 * zU * zS ) , x_ - ( zW + 2.0 * zU * ( x_ - zS ) ) * ( x_ - zT ) , step ( 0.5 , zT ) ) ; }".split(" ")}]};
a["include/fxaa.glslf"]={type:"group",a:[{type:"condition",a:[{type:"ifndef",name:"FXAA_PS3",group:{type:"group",a:[{type:"define",name:"FXAA_PS3",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_360",group:{type:"group",a:[{type:"define",name:"FXAA_360",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_360_OPT",group:{type:"group",a:[{type:"define",name:"FXAA_360_OPT",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_PC",group:{type:"group",a:[{type:"define",name:"FXAA_PC",
b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_PC_CONSOLE",group:{type:"group",a:[{type:"define",name:"FXAA_PC_CONSOLE",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_GLSL_120",group:{type:"group",a:[{type:"define",name:"FXAA_GLSL_120",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_GLSL_130",group:{type:"group",a:[{type:"define",name:"FXAA_GLSL_130",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_HLSL_3",group:{type:"group",a:[{type:"define",
name:"FXAA_HLSL_3",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_HLSL_4",group:{type:"group",a:[{type:"define",name:"FXAA_HLSL_4",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_HLSL_5",group:{type:"group",a:[{type:"define",name:"FXAA_HLSL_5",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_GREEN_AS_LUMA",group:{type:"group",a:[{type:"define",name:"FXAA_GREEN_AS_LUMA",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_EARLY_EXIT",group:{type:"group",
a:[{type:"define",name:"FXAA_EARLY_EXIT",b:["1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_DISCARD",group:{type:"group",a:[{type:"define",name:"FXAA_DISCARD",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",a:[{type:"condition",a:[{type:"ifdef",name:"GL_EXT_gpu_shader4",group:{type:"group",a:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",b:["1"]}]}}]},{type:"condition",a:[{type:"ifdef",name:"GL_NV_gpu_shader5",group:{type:"group",a:[{type:"define",
name:"FXAA_FAST_PIXEL_OFFSET",b:["1"]}]}}]},{type:"condition",a:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",a:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",b:["1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",a:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",b:["0"]}]}}]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FXAA_HLSL_5",1,{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"define",name:"FXAA_GATHER4_ALPHA",b:["1"]}]}}]},{type:"condition",a:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",a:[{type:"define",name:"FXAA_GATHER4_ALPHA",b:["1"]}]}}]},{type:"condition",a:[{type:"ifdef",name:"GL_NV_gpu_shader5",group:{type:"group",a:[{type:"define",name:"FXAA_GATHER4_ALPHA",b:["1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",a:[{type:"define",name:"FXAA_GATHER4_ALPHA",b:["0"]}]}}]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:[0],group:{type:"group",a:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",b:["4.0"]}]}}]},{type:"condition",a:[{type:"if",c:[0],group:{type:"group",a:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",b:["2.0"]}]}}]}]}}]},{type:"condition",a:[{type:"ifndef",
name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",b:["0.125"]}]}},{type:"else",group:{type:"group",a:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",b:["0.25"]}]}}]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_QUALITY_PRESET",group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PRESET",b:["12"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",
10,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["3"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",b:["3.0"]},{type:"define",name:"FXAA_QUALITY_P2",b:["12.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",11,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["4"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},
{type:"define",name:"FXAA_QUALITY_P2",b:["3.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["12.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",12,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["5"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["12.0"]}]}}]},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",13,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["6"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["12.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",
14,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["7"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["12.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",
15,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["8"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["12.0"]}]}}]},{type:"condition",
a:[{type:"if",c:["FXAA_QUALITY_PRESET",20,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["3"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P2",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",21,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["4"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",
name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",22,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["5"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P4",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",23,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["6"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["8.0"]}]}}]},{type:"condition",
a:[{type:"if",c:["FXAA_QUALITY_PRESET",24,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["7"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["3.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["8.0"]}]}}]},{type:"condition",
a:[{type:"if",c:["FXAA_QUALITY_PRESET",25,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["8"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P7",
b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",26,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["9"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",
b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P8",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",27,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["10"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",
b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P9",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",28,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["11"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",
b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P10",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",
29,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["12"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P8",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",39,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["12"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P2",b:["1.0"]},{type:"define",
name:"FXAA_QUALITY_P3",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P6",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",b:["8.0"]}]}}]},{type:"var",name:"FXAA_QUALITY_P12",b:["0.0"]},{type:"textline",b:"float At ( float As ) { return clamp ( As , 0.0 , 1.0 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_BLEND4WEB",1,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Aw ( sampler2D Au , vec2 Av ) { return texture2D ( Au , Av ) ; } vec4 AB ( sampler2D Ax , vec2 Ay , vec2 Az , vec2 AA ) { return texture2D ( Ax , Ay + ( Az * AA ) ) ; }".split(" ")}]}}]},{type:"textline",b:"vec4 Bh ( vec2 AC , sampler2D AD , vec2 AE , float AF , float AG , float AH ) { bool AI , AJ , AK , AL , AM ; float AN , AO , AP , AQ , AR , AS , AT , AU , AV , AW , AX , AY , AZ , A_ , Ba ; vec4 Bb ; vec2 Bc , Bd , Be , Bf , Bg ; Bc . x = AC . x ; Bc . y = AC . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_GATHER4_ALPHA",1,{type:"equal_expr",d:2}],group:{type:"group",a:[]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Bb = Aw ( AD , Bc ) ; AN = bB ( Bb ) ; AO = bB ( AB ( AD , Bc , vec2 ( 0 , 1 ) , AE . xy ) ) ; AP = bB ( AB ( AD , Bc , vec2 ( 1 , 0 ) , AE . xy ) ) ; AQ = bB ( AB ( AD , Bc , vec2 ( 0 , - 1 ) , AE . xy ) ) ; AR = bB ( AB ( AD , Bc , vec2 ( - 1 , 0 ) , AE . xy ) ) ;".split(" ")}]}}]},{type:"textline",b:"AS = max ( AO , AN ) ; AT = min ( AO , AN ) ; AS = max ( AP , AS ) ; AT = min ( AP , AT ) ; AU = max ( AQ , AR ) ; AV = min ( AQ , AR ) ; AS = max ( AU , AS ) ; AT = min ( AV , AT ) ; AV = AS * AG ; AT = AS - AT ; AV = max ( AH , AV ) ; AI = AT < AV ; if ( AI ) return Bb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_GATHER4_ALPHA",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AV = bB ( AB ( AD , Bc , vec2 ( - 1 , - 1 ) , AE . xy ) ) ; AS = bB ( AB ( AD , Bc , vec2 ( 1 , 1 ) , AE . xy ) ) ; AU = bB ( AB ( AD , Bc , vec2 ( 1 , - 1 ) , AE . xy ) ) ; AW = bB ( AB ( AD , Bc , vec2 ( - 1 , 1 ) , AE . xy ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[]}}]},{type:"textline",b:"AX = AQ + AO ; AY = AR + AP ; AT = 1.0 / AT ; AZ = AX + AY ; AX = ( - 2.0 * AN ) + AX ; AY = ( - 2.0 * AN ) + AY ; A_ = AU + AS ; AU = AV + AU ; Ba = ( - 2.0 * AP ) + A_ ; AU = ( - 2.0 * AQ ) + AU ; AV = AV + AW ; AS = AW + AS ; Ba = ( abs ( AX ) * 2.0 ) + abs ( Ba ) ; AU = ( abs ( AY ) * 2.0 ) + abs ( AU ) ; AY = ( - 2.0 * AR ) + AV ; AS = ( - 2.0 * AO ) + AS ; Ba = abs ( AY ) + Ba ; AU = abs ( AS ) + AU ; A_ = AV + A_ ; AV = AE . x ; AI = Ba >= AU ; A_ = AZ * 2.0 + A_ ; if ( ! AI ) AQ = AR ; if ( ! AI ) AO = AP ; if ( AI ) AV = AE . y ; A_ = ( A_ * ( 1.0 / 12.0 ) ) - AN ; AP = AQ - AN ; AR = AO - AN ; AQ = AQ + AN ; AO = AO + AN ; AJ = abs ( AP ) >= abs ( AR ) ; AR = max ( abs ( AP ) , abs ( AR ) ) ; if ( AJ ) AV = - AV ; AT = At ( abs ( A_ ) * AT ) ; Bd . x = Bc . x ; Bd . y = Bc . y ; Be . x = ( ! AI ) ? 0.0 : AE . x ; Be . y = ( AI ) ? 0.0 : AE . y ; if ( ! AI ) Bd . x += AV * 0.5 ; if ( AI ) Bd . y += AV * 0.5 ; Bf . x = Bd . x - Be . x * FXAA_QUALITY_P0 ; Bf . y = Bd . y - Be . y * FXAA_QUALITY_P0 ; Bg . x = Bd . x + Be . x * FXAA_QUALITY_P0 ; Bg . y = Bd . y + Be . y * FXAA_QUALITY_P0 ; A_ = ( ( - 2.0 ) * AT ) + 3.0 ; AP = bB ( Aw ( AD , Bf ) ) ; AT = AT * AT ; AZ = bB ( Aw ( AD , Bg ) ) ; if ( ! AJ ) AQ = AO ; AR = AR * 1.0 / 4.0 ; AO = AN - AQ * 0.5 ; AT = A_ * AT ; AJ = AO < 0.0 ; AP -= AQ * 0.5 ; AZ -= AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P1 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P1 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P1 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P1 ; if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P2 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P2 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P2 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P2 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P3 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P3 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P3 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P3 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",4,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P4 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P4 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P4 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P4 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",5,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P5 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P5 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P5 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",6,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P6 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P6 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P6 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P6 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",7,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P7 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P7 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P7 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P7 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",8,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P8 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P8 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P8 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P8 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",9,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P9 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P9 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P9 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P9 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",10,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P10 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P10 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P10 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P10 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",11,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P11 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P11 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P11 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P11 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",12,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P12 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P12 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P12 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P12 ; }".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"} AR = Bc . x - Bf . x ; AQ = Bg . x - Bc . x ; if ( ! AI ) AR = Bc . y - Bf . y ; if ( ! AI ) AQ = Bg . y - Bc . y ; AL = ( AP < 0.0 ) != AJ ; AP = ( AQ + AR ) ; AJ = ( AZ < 0.0 ) != AJ ; AP = 1.0 / AP ; AK = AR < AQ ; AQ = min ( AR , AQ ) ; AJ = AK ? AL : AJ ; AT = AT * AT ; AP = ( AQ * ( - AP ) ) + 0.5 ; AT = AT * AF ; AP = AJ ? AP : 0.0 ; AT = max ( AP , AT ) ; if ( ! AI ) Bc . x += AT * AV ; if ( AI ) Bc . y += AT * AV ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_DISCARD",1,{type:"equal_expr",d:2},"FXAA_BLEND4WEB",1,{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Aw ( AD , Bc ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec4 ( Aw ( AD , Bc ) . xyz , AN ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float Bo ( in sampler2D Bi , in vec2 Bj , in vec2 Bk ) { float Bl , Bm , Bn ; Bl = texture2D ( Bi , Bj ) . r ; Bm = Bk . x ; Bn = Bk . y ; Bm = 2.0 * Bm / ( Bm + Bn - ( 2.0 * Bl - 1.0 ) * ( Bn - Bm ) ) ; return Bm ; }".split(" ")}]}};b4w.module.animation=function(a,p){var d=p("__animation"),b=p("__armature"),c=p("__obj_util"),q=p("__print"),f=p("__tsr");a.SLOT_0=d.SLOT_0;a.SLOT_1=d.SLOT_1;a.SLOT_2=d.SLOT_2;a.SLOT_3=d.SLOT_3;a.SLOT_4=d.SLOT_4;a.SLOT_5=d.SLOT_5;a.SLOT_6=d.SLOT_6;a.SLOT_7=d.SLOT_7;a.SLOT_ALL=d.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=d.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=d.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=d.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=d.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=d.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=d.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=d.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=d.AB_CYCLIC;a.AB_FINISH_RESET=d.AB_FINISH_RESET;a.AB_FINISH_STOP=d.AB_FINISH_STOP;var t=f.create();a.is_animated=function(a){return d.is_animated(a)};a.get_anim_names=function(a){return d.Xv(a)?d.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.cD(a,b)};a.apply=function(a,b,c){if(c>d.SLOT_7)q.error("Can't apply animation to slot "+
c+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{c=c||d.SLOT_0;if(d.is_animated(a)){var f=d.get_slot_num_by_anim(a,b);if(-1!=f&&f!=c){q.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+f+'").');return}}d.WH(a,b)?d.apply(a,b,c):q.error('No fcurves in action "'+b+'"')}};a.remove=function(a){d.remove(a)};a.remove_slot_animation=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.remove_slot_animation(a,b))};a.apply_def=function(a){d.apply_def(a)};
a.play=function(a,b,c){d.is_animated(a)?(c=c||d.SLOT_0,d.play(a,b,c),d.uH(a,0,c,!0)):q.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.stop(a,b))};a.is_play=function(a,b){if(!d.is_animated(a))return!1;b=b||d.SLOT_0;return d.is_play(a,b)};a.set_frame=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_frame(a,b,c))};a.set_first_frame=function(a,b){d.is_animated(a)&&d.set_first_frame(a,b)};a.set_last_frame=function(a,b){if(d.is_animated(a)){b=
b||d.SLOT_0;var c=d.get_anim_start_frame(a,b),f=d.get_anim_length(a,b);d.set_frame(a,c+f-d.Fy,b)}};a.get_frame=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return d.Ju(a,b)};a.set_speed=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return a.M[b]?d.get_speed(a,b):0};a.get_anim_start_frame=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.M[b])?d.get_anim_start_frame(a,b):-1};a.get_anim_length=
function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.M[b])?d.get_anim_length(a,b):-1};a.set_behavior=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,f){f=f||d.SLOT_0;d.is_animated(a)&&d.apply_smoothing(a,b,c,f)};a.frame_to_sec=function(a){return d.frame_to_sec(a)};a.get_bone_translation=function(a,d,f){q.Ga("get_bone_translation","armature.get_bone_tsr");
if(!c.is_armature(a))return null;if(!b.jk(a,d))return q.error('There is no bone: "',d,'" in "',a.name,'".'),null;f||(f=new Float32Array(3));b.get_bone_tsr(a,d,!1,!1,t);f[0]=t[0];f[1]=t[1];f[2]=t[2];return f};a.get_first_armature_object=function(){q.Nm("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return d.is_animated(a)&&b?d.get_slot_num_by_anim(a,b):null};a.get_anim_type=function(a,b){return d.is_animated(a)?d.get_anim_type(a,b):null};a.apply_to_first_empty_slot=
function(a,b){return d.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.f.Mf};a.set_skel_mix_factor=function(a,b,f){c.is_armature(a)?(b=Math.min(Math.max(b,0),1),a.f.Mf!=b&&d.set_skel_mix_factor(a,b,f||0)):q.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,p){var d=p("__anchors");p("__print");a.attach_move_cb=d.attach_move_cb;a.detach_move_cb=d.detach_move_cb;a.is_anchor=d.is_anchor;a.get_element_id=d.get_element_id};b4w.module.armature=function(a,p){var d=p("__armature"),b=p("__obj_util"),c=p("__transform"),q=p("__print");a.get_bone_tsr=function(a,c,l){if(!b.is_armature(a))return null;if(!d.jk(a,c))return q.error('There is no bone: "',c,'" in "',a.name,'".'),null;l||(l=new Float32Array(8));d.get_bone_tsr(a,c,!1,!1,l);return l};a.get_bone_tsr_rel=function(a,c,l){if(!b.is_armature(a))return null;if(!d.jk(a,c))return q.error('There is no bone: "',c,'" in "',a.name,'".'),null;l||(l=new Float32Array(8));d.get_bone_tsr(a,
c,!1,!0,l);return l};a.set_bone_tsr=function(a,p,l){b.is_armature(a)&&(d.jk(a,p)?(d.set_bone_tsr(a,p,l,!1),c.n(a)):q.error('There is no bone: "',p,'" in "',a.name,'".'))};a.set_bone_tsr_rel=function(a,p,l){b.is_armature(a)&&(d.jk(a,p)?(d.set_bone_tsr(a,p,l,!0),c.n(a)):q.error('There is no bone: "',p,'" in "',a.name,'".'))}};b4w.module.assets=function(a,p){var d=p("__assets");a.AT_ARRAYBUFFER=d.AT_ARRAYBUFFER;a.AT_JSON=d.AT_JSON;a.AT_TEXT=d.AT_TEXT;a.AT_AUDIOBUFFER=d.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=d.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=d.AT_AUDIO_ELEMENT;a.enqueue=function(a,c,p,f){if(a.length)if(a.id)d.enqueue(a,c,p,f);else{for(var t=[],l=0;l<a.length;l++){var n=a[l];t.push({id:n[0],type:n[1],url:n[2],Sc:n.Sc?n.Sc:"GET",og:null,vf:null,eb:n[3]})}d.enqueue(t,c,p,f)}}};b4w.module.camera=function(a,p){function d(a,c){n.Ga("camera.set_pivot","camera.target_set_trans_pivot");b.is_target_camera(a)?(k.copy(c,a.f.Sa),g.n(a),l.sync_transform(a)):n.error("set_pivot(): Wrong object or camera move style")}var b=p("__camera");p("__config");var c=p("__constraints"),q=p("__container");p("__mat3");var f=p("__mat4"),t=p("__obj_util"),l=p("__physics"),n=p("__print"),g=p("__transform"),z=p("__tsr"),h=p("__util"),k=p("__vec3"),u=p("__vec4"),w=new Float32Array(2),C=new Float32Array(3),
E=new Float32Array(3);new Float32Array(4);new Float32Array(9);var G={};a.MS_STATIC=b.MS_STATIC;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.static_set_look_at=function(a,c,d){b.is_static_camera(a)?(c=c||z.get_trans_view(a.f.h),b.set_look_at(a,c,d),g.n(a),l.sync_transform(a)):n.error("static_set_look_at(): Wrong camera object or camera move style")};a.static_set_rotation=function(a,c){b.is_static_camera(a)?(g.set_rotation(a,
c),g.n(a),l.sync_transform(a)):n.error("static_set_rotation(): Wrong camera object or camera move style")};a.static_get_rotation=function(a,c){if(!b.is_static_camera(a))return n.error("static_get_rotation(): Wrong camera object or camera move style"),null;c=c||new Float32Array(4);return g.get_rotation(a,c)};a.eye_set_look_at=function(a,d,f){b.is_eye_camera(a)?(d=d||z.get_trans_view(a.f.h),b.set_look_at(a,d,f),c.correct_up(a,a.f.Se,!0),g.n(a),l.sync_transform(a)):n.error("eye_set_look_at(): Wrong camera object or camera move style")};
a.eye_rotate=function(a,c,d,f,e){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,d,f||!1,e||!1),g.n(a),l.sync_transform(a)):n.error("eye_rotate(): Wrong camera object or camera move style")};a.eye_set_vertical_limits=function(a,c){if(b.is_eye_camera(a)){var d=a.f;c?"number"!=typeof c.down||"number"!=typeof c.up?n.error("eye_set_vertical_limits(): Incorrect limits object."):(d.s=d.s||{},d.s.down=c.down,d.s.up=c.up,d.s.Xf=c.down,d.s.Eg=c.up,d.s.camera_space=Boolean(c.camera_space),b.kw(a),g.n(a),l.sync_transform(a)):
d.s=null}else n.error("eye_set_vertical_limits(): Wrong camera object or camera move style")};a.eye_get_vertical_limits=function(a,c,d){if(!b.is_eye_camera(a))return n.error("eye_get_vertical_limits(): Wrong camera object or camera move style"),null;a=a.f;return a.s?(c=c||{},d?(c.down=a.s.Xf,c.up=a.s.Eg):(c.down=a.s.down,c.up=a.s.up),c.camera_space=d||!1,c):null};a.eye_set_horizontal_limits=function(a,c){if(b.is_eye_camera(a)){var d=a.f;c?"number"!=typeof c.left||"number"!=typeof c.right?n.error("eye_set_horizontal_limits(): Incorrect limits object."):
(d.ba=d.ba||{},d.ba.left=c.left,d.ba.right=c.right,d.ba.eg=c.left,d.ba.sg=c.right,d.ba.camera_space=Boolean(c.camera_space),b.jw(a),g.n(a),l.sync_transform(a)):d.ba=null}else n.error("eye_set_horizontal_limits(): Wrong camera object or camera move style")};a.eye_get_horizontal_limits=function(a,c,d){if(!b.is_eye_camera(a))return n.error("eye_get_horizontal_limits(): Wrong camera object or camera move style"),null;a=a.f;return a.ba?(c=c||{},d?(c.left=a.ba.eg,c.right=a.ba.sg):(c.left=a.ba.left,c.right=
a.ba.right),c.camera_space=d||!1,c):null};a.target_rotate=function(a,c,d,f,e){b.is_target_camera(a)?(b.rotate_target_camera(a,c,d,f||!1,e||!1),g.n(a),l.sync_transform(a)):n.error("target_rotate(): Wrong camera object or camera move style")};a.target_set_trans_pivot=function(a,c,d){b.is_target_camera(a)?(c=c||z.get_trans_view(a.f.h),d=d||a.f.Sa,b.set_trans_pivot(a,c,d),g.n(a),l.sync_transform(a)):n.error("target_set_trans_pivot(): Wrong camera object or camera move style")};a.target_set_distance=function(a,
c){if(b.is_target_camera(a)){var d=g.kj(a,a.f.Sa),f=Math.max(0,c);g.move_local(a,0,f-d,0);g.n(a);l.sync_transform(a)}else n.error("target_set_distance(): Wrong camera object or camera move style")};a.target_get_distance=function(a){return b.is_target_camera(a)?g.kj(a,a.f.Sa):(n.error("target_get_distance(): Wrong camera object or camera move style"),0)};a.target_zoom_object=function(a,c){if(b.is_target_camera(a)){var d=g.get_object_center(c,!1,C),f=g.get_object_size(c),e=b.Eu(a)/2,f=f/Math.sin(e),
e=g.kj(a,d);b.set_trans_pivot(a,z.get_trans_view(a.f.h),d);g.n(a);g.move_local(a,0,f-e,0);g.n(a);l.sync_transform(a)}else n.error("target_zoom_object(): Wrong camera object or camera move style")};a.target_get_pivot=function(a,c){if(!b.is_target_camera(a))return n.error("target_get_pivot(): Wrong camera object or camera move style"),null;c=c||new Float32Array(3);k.copy(a.f.Sa,c);return c};a.target_set_distance_limits=function(a,c){b.is_target_camera(a)?c&&("number"!=typeof c.min||"number"!=typeof c.max||
c.min>c.max)?n.error("target_set_distance_limits(): Wrong limits object"):(b.apply_distance_limits(a,c),g.n(a),l.sync_transform(a)):n.error("target_set_distance_limits(): Wrong camera object or camera move style")};a.target_get_distance_limits=function(a,c){if(!b.is_target_camera(a))return n.error("target_get_distance_limits(): Wrong camera object or camera move style"),null;var d=a.f;return d.hb?(c=c||{},c.min=d.hb.min,c.max=d.hb.max,c):null};a.target_set_vertical_limits=function(a,c){if(b.is_target_camera(a)){var d=
a.f;c?"number"!=typeof c.down||"number"!=typeof c.up?n.error("target_set_vertical_limits(): Wrong limits object"):(d.s=d.s||{},d.s.down=c.down,d.s.up=c.up,d.s.Xf=c.down,d.s.Eg=c.up,d.s.camera_space=Boolean(c.camera_space),b.kw(a),g.n(a),l.sync_transform(a)):d.s=null}else n.error("target_set_vertical_limits(): Wrong camera object or camera move style")};a.target_get_vertical_limits=function(a,c,d){if(!b.is_target_camera(a))return n.error("target_get_vertical_limits(): Wrong camera object or camera move style"),
null;a=a.f;return a.s?(c=c||{},d?(c.down=a.s.Xf,c.up=a.s.Eg):(c.down=a.s.down,c.up=a.s.up),c.camera_space=d||!1,c):null};a.target_set_horizontal_limits=function(a,c){if(b.is_target_camera(a)){var d=a.f;c?"number"!=typeof c.left||"number"!=typeof c.right?n.error("target_set_horizontal_limits(): Wrong limits object"):(d.ba=d.ba||{},d.ba.left=c.left,d.ba.right=c.right,d.ba.eg=c.left,d.ba.sg=c.right,d.ba.camera_space=Boolean(c.camera_space),b.jw(a),g.n(a),l.sync_transform(a)):d.ba=null}else n.error("target_set_horizontal_limits(): Wrong camera object or camera move style")};
a.target_get_horizontal_limits=function(a,c,d){if(!b.is_target_camera(a))return n.error("target_get_horizontal_limits(): Wrong camera object or camera move style"),null;a=a.f;return a.ba?(c=c||{},d?(c.left=a.ba.eg,c.right=a.ba.sg):(c.left=a.ba.left,c.right=a.ba.right),c.camera_space=d||!1,c):null};a.hover_rotate=function(a,c,d,f,e){b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,d,f||!1,e||!1),g.n(a),l.sync_transform(a)):n.error("hover_rotate(): Wrong camera object or camera move style")};a.hover_set_pivot_translation=
function(a,c){b.is_hover_camera(a)?(b.set_hover_pivot(a,c),g.n(a),l.sync_transform(a)):n.error("hover_set_pivot_translation(): Wrong camera object or camera move style")};a.hover_get_pivot=function(a,c){if(!b.is_hover_camera(a))return n.error("hover_get_pivot(): Wrong camera object or camera move style"),null;c=c||new Float32Array(3);k.copy(a.f.Ka,c);return c};a.hover_get_distance=function(a){return b.is_hover_camera(a)?g.kj(a,a.f.Ka):(n.error("hover_get_distance(): Wrong camera object or camera move style"),
0)};a.hover_set_vertical_limits=function(a,c){b.is_hover_camera(a)?"number"!=typeof c.down||"number"!=typeof c.up||c.down<c.up?n.error("hover_set_vertical_limits(): Wrong limits object"):(b.hover_set_vertical_limits(a,c),g.n(a),l.sync_transform(a)):n.error("hover_set_vertical_limits(): Wrong camera object or camera move style")};a.hover_get_vertical_limits=function(a,c){if(!b.is_hover_camera(a))return n.error("hover_get_vertical_limits(): Wrong camera object or camera move style"),null;var d=a.f;
c=c||{};c.down=d.s.down;c.up=d.s.up;return c};a.hover_set_distance_limits=function(a,c){b.is_hover_camera(a)?"number"!=typeof c.min||"number"!=typeof c.max||c.min>c.max?n.error("hover_set_distance_limits(): Wrong limits object"):(b.apply_distance_limits(a,c),g.n(a),l.sync_transform(a)):n.error("hover_set_distance_limits(): Wrong camera object or camera move style")};a.hover_get_distance_limits=function(a,c){if(!b.is_hover_camera(a))return n.error("hover_get_distance_limits(): Wrong camera object or camera move style"),
null;var d=a.f;c=c||{};c.min=d.hb.min;c.max=d.hb.max;return c};a.hover_set_vert_trans_limits=function(a,c){if(b.is_hover_camera(a)){var d=a.f;c?"number"!=typeof c.min||"number"!=typeof c.max||c.min>c.max?n.error("hover_set_vert_trans_limits(): Wrong limits object"):(d.tb=d.tb||{},d.tb.min=c.min,d.tb.max=c.max,g.n(a),l.sync_transform(a)):d.tb=null}else n.error("hover_set_vert_trans_limits(): Wrong camera object or camera move style")};a.hover_get_vert_trans_limits=function(a,c){if(!b.is_hover_camera(a))return n.error("hover_get_vert_trans_limits(): Wrong camera object or camera move style"),
null;var d=a.f;return d.tb?(c=c||{},c.min=d.tb.min,c.max=d.tb.max,c):null};a.hover_set_horiz_trans_limits=function(a,c){if(b.is_hover_camera(a)){var d=a.f;c?"number"!=typeof c.min||"number"!=typeof c.max||c.min>c.max?n.error("hover_set_horiz_trans_limits(): Wrong limits object"):(d.bc=d.bc||{},d.bc.min=c.min,d.bc.max=c.max,g.n(a),l.sync_transform(a)):d.bc=null}else n.error("hover_set_horiz_trans_limits(): Wrong camera object or camera move style")};a.hover_get_horiz_trans_limits=function(a,c){if(!b.is_hover_camera(a))return n.error("hover_get_horiz_trans_limits(): Wrong camera object or camera move style"),
null;var d=a.f;return d.bc?(c=c||{},c.min=d.bc.min,c.max=d.bc.max,c):null};a.hover_switch_horiz_rotation=function(a,c){if(!b.is_hover_camera(a))return n.error("hover_switch_horiz_rotation(): Wrong camera object or camera move style"),null;a.f.Vp=c};a.is_static_camera=b.is_static_camera;a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,c){if(!t.is_camera(a))return n.error("set_move_style(): Wrong camera object"),!1;
if(c!=b.MS_STATIC&&c!=b.MS_EYE_CONTROLS&&c!=b.MS_TARGET_CONTROLS&&c!=b.MS_HOVER_CONTROLS)return n.error("set_move_style(): Wrong move style"),!1;b.set_move_style(a,c);g.n(a);l.sync_transform(a);return!0};a.get_move_style=function(a){return t.is_camera(a)?b.get_move_style(a):(n.error("get_move_style(): Wrong camera object"),null)};a.set_translation=function(a,c){if(t.is_camera(a)){var d=a.f;if(b.is_target_camera(a)){var f=z.get_trans_view(d.h),f=k.subtract(c,f,C);k.add(f,d.Sa,d.Sa)}else b.is_hover_camera(a)&&
(f=z.get_trans_view(d.h),f=k.subtract(c,f,C),k.add(f,d.Ka,d.Ka));g.set_translation(a,c);g.n(a);l.sync_transform(a)}else n.error("set_translation(): Wrong camera object")};a.target_set_pivot_translation=function(a,c){b.is_target_camera(a)?(b.eG(a,c),g.n(a),l.sync_transform(a)):n.error("target_set_pivot_translation(): Wrong camera object or camera move style")};a.get_translation=function(a,b){if(!t.is_camera(a))return n.error("get_translation(): Wrong camera object"),null;b=b||new Float32Array(3);return g.get_translation(a,
b)};a.rotate_camera=function(a,c,d,f,e){t.is_camera(a)?(f=f||!1,e=e||!1,b.is_target_camera(a)?b.rotate_target_camera(a,c,d,f,e):b.is_eye_camera(a)?b.rotate_eye_camera(a,c,d,f,e):b.is_hover_camera(a)?b.rotate_hover_camera(a,c,d,f,e):b.is_static_camera(a)||n.error("rotate_camera(): Wrong camera move style"),g.n(a),l.sync_transform(a)):n.error("rotate_camera(): Wrong camera object")};a.set_velocities=function(a,b){if(t.is_camera(a)){var c=a.f;"number"==typeof b.trans&&(c.Nl=h.clamp(b.trans,0,Infinity));
"number"==typeof b.rot&&(c.Ml=h.clamp(b.rot,0,Infinity));"number"==typeof b.zoom&&(c.Ol=h.clamp(b.zoom,0,.99))}else n.error("set_velocities(): Wrong camera object")};a.get_velocities=function(a,b){if(!t.is_camera(a))return n.error("get_velocities(): Wrong camera object"),null;var c=a.f;b=b||{};b.trans=c.Nl;b.rot=c.Ml;b.zoom=c.Ol;return b};a.is_look_up=function(a){if(!t.is_camera(a))return n.error("is_look_up(): Wrong camera object"),!1;a=z.get_quat_view(a.f.h);return 0<=h.quat_to_dir(a,h.AXIS_MY,
C)[1]};a.get_camera_angles=function(a,c){if(!t.is_camera(a))return n.error("get_camera_angles(): Wrong camera object"),null;c=c||new Float32Array(2);b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){if(!t.is_camera(a))return n.error("get_camera_angles_char(): Wrong camera object"),null;c=c||new Float32Array(2);b.get_camera_angles_char(a,c);return c};a.set_stereo_distance=function(a,c){if(t.is_camera(a))for(var d=a.f.L,f=0;f<d.length;f++){var e=d[f];e.type!=b.xb&&e.type!=b.Gb||
b.Mw(e,c,e.Xd)}else n.error("set_stereo_distance(): Wrong camera object")};a.get_stereo_distance=function(a){if(!t.is_camera(a))return n.error("get_stereo_distance(): Wrong camera object"),0;a=a.f.L;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.xb||d.type==b.Gb)return d.Hj}return 0};a.set_eye_distance=function(a,c){if(t.is_camera(a))for(var d=a.f.L,f=0;f<d.length;f++){var e=d[f];e.type!=b.xb&&e.type!=b.Gb&&e.type!=b.kc&&e.type!=b.lc||b.Mw(e,e.Hj,c)}else n.error("set_eye_distance(): Wrong camera object")};
a.get_eye_distance=function(a){if(!t.is_camera(a))return n.error("get_eye_distance(): Wrong camera object"),0;a=a.f.L;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.xb||d.type==b.Gb||d.type==b.kc||d.type==b.lc)return d.Xd}return 0};a.set_vertical_axis=function(a,b){t.is_camera(a)?(k.copy(b,a.f.Se),g.n(a),l.sync_transform(a)):n.error("set_vertical_axis(): Wrong camera object")};a.get_vertical_axis=function(a,b){if(t.is_camera(a))return b||(b=k.create()),k.copy(a.f.Se,b),b;n.error("get_vertical_axis(): Wrong camera object")};
a.translate_view=function(a,c,d,h){if(t.is_camera(a)){a=a.f.L;for(var e=0;e<a.length;e++){var g=a[e];g.cc||b.zf(g,g.Ua);var k=C;k[0]=-c;k[1]=-d;k[2]=0;f.translate(g.lb,k,g.lb);f.rotateZ(g.lb,h,g.lb);b.kp(g);b.tm(g)}}else n.error("translate_view(): Wrong camera object")};a.get_fov=function(a){return t.is_camera(a)?h.xd(a.f.L[0].Jc):(n.error("get_fov(): Wrong camera object"),0)};a.set_fov=function(a,c){if(t.is_camera(a))for(var d=a.f.L,f=0;f<d.length;f++){var e=d[f];e.Jc=h.aC(c);e.cc||b.zf(e,e.Ua);
b.kp(e);b.tm(e)}else n.error("set_fov(): Wrong camera object")};a.set_hmd_fov=function(a,c,d){var f;if(f=!t.is_camera(a)){a:{if(t.is_camera(a)){f=a.f.L;for(var e=0;e<f.length;e++){var h=f[e];if(h.type==b.kc||h.type==b.lc){f=!0;break a}}}else n.error("is_hmd_camera(): Wrong camera object");f=!1}f=!f}if(f)n.error("set_hmd_fov(): Wrong camera object");else if(c&&d)for(a=a.f.L,f=0;f<a.length;f++)if(e=a[f],e.type==b.kc||e.type==b.lc)e.type==b.kc&&u.copy(c,e.Lc),e.type==b.lc&&u.copy(d,e.Lc),e.cc||b.zf(e),
b.kp(e),b.tm(e)};a.correct_up=function(a,b,d){t.is_camera(a)?(b=b||a.f.Se,c.correct_up(a,b,d||!1),g.n(a),l.sync_transform(a)):n.error("correct_up(): Wrong camera object")};a.set_ortho_scale=function(a,c){if(t.is_camera(a)&&b.is_ortho_camera(a)){var d=a.f;if(b.is_target_camera(a)){var f=z.get_trans_view(d.h),f=k.dist(f,d.Sa);d.Wi=c/2*d.Vi/f}else b.is_hover_camera(a)?(f=z.get_trans_view(d.h),f=k.distance(f,d.Ka),d.Wi=c/2*d.Vi/f):a.f.L[0].top=c/2;b.xH(a)}else n.error("set_ortho_scale(): Wrong camera object")};
a.get_ortho_scale=function(a){return t.is_camera(a)&&b.is_ortho_camera(a)?2*a.f.L[0].top:(n.error("get_ortho_scale(): Wrong camera object"),0)};a.is_ortho_camera=function(a){return t.is_camera(a)?b.is_ortho_camera(a):(n.error("is_ortho_camera(): Wrong camera object"),!1)};a.calc_ray=function(a,c,d,f){if(!t.is_camera(a))return n.error("calc_ray(): Wrong camera object"),null;f=f||new Float32Array(3);var e=a.f.L[0];switch(e.type){case b.mc:case b.Ue:case b.xb:case b.Gb:var h=Math.tan(e.Jc*Math.PI/360),
g=h*e.Ua;c=q.np(c,d,w,e);C[0]=(2*c[0]/e.width-1)*g;C[1]=-1;C[2]=(2*c[1]/e.height-1)*h;z.transform_dir_vec3(C,a.f.h,C);f[0]=C[0];f[1]=C[1];f[2]=C[2];k.normalize(f,f);return f;default:return n.error("calc_ray(): Non-compatible camera"),f}};a.project_point=function(a,c,d){if(!t.is_camera(a))return n.error("project_point(): Wrong camera object"),null;d=d||new Float32Array(2);return b.project_point(a,c,d)};a.has_distance_limits=function(a){return b.is_target_camera(a)?null!==a.f.hb:(n.error("has_distance_limits(): Wrong camera object or camera move style"),
!1)};a.has_vertical_rot_limits=function(a){return b.is_target_camera(a)||b.is_eye_camera(a)?null!==a.f.s:(n.error("has_vertical_rot_limits(): Wrong camera object or camera move style"),!1)};a.has_vertical_limits=function(a){n.Ga("has_vertical_limits","has_vertical_rot_limits");return b.is_target_camera(a)||b.is_eye_camera(a)?null!==a.f.s:(n.error("has_vertical_limits(): Wrong camera object"),!1)};a.has_horizontal_rot_limits=function(a){return b.is_target_camera(a)||b.is_eye_camera(a)?null!==a.f.ba:
(n.error("has_horizontal_rot_limits(): Wrong camera object or camera move style"),!1)};a.has_horizontal_limits=function(a){n.Ga("has_horizontal_limits","has_horizontal_rot_limits");return b.is_target_camera(a)||b.is_eye_camera(a)?null!==a.f.ba:(n.error("has_horizontal_limits(): Wrong camera object"),!1)};a.has_vertical_trans_limits=function(a){return b.is_hover_camera(a)?null!==a.f.tb:(n.error("has_vertical_trans_limits(): Wrong camera object or camera move style"),!1)};a.has_horizontal_trans_limits=
function(a){return b.is_hover_camera(a)?null!==a.f.bc:(n.error("has_horizontal_trans_limits(): Wrong camera object or camera move style"),!1)};a.move_pivot=function(a,c,d){n.Ga("move_pivot","target_pan_pivot");if(b.is_target_camera(a)){var f=a.f;if(f.Bs){var e=z.get_trans_view(f.h),h=k.subtract(e,f.Sa,E);C[0]=c;C[1]=0;C[2]=d;k.scale(C,k.len(h),C);z.transform_dir_vec3(C,f.h,C);k.add(f.Sa,C,f.Sa);k.add(e,C,e);g.n(a);l.sync_transform(a)}}else n.error("move_pivot(): wrong object")};a.target_pan_pivot=
function(a,c,d){if(b.is_target_camera(a)){var f=a.f;f.Bs&&(C[0]=c,C[1]=0,C[2]=d,z.transform_dir_vec3(C,f.h,C),k.add(f.Sa,C,f.Sa),c=z.get_trans_view(f.h),k.add(c,C,c),g.n(a),l.sync_transform(a))}else n.error("target_pan_pivot(): wrong object")};a.set_velocity_params=function(a,b){n.Ga("set_velocity_params","set_velocities");if(t.is_camera(a)){var c=a.f;c.Nl=h.clamp(b[0],0,Infinity);c.Ml=h.clamp(b[1],0,Infinity);c.Ol=h.clamp(b[2],0,.99)}else n.error("set_velocity_params(): Wrong camera object")};a.get_velocity_params=
function(a,b){n.Ga("get_velocity_params","get_velocities");if(!t.is_camera(a))return n.error("get_velocity_params(): Wrong camera object"),null;b=b||new Float32Array(3);var c=a.f;b[0]=c.Nl;b[1]=c.Ml;b[2]=c.Ol;return b};a.clear_horizontal_limits=function(a){n.Nm('camera.clear_horizontal_limits() deprecated, use camera.target_set_horizontal_limits(), camera.eye_set_horizontal_limits() or camera.hover_set_horiz_trans_limits() with passing NULL as the "limits" argument.');t.is_camera(a)?b.is_target_camera(a)||
b.is_eye_camera(a)?a.f.ba=null:b.is_hover_camera(a)&&(a.f.bc=null):n.error("clear_horizontal_limits(): Wrong camera object")};a.clear_vertical_limits=function(a){n.Nm('camera.clear_vertical_limits() deprecated, use camera.target_set_vertical_limits(), camera.eye_set_vertical_limits() or camera.hover_set_vert_trans_limits() with passing NULL as the "limits" argument.');t.is_camera(a)?b.is_target_camera(a)||b.is_eye_camera(a)?a.f.s=null:b.is_hover_camera(a)&&(a.f.tb=null):n.error("clear_vertical_limits(): Wrong camera object")};
a.clear_hover_angle_limits=function(){n.Nm("camera.clear_hover_angle_limits() deprecated, HOVER camera always has hover angle limits")};a.set_look_at=function(a,d,f,h){n.jf("camera.set_look_at",["camera.static_set_look_at","camera.eye_set_look_at"]);h=h||a.f.Se;b.set_look_at(a,d,f);c.correct_up(a,h,!0);g.n(a);l.sync_transform(a)};a.rotate_eye_camera=function(a,c,d,f,e){n.jf("camera.rotate_eye_camera",["camera.eye_rotate","camera.rotate_camera"]);b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,d,f,e),
g.n(a),l.sync_transform(a)):n.error("rotate_eye_camera(): wrong object")};a.rotate_target_camera=function(a,c,d,f,e){n.jf("camera.rotate_target_camera",["camera.target_rotate","camera.rotate_camera"]);b.is_target_camera(a)?(b.rotate_target_camera(a,c,d,f,e),g.n(a),l.sync_transform(a)):n.error("rotate_target_camera(): wrong object")};a.set_trans_pivot=function(a,c,d){n.Ga("camera.set_trans_pivot","camera.target_set_trans_pivot");b.is_target_camera(a)?(b.set_trans_pivot(a,c,d),g.n(a),l.sync_transform(a)):
n.error("set_trans_pivot(): Wrong object or camera move style")};a.zoom_object=function(a,c){n.Ga("camera.zoom_object","camera.target_zoom_object");if(b.is_target_camera(a)){g.get_object_center(c,!1,C);d(a,C);g.n(a);var f=g.get_object_size(c),h=b.Eu(a)/2,f=f/Math.sin(h),h=g.kj(a,C);g.move_local(a,0,f-h,0);g.n(a);l.sync_transform(a)}else n.error("zoom_object(): wrong object")};a.set_pivot=d;a.rotate_hover_camera=function(a,c,d,f,e){n.Ga("camera.rotate_hover_camera","camera.hover_rotate");b.is_hover_camera(a)?
(b.rotate_hover_camera(a,c,d,f,e),g.n(a),l.sync_transform(a)):n.error("rotate_hover_camera(): wrong object")};a.get_hover_cam_pivot=function(a,c){n.Ga("camera.get_hover_cam_pivot","camera.hover_get_pivot");if(!b.is_hover_camera(a))return n.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));k.copy(a.f.Ka,c);return c};a.get_eye=function(a,c){n.Ga("camera.get_eye","camera.get_translation");return t.is_camera(a)?b.get_eye(a,c):(n.error("get_eye(): Wrong object"),null)};a.get_pivot=
function(a,c){n.Ga("camera.get_pivot","camera.target_get_pivot");if(!b.is_target_camera(a))return n.error("get_pivot(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));k.copy(a.f.Sa,c);return c};a.hover_cam_set_translation=function(a,c){n.Ga("camera.hover_cam_set_translation","camera.set_translation");if(b.is_hover_camera(a)){var d=a.f,f=z.get_trans_view(d.h),f=k.subtract(c,f,C);k.add(f,d.Ka,d.Ka);g.set_translation(a,c);g.n(a);l.sync_transform(a)}else n.error("hover_cam_set_translation(): wrong object")};
a.set_hover_pivot=function(a,c){n.Ga("camera.set_hover_pivot","camera.hover_set_pivot_translation");b.is_hover_camera(a)?(b.set_hover_pivot(a,c),g.n(a),l.sync_transform(a)):n.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){n.Ga("camera.get_hover_angle_limits","camera.hover_get_vertical_limits");if(!b.is_hover_camera(a))return n.error("get_hover_angle_limits(): wrong object"),null;c=c||new Float32Array(2);c[0]=a.f.s.down;c[1]=a.f.s.up;return c};
a.get_cam_dist_limits=function(a,c){n.jf("camera.get_cam_dist_limits",["camera.hover_get_distance_limits","camera.target_get_distance_limits"]);if(!b.is_hover_camera(a)&&!b.is_target_camera(a))return n.error("get_cam_dist_limits(): wrong object"),null;if(a.f.hb)c=c||new Float32Array(2),c[0]=a.f.hb.max,c[1]=a.f.hb.min;else return null;return c};a.apply_vertical_limits=function(c,d,f,h){n.jf("camera.apply_vertical_limits",["camera.eye_set_vertical_limits","camera.target_set_vertical_limits","camera.hover_set_vert_trans_limits"]);
if(b.is_target_camera(c)){var e=G;e.down=d;e.up=f;e.camera_space=h==g.SPACE_LOCAL;a.target_set_vertical_limits(c,e)}else b.is_eye_camera(c)?(e=G,e.down=d,e.up=f,e.camera_space=h==g.SPACE_LOCAL,a.eye_set_vertical_limits(c,e)):b.is_hover_camera(c)?(e=G,e.min=d,e.max=f,a.hover_set_vert_trans_limits(c,e)):n.error("apply_vertical_limits(): wrong object")};a.apply_hover_angle_limits=function(b,c,d){n.Ga("camera.apply_hover_angle_limits","camera.hover_set_vertical_limits");G.down=c;G.up=d;a.hover_set_vertical_limits(b,
G)};a.apply_distance_limits=function(c,d,f){n.jf("camera.apply_distance_limits",["camera.target_set_distance_limits","camera.hover_set_distance_limits"]);if(b.is_target_camera(c)){var h=G;h.min=d;h.max=f;a.target_set_distance_limits(c,h)}else b.is_hover_camera(c)?(h=G,h.min=d,h.max=f,a.hover_set_distance_limits(c,h)):n.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(b){n.Ga("camera.clear_distance_limits","camera.target_set_distance_limits");a.target_set_distance_limits(b,
null)};a.get_vertical_limits=function(a,c){n.jf("camera.get_vertical_limits",["camera.eye_get_vertical_limits","camera.target_get_vertical_limits","camera.hover_get_vert_trans_limits"]);if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return n.error("get_vertical_limits(): wrong object"),null;var d=a.f;c=c||new Float32Array(2);if(b.is_eye_camera(a)||b.is_target_camera(a)){if(d.s)return c[0]=d.s.down,c[1]=d.s.up,c}else if(b.is_hover_camera(a)&&d.tb)return c[0]=d.tb.min,c[1]=d.tb.max,
c;return null};a.apply_horizontal_limits=function(c,d,f,h){n.jf("camera.apply_horizontal_limits",["camera.eye_set_horizontal_limits","camera.target_set_horizontal_limits","camera.hover_set_horiz_trans_limits"]);if(b.is_target_camera(c)){var e=G;e.left=d;e.right=f;e.camera_space=h==g.SPACE_LOCAL;a.target_set_horizontal_limits(c,e)}else b.is_eye_camera(c)?(e=G,e.left=d,e.right=f,e.camera_space=h==g.SPACE_LOCAL,a.eye_set_horizontal_limits(c,e)):b.is_hover_camera(c)?(e=G,e.min=d,e.max=f,a.hover_set_horiz_trans_limits(c,
e)):n.error("apply_horizontal_limits(): wrong object")};a.get_horizontal_limits=function(a,c){n.jf("camera.get_horizontal_limits",["camera.eye_get_horizontal_limits","camera.target_get_horizontal_limits","camera.hover_get_horiz_trans_limits"]);if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return n.error("get_horizontal_limits(): wrong object"),null;var d=a.f;c=c||new Float32Array(2);if(b.is_eye_camera(a)||b.is_target_camera(a)){if(d.ba)return c[0]=d.ba.left,c[1]=d.ba.right,
c}else if(b.is_hover_camera(a)&&d.bc)return c[0]=d.bc.min,c[1]=d.bc.max,c;return null}};b4w.module.config=function(a,p){var d=p("__config");a.P_LOW=d.P_LOW;a.P_HIGH=d.P_HIGH;a.P_ULTRA=d.P_ULTRA;a.P_CUSTOM=d.P_CUSTOM;a.set=d.set;a.get=d.get;a.reset=d.reset;a.get_std_assets_path=d.get_std_assets_path};b4w.module.controls=function(a,p){var d=p("__controls");p("__print");a.CT_POSITIVE=d.CT_POSITIVE;a.CT_CONTINUOUS=d.CT_CONTINUOUS;a.CT_TRIGGER=d.CT_TRIGGER;a.CT_SHOT=d.CT_SHOT;a.CT_LEVEL=d.CT_LEVEL;a.CT_CHANGE=d.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;
a.KEY_8=56;a.KEY_9=57;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=
187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=d.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=d.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=d.PL_MULTITOUCH_MOVE_PAN;a.PL_MULTITOUCH_MOVE_ROTATE=d.PL_MULTITOUCH_MOVE_ROTATE;a.create_custom_sensor=d.create_custom_sensor;a.create_keyboard_sensor=d.create_keyboard_sensor;a.create_collision_sensor=
function(a,c,p){return d.create_collision_sensor(a,c||"ANY",p||!1)};a.create_collision_impulse_sensor=d.create_collision_impulse_sensor;a.create_ray_sensor=function(a,c,p,f,t,l,n){return d.create_ray_sensor(a,c,p,f||"ANY",t||!1,l||!1,n||!1)};a.create_mouse_click_sensor=d.create_mouse_click_sensor;a.create_mouse_wheel_sensor=d.create_mouse_wheel_sensor;a.create_mouse_move_sensor=d.create_mouse_move_sensor;a.create_touch_move_sensor=d.create_touch_move_sensor;a.create_touch_zoom_sensor=d.create_touch_zoom_sensor;
a.create_touch_rotate_sensor=d.create_touch_rotate_sensor;a.create_motion_sensor=d.create_motion_sensor;a.create_vertical_velocity_sensor=d.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=d.create_gyro_angles_sensor;a.create_gyro_delta_sensor=d.create_gyro_delta_sensor;a.create_timer_sensor=function(a,c){return d.create_timer_sensor(a,c||!1)};a.reset_timer_sensor=d.reset_timer_sensor;a.create_elapsed_sensor=d.create_elapsed_sensor;a.create_timeline_sensor=d.create_timeline_sensor;a.create_selection_sensor=
function(a,c){return d.create_selection_sensor(a,c||!1)};a.create_callback_sensor=function(a,c){return d.create_callback_sensor(a,c||0)};a.set_custom_sensor=function(a,c){d.PF(a,c)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=d.get_sensor_value;a.get_sensor_payload=d.get_sensor_payload;a.create_sensor_manifold=function(a,c,p,f,t,l,n){t=t||d.eu;d.create_sensor_manifold(a,c,p,f,t,l,void 0===n?null:n)};a.create_kb_sensor_manifold=function(a,c,p,f,t,l){f=d.create_keyboard_sensor(f);
d.create_sensor_manifold(a,c,p,[f],d.eu,t,void 0===l?null:l)};a.check_sensor_manifolds=function(a){return d.check_sensor_manifold(a,null)};a.check_sensor_manifold=d.check_sensor_manifold;a.remove_sensor_manifold=d.remove_sensor_manifold;a.reset=d.reset;a.register_keyboard_events=d.register_keyboard_events;a.register_mouse_events=function(a,c,p){d.register_mouse_events(a,c,!!p)};a.register_wheel_events=d.register_wheel_events;a.register_touch_events=d.register_touch_events;a.register_device_orientation=
d.register_device_orientation;a.unregister_keyboard_events=d.unregister_keyboard_events;a.unregister_mouse_events=d.unregister_mouse_events;a.unregister_wheel_events=d.unregister_wheel_events;a.unregister_touch_events=d.unregister_touch_events;a.unregister_device_orientation=d.unregister_device_orientation};b4w.module.constraints=function(a,p){var d=p("__camera"),b=p("__constraints"),c=p("__obj_util"),q=p("__physics"),f=p("__print"),t=p("__transform");a.append_stiff=function(a,c,d,f,h){h=h||1;c instanceof Array&&2==c.length?b.Xz(a,c[0],c[1],d,f,h):b.kt(a,c,d,f,h);t.n(a);q.sync_transform(a)};a.append_semi_stiff=function(a,c,d,f){b.Wz(a,c,d,f);t.n(a);q.sync_transform(a)};a.append_semi_stiff_cam=function(a,c,g,p,h,k,u,w){d.is_eye_camera(a)?(b.Vz(a,c,g,p,h,k,u,w),t.n(a),q.sync_transform(a)):f.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented.")};
a.append_semi_soft_cam=function(a,c,g,p){if(d.is_eye_camera(a)){if(!p||0>p)p=.25;b.Uz(a,c,g,p);t.n(a);q.sync_transform(a)}else f.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_stiff_trans=function(a,c,d){b.Zz(a,c,d);t.n(a);q.sync_transform(a)};a.append_copy_trans=function(a,c,d){b.Pz(a,c,d);t.n(a);q.sync_transform(a)};a.append_stiff_trans_rot=function(a,c,d,f){b.$z(a,c,d,f);t.n(a);q.sync_transform(a)};a.append_track=function(a,c){3==c.length?
b.cA(a,c):b.bA(a,c);t.n(a);q.sync_transform(a)};a.append_follow=function(a,c,d,f){3==c.length?b.Rz(a,c,d,f):b.Qz(a,c,d,f);t.n(a);q.sync_transform(a)};a.append_stiff_viewport=function(a,c,d){b.append_stiff_viewport(a,c,d);t.n(a);q.sync_transform(a)};a.remove=function(a){a.gb&&b.remove(a)};a.get_parent=function(a){f.Ga("constraints.get_parent","objects.get_parent");return c.get_parent(a)}};b4w.module.container=function(a,p){var d=p("__container"),b=p("__print");a.get_canvas=d.get_canvas;a.get_canvas_hud=d.get_canvas_hud;a.get_container=d.get_container;a.insert_to_container=function(a,p){2!=arguments.length?b.error("insert_to_container(): two arguments required"):a&&p&&d.insert_to_container(a,p)};a.set_canvas_offsets=d.set_canvas_offsets;a.update_canvas_offsets=d.update_canvas_offsets;a.client_to_canvas_coords=d.client_to_canvas_coords;a.force_offsets_updating=d.force_offsets_updating;
a.resize=function(a,p,f){a&&p||b.warn("Wrong canvas container dimensions: "+a+"x"+p+". Zero dimensions aren't allowed. Resized to: "+d.Fo+"x"+d.Eo+".");d.resize(a,p,f)}};b4w.module.data=function(a,p){var d=p("__data"),b=p("__loader");p("__print");p("__util");a.load=d.load;a.unload=function(a){d.unload(a|0)};a.set_debug_resources_root=d.set_debug_resources_root;a.is_primary_loaded=d.is_primary_loaded;a.is_idle=b.uh;a.load_and_add_new=d.load;a.cleanup=a.unload;a.activate_media=d.activate_media};b4w.module.debug=function(a,p){function d(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var f=d.split(" ")[0];f in b||(b[f]=0);b[f]++}}c=a=0;for(f in b)switch(f){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[f];break;default:a+=b[f]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function b(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function c(a){a.sort(function(a,b){return b.gq.ALU_OPS-a.gq.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.gq,f=c.dI,h=q(c.QB),h=h?"\t\t("+h.join(", ")+")":"\t\t(NA)";k.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,h);k.groupCollapsed("directives");for(var h=c.wb.Wf,g=0;g<h.length;g++){var m=h[g];k.log(m[0],m[1])}k.groupEnd();k.groupCollapsed("vert src");
k.log(c.cI);k.groupEnd();k.groupCollapsed("vert stats");for(var l in f)"ALU_OPS"!=l&&"TEX_OPS"!=l&&k.log(l,f[l]);k.groupEnd();k.groupCollapsed("frag src");k.log(c.LC);k.groupEnd();k.groupCollapsed("frag stats");for(l in d)"ALU_OPS"!=l&&"TEX_OPS"!=l&&k.log(l,d[l]);k.groupEnd();k.groupEnd()}}function q(a){for(var b=w.Mi(),c=0;c<b.length;c++)for(var d=b[c],f=g.Ia(d,"MESH",g.DATA_ID_ALL),h=0;h<f.length;h++){var k=z.Pa(f[h],d);if(k&&k.T.length)for(var k=k.T,m=0;m<k.length;m++){var l=k[m];if(l.dc==a&&l.rd.length)return l.rd}}return null}
p("__batch");p("__config");var f=p("__controls"),t=p("__debug"),l=p("__extensions"),n=p("__loader"),g=p("__objects"),z=p("__obj_util"),h=p("__physics"),k=p("__print"),u=p("__renderer"),w=p("__scenes"),C=p("__scenegraph"),E=p("__sfx"),G=p("__shaders"),m=p("__textures"),x=p("__util"),A=p("vec3");a.WM_NONE=t.WM_NONE;a.WM_OPAQUE_WIREFRAME=t.WM_OPAQUE_WIREFRAME;a.WM_TRANSPARENT_WIREFRAME=t.WM_TRANSPARENT_WIREFRAME;a.WM_FRONT_BACK_VIEW=t.WM_FRONT_BACK_VIEW;a.WM_DEBUG_SPHERES=t.WM_DEBUG_SPHERES;a.physics_stats=
function(){h.YB()};a.physics_id=function(a){k.log("O",h.AC(a));for(var b=h.aD().yb.q,c=0;c<b.length;c++){var d=b[c];d.o.v==a&&k.log("B",d)}};a.visible_objects=function(){for(var a=w.get_active(),b=g.Ia(a,"MESH",g.DATA_ID_ALL),a=[w.Z(a,"MAIN_OPAQUE"),w.Z(a,"MAIN_BLEND"),w.Z(a,"MAIN_GLOW")],c=0;c<a.length;c++){var d=a[c],f=d.q;if(f.length){k.group(d.type,"DYNAMIC");for(var h=0;h<b.length;h++){var m=b[h],l=m.f;if("DYNAMIC"==l.type)for(var n=0;n<f.length;n++){var p=f[n];if(p.Ib&&p.ke==l){k.Vq(m.name,
m);break}}}k.groupEnd();k.groupCollapsed(d.type,"STATIC");for(h=0;h<b.length;h++)if(m=b[h],l=m.f,"DYNAMIC"!=l.type)for(n=0;n<f.length;n++)if(p=f[n],p.Ib&&p.ke==l){k.Vq(m.name,m);break}k.groupEnd()}}};a.object_info=function(a){for(var b=w.get_active(),c=g.Ia(b,"MESH",g.DATA_ID_ALL),d=0;d<c.length;d++){var f=c[d];if(f.name==a){k.log("Object",f);for(var h=w.lq(b),m=0;m<h.length;m++){for(var l=h[m],n=l.q,p=[],q=0;q<n.length;q++)n[q].ke==f.f&&p.push(n[q]);k.log("Subscene "+l.type,p)}}}};a.objects_stat=
function(){var a=w.get_active();console.log("Armatures: "+g.Ia(a,"ARMATURE",g.DATA_ID_ALL).length);console.log("Cameras: "+g.Ia(a,"CAMERA",g.DATA_ID_ALL).length);console.log("Curves: "+g.Ia(a,"CURVE",g.DATA_ID_ALL).length);console.log("Empties: "+g.Ia(a,"EMPTY",g.DATA_ID_ALL).length);console.log("Lamps: "+g.Ia(a,"LAMP",g.DATA_ID_ALL).length);console.log("Meshes: "+g.Ia(a,"MESH",g.DATA_ID_ALL).length);console.log("Speakers: "+g.Ia(a,"SPEAKER",g.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=
0,b=w.get_active(),b=[w.Z(b,"MAIN_OPAQUE"),w.Z(b,"MAIN_BLEND"),w.Z(b,"MAIN_GLOW")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.q,f=0;f<d.length;f++){var h=d[f].G;h&&(a+=h.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=w.get_active(),b=[w.Z(b,"MAIN_OPAQUE"),w.Z(b,"MAIN_BLEND"),w.Z(b,"MAIN_GLOW")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.q,f=0;f<d.length;f++){var h=d[f].G;h&&(a+=h.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=w.get_active(),b=[w.Z(a,"MAIN_OPAQUE"),
w.Z(a,"MAIN_BLEND"),w.Z(a,"MAIN_GLOW")],c=0,d=0;d<b.length;d++){var f=b[d];f&&(c+=f.q.length)}a=w.lx(a,["MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"]);for(d=0;d<a.length;d++)f=a[d],c="MAIN_PLANE_REFLECT"==f.type?c+f.q.length:c+6*f.q.length;return c};a.num_shaders=function(){return x.Sk(G.Iu())};a.geometry_stats=function(){for(var a=w.get_active(),b=w.lq(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var f=d.q,h=0;h<f.length;h++){var g=f[h].G,k=f[h].ke;g&&("COLOR_PICKING"!=
d.type&&"OUTLINE_MASK"!=d.type||k.Bn||k.An)&&(a[g.id]=g)}}var f=d=c=b=0,m;for(m in a)g=a[m],g=g.O,g.Em&&(d++,f+=g.Em/1048576),b++,c+=g.du/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:f}};a.num_textures=function(){for(var a=[],b=0,c=w.get_active(),c=[w.Z(c,"MAIN_OPAQUE"),w.Z(c,"MAIN_BLEND"),w.Z(c,"MAIN_GLOW")],d=0;d<c.length;d++){var f=c[d];if(f)for(var f=f.q,h=0;h<f.length;h++){var g=f[h].G;if(g)for(var g=g.U,k=0;k<g.length;k++){var m=g[k];if("IMAGE"===m.source||"ENVIRONMENT_MAP"===
m.source){var l=m.Na;-1===a.indexOf(l)&&(a.push(l),m=m.width*m.height*4/1048576/m.xp,m*=1.3333,b+=m)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=w.get_active(),c=w.lq(c),d=0;d<c.length;d++){var f=c[d];if("SINK"!=f.type){var h=f.j,g=[h.Hb,h.Ld];g.push.apply(g,f.Pe);for(f=0;f<g.length;f++){var k=g[f];m.Zi(k)&&-1==a.indexOf(k)&&(a.push(k),b+=h.width*h.height*m.BD(k))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=
w.get_active();(a=w.Z(a,"MAIN_OPAQUE"))&&w.Dv(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=w.get_active(),b=w.Z(a,"MAIN_OPAQUE"),a=w.lx(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],f;switch(c){case 0:f=[1,0,0];break;case 1:f=[0,1,0];break;case 2:f=[0,0,1];break;default:f=[1,0,1]}w.Dv(d.j,b,f)}};a.scenegraph_to_dot=function(){for(var a=w.Mi(),b=0;b<a.length;b++)k.log("\n"+C.VB(w.Lu(a[b])))};a.scenes_to_dot=function(){};a.loading_graph_to_dot=function(){k.log("\n"+n.HD())};
a.controls_info=f.debug;a.object_distance=function(a,b){var c=m_tsr.get_trans_view(a.f.h),d=m_tsr.get_trans_view(b.f.h);return A.dist(c,d)};a.msg=t.msg;a.fbmsg=t.fbmsg;a.print_telemetry=t.print_telemetry;a.plot_telemetry=t.plot_telemetry;a.fbres=function(a,b){function c(){t.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),f=new Float32Array([0,0,1]),h=new Float32Array([-1,
0,0]),g=new Float32Array([0,-1,0]),k=new Float32Array([0,0,-1]);if(!x.Rf(a,x.Ws))throw"Wrong VEC3_IDENT";if(!x.Rf(b,x.Vs))throw"Wrong QUAT4_IDENT";if(!x.Rf(c,x.AXIS_X))throw"Wrong AXIS_X";if(!x.Rf(d,x.AXIS_Y))throw"Wrong AXIS_Y";if(!x.Rf(f,x.AXIS_Z))throw"Wrong AXIS_Z";if(!x.Rf(h,x.AXIS_MX))throw"Wrong AXIS_MX";if(!x.Rf(g,x.AXIS_MY))throw"Wrong AXIS_MY";if(!x.Rf(k,x.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=E.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==
E.qq(c)&&E.mute(c,!0)}};a.check_finite=function(a){t.check_finite(a)};a.set_debug_params=function(a){var b=w.get_active();if(b=w.Z(b,"WIREFRAME")){if("number"==typeof a.wireframe_mode)switch(a.wireframe_mode){case t.WM_NONE:case t.WM_OPAQUE_WIREFRAME:case t.WM_TRANSPARENT_WIREFRAME:case t.WM_FRONT_BACK_VIEW:case t.WM_DEBUG_SPHERES:w.jG(b,a.wireframe_mode);break;default:k.error("set_debug_params(): Wrong wireframe mode")}"object"==typeof a.wireframe_edge_color&&w.iG(b,a.wireframe_edge_color)}else throw"Wireframe subscene not found.";
};a.get_error_quantity=function(){return k.oD()};a.get_warning_quantity=function(){return k.FD()};a.clear_errors_warnings=function(){return k.clear_errors_warnings()};a.analyze_shaders=function(a){var f=G.Iu(),h=0,g;for(g in f)a&&-1===g.indexOf(a)||h++;var h="of "+h+" analyzing...",m={};for(g in f)if(!a||-1!==g.indexOf(a)){var n=f[g],p;var q=n.Gs;p=n.yu;var t=l.mq();if(t){q=t.getTranslatedShaderSource(q);p=t.getTranslatedShaderSource(p);q=q.replace("#version","#version 400 //");p=p.replace("#version",
"#version 400 //");var t=b("/nvidia_vert",q),u=d(t),w=b("/nvidia_frag",p),A=d(w);p={cI:q,hL:t,dI:u,LC:p,JJ:w,gq:A}}else k.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),p=void 0;t=n.wb;q=t.Rj+" + "+t.Ji;p.QB=n;p.wb=t;n=m[q]=m[q]||[];n.push(p);k.log(h)}for(q in m)k.group("%c"+q,"color: #800"),n=m[q],c(n),k.groupEnd()};a.fake_load=t.fake_load;a.test_performance=function(a){if(l.Um()){var b=C.AB();w.Bu(b);for(var c=C.qb(b,"PERFORMANCE"),b=0;10>b;b++)u.Di(c);
window.setTimeout(function(){t.sF(c);a(c.Tf)},100)}else a(-1)}};b4w.module.geometry=function(a,p){var d=p("__batch"),b=p("__geometry"),c=p("__print"),q=p("__renderer");a.extract_vertex_array=function(a,p,l){if(!b.Ti(a))return c.error("Wrong object:",a.name),null;if(a=d.Ha(a,p,"MAIN")){if((p=a.O)&&p.Eb&&p.Eb[l])return b.tC(p,l);c.error("Attribute not found:"+l);return null}c.error("Wrong material:",p);return null};a.extract_index_array=function(a,p){if(!b.Ti(a))return c.error("Wrong object:",a.name),null;var l=d.Ha(a,p,"MAIN");if(l){if((l=l.O)&&l.Eb)return l.bg;
c.error("Buffer data not found");return null}c.error("Wrong material:",p);return null};a.update_vertex_array=function(a,p,l,n){var g=["MAIN","DEPTH","COLOR_ID"];if(b.Ti(a))for(var q=0;q<g.length;q++){var h=d.Ha(a,p,g[q]);h&&(h=h.O)&&h.Eb&&h.Eb[l]&&b.lo(h,l,0,n)}else c.error("Wrong object:",a.name)};a.override_geometry=function(a,p,l,n,g){var z=["MAIN","DEPTH","COLOR_ID"];if(b.Ti(a))if(l instanceof Uint16Array||l instanceof Uint32Array)if(n instanceof Float32Array)for(var h=0;h<z.length;h++){var k=
d.Ha(a,p,z[h]);if(k){var u=k.O;if(u){b.Ax(u,k.Ce,l);var w=0,C;for(C in u.Eb)var E=u.Eb[C],w=w+n.length/3*E.Ud;u.xc=new Float32Array(w);var w=u.xc,G=0;for(C in u.Eb)switch(E=u.Eb[C],C){case "a_position":w.set(n,G);E.offset=G;E.length=n.length;G+=E.length;break;case "a_normal":var m;g&&(m=b.zt(l,n,n));var x=b.yt(l,n,m);w.set(x,G);E.offset=G;E.length=n.length;G+=E.length;break;case "a_tangent":E.offset=G;E.length=n.length/3*E.Ud;for(var x=new Float32Array(E.length),A=0;A<x.length;A+=4)x[A]=1,x[A+3]=
1;w.set(x,G);G+=E.length;break;default:E.offset=G,E.length=n.length/3*E.Ud,x=new Float32Array(E.length),w.set(x,G),G+=E.length}b.Ex(u);q.To(k);(k=d.nd(a,k))&&k.O&&(k.O=u)}}}else c.error("Wrong positions_array type");else c.error("Wrong ibo_array type");else c.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,d,l){b.check_shape_keys(a)?b.wq(a,d)?b.lt(a,d,parseFloat(l)):c.error("Wrong key name:",d):c.error("Wrong object:",a.name)};a.check_shape_keys=function(a){return b.check_shape_keys(a)};
a.get_shape_keys_names=function(a){return b.check_shape_keys(a)?b.get_shape_keys_names(a):(c.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,d){return b.check_shape_keys(a)?b.wq(a,d)?b.get_shape_key_value(a,d):(c.error("Wrong key name:",d),null):(c.error("Wrong object:",a.name),null)};a.draw_line=function(a,p,l){l=l||!1;if(p instanceof Float32Array){if(a=d.pq(a))b.draw_line(a,p,l),q.To(a)}else c.error("Wrong positions type")}};b4w.module.hud=function(a,p){var d=p("__hud");p("__print");a.draw_mixer_strip=d.draw_mixer_strip;a.plot_array=d.plot_array};b4w.module.lights=function(a,p){function d(a){for(var b=l.get_active(),d=q.Ia(b,"LAMP",q.DATA_ID_ALL),f=0;f<d.length;f++){var p=d[f];if("SUN"==p.La.type){var u=p;break}}u?"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,f=u.f,n.set_rotation_euler(u,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),p=g.get_quat_view(f.h),z.quat_to_dir(p,z.AXIS_Y,a),f=g.get_trans_view(f.h),f=h.length(f),h.copy(a,k),h.scale(k,f,k),n.set_translation(u,
k),n.n(u),a=u.La,a.nu&&(f=b.world.light_settings.environment_energy,p=Math.cos(Math.abs(d)),d=Math.max(Math.min(3*p,1),0)*a.gu,f*=Math.max(p,.1),c.Mr(a,d),l.set_environment_colors(b,f,null,null)),l.mo(u,b)):t.error("There is no sun on the scene")}function b(a){if(f.is_lamp(a))return a.La.type;t.error("get_light_type(): Wrong object");return!1}var c=p("__lights"),q=p("__objects"),f=p("__obj_util"),t=p("__print"),l=p("__scenes"),n=p("__transform"),g=p("__tsr"),z=p("__util"),h=p("__vec3"),k=new Float32Array(3),
u,w=60;a.get_lamps=function(a){var b=l.get_active(),b=q.Ia(b,"LAMP",q.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var f=b[d];f.La.type===a&&c.push(f)}return c};a.get_sun_params=function(){for(var a=l.get_active(),a=q.Ia(a,"LAMP",q.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.La.type){b=d;break}}return b?(b=b.La.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=
b,c):null};a.set_sun_params=d;a.set_day_time=function(a){for(var b=l.get_active(),b=q.Ia(b,"LAMP",q.DATA_ID_ALL),c=0;c<b.length;c++){var f=b[c];if("SUN"==f.La.type){var h=f;break}}h?(h=-Math.cos(a/12*Math.PI)*w,b={},b.hor_position=12>a?15*a:15*(a-24),b.vert_position=h,d(b)):t.error("There is no sun on the scene")};a.set_date=function(a){(u=a.getDate())?1582==u&&10==a.DK&&4<a.UB&&15>a.UB&&t.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):t.error("There is no year 0 in the Julian system!")};
a.set_max_sun_angle=function(a){w=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(f.is_lamp(a))var c=a.La;else return t.error("get_light_params(): Wrong object"),null;if(a=b(a))switch(a){case "SPOT":var d={light_type:a,light_color:c.color,light_energy:c.hf,light_spot_blend:c.Al,light_spot_size:c.Zh,light_distance:c.distance};break;case "POINT":d={light_type:a,light_color:c.color,light_energy:c.hf,light_distance:c.distance};break;default:d={light_type:a,light_color:c.color,light_energy:c.hf}}return d?
d:null};a.get_light_type=b;a.set_light_params=function(a,b){if(f.is_lamp(a)){var d=a.La,h=l.get_active();"number"==typeof b.light_energy&&c.Mr(d,b.light_energy);"object"==typeof b.light_color&&c.Kw(d,b.light_color);"number"==typeof b.light_spot_blend&&c.ZF(d,b.light_spot_blend);"number"==typeof b.light_spot_size&&c.$F(d,b.light_spot_size);"number"==typeof b.light_distance&&c.YF(d,b.light_distance);l.mo(a,h);q.aH(h)}else t.error("set_light_params(): Wrong object")}};b4w.module.material=function(a,p){function d(a,b){for(var c=a.J[0].T,d=0;d<c.length;d++){var f=c[d];if(-1<f.rd.indexOf(b))return"MAIN"==f.type}return!1}function b(a,b){var c=q.Ha(a,b,"MAIN");return Boolean(c&&c.Wc[0])}function c(a,b){var c=q.Ha(a,b,"MAIN");return Boolean(c&&c.Wc[1])}var q=p("__batch"),f=p("__config"),t=p("__obj_util"),l=p("__print"),n=p("__shaders"),g=p("__util"),z=f.p;a.inherit_material=function(a,b,c,d){t.Hq(c)&&t.Hq(a)?q.inherit_material(a,b,c,d):l.error("Wrong or batched object(s)")};
a.get_materials_names=function(a){var b=[];a=a.J;for(var c=0;c<a.length;c++)for(var d=a[c].T,f=0;f<d.length;f++)for(var g=0;g<d[f].rd.length;g++)-1==b.indexOf(d[f].rd[g])&&b.push(d[f].rd[g]);return b};a.set_diffuse_color=function(a,b,c){var d=q.Ha(a,b,"MAIN");d?(d.rc.set(c),(a=q.nd(a,b,"MAIN"))&&a.rc.set(c)):l.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=q.Ha(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.rc);return d}l.error('Couldn\'t get property "diffuse_color"!')};
a.set_diffuse_intensity=function(a,b,c){var d=q.Ha(a,b,"MAIN");if(d){if(d.Vf=c,a=q.nd(a,b,"MAIN"))a.Vf=c}else l.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=q.Ha(a,b,"MAIN");if(c)return c.Vf;l.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=q.Ha(a,b,"MAIN");d?(d.Ne.set(c),(a=q.nd(a,b,"MAIN"))&&a.Ne.set(c)):l.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=q.Ha(a,
b,"MAIN");if(c){var d=Array(3);d[0]=c.Ne[0];d[1]=c.Ne[1];d[2]=c.Ne[2];return d}l.error('Couldn\'t get property "specular_color"!')};a.set_specular_color_factor=function(a,b,c){var d=q.Ha(a,b,"MAIN");if(d){if(d.Yh=c,a=q.nd(a,b,"MAIN"))a.Yh=c}else l.error('Couldn\'t set property "specular_color_factor"!')};a.get_specular_color_factor=function(a,b){var c=q.Ha(a,b,"MAIN");if(c)return c.Yh;l.error('Couldn\'t get property "specular_color_factor"!')};a.set_specular_intensity=function(a,c,d){b(a,c)||l.error('Property "specular_intensity" is missing!');
q.Ha(a,c,"MAIN").Wc[0]=d;(a=q.nd(a,c,"MAIN"))&&(a.Wc[0]=d)};a.get_specular_intensity=function(a,c){b(a,c)||l.error('Property "specular_intensity" is missing!');return q.Ha(a,c,"MAIN").Wc[0]};a.check_specular_intensity=b;a.set_specular_hardness=function(a,b,d){c(a,b)||l.error('Property "specular_hardness" is missing!');q.Ha(a,b,"MAIN").Wc[1]=d;(a=q.nd(a,b,"MAIN"))&&(a.Wc[1]=d)};a.get_specular_hardness=function(a,b){c(a,b)||l.error('Property "specular_hardness" is missing!');return q.Ha(a,b,"MAIN").Wc[1]};
a.check_specular_hardness=c;a.set_emit_factor=function(a,b,c){var d=q.Ha(a,b,"MAIN");if(d){if(d.gf=c,a=q.nd(a,b,"MAIN"))a.gf=c}else l.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=q.Ha(a,b,"MAIN");if(c)return c.gf;l.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,b,c){var d=q.Ha(a,b,"MAIN");if(d){if(d.We=c,a=q.nd(a,b,"MAIN"))a.We=c}else l.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=
q.Ha(a,b,"MAIN");if(c)return c.We;l.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var d=q.Ha(a,b,"MAIN");if(d){if(d.Uf=c,a=q.nd(a,b,"MAIN"))a.Uf=c}else l.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=q.Ha(a,b,"MAIN");if(c)return c.Uf;l.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=q.Ha(a,b,"MAIN");if(d){if(d.Lf=c,a=q.nd(a,b,"MAIN"))a.Lf=c}else l.error('Couldn\'t set property "alpha_factor"!')};
a.get_alpha_factor=function(a,b){var c=q.Ha(a,b,"MAIN");if(c)return c.Lf;l.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return l.error("missing arguments in get_material_params"),null;if(!d(a,b))return null;var c=q.Ha(a,b,"MAIN");if(!c)return null;var f={};"MAIN"==c.type&&(f.reflect_factor=c.reflect_factor,f.fresnel=c.he[2],f.fresnel_factor=5*(1-c.he[3]),f.parallax_scale=c.parallax_scale,f.parallax_steps=q.ac(c,"PARALLAX_STEPS")[1]);return f};
a.get_water_material_params=function(a,b){if(!a||!b)return l.error("missing arguments in get_water_material_params"),null;if(!d(a,b))return null;var c=q.Ha(a,b,"MAIN");if(!c||!c.Ig)return null;if(!c)return l.error("material not found"),null;var f={};if("MAIN"==c.type){if(z.wj){var g=f.shallow_water_col=Array(3);g[0]=c.shallow_water_col[0];g[1]=c.shallow_water_col[1];g[2]=c.shallow_water_col[2];g=f.shore_water_col=Array(3);g[0]=c.shore_water_col[0];g[1]=c.shore_water_col[1];g[2]=c.shore_water_col[2];
f.shallow_water_col_fac=c.shallow_water_col_fac;f.shore_water_col_fac=c.shore_water_col_fac}f.foam_factor=c.foam_factor;f.norm_uv_velocity=c.Tj;f.absorb_factor=q.ac(c,"ABSORB")[1];f.sss_strength=q.ac(c,"SSS_STRENGTH")[1];f.sss_width=q.ac(c,"SSS_WIDTH")[1];f.dst_noise_scale0=q.ac(c,"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=q.ac(c,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=q.ac(c,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=q.ac(c,"DST_NOISE_FREQ_1")[1];f.dir_min_shore_fac=q.ac(c,"DIR_MIN_SHR_FAC")[1];
f.dir_freq=q.ac(c,"DIR_FREQ")[1];f.dir_noise_scale=q.ac(c,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=q.ac(c,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=q.ac(c,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=q.ac(c,"DST_MIN_FAC")[1];f.waves_hor_fac=q.ac(c,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=function(a,b,c){if(a&&b&&c)if(d(a,b)){var f=q.Ha(a,b,"MAIN");if(f){var g=[f];(f=q.nd(a,b,"MAIN"))&&g.push(f);for(a=0;a<g.length;a++)f=g[a],"number"==typeof c.material_reflectivity&&(f.reflect_factor=c.material_reflectivity),
"number"==typeof c.material_fresnel&&(f.he[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(f.he[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(f.parallax_scale=c.material_parallax_scale),"number"==typeof c.material_parallax_steps&&(b=n.t(parseFloat(c.material_parallax_steps)),q.Aa(f,"PARALLAX_STEPS",b),q.Sb(f,!0))}else l.error("material not found")}else l.error("setting material params is not possible");else l.error("missing arguments in set_material_params")};
a.set_water_material_params=function(a,b,c){if(a&&b&&c)if(d(a,b)){var f=q.Ha(a,b,"MAIN");if(f){var g=[f];(f=q.nd(a,b,"MAIN"))&&g.push(f);for(a=0;a<g.length;a++)f=g[a],z.wj&&("object"==typeof c.shallow_water_col&&f.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(f.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&f.shore_water_col.set(c.shore_water_col),"number"==typeof c.shore_water_col_fac&&(f.shore_water_col_fac=c.shore_water_col_fac)),
z.shore_smoothing&&f.Ao&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?q.Aa(f,"SHORE_SMOOTHING",1):q.Aa(f,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=n.t(parseFloat(c.absorb_factor)),q.Aa(f,"ABSORB",b))),"number"==typeof c.foam_factor&&z.Hi&&(f.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&(f.Tj=c.norm_uv_velocity),z.water_dynamic&&f.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?q.Aa(f,"DYNAMIC",1):q.Aa(f,"DYNAMIC",0)),"number"==typeof c.waves_height&&
(b=n.t(parseFloat(c.waves_height)),q.Aa(f,"WAVES_HEIGHT",b)),"number"==typeof c.waves_length&&(b=n.t(parseFloat(c.waves_length)),q.Aa(f,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&(b=n.t(parseFloat(c.sss_strength)),q.Aa(f,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=n.t(parseFloat(c.sss_width)),q.Aa(f,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=n.t(parseFloat(c.dst_noise_scale0)),q.Aa(f,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=n.t(parseFloat(c.dst_noise_scale1)),
q.Aa(f,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&(b=n.t(parseFloat(c.dst_noise_freq0)),q.Aa(f,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=n.t(parseFloat(c.dst_noise_freq1)),q.Aa(f,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=n.t(parseFloat(c.dir_min_shore_fac)),q.Aa(f,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=n.t(parseFloat(c.dir_freq)),q.Aa(f,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=n.t(parseFloat(c.dir_noise_scale)),
q.Aa(f,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=n.t(parseFloat(c.dir_noise_freq)),q.Aa(f,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=n.t(parseFloat(c.dir_min_noise_fac)),q.Aa(f,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=n.t(parseFloat(c.dst_min_fac)),q.Aa(f,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=n.t(parseFloat(c.waves_hor_fac)),q.Aa(f,"WAVES_HOR_FAC",b))),q.Sb(f,!0)}else l.error("material not found")}else l.error("setting water material params is not possible");
else l.error("missing arguments in set_water_material_params")};a.set_line_params=function(a,b){var c=q.pq(a);c?(g.pd(b.color)&&c.rc.set(b.color),g.pd(b.width)&&(c.on=b.width)):l.error("Couldn't set line params!")};a.get_line_params=function(a){if(a=q.pq(a))return{color:new Float32Array(a.rc),width:a.on};l.error("Couldn't get line params");return null}};b4w.module.particles=function(a,p){var d=p("__particles"),b=p("__print");a.set_size=function(a,p,f){d.jj(a)?d.set_size(a,p,f):b.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,p,f){d.jj(a)?d.set_normal_factor(a,p,f):b.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,p,f){d.jj(a)?(f=Math.min(f,1),f=Math.max(f,0),d.set_factor(a,p,f)):b.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){p("__config");var d=p("__ipc"),b=p("__physics"),c=p("__print"),q=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.P(a)?b.enable_simulation(a):c.error("No physics for object "+a.name)};a.disable_simulation=function(a){b.P(a)?b.disable_simulation(a):c.error("No physics for object "+a.name)};a.has_physics=function(a){return b.P(a)};a.has_simulated_physics=function(a){return b.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return b.has_dynamic_physics(a)};a.set_gravity=function(a,d){b.P(a)?b.set_gravity(a,d):c.error("No physics for object "+a.name)};a.set_damping=function(a,d,l){b.P(a)?b.A("set_damping",a.o.v,d,l):c.error("No physics for object "+a.name)};a.reset_damping=function(a){if(b.P(a)){var d=a.le;b.A("set_damping",a.o.v,d.Kp,d.Er)}else c.error("No physics for object "+a.name)};a.set_transform=function(a,d,l){b.P(a)?b.set_transform.apply(this,arguments):c.error("No physics for object "+a.name)};a.sync_transform=
function(a){b.P(a)?b.sync_transform(a):c.error("No physics for object "+a.name)};a.apply_velocity=function(a){b.P(a)?b.apply_velocity.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){b.P(a)?b.apply_velocity_world.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_force=function(a,d,l,n){b.P(a)?b.apply_force.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_torque=function(a,d,l,n){b.P(a)?b.apply_torque.apply(this,
arguments):c.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,d){b.P(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_throttle(a,q.clamp(d,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,d,l){if(b.P(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");d=q.clamp(d,0,1);var n=a.l.Ei;-1==l||1==l?n=Math.max(-1,Math.min(n+l*d,1)):0==l&&0<=n?(n-=d,n=Math.max(0,n)):0==l&&0>n?(n+=d,n=Math.min(0,
n)):c.error("Wrong steering direction");b.vehicle_throttle(a,q.clamp(n,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_steer=function(a,d){b.P(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_steer(a,q.clamp(d,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,d,l){if(b.P(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");d=q.clamp(d,0,1);var n=a.l.Dj;-1==l||1==l?n=Math.max(-1,Math.min(n+l*d,
1)):0==l&&0<=n?(n-=d,n=Math.max(0,n)):0==l&&0>n?(n+=d,n=Math.min(0,n)):c.error("Wrong steering direction");b.vehicle_steer(a,q.clamp(n,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_brake=function(a,d){b.P(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_brake(a,q.clamp(d,0,1))):c.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,d){if(b.P(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");d=q.clamp(d,
-1,1);var l=a.l.dk;b.vehicle_brake(a,q.clamp(l+l*d,0,1))}else c.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return b.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return b.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!b.P(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.Zc.name;c.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!b.P(a))return c.error("No physics for object "+
a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.l.Ei;c.error("Wrong object");return null};a.get_vehicle_steering=function(a){if(!b.P(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.l.Dj;c.error("Wrong object")};a.get_vehicle_brake=function(a){if(!b.P(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.l.dk;c.error("Wrong object")};a.get_vehicle_speed=
function(a){if(!b.P(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return b.get_vehicle_speed(a);c.error("Wrong object")};a.is_character=function(a){return b.is_character(a)};a.set_character_move_dir=function(a,d,l){b.P(a)?b.set_character_move_dir(a,d,l):c.error("No physics for object "+a.name)};a.set_character_move_type=function(a,d){b.P(a)?b.set_character_move_type(a,d):c.error("No physics for object "+a.name)};a.set_character_walk_velocity=
function(a,d){b.P(a)?b.set_character_walk_velocity(a,d):c.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,d){b.P(a)?b.set_character_run_velocity(a,d):c.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,d){b.P(a)?b.set_character_fly_velocity(a,d):c.error("No physics for object "+a.name)};a.character_jump=function(a){b.P(a)?b.character_jump(a):c.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,d,l){b.P(a)?b.character_rotation_inc(a,
d,l):c.error("No physics for object "+a.name)};a.set_character_rotation=function(a,d,l){b.P(a)?b.set_character_rotation(a,d,l):c.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,d){b.P(a)?b.set_character_rotation_v(a,d):c.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,d){b.P(a)?b.set_character_rotation_h(a,d):c.error("No physics for object "+a.name)};a.append_collision_test=function(a,d,l,n){b.P(a)?b.append_collision_test(a,d,l,n||!1):c.error("No physics for object "+
a.name)};a.remove_collision_test=function(a,d,l){b.P(a)?b.remove_collision_test(a,d||"ANY",l):c.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,d){b.P(a)?b.apply_collision_impulse_test(a,d):c.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){b.P(a)?b.clear_collision_impulse_test(a):c.error("No physics for object "+a.name)};a.append_ray_test=function(a,d,l,n,g,p){if(b.P(a))return b.append_ray_test(a,d,l,n,g,p||!1,!1,!1,!1);c.error("No physics for object "+
a.name)};a.append_ray_test_ext=function(a,d,l,n,g,p,h,k,q){if(b.P(a))return b.append_ray_test(a,d,l,n,g,p||!1,h||!1,k||!1,q||!1);c.error("No physics for object "+a.name)};a.remove_ray_test=function(a){b.nv(a)?b.remove_ray_test(a):c.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,d,l){b.nv(a)?b.change_ray_test_from_to(a,d,l):c.error("Wrong ray test ID")};a.apply_constraint=function(a,d,l,n,g,p,h,k,q,w){b.P(d)&&b.P(g)?b.apply_constraint(a,d,l,n,g,p,h,k,q,w):c.error("Wrong objects")};
a.clear_constraint=function(a){b.P(a)&&b.KD(a)?b.clear_constraint(a):c.error("Wrong object")};a.pull_to_constraint_pivot=function(a,d,l,n,g,p){b.P(a)&&b.P(n)?b.pull_to_constraint_pivot(a,d,l,n,g,p):c.error("Wrong objects")};a.get_worker_listeners=d.get_worker_listeners};b4w.module.rgb=function(a,p){p("__print");var d=p("__util"),b=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,b,d){var p=new Float32Array(3);p[0]=a;p[1]=b;p[2]=d;return p};a.set=function(a,b,d,p){p[0]=a;p[1]=b;p[2]=d;return p};a.css_to_rgb=function(a,b,f,p){p=p||new Float32Array(3);p[0]=a/255;p[1]=b/255;p[2]=f/255;d.dx(p,p);return p};a.rgb_to_css=function(a){a=d.Sq(a,b);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};a.rgb_to_css_hex=
function(a){function p(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a}a=d.Sq(a,b);return"#"+p(a[0])+p(a[1])+p(a[2])}};
b4w.module.rgba=function(a,p){p("__print");var d=p("__util"),b=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,b,d,p){var l=new Float32Array(4);l[0]=a;l[1]=b;l[2]=d;l[3]=p;return l};a.set=function(a,b,d,p,l){l[0]=a;l[1]=b;l[2]=d;l[3]=p;return l};a.css_to_rgba=function(a,b,f,p,l){l=l||new Float32Array(4);l[0]=a/255;l[1]=b/255;l[2]=f/255;l[3]=p;d.dx(l,l);return l};a.rgba_to_css=function(a){var p=d.Sq(a,b);return[Math.round(255*p[0]),Math.round(255*
p[1]),Math.round(255*p[2]),a[3]]}};b4w.module.scenes=function(a,p){var d=p("__batch"),b=p("__camera"),c=p("__data"),q=p("__graph"),f=p("__objects"),t=p("__obj_util"),l=p("__physics"),n=p("__print"),g=p("__scenes"),z=p("__util");p("__vec4");a.DATA_ID_ALL=f.DATA_ID_ALL;a.set_active=function(a){var b=g.Mi();g.set_active(z.keysearch("name",a,b))};a.get_active=function(){return g.ma()?g.get_active().name:""};a.get_scenes=function(){for(var a=g.Mi(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(g.ma())return g.Ni(g.get_active());
n.error("No active scene");return!1};a.get_object_by_name=function(a,b){var c=f.Qb(f.Ho,a,b|0);if(c)return c;n.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=f.Qb(f.Go,a,b,c|0))return a;n.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=f.Qb(f.ec,a,b|0);if(c)return c;n.error("get object "+a+": not found")};a.get_object_data_id=function(a){return g.get_object_data_id(a)};a.pick_object=f.pick_object;a.outlining_is_enabled=
function(a){return a&&a.f&&a.f.Jb};a.set_outline_intensity=function(a,b){a&&a.f&&a.f.Jb?a.f.lg=b:n.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.f&&a.f.Jb)return a.f.lg;n.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,d){a&&a.f&&a.f.Jb?f.apply_outline_anim(a,b,c,d):n.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.f&&a.f.Jb){var b=a.f.mj;f.apply_outline_anim(a,b.nj,b.oj,b.pj)}else n.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.f&&a.f.Jb?f.clear_outline_anim(a):n.error("clear_outline_anim(): wrong object")};a.set_outline_color=g.set_outline_color;a.get_outline_color=function(a){var b=g.get_active();if(b=g.Z(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.uf),a};a.set_hmd_params=function(a){if(!g.ma())n.error("No active scene");else if(a){var b=g.get_active();if(b=g.Z(b,"STEREO"))a.distortion_coefs&&a.distortion_coefs instanceof Array&&(b.Bi[0]=a.distortion_coefs[0],b.Bi[1]=a.distortion_coefs[1],
b.sa=!0),a.chromatic_aberration_coefs&&a.chromatic_aberration_coefs instanceof Array&&(b.chromatic_aberration_coefs[0]=a.chromatic_aberration_coefs[0],b.chromatic_aberration_coefs[1]=a.chromatic_aberration_coefs[1],b.chromatic_aberration_coefs[2]=a.chromatic_aberration_coefs[2],b.chromatic_aberration_coefs[3]=a.chromatic_aberration_coefs[3],b.sa=!0),a.distortion_scale&&"number"==typeof a.distortion_scale&&(b.Bi[2]=a.distortion_scale,b.sa=!0),a.distortion_offset&&"number"==typeof a.distortion_offset&&
(b.Bi[3]=a.distortion_offset,b.sa=!0),a.enable_hmd_stereo&&"boolean"==typeof a.enable_hmd_stereo&&(b.enable_hmd_stereo=a.enable_hmd_stereo,b.sa=!0)}};a.get_shadow_params=function(){if(!g.ma())return n.error("No active scene"),!1;var a=g.get_active(),b=g.Z(a,"SHADOW_CAST");if(!b)return null;var c=a.k.hc,d=g.Z(a,"MAIN_OPAQUE"),f=g.Z(a,"DEPTH"),l={};l.csm_resolution=c.csm_resolution;l.self_shadow_polygon_offset=b.self_shadow_polygon_offset;f&&(l.self_shadow_normal_offset=f.self_shadow_normal_offset);
l.enable_csm=c.enable_csm;l.csm_num=c.csm_num;l.csm_first_cascade_border=c.csm_first_cascade_border;l.first_cascade_blur_radius=c.first_cascade_blur_radius;l.csm_last_cascade_border=c.csm_last_cascade_border;l.last_cascade_blur_radius=c.last_cascade_blur_radius;l.fade_last_cascade=c.fade_last_cascade;l.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(l.csm_borders=g.lD(a,d.j),l.blur_radii=new Float32Array(c.csm_num),l.blur_radii.set(d.j.Fn.subarray(0,c.csm_num))):(l.csm_borders=null,
l.blur_radii=null);return l};a.set_shadow_params=function(a){if(g.ma()){var c=g.get_active();"number"==typeof a.self_shadow_polygon_offset&&q.aa(c.k.ib,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var f=g.Z(c,"DEPTH");f&&("number"==typeof a.self_shadow_normal_offset&&(f.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(f.pcf_blur_radius=a.pcf_blur_radius));var l=g.Z(c,"MAIN_BLEND");l&&("number"==typeof a.self_shadow_normal_offset&&
(l.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius),l.sa=!0);l=c.k.hc;"number"==typeof a.csm_first_cascade_border&&(l.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(l.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(l.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(l.last_cascade_blur_radius=
a.last_cascade_blur_radius);if(f){for(var p=f.q,t=0;t<p.length;t++){var z=p[t];z.ke.wc&&(z=z.G,d.mt(z,l),d.Sb(z))}f.sa=!0}f=c.Qg.f.L;for(t=0;t<f.length;t++)b.ws(f[t],l);g.Hr(c)}else n.error("No active scene")};a.get_environment_colors=function(){if(!g.ma())return n.error("No active scene"),!1;var a=g.get_active();return g.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(g.ma()){var d=g.get_active();g.set_environment_colors(d,parseFloat(a),b,c)}else n.error("No active scene")};
a.get_fog_color_density=function(a){if(!g.ma())return n.error("No active scene"),!1;var b=g.get_active();return g.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(g.ma()){var b=g.get_active();g.set_fog_color_density(b,a)}else n.error("No active scene")};a.get_ssao_params=function(){if(!g.ma())return n.error("No active scene"),!1;var a=g.get_active();return g.get_ssao_params(a)};a.set_ssao_params=function(a){if(g.ma()){var b=g.get_active();g.set_ssao_params(b,a)}else n.error("No active scene")};
a.get_color_correction_params=function(){if(!g.ma())return n.error("No active scene"),null;var a=g.get_active(),a=g.Z(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(g.ma()){var b=g.get_active();if(b=g.Z(b,"COMPOSITING"))"number"==typeof a.brightness&&(b.brightness=a.brightness),"number"==typeof a.contrast&&(b.contrast=a.contrast),"number"==typeof a.exposure&&
(b.exposure=a.exposure),"number"==typeof a.saturation&&(b.saturation=a.saturation),b.sa=!0}else n.error("No active scene")};a.get_sky_params=function(){if(!g.ma())return n.error("No active scene"),!1;var a=g.get_active();return g.get_sky_params(a)};a.set_sky_params=function(a){if(g.ma()){var b=g.get_active();g.set_sky_params(b,a)}else n.error("No active scene")};a.get_dof_params=function(){if(!g.ma())return n.error("No active scene"),!1;var a=g.get_active();return g.Z(a,"DOF")?g.get_dof_params(a):
null};a.set_dof_params=function(a){if(g.ma()){var b=g.get_active();g.set_dof_params(b,a)}else n.error("No active scene")};a.get_god_rays_params=function(){if(!g.ma())return n.error("No active scene"),!1;var a=g.get_active();return g.Z(a,"GOD_RAYS")?g.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(g.ma()){var b=g.get_active();g.set_god_rays_params(b,a)}else n.error("No active scene")};a.get_bloom_params=function(){if(!g.ma())return n.error("No active scene"),!1;var a=g.get_active();
return g.Z(a,"BLOOM")?g.get_bloom_params(a):null};a.set_bloom_params=function(a){if(g.ma()){var b=g.get_active();g.set_bloom_params(b,a)}else n.error("No active scene")};a.get_glow_material_params=function(){if(!g.ma())return n.error("No active scene"),!1;var a=g.get_active();return g.Z(a,"GLOW_COMBINE")?g.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(g.ma()){var b=g.get_active();g.set_glow_material_params(b,a)}else n.error("No active scene")};a.get_wind_params=function(){if(!g.ma())return n.error("No active scene"),
!1;var a=g.get_active();return g.get_wind_params(a)};a.set_wind_params=function(a){if(g.ma()){var b=g.get_active();f.set_wind_params(b,a)}else n.error("No active scene")};a.get_water_surface_level=g.get_water_surface_level;a.set_water_params=function(a){if(g.ma()){var b=g.get_active();g.set_water_params(b,a)}else n.error("No active scene")};a.get_water_mat_params=function(a){if(g.ma()){var b=g.get_active();g.get_water_mat_params(b,a)}else n.error("No active scene")};a.update_scene_materials_params=
function(){if(g.ma()){var a=g.get_active();g.ys(a)}else n.error("No active scene")};a.hide_object=function(a,b){b=b||!1;!t.is_mesh(a)&&!t.is_empty(a)||t.ka(a)?b?g.ik(a,!0):g.Ft(a,!0):n.error("show/hide is only supported for dynamic objects.")};a.show_object=function(a,b){b=b||!1;!t.is_mesh(a)&&!t.is_empty(a)||t.ka(a)?b?g.ik(a,!1):g.Ft(a,!1):n.error("show/hide is only supported for dynamic objects.")};a.is_hidden=function(a){if(t.Hq(a)||t.is_empty(a)||t.is_lamp(a))return g.is_hidden(a);n.error("show/hide is only supported for dynamic meshes/empties and lamps");
return!1};a.is_visible=function(a){return a.f.is_visible};a.check_object=function(a){n.Ga("scenes.check_object","scenes.check_object_by_name");return g.ma()?f.aF(a,g.get_active()):(n.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return f.Qb(f.Ho,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return f.Qb(f.Go,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return f.Qb(f.ec,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=g.get_active();a||(a="ALL");
b||0===b||(b=f.DATA_ID_ALL);return f.Ia(c,a,b)};a.get_object_name=function(a){return a?a.Jh:(n.error("Wrong object name"),"")};a.get_object_name_hierarchy=function(a){if(!a)return n.error("Wrong object name"),null;for(var b=[];a;)b.push(a.Jh),a=t.get_dg_parent(a);return b.reverse()};a.get_object_type=function(a){return a&&a.type?a.type:(n.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){n.Ga("scenes.get_object_dg_parent","objects.get_dg_parent");return t.get_dg_parent(a)};a.get_object_children=
function(a){return a.be.slice(0)};a.get_first_character=function(){for(var a=f.Ia(g.get_active(),"MESH",f.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(l.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return g.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return g.get_cam_water_depth()};a.get_type_mesh_object=function(a){return t.is_mesh(a)?a.f.type:null};a.get_meta_tags=function(){if(!g.ma())return n.error("No active scene"),!1;var a=g.get_active();
return g.get_meta_tags(a)};a.append_object=function(a,b){if(a.f.lv){if(b)var c=g.Mi(),c=z.keysearch("name",b,c);else c=g.get_active();g.append_object(c,a,!0)}else n.error('object "'+a.name+'" has been created not by coping.')};a.remove_object=function(a){if((t.is_mesh(a)||t.is_empty(a))&&t.ka(a)){for(var b=a.J,d=0;d<b.length;d++)c.pF(b[d].Ea,a,!1);f.remove_object(a)}else n.error("Can't remove object \""+a.name+'". It must be dynamic and type of MESH or EMPTY.')};a.marker_frame=function(a){var b=g.get_active();
if(b.timeline_markers&&a in b.timeline_markers)return g.marker_frame(b,a);n.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=g.get_active();return(a=g.Z(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=g.get_active();(b=g.Z(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):n.error("The motion blur subscene doesn't exist.")};
a.can_select_objects=function(){var a=g.get_active();return Boolean(g.Z(a,"COLOR_PICKING"))}};b4w.module.sfx=function(a,p){var d=p("__obj_util"),b=p("__scenes"),c=p("__sfx"),q=p("__print");a.play=function(a,b,d){c.play(a,b||0,d||0)};a.play_def=function(a){c.play_def(a)};a.is_play=function(a){return c.is_playing(a)};a.is_playing=function(a){return c.is_playing(a)};a.stop=function(a){c.stop(a)};a.pause=function(a){c.wG(a)};a.resume=function(a){c.yG(a)};a.playrate=function(a,b){c.playrate(a,b)};a.get_playrate=function(a){return c.get_playrate(a)};a.cyclic=function(a,b){c.cyclic(a,b)};a.is_cyclic=
function(a){return c.is_cyclic(a)};a.listener_reset_speed=function(a,b){c.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,d){c.speaker_reset_speed(a,b,d)};a.get_volume=function(a){return a&&"object"===typeof a?c.get_volume(a):c.uD()};a.set_volume=function(a,b){a&&"object"===typeof a?c.set_volume(a,b):c.bG(b)};a.mute=function(a,b){a&&"object"===typeof a?c.mute(a,b):c.VE(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.is_muted(a):c.$D()};a.get_speaker_objects=function(){return c.get_speaker_objects().slice(0)};
a.check_active_speakers=c.check_active_speakers;a.set_compressor_params=function(a){c.set_compressor_params(b.get_active(),a)};a.get_compressor_params=function(){return c.get_compressor_params(b.get_active())};a.duck=function(a,b,d){a&&"object"===typeof a?c.duck(a,b,d):c.iC(b,d)};a.unduck=function(a){a&&"object"===typeof a?c.unduck(a):c.$G()};a.apply_playlist=c.apply_playlist;a.clear_playlist=c.clear_playlist;a.detect_audio_container=c.detect_audio_container;a.detect_video_container=c.detect_video_container;
a.set_positional_params=c.set_positional_params;a.get_positional_params=c.get_positional_params;a.set_filter_params=c.set_filter_params;a.get_filter_params=c.get_filter_params;a.get_filter_freq_response=c.get_filter_freq_response;a.get_duration=function(a){if(a&&d.is_speaker(a))return c.get_duration(a);q.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,p){var d=p("__print"),b=p("__scenes"),c=p("__textures"),q=p("__obj_util");a.get_canvas_texture_context=function(a,b){d.Ga("get_canvas_texture_context","get_canvas_ctx");b||(b=0);var l=c.hD(a,b);if(l)return l;d.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,b){d.Ga("update_canvas_texture_context","update_canvas_ctx");b||(b=0);c.mH(a,b)||d.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,p){p||
(p=0);b.get_active().b4w_use_nla&&c.Fs(a,p)?d.error("NLA texture can't be controlled directly through API."):c.play_video(a,p)||d.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,p){p||(p=0);b.get_active().b4w_use_nla&&c.Fs(a,p)?d.error("NLA texture can't be controlled directly through API."):c.pause_video(a,p)||d.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a,p){p||(p=0);b.get_active().b4w_use_nla&&c.Fs(a,p)?d.error("NLA texture can't be controlled directly through API."):
c.reset_video(a,p)||d.error('Texture with name "'+a+'" not found!')};a.get_canvas_ctx=function(a,b){if(q.is_mesh(a)){var l=c.iD(a,b);if(l)return l;d.error("Couldn't find canvas texture with this name: "+b)}else d.error("Object must be type of mesh.");return null};a.update_canvas_ctx=function(a,b){if(q.is_mesh(a)){if(c.nH(a,b))return!0;d.error("Couldn't find canvas texture with this name: "+b)}else d.error("Object must be type of mesh.");return!1}};b4w.module.time=function(a,p){var d=p("__time");a.set_timeout=d.set_timeout;a.clear_timeout=d.clear_timeout;a.get_timeline=d.get_timeline;a.animate=d.animate;a.clear_animation=d.clear_animation};b4w.module.transform=function(a,p){var d=p("__obj_util"),b=p("__physics"),c=p("__print"),q=p("__quat"),f=p("__transform"),t=p("__tsr"),l=p("__util"),n=new Float32Array(4),g=new Float32Array(3),z=new Float32Array(4);a.SPACE_LOCAL=f.SPACE_LOCAL;a.SPACE_WORLD=f.SPACE_WORLD;a.set_translation=function(a,k,l,n){d.ka(a)?(g[0]=k,g[1]=l,g[2]=n,f.set_translation(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,k,l,n){d.ka(a)?(g[0]=k,g[1]=
l,g[2]=n,f.set_translation_rel(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,g){d.ka(a)?(f.set_translation(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,g){d.ka(a)?(f.set_translation_rel(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_obj_rel=function(a,k,n,p,q){d.ka(a)?(g[0]=k,g[1]=n,g[2]=p,
k=t.get_trans_view(q.f.h),q=t.get_quat_view(q.f.h),l.transform_vec3(g,1,q,k,g),f.set_translation(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));f.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));f.get_translation_rel(a,b);return b};a.set_rotation=function(a,g,l,n,p){d.ka(a)?(z[0]=g,z[1]=l,z[2]=n,z[3]=p,f.set_rotation(a,z),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,g,l,n,p){d.ka(a)?(z[0]=g,z[1]=l,z[2]=n,z[3]=p,f.set_rotation_rel(a,z),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_v=function(a,g){d.ka(a)?(f.set_rotation(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,g){d.ka(a)?(f.set_rotation_rel(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.get_rotation=function(a,b){b||(b=new Float32Array(4));f.get_rotation(a,b);return b};a.get_rotation_rel=function(a,b){b||(b=new Float32Array(4));f.get_rotation_rel(a,b);return b};a.set_rotation_euler=function(a,k,l,n){d.ka(a)?(g[0]=k,g[1]=l,g[2]=n,f.set_rotation_euler(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel=function(a,k,l,n){d.ka(a)?(g[0]=k,g[1]=l,g[2]=n,f.set_rotation_euler_rel(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,g){d.ka(a)?(f.set_rotation_euler(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=function(a,g){d.ka(a)?(f.set_rotation_euler_rel(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,b){d.ka(a)?(f.set_scale(a,b),f.n(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,b){d.ka(a)?(f.set_scale_rel(a,
b),f.n(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return f.get_scale(a)};a.get_scale_rel=function(a){return f.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)c.error("Wrong object: "+a.name);else{for(var g=0;g<a.be.length;g++)if(!d.ka(a.be[g])){c.error('Wrong object: "'+a.be[g].name+'" is not dynamic.');return}f.set_translation(a,[0,0,0]);f.set_rotation(a,[0,0,0,1]);f.set_scale(a,1);f.n(a);b.sync_transform(a)}};a.get_object_size=function(a){return d.is_mesh(a)?
f.get_object_size(a):(c.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,b,g){return d.is_mesh(a)?f.get_object_center(a,b,g):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,g,l,n){d.ka(a)?(f.move_local(a,g,l,n),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_x_local=function(a,g){if(d.ka(a)){var n=q.setAxisAngle(l.AXIS_X,g,z);f.Dr(a,n);f.n(a);b.sync_transform(a)}else c.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.rotate_y_local=function(a,g){if(d.ka(a)){var n=q.setAxisAngle(l.AXIS_Y,g,z);f.Dr(a,n);f.n(a);b.sync_transform(a)}else c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=function(a,g){if(d.ka(a)){var n=q.setAxisAngle(l.AXIS_Z,g,z);f.Dr(a,n);f.n(a);b.sync_transform(a)}else c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return f.get_object_bounding_box(a)};a.set_tsr=function(a,g){d.ka(a)?(f.set_tsr(a,g),f.n(a),b.sync_transform(a)):
c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,g){d.ka(a)?(f.set_tsr_rel(a,g),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_tsr=function(a,b){b||(b=new Float32Array(8));f.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));f.get_tsr_rel(a,b);return b};a.distance=function(a,b){return f.distance(a,b)};a.set_matrix=function(a,g){d.ka(a)?(t.from_mat4(g,n),f.set_tsr(a,n),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_matrix_rel=function(a,g){d.ka(a)?(t.from_mat4(g,n),f.set_tsr_rel(a,n),f.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_matrix=function(a,b){b||(b=new Float32Array(16));f.get_tsr(a,n);t.to_mat4(n,b);return b};a.get_matrix_rel=function(a,b){b||(b=new Float32Array(16));f.get_tsr_rel(a,n);t.to_mat4(n,b);return b}};b4w.module.tsr=function(a,p){function d(a,b,c,n){n||(n=q.create());d(a,b,c,n);return n}p("__mat3");var b=p("__mat4"),c=p("__print"),q=p("__tsr");a.create=q.create;a.from_values=q.from_values;a.copy=q.copy;a.identity=q.identity;a.create_sep=function(a,b,l,n){c.Ga("create_sep","set_sep");return d(a,b,l,n)};a.set_sep=q.set_sep;a.set_trans=q.set_trans;a.set_scale=q.set_scale;a.set_transcale=q.set_transcale;a.set_quat=q.set_quat;a.get_trans_view=q.get_trans_view;a.get_scale=q.get_scale;a.get_quat_view=
q.get_quat_view;a.invert=q.invert;a.to_mat4=function(a,c){c||(c=b.create());q.to_mat4(a,c);return c};a.from_mat4=q.from_mat4;a.multiply=q.multiply;a.transform_vec3=q.transform_vec3;a.transform_vec3_inv=q.transform_vec3_inv;a.transform_vectors=q.transform_vectors;a.transform_dir_vectors=q.transform_dir_vectors;a.transform_dir_vec3=q.transform_dir_vec3;a.transform_tangents=q.transform_tangents;a.translate=q.translate;a.interpolate=function(a,b,c,d){d||(d=q.create());q.interpolate(a,b,c,d);return d}};b4w.module.util=function(a,p){var d=p("__obj_util"),b=p("__print"),c=p("__util"),q=p("__vec3");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.f32=function(a){return new Float32Array(a||0)};a.assert=c.assert;a.keyfind=c.keyfind;a.keysearch=c.keysearch;a.matrix_to_quat=function(a){return c.matrix_to_quat(a)};a.euler_to_quat=function(a,
b){b||(b=new Float32Array(4));return c.euler_to_quat(a,b)};a.quat_to_euler=function(a,b){b||(b=new Float32Array(3));return c.quat_to_euler(a,b)};a.sign=c.sign;a.clamp=c.clamp;a.quat_to_dir=c.quat_to_dir;a.ground_project_quat=function(a,b){return c.quat_project(a,c.AXIS_MY,c.AXIS_Y,c.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return c.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,d,l,n,g){return 0!=q.dot(l,n)?(b.error("Wrong in-plane direction"),null):c.quat_project(a,d,l,n,g)};a.hash_code=
c.hash_code;a.smooth=c.smooth;a.smooth_v=c.smooth_v;a.is_vector=c.is_vector;a.correct_cam_quat_up=c.correct_cam_quat_up;a.quat_to_angle_axis=c.quat_to_angle_axis;a.random_from_array=c.random_from_array;a.xz_direction=c.xz_direction;a.line_plane_intersect=c.line_plane_intersect;a.is_mesh=function(a){b.Ga("util.is_mesh","objects.is_mesh");return d.is_mesh(a)};a.is_armature=function(a){b.Ga("util.is_armature","objects.is_armature");return d.is_armature(a)};a.angle_wrap_0_2pi=c.angle_wrap_0_2pi;a.angle_wrap_periodic=
c.angle_wrap_periodic;a.smooth_step=c.smooth_step;a.lerp=c.lerp};"object"==typeof module&&module.Zp&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){p("__print");var d=p("__version");a.version=d.version;a.version_str=d.version_str;a.type=d.type;a.date=d.date;a.date_str=d.date_str};"object"==typeof module&&module.Zp&&b4w.module.version(exports);b4w.module.objects=function(a,p){var d=p("__geometry"),b=p("__objects"),c=p("__obj_util"),q=p("__print"),f=p("__scenes");p("__util");a.get_meta_tags=function(a){if(a)return b.get_meta_tags(a)};a.copy=function(a,l,n){return c.is_mesh(a)?c.ka(a)?d.Ti(a)||d.check_shape_keys(a)||!n?-1==b.Ia(f.get_active(),"MESH",b.DATA_ID_ALL).indexOf(a)?(q.error('object "'+a.name+'" does not belong to the active scene.'),!1):b.copy(a,l||"",n):(q.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(q.error('object "'+a.name+'" is not dynamic.'),!1):(q.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,d,f){c.is_mesh(a)?b.set_nodemat_value(a,d,f):q.error('The type of the object "'+a.name+'" is not "MESH".')};a.set_nodemat_rgb=function(a,d,f,g,p){c.is_mesh(a)?b.set_nodemat_rgb(a,d,f,g,p):q.error('The type of the object "'+a.name+'" is not "MESH".')};a.update_boundings=function(a){c.is_mesh(a)?d.Ti(a)||d.check_shape_keys(a)?b.update_boundings(a):q.error('object "'+
a.name+'" has not dynamic geometry.'):q.error('The type of the object "'+a.name+'" is not "MESH".')};a.get_parent=c.get_parent;a.get_dg_parent=c.get_dg_parent;a.is_mesh=c.is_mesh;a.is_armature=c.is_armature;a.is_speaker=c.is_speaker;a.is_camera=c.is_camera;a.is_lamp=c.is_lamp;a.is_empty=c.is_empty;a.is_line=c.is_line;a.get_selectable_objects=function(){return b.get_selectable_objects()};a.get_outlining_objects=function(){return b.get_outlining_objects()}};b4w.module.main=function(a,p){function d(){}function b(){}function c(){}function q(){window.performance||(P.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(P.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});V.Nw(0)}function f(a,b){for(var c=null,d=b?N:la,e=0;e<d.length;e++){var f=d[e];try{c=a.getContext(f,ha)}catch(g){}if(c)break}c&&E.dC(c);return c}function t(a,c,d){a.addEventListener("webglcontextlost",
function(a){a.preventDefault();P.error("WebGL context lost");n()},!1);r.Ad(d);var f=r.Qu();f&&P.log("%cRENDERER INFO:","color: #00a",d.getParameter(f.UNMASKED_VENDOR_WEBGL)+", "+d.getParameter(f.UNMASKED_RENDERER_WEBGL));K.Ad(d);e.Ad(d);O.Ad(d);M.Ad(d);A.Ad(d);G.Ad(d);x.kG(a);G.init(a,c);y.Ow(a.width,a.height,1);F.init();b=h();z()}function l(){d=function(){}}function n(){g()||(Y=performance.now()/1E3,F.pause(),I.pause(),O.pause(),k.pause())}function g(){return ka<Y}function z(){aa(z);var a=performance.now()/
1E3;R||(R=a);var c=a-R;if(!(c<1/ba.je)){for(var e=V.get_timeline(),f=0;f<ea.length;f++)ea[f](e,c);g()||(ka>R&&(c-=ka-Math.max(Y,R)),e+=c,V.Nw(e),A.update(),w.update(),x.update(),f=c,x.is_primary_loaded()&&(v.reset(),T.update(f),D.update(e,f),J.update(e,f),F.update(e,f),f&&u.update(f),x.is_primary_loaded()&&(I.update(e,f),x.is_primary_loaded()&&(m.update(e,f),x.is_primary_loaded()&&(k.update(),H.update(e,f),d(f,e),x.is_primary_loaded()&&(y.update(e,f),k.Jx(),ma&&(ma(da.toDataURL()),ma=null)))))),b(c));
R=a}}function h(){var a=60,b=0,d=ba.wu,e=ba.DC;return function(f){f<1/ba.je||(a=U.smooth(1/f,a,f,d),f=I.qD(),b=(b+1)%e,0==b&&c(Math.round(a),f))}}var k=p("__anchors"),u=p("__animation"),w=p("__assets"),C=p("__config"),E=p("__compat"),G=p("__container"),m=p("__controls"),x=p("__data"),A=p("__debug"),r=p("__extensions"),e=p("__geometry"),v=p("__hud"),J=p("__nla"),D=p("__logic_nodes"),H=p("__objects"),I=p("__physics"),P=p("__print"),K=p("__renderer"),y=p("__scenes"),F=p("__sfx"),M=p("__shaders"),O=p("__textures"),
V=p("__time"),T=p("__transform");p("__armature");var U=p("__util"),B=p("__version"),ha=C.context,ba=C.p,da=null,W=null,R=0,Y=0,ka=0,ea=[],ma=null,la=["webgl","experimental-webgl"],N=["webgl2","experimental-webgl2"],aa=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/ba.je)}}();a.init=function(a,b){C.cG();P.gG(ba.console_verbose);
var c=B.version_str()+" "+B.type()+" ("+B.date_str()+")";P.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;q();da=a;b?(v.init(b),W=b):(C.p.show_hud_debug_info=!1,C.F.vn=!1);E.fA();E.YA("Chrome")||(ba.Ec=!1);c=f(a,ba.Ec);!c&&ba.Ec&&(ba.Ec=!1,c=f(a,!1));if(!c)return null;P.log("%cINIT WEBGL "+(ba.Ec?"2":"1"),"color: #00a");window.eK=c;t(da,W,c);C.hA();E.WF(c);M.wE();ba.zq&&(a.style["touch-action"]="none");P.log("%cSET PRECISION:","color: #00a",ba.precision);return c};
a.set_check_gl_errors=function(a){A.set_check_gl_errors(a)};a.resize=function(a,b,c){P.Ga("main.resize","container.resize");G.resize(a,b,c)};a.set_fps_callback=function(a){c=a};a.clear_fps_callback=function(){c=function(){}};a.set_render_callback=function(a){d=a};a.clear_render_callback=function(){l()};a.global_timeline=function(){P.Ga("main.global_timeline","time.get_timeline");return V.get_timeline()};a.pause=n;a.resume=function(){g()&&(ka=performance.now()/1E3,F.resume(),I.resume(),O.play(!0),
k.resume())};a.is_paused=g;a.reset=function(){x.unload(0);W=da=null;ka=Y=R=0;c=function(){};b=function(){};d=function(){};ea.length=0;V.reset()};a.canvas_data_url=function(a){ma=a};a.get_canvas_elem=function(){P.Ga("main.get_canvas_elem","container.get_canvas");return da};a.detect_mobile=function(){return E.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<ea.length;b++)if(ea[b]==a)return;ea.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<ea.length;b++)if(ea[b]==a){ea.splice(b,1);break}}};b4w.module.nla=function(a,p){var d=p("__nla"),b=p("__time"),c=p("__print"),q=p("__util");a.set_frame=function(a){a=q.clamp(a,d.get_frame_start(),d.get_frame_end());d.check_logic_nodes()?c.error("The active scene is using NLA script."):d.set_frame(a,b.get_timeline())};a.get_frame=function(){return d.get_frame(b.get_timeline())};a.stop=function(){d.check_logic_nodes()?c.error("The active scene is using NLA script."):d.cs()};a.play=function(a){d.check_logic_nodes()?c.error("The active scene is using NLA script."):
d.hw(a)};a.is_play=function(){return d.is_play()};a.get_frame_start=function(){return d.get_frame_start()};a.get_frame_end=function(){return d.get_frame_end()};a.check_nla=function(){return d.check_nla()};a.check_nla_scripts=function(){return d.check_logic_nodes()};a.check_logic_nodes=function(){return d.check_logic_nodes()};a.set_range=function(a,b){d.check_logic_nodes()?c.error("The active scene is using NLA script."):(b=parseFloat(b)||d.get_frame_end(),a=parseFloat(a)||d.get_frame_end(),b=q.clamp(b,
d.get_frame_start(),d.get_frame_end()),a=q.clamp(a,d.get_frame_start(),b),d.set_range(a,b))};a.reset_range=function(){d.check_logic_nodes()?c.error("The active scene is using NLA script."):d.reset_range()};a.set_cyclic=function(a){d.check_logic_nodes()?c.error("The active scene is using NLA script."):d.set_cyclic(a)};a.clear_callback=function(){d.check_logic_nodes()?c.error("The active scene is using NLA script."):d.clear_callback()}};b4w.module.app=function(a,p){function d(){var a=D.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=D.is_paused(),D.pause()):a||D.resume()},!1)}function b(a,b,c,d){var e=document.createElement("canvas"),f=document.getElementById(a);e.style.position="absolute";e.style.left=0;e.style.top=0;e.style.width=f.offsetWidth+"px";e.style.height=f.offsetHeight+"px";e.width=f.offsetWidth*window.devicePixelRatio;e.height=f.offsetHeight*window.devicePixelRatio;b?(b=document.createElement("canvas"),
b.style.position="absolute",e.style.left=0,e.style.top=0,b.style.pointerEvents="none"):b=null;f||(I.error('Warning: canvas container "'+a+'" not found, appending to body'),f=document.body);f.appendChild(e);if(!D.init(e,b))return c&&E("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",d),!1;b&&r.insert_to_container(b,"LAST");return!0}function c(a,b){a?(b&&(document.getElementById(b).style.display="block"),O=document.getElementById(a)):(O=document.createElement("div"),
O.innerHTML=0,O.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",r.insert_to_container(O,"JUST_AFTER_CANVAS"))}function q(a,b){var c=String(a);b&&(c+="/"+String(b));O.innerHTML=c}function f(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function t(){var a=r.get_container();r.resize(a.clientWidth,a.clientHeight,!0)}function l(a,b,c){var d=Math.max(m.hover_get_distance(a),1),e=K.get_rotation(a,
W);b=y.quat_to_dir(e,b,ba);b[1]=0;F.normalize(b,b);F.scale(b,d*c,b);c=K.get_translation(a,da);F.add(c,b,c);m.set_translation(a,c)}function n(a,b){var c=m.hover_get_vertical_limits(a,Y);if(0>c.up-c.down){var d=m.get_camera_angles(a,ha)[1],c=(c.down-d)/(c.down-c.up),d=m.hover_get_distance_limits(a,Y),c=Math.max(c,2/d.max);m.hover_rotate(a,0,c*b)}}function g(a,b,c,d){K.move_local(a,5*b,5*c,5*d)}function z(a,b,c){var d=m.target_get_distance(a),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));K.move_local(a,
0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function h(a,b,c,d){for(var e=c*b;0<a;--a)c+=e,d+=e,e=c*b;return d}function k(a,b,c,d,e){e?(e=m.target_get_pivot(a,ba),a=m.get_translation(a),a=F.dist(e,a)+d,d=0<b?h(b,-c,a,d):h(-b,c/(1-c),a,d)):d-=2*b*c;return d}function u(a,b,c){function d(a,b,c,f){if(1==c){var g=u?.003*v.trans:.003*v.rot;c=e.get_sensor_value(a,b,0);e.get_sensor_payload(a,b,0)===e.PL_SINGLE_TOUCH_MOVE?(xa+="X"==f?-c*g:0,Yb+="Y"==f?-c*g:0):e.get_sensor_payload(a,b,0)===e.PL_MULTITOUCH_MOVE_PAN&&(a=
u?.003*v.rot:7.5E-4*v.trans,fc+="X"==f?-c*a:0,Tb+="Y"==f?-c*a:0)}}function f(a,b,c,d){if(1==c){c=e.get_sensor_value(a,b,1);m.get_velocities(a,v);if(u)g=.003*v.trans,h=7.5E-4*v.rot;else var g=.003*v.rot,h=7.5E-4*v.trans;if(1===e.get_sensor_payload(a,b,0))Fb+="X"==d?-c*g:0,na+="Y"==d?-c*g:0;else if(2===e.get_sensor_payload(a,b,0)||3===e.get_sensor_payload(a,b,0))Ba+="X"==d?-c*h:0,Bb+="Y"==d?-c*h:0}}function h(a){return a[0]&&(a[1]||a[2])}function p(a,b,c){if(1==c)switch(c=e.get_sensor_value(a,b,0),
m.get_velocities(a,v),b){case "FORWARD":t?C[0]=1:u?(b=m.get_camera_angles(a,ha)[1],b=Math.abs(b)>=Math.PI/4?y.AXIS_MZ:y.AXIS_MY,l(a,b,.5*v.trans*c)):r?z(a,-v.zoom,c):g(a,0,-v.trans*c,0);break;case "BACKWARD":t?C[0]=-1:u?(b=m.get_camera_angles(a,ha)[1],b=Math.abs(b)>=Math.PI/4?y.AXIS_Z:y.AXIS_Y,l(a,b,.5*v.trans*c)):r?z(a,v.zoom,c):g(a,0,v.trans*c,0);break;case "UP":u?n(a,30*-v.zoom*c):t||g(a,0,0,-v.trans*c);break;case "DOWN":u?n(a,30*v.zoom*c):t||g(a,0,0,v.trans*c);break;case "LEFT":t?C[1]=1:u?l(a,
y.AXIS_MX,.5*v.trans*c):g(a,-v.trans*c,0,0);break;case "RIGHT":t?C[1]=-1:u?l(a,y.AXIS_X,.5*v.trans*c):g(a,v.trans*c,0,0);break;case "ROT_LEFT":r?m.target_rotate(a,2*-v.rot*c,0):m.eye_rotate(a,2*v.rot*c,0);break;case "ROT_RIGHT":r?m.target_rotate(a,2*v.rot*c,0):m.eye_rotate(a,2*-v.rot*c,0);break;case "ROT_UP":r?m.target_rotate(a,0,2*-v.rot*c):m.eye_rotate(a,0,2*v.rot*c);break;case "ROT_DOWN":r?m.target_rotate(a,0,2*v.rot*c):m.eye_rotate(a,0,2*-v.rot*c)}else switch(b){case "FORWARD":case "BACKWARD":t&&
(C[0]=0);break;case "LEFT":case "RIGHT":t&&(C[1]=0)}t&&(H.set_character_move_dir(t,C[0],C[1]),a=m.get_camera_angles_char(a,B),H.set_character_rotation(t,a[0],a[1]))}V=a;T=b;U=c;var q=P.get_active_camera();w(q);var r=!1,t=null,u=!1;switch(m.get_move_style(q)){case m.MS_TARGET_CONTROLS:r=!a;break;case m.MS_EYE_CONTROLS:t=P.get_first_character();break;case m.MS_STATIC:return;case m.MS_HOVER_CONTROLS:u=!0}var v=m.get_velocities(q,R);a=e.create_elapsed_sensor();if(H.has_simulated_physics(q)){var x=e.create_collision_sensor(q,
null,!0);e.create_sensor_manifold(q,"CAMERA_COLLISION",e.CT_POSITIVE,[x],null,function(a,b){var c=e.get_sensor_payload(a,b,0).coll_dist;if(0>c){var d=e.get_sensor_payload(a,b,0).coll_norm,f=ba;F.scale(d,-.25*c,f);c=K.get_translation(a,da);F.add(c,f,c);K.set_translation_v(a,c)}})}if(t){var x=K.get_translation(q),D=K.get_rotation(q),D=y.cam_quat_to_mesh_quat(D);x[1]-=.5;H.set_transform(t,x,D);A.append_stiff_trans(q,t,[0,.5,0]);var C=new Float32Array(2),I=!0;H.set_character_move_type(t,H.CM_FLY);e.create_kb_sensor_manifold(q,
"TOGGLE_CHAR_MOVE_TYPE",e.CT_SHOT,e.KEY_C,function(){I=!I;H.set_character_move_type(t,I?H.CM_FLY:H.CM_WALK)})}if(b)b=x=D=E=G=O=e.create_custom_sensor(0);else{b=e.create_keyboard_sensor(e.KEY_W);var x=e.create_keyboard_sensor(e.KEY_S),D=e.create_keyboard_sensor(e.KEY_A),E=e.create_keyboard_sensor(e.KEY_D),G=e.create_keyboard_sensor(e.KEY_R),O=e.create_keyboard_sensor(e.KEY_F)}var J=e.create_keyboard_sensor(e.KEY_UP),W=e.create_keyboard_sensor(e.KEY_DOWN),Y=e.create_keyboard_sensor(e.KEY_LEFT),ra=e.create_keyboard_sensor(e.KEY_RIGHT);
u||(e.create_sensor_manifold(q,"FORWARD",e.CT_CONTINUOUS,[a,b],null,p),e.create_sensor_manifold(q,"BACKWARD",e.CT_CONTINUOUS,[a,x],null,p));r?(e.create_sensor_manifold(q,"ROT_UP",e.CT_CONTINUOUS,[a,J,G],h,p),e.create_sensor_manifold(q,"ROT_DOWN",e.CT_CONTINUOUS,[a,W,O],h,p),e.create_sensor_manifold(q,"ROT_LEFT",e.CT_CONTINUOUS,[a,Y,D],h,p),e.create_sensor_manifold(q,"ROT_RIGHT",e.CT_CONTINUOUS,[a,ra,E],h,p)):u?(e.create_sensor_manifold(q,"LEFT",e.CT_CONTINUOUS,[a,Y,D],h,p),e.create_sensor_manifold(q,
"RIGHT",e.CT_CONTINUOUS,[a,ra,E],h,p),e.create_sensor_manifold(q,"FORWARD",e.CT_CONTINUOUS,[a,J,b],h,p),e.create_sensor_manifold(q,"BACKWARD",e.CT_CONTINUOUS,[a,W,x],h,p),e.create_sensor_manifold(q,"UP",e.CT_CONTINUOUS,[a,O],h,p),e.create_sensor_manifold(q,"DOWN",e.CT_CONTINUOUS,[a,G],h,p)):(e.create_sensor_manifold(q,"UP",e.CT_CONTINUOUS,[a,G],h,p),e.create_sensor_manifold(q,"DOWN",e.CT_CONTINUOUS,[a,O],h,p),e.create_sensor_manifold(q,"LEFT",e.CT_CONTINUOUS,[a,D],h,p),e.create_sensor_manifold(q,
"RIGHT",e.CT_CONTINUOUS,[a,E],h,p),e.create_sensor_manifold(q,"ROT_UP",e.CT_CONTINUOUS,[a,J],h,p),e.create_sensor_manifold(q,"ROT_DOWN",e.CT_CONTINUOUS,[a,W],h,p),e.create_sensor_manifold(q,"ROT_LEFT",e.CT_CONTINUOUS,[a,Y],h,p),e.create_sensor_manifold(q,"ROT_RIGHT",e.CT_CONTINUOUS,[a,ra],h,p));if(!c){var Ja=0;c=e.create_mouse_wheel_sensor();var oa=0;b=e.create_touch_zoom_sensor();e.create_sensor_manifold(q,"MOUSE_WHEEL",e.CT_LEVEL,[c],null,function(a,b,c){1==c&&(b=e.get_sensor_value(a,b,0),m.get_velocities(a,
v),r||u?Ja=k(a,b,v.zoom,Ja,r):(v.trans*=1+b*v.zoom,m.set_velocities(a,v)))});e.create_sensor_manifold(q,"TOUCH_ZOOM",e.CT_LEVEL,[b],null,function(a,b,c){1==c&&(c=e.get_sensor_value(a,b,0),m.get_velocities(a,v),e.get_sensor_payload(a,b,0)===e.PL_MULTITOUCH_MOVE_ZOOM&&(oa=k(a,c,.03*v.zoom,oa,r)))});e.create_sensor_manifold(q,"ZOOM_INTERPOL",e.CT_POSITIVE,[a],null,function(a,b){if(r||u)if(1E-5<Math.abs(Ja)||1E-5<Math.abs(oa)){var c=e.get_sensor_value(a,b,0),d=y.smooth(Ja,0,c,.1*M);Ja-=d;c=y.smooth(oa,
0,c,.15*M);oa-=c;u?n(a,-(d+c)):(d=m.target_get_distance(a)+d+c,d=Math.max(d,.001),m.target_set_distance(a,d))}else oa=Ja=0})}var Fb=0,na=0,Ba=0,Bb=0;c=e.create_mouse_move_sensor("X");b=e.create_mouse_move_sensor("Y");x=e.create_mouse_click_sensor();e.create_sensor_manifold(q,"MOUSE_X",e.CT_LEVEL,[x,c],null,f,"X");e.create_sensor_manifold(q,"MOUSE_Y",e.CT_LEVEL,[x,b],null,f,"Y");var xa=0,Yb=0,fc=0,Tb=0;c=e.create_touch_move_sensor("X");b=e.create_touch_move_sensor("Y");e.create_sensor_manifold(q,"TOUCH_X",
e.CT_LEVEL,[c],null,d,"X");e.create_sensor_manifold(q,"TOUCH_Y",e.CT_LEVEL,[b],null,d,"Y");e.create_sensor_manifold(q,"ROT_TRANS_INTERPOL",e.CT_POSITIVE,[a],null,function(a,b){if(1E-5<Math.abs(Fb)||1E-5<Math.abs(na)||1E-5<Math.abs(xa)||1E-5<Math.abs(Yb)||1E-5<Math.abs(Ba)||1E-5<Math.abs(Bb)||1E-5<Math.abs(fc)||1E-5<Math.abs(Tb)){var c=e.get_sensor_value(a,b,0),d=y.smooth(Fb,0,c,.08*M),f=y.smooth(na,0,c,.08*M);Fb-=d;na-=f;var g=y.smooth(xa,0,c,.12*M),h=y.smooth(Yb,0,c,.12*M);xa-=g;Yb-=h;var k=y.smooth(Ba,
0,c,.08*M),n=y.smooth(Bb,0,c,.08*M);Ba-=k;Bb-=n;var p=y.smooth(fc,0,c,.12*M),c=y.smooth(Tb,0,c,.12*M);fc-=p;Tb-=c;r?(m.target_rotate(a,d+g,f+h),f=m.target_get_distance(a),m.target_pan_pivot(a,f*(k+p),f*(n+c))):u?(d+g&&l(a,y.AXIS_X,.2*(d+g)),f+h&&(n=m.get_camera_angles(a,ha)[1],l(a,Math.abs(n)>Math.PI/4?y.AXIS_Z:y.AXIS_Y,.2*(f+h))),m.hover_rotate(a,k+p,0)):(m.eye_rotate(a,.5*(d+g),.5*(f+h)),t&&(k=m.get_camera_angles_char(a,B),H.set_character_rotation(t,k[0],k[1])))}});e.create_kb_sensor_manifold(q,
"DEC_STEREO_DIST",e.CT_SHOT,e.KEY_LEFT_SQ_BRACKET,function(a){var b=m.get_stereo_distance(a);m.set_stereo_distance(a,.9*b)});e.create_kb_sensor_manifold(q,"INC_STEREO_DIST",e.CT_SHOT,e.KEY_RIGHT_SQ_BRACKET,function(a){var b=m.get_stereo_distance(a);m.set_stereo_distance(a,1.1*b)})}function w(a){var b=m.get_move_style(a),c=e.create_callback_sensor(function(){var c=m.get_move_style(a),d=c!=b;b=c;return d});e.create_sensor_manifold(a,"CHANGE_MOVE_STYLE",e.CT_POSITIVE,[c],null,function(){C();u(V,T,U)})}
function C(){for(var a=P.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL CHANGE_MOVE_STYLE".split(" "),c=0;c<b.length;c++)e.remove_sensor_manifold(a,b[c]);m.get_move_style(a)==m.MS_EYE_CONTROLS&&P.get_first_character()&&A.remove(a)}function E(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=
0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function G(a,b,c,
d,e){function f(){var h=performance.now()-g;e(b+h*(c-b)/d);(h>=d||!a.parentNode)&&D.remove_loop_cb(f)}var g=performance.now();D.append_loop_cb(f)}p("animation");var m=p("camera"),x=p("config"),A=p("constraints"),r=p("container"),e=p("controls"),v=p("data"),J=p("debug"),D=p("main"),H=p("physics"),I=p("print"),P=p("scenes"),K=p("transform"),y=p("util"),F=p("vec3"),M=1,O=null,V=!1,T=!1,U=!1,B=new Float32Array(2),ha=new Float32Array(2),ba=new Float32Array(3),da=new Float32Array(3);new Float32Array(3);
var W=new Float32Array(4),R={},Y={};a.init=function(a){function f(){var a=b(l,E,F,m),e=r.get_canvas();if(a){var g=r.get_container();t();D.set_check_gl_errors(y);z&&(c(n,u),D.set_fps_callback(q));A&&d();p&&D.append_loop_cb(function(){g.style.height=g.clientWidth/p+"px"});k&&D.append_loop_cb(function(){var a=g.clientWidth,b=g.clientHeight;a==e.clientWidth&&b==e.clientHeight||r.resize(a,b,!0)});K&&D.append_loop_cb(function(){r.force_offsets_updating()});h(e,!0)}else h(e,!1)}function g(a){a.keyCode==
e.KEY_P&&(D.is_paused()?D.resume():D.pause())}function h(){}a=a||{};var k=!1,l=null,m=null,n=null,p=0,u=null,y=!1,w=!0,A=!0,F=!0,B=!1,z=!1,C=!1,K=!1,I;for(I in a)switch(I){case "canvas_container_id":l=a.canvas_container_id;break;case "callback":h=a.callback;break;case "autoresize":k=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":y=a.gl_debug;break;case "show_hud_debug_info":C=a.show_hud_debug_info;break;case "sfx_mix_mode":B=a.sfx_mix_mode;break;case "show_fps":z=a.show_fps;break;
case "track_container_position":K=a.track_container_position;break;case "fps_wrapper_id":u=a.fps_wrapper_id;break;case "fps_elem_id":n=a.fps_elem_id;break;case "error_purge_elements":m=a.error_purge_elements;break;case "report_init_failure":F=a.report_init_failure;break;case "pause_invisible":A=a.pause_invisible;break;case "key_pause_enabled":w=a.key_pause_enabled;break;case "force_container_ratio":p=a.force_container_ratio;break;default:x.set(I,a[I])}w&&document.addEventListener("keydown",g,!1);
x.set("show_hud_debug_info",C);x.set("sfx_mix_mode",B);var E=C||B||null;"complete"==document.readyState?window.setTimeout(f,0):window.addEventListener("load",f,!1);window.addEventListener("unload",function(){v.cleanup()},!1)};a.resize_to_container=t;a.set_onclick=function(a,b){var c=f(a);c.addEventListener("mouseup",function(){b(c.value)},!1)};a.set_onchange=function(a,b){var c=f(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=
f(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=u;a.disable_camera_controls=C;a.set_camera_move_style=function(a){I.Ga("app.set_camera_move_style","camera.set_move_style");var b=P.get_active_camera();m.set_move_style(b,a)};a.enable_object_controls=function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,f){if(1==f)switch(f=e.get_sensor_value(a,b,0),b){case "FORWARD":d?H.vehicle_throttle(a,1):K.move_local(a,0,0,1*f);break;case "BACKWARD":d?
H.vehicle_throttle(a,-1):K.move_local(a,0,0,-1*f);break;case "LEFT":d?H.vehicle_steer(a,-1):K.move_local(a,1*f,0,0);break;case "RIGHT":d?H.vehicle_steer(a,1):K.move_local(a,-1*f,0,0)}else switch(b){case "FORWARD":case "BACKWARD":d&&H.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":d&&H.vehicle_steer(a,0)}}var d=H.is_vehicle_chassis(a)||H.is_vehicle_hull(a),f=e.create_elapsed_sensor(),g=e.create_keyboard_sensor(e.KEY_W),h=e.create_keyboard_sensor(e.KEY_S),k=e.create_keyboard_sensor(e.KEY_A),l=
e.create_keyboard_sensor(e.KEY_D),m=e.create_keyboard_sensor(e.KEY_UP),n=e.create_keyboard_sensor(e.KEY_DOWN),p=e.create_keyboard_sensor(e.KEY_LEFT),q=e.create_keyboard_sensor(e.KEY_RIGHT);e.create_sensor_manifold(a,"FORWARD",e.CT_CONTINUOUS,[f,g,m],b,c);e.create_sensor_manifold(a,"BACKWARD",e.CT_CONTINUOUS,[f,h,n],b,c);e.create_sensor_manifold(a,"LEFT",e.CT_CONTINUOUS,[f,k,p],b,c);e.create_sensor_manifold(a,"RIGHT",e.CT_CONTINUOUS,[f,l,q],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD",
"BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)e.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){var b=r.get_container();a=a||!1;e.register_keyboard_events(document,!1);e.register_mouse_events(b,!0,a);e.register_wheel_events(b,!0);e.register_touch_events(b,!0);e.register_device_orientation()};a.disable_controls=function(){var a=r.get_container();e.unregister_keyboard_events(document);e.unregister_mouse_events(a);e.unregister_wheel_events(a);e.unregister_touch_events(a);e.unregister_device_orientation()};
a.enable_debug_controls=function(){e.create_kb_sensor_manifold(null,"CAMERA_SHOT",e.CT_SHOT,e.KEY_K,function(){J.make_camera_frustum_shot()});e.create_kb_sensor_manifold(null,"LIGHT_SHOT",e.CT_SHOT,e.KEY_L,function(){J.make_light_frustum_shot()});e.create_kb_sensor_manifold(null,"TELEMETRY",e.CT_SHOT,e.KEY_T,function(){J.plot_telemetry()})};a.request_fullscreen=function(a,b,c,d){function e(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||
document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",e,!1),document.removeEventListener("webkitfullscreenchange",e,!1),document.removeEventListener("mozfullscreenchange",e,!1),document.removeEventListener("MSFullscreenChange",e,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",e,!1);document.addEventListener("webkitfullscreenchange",e,!1);document.addEventListener("mozfullscreenchange",e,!1);document.addEventListener("MSFullscreenChange",
e,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;var f=null;a.requestFullScreen==a.webkitRequestFullScreen&&(f=Element.ALLOW_KEYBOARD_INPUT);d&&a.requestFullScreen!=a.mozRequestFullScreen&&(f=f||{vrDisplay:d,vrDistortion:x.get("use_browser_distortion_cor")});a.requestFullScreen(f)};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;
if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=E;a.get_url_params=function(a){a=!!a;var b=decodeURIComponent(location.href.toString());if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=
b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,b,c,d,e,f,g,h){function k(e){a&&(l[b]=f+e+g,c>d&&e<=d||c<d&&e>=d)&&(l[b]=f+d+g,h())}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};var l=a.style,m=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==l[b])if(void 0!=l["webkit"+m])b="webkit"+m;else if(void 0!=l["ms"+m])b="ms"+m;else if(void 0!=l["moz"+m])b="moz"+m;else return;
G(a,c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,f){function g(e){a&&(0<=e&&a.setAttribute(b,e),c>d&&e<=d||c<d&&e>=d)&&(a.setAttribute(b,d),f())}a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(f=f||function(){},G(a,c,d,e,g))};a.queue_animate=function(b){if(b.length){var c=b.shift(),d=c.elem,e=c.prop,f=c.from,g=c.to,h=c.duration,k=c.opt_prefix,l=c.opt_suffix,m=function(){c.cb&&c.cb();a.queue_animate(b)};"css"==c.type?a.css_animate(d,e,f,g,h,k,l,m):"attr"==c.type&&a.attr_animate(d,e,f,g,h,m)}};a.set_camera_smooth_factor=
function(a){M=a};a.get_camera_smooth_factor=function(){return M}};b4w.module.camera_anim=function(a,p){function d(a,b,c,d){b=g.angle_wrap_0_2pi(a-b);a=g.angle_wrap_0_2pi(c-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;d[0]=b;d[1]=a;return d}var b=p("camera"),c=p("controls"),q=p("print"),f=p("scenes"),t=p("time"),l=p("transform"),n=p("tsr"),g=p("util"),z=p("vec3"),h=p("quat"),k=new Float32Array(2),u=new Float32Array(2),w=new Float32Array(3),C=new Float32Array(3),E=new Float32Array(3),G=new Float32Array(4),
m=n.create(),x=n.create(),A=n.create(),r={},e=!1,v=!1,J=!1,D=!1;a.track_to_target=function(a,d,e,f,m,n,p,r){if(!b.is_eye_camera(a))q.error("track_to_target(): wrong object");else if(a&&d){if(g.is_vector(d))var t=d;else t=E,l.get_object_center(d,!1,t);d=e||1;e=f||2;var u=m||1;m=n||1;C[0]=0;C[1]=-1;C[2]=0;var v=l.get_rotation(a);n=g.quat_to_dir(v,C);f=b.get_camera_angles(a,k);var A=l.get_translation(a);z.subtract(t,A,w);z.normalize(w,w);var x=h.rotationTo(n,w,h.create());h.multiply(x,v,G);g.correct_cam_quat_up(G,
!1);z.subtract(t,A,C);var D=z.length(C)*(1-1/e),t=Math.asin(w[1]);e=Math.acos(-w[2]/Math.abs(Math.cos(t)));0<w[0]&&(e=2*Math.PI-e);var J=e-f[0],W=t-f[1];E[0]=0;E[1]=0;E[2]=-1;e=l.get_rotation(a);0>g.quat_to_dir(e,E)[1]?(W=0<n[1]?t-Math.PI+f[1]:t+Math.PI+f[1],J=0<J?-Math.PI+J:Math.PI+J):Math.abs(J)>Math.PI&&(J=0<J?J-2*Math.PI:J+2*Math.PI);var R=0,t=c.create_elapsed_sensor();n=Math.abs(J/d);d=Math.abs(W/d);var Y=n>d?n:d,ka=Y+u,ea=ka+m,ma=ea+u,la=J,N=W,aa=D,X=function(){c.remove_sensor_manifold(a,"TRACK_TO_TARGET");
p&&p()};c.create_sensor_manifold(a,"TRACK_TO_TARGET",c.CT_CONTINUOUS,[t],null,function(a,d,e){if(e)if(b.is_eye_camera(a))if(e=c.get_sensor_value(a,d,0),R+=e,R<Y){var f=J/Y*e;e*=W/Y;d=R/Y;d=6*d*(1-d);f*=d;e*=d;la-=f;N-=e;b.eye_rotate(a,f,e)}else R<ka?(la&&(b.eye_rotate(a,la,N),la=0,r&&r()),d=(R-Y)/u,e=-D*e/u,aa-=f,l.move_local(a,0,6*e*d*(1-d),0)):R<ea?aa&&(l.move_local(a,0,aa,0),aa=0):R<ma?(d=(R-ea)/u,e=D*e/u,e=6*e*d*(1-d),l.move_local(a,0,e,0)):(l.set_translation_v(a,A),X());else X()})}};a.auto_rotate=
function(a,e,h){function m(e,f,h){if(1==h)if(h=b.get_move_style(e),h==b.MS_STATIC)l();else if(h!=b.MS_TARGET_CONTROLS&&h!=b.MS_EYE_CONTROLS||!b.has_horizontal_rot_limits(e))p=null,f=c.get_sensor_value(e,f,0),b.rotate_camera(e,f*a,0);else{h=h==b.MS_EYE_CONTROLS?b.eye_get_horizontal_limits(e,r):b.target_get_horizontal_limits(e,r);if(null===p||h.left!=p.left||h.right!=p.right){p=p||{};p.left=h.left;p.right=h.right;t=Math.min(.2,g.angle_wrap_0_2pi(p.right-p.left)/2);h=p;var q=b.get_camera_angles(n,k)[0];
h=d(q,h.left,h.right,u);v=a*Math.min(1,h[0]/.2,h[1]/.2)}f=c.get_sensor_value(e,f,0);h=b.get_camera_angles(e,k)[0];h=d(h,p.left,p.right,u);h[1]>t&&h[0]>t?v=g.sign(v)*a:h[1]<t?v-=Math.pow(a,2)/.4*f:h[0]<t&&(v+=Math.pow(a,2)/.4*f);b.rotate_camera(e,f*v,0)}}function l(){c.remove_sensor_manifold(n,"AUTO_ROTATE");c.remove_sensor_manifold(n,"DISABLE_AUTO_ROTATE");e()}e=e||function(){};var n=f.get_active_camera();if(b.is_static_camera(n))q.error("auto_rotate(): Wrong camera move style");else{var p={},t=0,
v=0;if(c.check_sensor_manifold(n,"AUTO_ROTATE"))l();else{var w=c.create_mouse_move_sensor("X"),A=c.create_mouse_move_sensor("Y"),x=c.create_mouse_click_sensor(),z=c.create_touch_move_sensor(),D=c.create_touch_zoom_sensor(),C=c.create_elapsed_sensor();h=h?c.create_mouse_wheel_sensor():c.create_custom_sensor(0);c.create_sensor_manifold(n,"DISABLE_AUTO_ROTATE",c.CT_LEVEL,[w,A,x,z,D,h],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]||a[5]},l);c.create_sensor_manifold(n,"AUTO_ROTATE",c.CT_CONTINUOUS,
[C],function(a){return a[0]},m)}}};a.is_auto_rotate=function(){var a=f.get_active_camera();return c.check_sensor_manifold(a,"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=f.get_active_camera();return b.get_move_style(a)==b.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,c,d,f,h){if(b.get_move_style(a)!=b.MS_STATIC)q.error("move_camera_to_point(): wrong camera type");else if(!e)if(a)if(c){d=d||1;f=f||.01;var k=g.is_vector(a)?a:l.get_tsr(a,m),p=g.is_vector(c)?c:l.get_tsr(c,x);c=z.distance(n.get_trans_view(k),
n.get_trans_view(p))/d;d=g.quat_to_dir(n.get_quat_view(k),g.AXIS_MY,w);var r=g.quat_to_dir(n.get_quat_view(p),g.AXIS_MY,C);d=Math.min(Math.abs(z.dot(d,r)),1);f=1E3*Math.max(c,Math.acos(d)/f);e=!0;var u=t.animate(0,1,f,function(b){var c=n.interpolate(k,p,g.smooth_step(b),A);J?(t.clear_animation(u),e=J=!1):(l.set_tsr(a,c),1==b&&(e=!1,h&&h()))})}else q.error("move_camera_to_point(): you must specify the point object");else q.error("move_camera_to_point(): you must specify the camera object")};a.rotate_camera=
function(a,c,d,e,f){if(!v)if(a)if(c||d){v=!0;var g=0,h=0,k=0!=c?c:d,l=t.animate(0,k,e||1E3,function(e){D?(t.clear_animation(l),v=D=!1):(g-=e,h-=e,d&&c?b.rotate_camera(a,g,h):d?b.rotate_camera(a,0,h):c&&b.rotate_camera(a,g,0),h=g=e,e==k&&(v=!1,f&&f()))})}else q.error("rotate_camera(): you must specify the rotation angle");else q.error("rotate_camera(): you must specify the camera object")};a.stop_cam_moving=function(){J=!0};a.stop_cam_rotating=function(){D=!0};a.is_moving=function(){return e};a.is_rotating=
function(){return v}};b4w.module.gyroscope=function(a,p){function d(a){var c=b.create_gyro_angles_sensor(),d=!0;b.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",b.CT_CONTINUOUS,[c],null,function(a,c,h){if(0<h){t=b.get_sensor_payload(a,c,0);d&&(f[0]=t[0],f[1]=t[1],f[2]=t[2],d=!1);h=c=0;0==window.orientation&&(c=t[1]-f[1],h=t[0]-f[0],t[1]>n&&t[1]<l&&(h=0));if(180==window.orientation){c=t[1]-f[1];0>t[1]&&(c=-c);h=f[0]-t[0];if(c>Math.PI/2||c<-Math.PI/2)c=0;t[1]>-l&&t[1]<-n&&(h=0)}if(-90==window.orientation){c=t[0]-f[0];if(c>
Math.PI/2||c<-Math.PI/2)c=0;h=f[1]-t[1];if(t[0]>g||t[0]<z)h=0}if(90==window.orientation){c=f[0]-t[0];if(c>Math.PI/2||c<-Math.PI/2)c=0;h=t[1]-f[1];if(t[0]>g||t[0]<z)h=0}q.rotate_camera(a,h,c);f[0]=t[0];f[1]=t[1];f[2]=t[2]}})}var b=p("controls"),c=p("scenes"),q=p("camera"),f=new Float32Array(3),t=new Float32Array(3),l=110*Math.PI/180,n=70*Math.PI/180,g=70*Math.PI/180,z=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=c.get_active_camera();d(a)}};b4w.module.hmd=function(a,p){function d(a){var b=a.filter(function(a){return a instanceof HMDVRDevice});b.length&&(E=b[0]);E&&(G=a.filter(function(a){return-1!==a.deviceName.toLowerCase().indexOf("oculus")&&a.hardwareUnitId==E.hardwareUnitId&&a instanceof PositionSensorVRDevice}))}function b(a){if(G)for(var b=0;b<G.length;b++){var c=G[b].getState();if(c.orientation)return a||(a=g.create()),a[0]=c.orientation.x,a[1]=c.orientation.y,a[2]=c.orientation.z,a[3]=c.orientation.w,a}}function c(a,b){if(E){var c=
E.getEyeParameters(a);if(c&&c.currentFieldOfView)return b||(b=C.create()),b[0]=c.currentFieldOfView.upDegrees,b[1]=c.currentFieldOfView.rightDegrees,b[2]=c.currentFieldOfView.downDegrees,b[3]=c.currentFieldOfView.leftDegrees,b}}function q(){if(G)for(var a=0;a<G.length;a++)G[a].resetSensor()}function f(a){if(E){var d=l.create_elapsed_sensor(),f=!1;l.create_sensor_manifold(null,"HMD_ROTATE_CAMERA",l.CT_CONTINUOUS,[d],null,function(d,l,p){if((d=h.get_active_camera())&&0<p&&(f||(p=c("left",v),l=c("right",
J),p&&p&&t.set_hmd_fov(d,p,l),E?(p=E.getEyeParameters("left"),p=E.getEyeParameters("right").eyeTranslation.x-p.eyeTranslation.x):p=void 0,p&&t.set_eye_distance(d,p),p={},l=-1!==E.deviceName.toLowerCase().indexOf("oculus")?"oculus":"default",p.distortion_coefs=[P[l].distortion_coefs[0],P[l].distortion_coefs[1]],p.chromatic_aberration_coefs=[P[l].chromatic_aberration_coefs[0],P[l].chromatic_aberration_coefs[1],P[l].chromatic_aberration_coefs[2],P[l].chromatic_aberration_coefs[3]],p.distortion_scale=
P[l].distortion_scale,p.distortion_offset=0,p.enable_hmd_stereo=!0,h.set_hmd_params(p),p=n.get_container(),n.resize(p.clientWidth,p.clientHeight,!0),f=!0,m=k.get_rotation(d,m),q()),t.is_eye_camera(d)))if(1==a){if(p=b(D)){l=g.setAxisAngle(u.AXIS_X,Math.PI/2,H);g.normalize(l,l);p=g.multiply(p,l,D);var y=w.transformQuat(u.AXIS_Z,p,A);t.set_vertical_axis(d,y);k.set_rotation_v(d,p)}}else if(2==a||3==a)if(p=b(D)){l=g.setAxisAngle(u.AXIS_X,Math.PI/2,H);g.normalize(l,l);p=g.multiply(p,l,D);l=k.get_rotation(d,
H);l=g.invert(l,H);var z=g.multiply(m,l,H);l=t.get_vertical_axis(d,A);Math.abs(l[2])<Math.PI/4?y=w.cross(l,u.AXIS_Z,r):Math.abs(l[1])<Math.PI/4&&(y=w.cross(l,u.AXIS_Y,r));w.normalize(y,y);var z=w.transformQuat(y,z,e),B=w.dot(l,z),z=w.scaleAndAdd(z,l,-B,e);w.normalize(z,z);l=w.cross(l,y,A);y=Math.acos(u.clamp(w.dot(y,z),0,1));l=u.sign(w.dot(z,l));x+=y*l;y=g.setAxisAngle(u.AXIS_Y,-x,H);3!=a&&(l=u.quat_project(p,u.AXIS_MY,u.AXIS_Y,u.AXIS_MZ,I),l=g.invert(l,I),p=g.multiply(l,p,I));p=g.multiply(y,p,D);
y=w.transformQuat(u.AXIS_Z,p,A);t.set_vertical_axis(d,y);k.set_rotation_v(d,p);g.copy(p,m)}})}else z.warn("Head-mounted display is not found.")}var t=p("camera"),l=p("controls"),n=p("container"),g=p("quat"),z=p("print"),h=p("scenes"),k=p("transform"),u=p("util"),w=p("vec3"),C=p("vec4"),E=null,G=null,m=g.create(),x=0,A=w.create(),r=w.create(),e=w.create(),v=C.create(),J=C.create(),D=g.create(),H=g.create(),I=g.create(),P={oculus:{distortion_coefs:[.22,.28],distortion_scale:.66,chromatic_aberration_coefs:[-.015,
.02,.025,.02]},"default":{distortion_coefs:[0,0],distortion_scale:1,chromatic_aberration_coefs:[0,0,0,0]}};a.HMD_NONE_MOUSE_ALL_AXES=0;a.HMD_ALL_AXES_MOUSE_NONE=1;a.HMD_ROLL_PITCH_MOUSE_YAW=2;a.HMD_ALL_AXES_MOUSE_YAW=3;a.enable_hmd=function(a){navigator.getVRDevices&&navigator.getVRDevices().then(function(b){d(b);E&&f(a)})};a.check_browser_support=function(){return Boolean(navigator.getVRDevices)};a.get_hmd_device=function(){return E};a.reset=q;a.disable_hmd=function(){l.remove_sensor_manifold(null,
"HMD_ROTATE_CAMERA");h.set_hmd_params({enable_hmd_stereo:!1});var a=n.get_container();n.resize(a.clientWidth,a.clientHeight,!0);a=h.get_active_camera();t.set_vertical_axis(a,u.AXIS_Y);var b=k.get_rotation(a,D);k.set_rotation_v(a,b)}};b4w.module.mixer=function(a,p){function d(){E=C.length=0;G=b();m=new Float32Array(G.length);x=new Float32Array(G.length);var a=u.get_speaker_objects();if(a.length){C.push(c());for(var d=0;d<a.length;d++)C.push(f(a[d]));C.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function b(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/
99;return a}function c(){var a=q("MASTER");a.R.push(["VOLUME",u.get_volume(null),0,1,50,!1]);var b=u.get_compressor_params();b&&(a.R.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.R.push(["KNEE",b.knee,0,40,40,!1]),a.R.push(["RATIO",b.ratio,1,20,20,!1]),a.R.push(["ATTACK",b.attack,0,1,1E3,!1]),a.R.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=u.is_muted(null)?1:0;a.Wd=-1;return a}function q(a){return{id:a,R:[],Sg:0,mute:-1,Wd:-1,Ya:null}}function f(a){var b=q(k.get_object_name(a));b.mute=u.is_muted(a)?
1:0;b.Wd=0;b.Ya=a;return b}function t(a){if(a.Ya){a.R.length=0;a.R.push(["VOLUME",u.get_volume(a.Ya),0,1,50,!1]);var b=u.get_positional_params(a.Ya);b&&(a.R.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.R.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.R.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=u.get_filter_params(a.Ya))a.R.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.R.push(["EQ_Q",b.Q,0,10,100,!1]),a.R.push(["EQ_GAIN",b.gain,-70,30,100,!1]);w.clamp(a.Sg,0,a.R.length-1)}}function l(a){for(var b=
0;b<C.length;b++){var c=C[b];if(c!=a&&1==c.Wd)return!0}return!1}function n(a){for(var b=0;b<C.length;b++){var c=C[b];c!=a&&0==c.mute&&0==c.Wd&&u.mute(c.Ya,!1)}}function g(){if(0==C.length)return[0,-1];var a=8*Math.floor(E/8),b=a+7,a=w.clamp(a,0,C.length-1),b=w.clamp(b,0,C.length-1);return[a,b]}var z=p("controls");p("debug");var h=p("hud"),k=p("scenes"),u=p("sfx"),w=p("util"),C=[],E=0,G=null,m=null,x=null;a.enable_mixer_controls=function(){function a(b,c,d){if(1==d){var e=Boolean(z.get_sensor_value(b,
c,2))?-1:1,f=C[E];if(f)switch(d=f.R[f.Sg],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=w.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?u.set_volume(f.Ya,d[1]):u.set_volume(null,d[1]);break;case "DIST_REF":e=u.get_positional_params(f.Ya);e.dist_ref=d[1];u.set_positional_params(f.Ya,e);break;case "ATTENUATION":e=u.get_positional_params(f.Ya);e.attenuation=d[1];u.set_positional_params(f.Ya,e);break;case "DIST_MAX":e=u.get_positional_params(f.Ya);e.dist_max=d[1];u.set_positional_params(f.Ya,
e);break;case "EQ_FREQ":e=u.get_filter_params(f.Ya);e.freq=d[1];u.set_filter_params(f.Ya,e);break;case "EQ_Q":e=u.get_filter_params(f.Ya);e.Q=d[1];u.set_filter_params(f.Ya,e);break;case "EQ_GAIN":e=u.get_filter_params(f.Ya);e.gain=d[1];u.set_filter_params(f.Ya,e);break;case "THRESHOLD":f=u.get_compressor_params();f.threshold=d[1];u.set_compressor_params(f);break;case "KNEE":f=u.get_compressor_params();f.knee=d[1];u.set_compressor_params(f);break;case "RATIO":f=u.get_compressor_params();f.ratio=d[1];
u.set_compressor_params(f);break;case "ATTACK":f=u.get_compressor_params();f.attack=d[1];u.set_compressor_params(f);break;case "RELEASE":f=u.get_compressor_params();f.release=d[1];u.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==c?z.reset_timer_sensor(b,c,6,.35):z.reset_timer_sensor(b,c,6,.05)}else z.reset_timer_sensor(b,c,6,10)}function b(a,c,d){if(1==d){d=Boolean(z.get_sensor_value(a,c,0))?-1:1;if(C.length){1==d&&E<C.length-1?E++:-1==d&&0<E&&E--;d=g();for(var e=d[0];e<=
d[1];e++)t(C[e])}"SWITCH_STRIP"==c?z.reset_timer_sensor(a,c,5,.15+.3):z.reset_timer_sensor(a,c,5,.15)}else z.reset_timer_sensor(a,c,5,10)}d();var c=z.create_keyboard_sensor(z.KEY_LEFT_SQ_BRACKET),f=z.create_keyboard_sensor(z.KEY_RIGHT_SQ_BRACKET),k=z.create_keyboard_sensor(z.KEY_SEMI_COLON),p=z.create_keyboard_sensor(z.KEY_SINGLE_QUOTE),q=z.create_keyboard_sensor(z.KEY_SHIFT),I=z.create_timer_sensor(.15,!0),P=z.create_timer_sensor(.05,!0),c=[c,f,k,p,q,I,P];z.create_sensor_manifold(null,"SWITCH_STRIP",
z.CT_TRIGGER,c,function(a){return(a[0]||a[1])&&!a[4]},b);z.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",z.CT_SHOT,c,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);z.create_sensor_manifold(null,"SWITCH_PARAM",z.CT_SHOT,c,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(z.get_sensor_value(a,b,0))?-1:1,d=C[E];d&&(1==c&&d.Sg<d.R.length-1?d.Sg++:-1==c&&0<d.Sg&&d.Sg--)});z.create_sensor_manifold(null,"INC_DEC",z.CT_TRIGGER,c,function(a){return(a[2]||a[3])&&!a[4]},a);z.create_sensor_manifold(null,
"INC_DEC_HOLD",z.CT_SHOT,c,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);z.create_sensor_manifold(null,"MUTE_SOLO",z.CT_SHOT,c,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(z.get_sensor_value(a,b,2))){var c=C[E];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,u.mute(c.Ya,!0),1==c.Wd&&(c.Wd=0,l(c)||n(c))):(c.mute=0,l(c)||u.mute(c.Ya,!1)):0==c.mute?(c.mute=1,u.mute(null,!0)):(c.mute=0,u.mute(null,!1)))}else if((c=C[E])&&0<=c.Wd)if(0==c.Wd){c.Wd=1;u.mute(c.Ya,!1);1==c.mute&&(c.mute=
0);for(var d=0;d<C.length;d++){var e=C[d];e!=c&&0==e.mute&&0==e.Wd&&u.mute(e.Ya,!0)}}else c.Wd=0,l(c)?u.mute(c.Ya,!0):n(c)});c=z.create_elapsed_sensor();z.create_sensor_manifold(null,"MIXER_DRAW",z.CT_CONTINUOUS,[c],null,function(){if(C[E])for(var a=g(),b=a[0];b<=a[1];b++){var c=C[b];h.draw_mixer_strip(c.id,b==E,b%8,c.R,c.Sg,c.mute,c.Wd);if(c.Ya&&u.get_filter_params(c.Ya)){u.get_filter_freq_response(c.Ya,G,m,x);for(c=0;c<m.length;c++)m[c]=20*Math.log(m[c])/Math.LN10;h.plot_array("EQ",b%8,m,20,2E4,
-10,10)}}});c=z.create_timer_sensor(1,!0);z.create_sensor_manifold(null,"MIXER_UPDATE",z.CT_TRIGGER,[c],null,function(){for(var a=g(),b=a[0];b<=a[1];b++)t(C[b])})}};b4w.module.npc_ai=function(a,p){function d(a,b){var c=b.destination,d=E;k.get_translation(b.empty,d);var f=G;k.get_translation(b.collider,f);var h=0;b.Uj?h=b.Uj:b.If&&(h=b.If,b.type==v&&(h*=.5),b.type==D&&(h*=a));switch(b.type){case v:if(b.random&&b.qg){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var n=r,d=m,p=b.speed,q=b.rot_speed;k.get_rotation(b.collider,n);w.transformQuat(u.AXIS_Z,n,d);d[1]=0;w.normalize(d,d);n=.5*p/Math.sin(q/2);p=w.dist(c,f);p<2*n&&w.scaleAndAdd(c,
d,2*n-p,c);b.qg=!1}c[1]=f[1];h&&(c[1]+=h);break;case J:case D:b.random&&b.qg&&(b.type==D?(b.speed=Math.random()+.1,n=b.ME-b.SE):n=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=f[1]+(Math.random()*n-.5*n),c[2]=10*Math.random()-5+d[2],b.qg=!1),h&&(c[1]=f[1]+h)}var c=E,d=G,p=m,f=e,z=b.rig,n=b.collider,h=b.destination,C=b.speed,B=b.actions,ha=l.get_current_anim_name(z);if(!l.is_play(z)||!B.Uk||-1==B.Uk.indexOf(ha)){k.get_translation(n,c);var q=h[0]-c[0],ba=h[2]-c[2],q=Math.sqrt(q*q+ba*ba);
if(q>2*C*a)b.state=20,u.xz_direction(h,c,p),B=b.rig,l.is_animated(B)&&(z=b.speed,C=l.get_frame(B),B=l.get_anim_length(B),z*=B/24*(1-C/B),.9>q/z&&w.scaleAndAdd(h,p,z-q,h)),q=r,z=x,k.get_rotation(b.collider,q),w.transformQuat(u.AXIS_Z,q,d),z[0]=d[0],z[1]=0,z[2]=d[2],w.normalize(z,z),C=w.dot(z,p),B=a/(Math.abs(Math.acos(C))/Math.PI)*b.rot_speed*b.Fr,g.rotationTo(z,p,f),g.rotationTo(u.AXIS_Z,z,q),1<=Math.abs(C)?g.copy(q,f):(g.multiply(f,q,f),g.slerp(q,f,Math.min(B,1),f)),p=a,b.type!=J&&(p=Math.max(p,
1/60),q=A,z=r,g.setAxisAngle(u.AXIS_X,-Math.asin(d[1]),z),g.setAxisAngle(u.AXIS_X,-Math.atan(b.If/(b.speed*p)),q),g.slerp(z,q,p,q),g.multiply(f,q,f)),k.set_rotation_v(n,f),d=m,n=x,u.quat_to_dir(f,u.AXIS_Z,d),w.scale(d,b.speed*a,n),w.add(n,c,n),n[1]=b.type!=v?(h[1]-c[1])*a*.1+c[1]:h[1],k.set_translation_v(b.collider,n);else if(b.type==v)B.move?ha&&-1!=B.move.indexOf(ha)&&l.is_play(z)?b.state=20:(b.state=10,b.qg=!0):(b.state=10,b.qg=!0);else if(b.type==D||b.type==J)b.qg=!0;if(t(b)&&(c=b.rig,!l.is_play(c))){f=
null;switch(b.state){case 10:f=b.actions;f=f.Uk?u.random_from_array(f.Uk):null;break;case 20:f=l.get_current_anim_name(b.rig),d=h=b.actions,d.tf&&-1==d.tf.indexOf(f)&&d.move&&-1!=d.move.indexOf(f)&&.33<Math.random()?(h=b.actions,f=h.tf[h.move.indexOf(f)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(f)||!d.tf&&!d.gg||!d.gg&&!f||d.tf&&-1!=d.tf.indexOf(f)||d.gg&&-1!=d.gg.indexOf(f))?(h=b.actions,h.tf?(d=h.tf.indexOf(f),-1!=d?(f=d+1,f=f<h.move.length?f:0,f=h.move[f]):f=-1!=h.move.indexOf(f)?f:u.random_from_array(h.move)):
f=u.random_from_array(h.move)):(d=b.actions,f=d.gg&&-1==d.gg.indexOf(f)&&d.move&&-1==d.move.indexOf(f)?u.random_from_array(h.gg):null))}f&&(l.apply(c,f),l.set_behavior(c,l.AB_FINISH_RESET),l.set_frame(c,0),l.play(c))}}}function b(a,b,c,d){if(d)if(1==c)switch(d.type){case J:a:{for(c=0;3>c;c++){var e=n.get_sensor_payload(a,b,c).hit_fract;if(e){b=e;break a}}b=void 0}a=100*b;d.If=a<d.min_height?10:a>d.max_height?-10:0;break;case v:a=n.get_sensor_payload(a,b,0).hit_fract;d.If=d.mw==a?0:1-100*a;d.mw=a;
break;case D:a=n.get_sensor_payload(a,b,0).hit_fract,"CLOSE_GROUND"==b?(d.If=100*a-1,d.If=.1>d.If?.05:0):"CLOSE_WATER"==b&&(d.Uj=100*a,d.Uj=d.Uj<d.SE?-.02:d.Uj>d.ME?.02:0)}else d.If=0}function c(){for(var a=0;a<C.length;a++){var b=C[a];q(b);f(b);b.rig&&l.get_current_anim_name(b.rig)&&l.play(b.rig)}}function q(a){var c=w.create(),d=a.collider;switch(a.type){case J:var e=n.create_ray_sensor(d,c,[0,-100,0],"TERRAIN",!0),f=n.create_ray_sensor(d,c,[0,-100,0],"STONE",!0),c=n.create_ray_sensor(d,c,[0,-100,
0],"WATER",!0),e=[e,f,c];n.create_sensor_manifold(d,"CLOSE_GROUND",n.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},b,a);break;case v:e=n.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0);e=[e];n.create_sensor_manifold(d,"CLOSE_GROUND",n.CT_CONTINUOUS,e,null,b,a);break;case D:e=n.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0),c=n.create_ray_sensor(d,c,[0,100,0],"WATER",!0),e=[e],n.create_sensor_manifold(d,"CLOSE_WATER",n.CT_CONTINUOUS,[c],null,b,a),n.create_sensor_manifold(d,"CLOSE_GROUND",
n.CT_CONTINUOUS,e,null,b,a)}}function f(a){function b(c,d,e){1==e?(k.get_translation(a.empty,a.destination),a.Fr=4):a.Fr=1}var c=a.collider;if(a.type==v){var d=n.create_collision_sensor(c,"CONSTRUCTION",!1);n.create_sensor_manifold(c,"CONSTRUCTION_COLL",n.CT_CONTINUOUS,[d],null,b)}}function t(a){var b=a.rig;if(!l.is_play(b))return!0;b=l.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.Uk)return!1;if(-1==c.Uk.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||
c.gg&&-1!=c.gg.indexOf(b)||c.tf&&-1!=c.tf.indexOf(b))return!1;break;default:return!1}return!0}var l=p("animation"),n=p("controls"),g=p("quat"),z=p("scenes"),h=p("time"),k=p("transform"),u=p("util"),w=p("vec3"),C=[];new Float32Array(9);var E=new Float32Array(3),G=new Float32Array(3),m=new Float32Array(3),x=new Float32Array(3),A=new Float32Array(4),r=new Float32Array(4),e=new Float32Array(4),v=a.NT_WALKING=10,J=a.NT_FLYING=20,D=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);
a.start=[];a.ended=[];a.Qm=[];a.If=null;a.mw=null;a.Uj=null;a.qg=!0;a.Fr=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.Qm[b]=!1;C.push(a)};a.enable_animation=function(){if(C.length){c();var a=n.create_elapsed_sensor();n.create_sensor_manifold(C[0].collider,"ELAPSED",n.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,c){if(1==c)for(a=n.get_sensor_value(a,b,0),b=0;b<C.length;b++){c=C[b];var e=a;if(z.is_visible(c.obj))if(c.random)d(e,c);else{for(var f=h.get_timeline(),
g=0;g<c.path.length;g++)if(!c.ended[g]){c.Qm[g]||(c.Qm[g]=!0,c.destination[0]=c.path[g][0],c.destination[1]=c.path[g][1],c.destination[2]=c.path[g][2],c.start[g]=f+c.delay[g]);if(f<c.start[g])break;d(e,c);c.ended[g]=c.qg;break}a:{for(e=0;e<c.path.length;e++)if(0==c.ended[e]){e=!1;break a}e=!0}if(e)for(e=0;e<c.path.length;e++)c.Qm[e]=!1,c.ended[e]=!1}}})}};a.disable_animation=function(){if(!(0>=C.length))for(var a=0;a<C.length;a++){var b=C[a];n.check_sensor_manifolds(b.collider)&&n.remove_sensor_manifold(b.collider);
l.is_play(b.rig)&&l.stop(b.rig)}}};b4w.module.mouse=function(a,p){function d(){1==J&&(J=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);h.remove_sensor_manifold(w.get_active_camera(),"SMOOTH_PL")}function b(a){2==J&&(J=0);a.removeEventListener("mousedown",q,!1);a.removeEventListener("mouseup",f,!1);a.removeEventListener("mousemove",c,!1);h.remove_sensor_manifold(w.get_active_camera(),"SMOOTH_DRAG")}function c(a){e()&&(A[0]+=2*(a.clientX-m),A[1]+=
2*(a.clientY-x),m=a.clientX,x=a.clientY);a.preventDefault()}function q(a){m=a.clientX;x=a.clientY;a.currentTarget.addEventListener("mousemove",c,!1);a.preventDefault()}function f(a){a.currentTarget.removeEventListener("mousemove",c,!1);a.preventDefault()}function t(a,b,c,d){if(.01<Math.abs(A[0])||.01<Math.abs(A[1]))b=h.get_sensor_value(a,b,0),a=C.smooth(A[0],0,b,.1*G),b=C.smooth(A[1],0,b,.1*G),A[0]-=a,A[1]-=b,d(4E-4*-a,4E-4*-b)}function l(a,b){var c=w.get_first_character(),d=w.get_active_camera();
g.eye_rotate(d,a,b);c&&(d=g.get_camera_angles_char(d,r),k.set_character_rotation(c,d[0],d[1]))}function n(a){a=z.client_to_canvas_coords(a.clientX,a.clientY,r);(a=w.pick_object(a[0],a[1]))?(w.outlining_is_enabled(a)&&w.set_outline_intensity(a,1),w.outlining_is_enabled(v)&&a!=v&&w.set_outline_intensity(v,0)):w.outlining_is_enabled(v)&&w.set_outline_intensity(v,0);v=a}var g=p("camera"),z=p("container"),h=p("controls"),k=p("physics"),u=p("print"),w=p("scenes"),C=p("util"),E=p("main"),G=1,m=0,x=0,A=new Float32Array(2),
r=new Float32Array(2),e=null,v=null,J=0;a.request_pointerlock=function(a,c,d,e,f,g){function k(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){b(a);a.addEventListener("mousemove",e,!1);var f=w.get_active_camera();if(!h.check_sensor_manifold(f,"SMOOTH_PL")){var l=h.create_elapsed_sensor();h.create_sensor_manifold(f,"SMOOTH_PL",h.CT_CONTINUOUS,[l],null,t,g)}c()}else a.removeEventListener("mousemove",e,!1),J=0,document.removeEventListener("pointerlockchange",
k,!1),document.removeEventListener("webkitpointerlockchange",k,!1),document.removeEventListener("mozpointerlockchange",k,!1),d()}if(1!=J){J=1;c=c||function(){};d=d||function(){};g=g||l;f=f||function(){return!0};e=e||function(a){if(f()){if("number"==typeof a.movementX){var b=a.movementX;a=a.movementY}else"number"==typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;A[0]+=b;A[1]+=a}};document.addEventListener("pointerlockchange",
k,!1);document.addEventListener("webkitpointerlockchange",k,!1);document.addEventListener("mozpointerlockchange",k,!1);var m=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof m?m.apply(a):u.error("Pointer lock is not available")}};a.exit_pointerlock=d;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b,c){2!=J&&(J=2,d(),e=b||function(){return!0},
c=c||l,a.addEventListener("mousedown",q,!1),a.addEventListener("mouseup",f,!1),a=w.get_active_camera(),h.check_sensor_manifold(a,"SMOOTH_DRAG")||(b=h.create_elapsed_sensor(),h.create_sensor_manifold(a,"SMOOTH_DRAG",h.CT_CONTINUOUS,[b],null,t,c)))};a.exit_mouse_drag=b;a.enable_mouse_hover_outline=function(){E.detect_mobile()||z.get_canvas().addEventListener("mousemove",n)};a.disable_mouse_hover_outline=function(){E.detect_mobile()||(z.get_canvas().removeEventListener("mousemove",n),v&&w.set_outline_intensity(v,
0))};a.get_coords_x=function(a){return"clientX"in a?a.clientX:a.touches&&"clientX"in a.touches[0]?a.touches[0].clientX:-1};a.get_coords_y=function(a){return"clientY"in a?a.clientY:a.touches&&"clientY"in a.touches[0]?a.touches[0].clientY:-1};a.set_plock_smooth_factor=function(a){G=a};a.get_plock_smooth_factor=function(){return G}};b4w.module.preloader=function(a,p){var d=p("app"),b,c,q,f,t,l,n,g,z,h=null;a.create_simple_preloader=function(a){var d=null,g=null,n="#bf9221",p="#000",z;for(z in a)switch(z){case "canvas_container_id":d=a.canvas_container_id;break;case "background_container_id":g=a.background_container_id;break;case "bg_color":p=a.bg_color;break;case "bar_color":n=a.bar_color;break;case "preloader_fadeout":b=a.preloader_fadeout}a=document.createElement("div");z=document.createElement("div");a.id="simple_preloader_container";
var m=document.createElement("div"),x=document.createElement("div"),g=document.getElementById(g);h=document.getElementById(d);a.style.cssText="z-index: 4;background-color: "+p+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";z.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";m.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
n+";border-radius: 0px;";x.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+z.appendChild(m);z.appendChild(x);a.appendChild(z);document.body.appendChild(a);c="SIMPLE";q=a;f=m;t=x;l=g};a.create_rotation_preloader=function(a){var b=null,d=null,f="rgba(0,0,0,0)",g="",p="",m="rgba(0,0,0,0)",x;for(x in a)switch(x){case "canvas_container_id":b=a.canvas_container_id;
break;case "background_container_id":d=a.background_container_id;break;case "frame_bg_color":f=a.frame_bg_color;break;case "bg_color":m=a.bg_color;break;case "frame_class":g=a.frame_class;break;case "anim_elem_class":p=a.anim_elem_class}a=document.createElement("div");x=document.createElement("div");var z=document.createElement("div"),r=document.createElement("div"),d=document.getElementById(d);h=document.getElementById(b);a.style.cssText="z-index: 4;background-color: "+m+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
x.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+f+";";z.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";r.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";z.className=p;x.appendChild(z);x.className=g;x.appendChild(r);
a.appendChild(x);h.appendChild(a);c="ROTATION";q=a;n=z;t=r;l=d};a.create_advanced_preloader=function(a){var b=a.preloader_width,b=b/(b-a.img_width),d=document.getElementById(a.preloader_bar_id),n=document.getElementById(a.fill_band_id),p=document.getElementById(a.preloader_caption_id),G=document.getElementById(a.preloader_container_id),m=document.getElementById(a.background_container_id);h=document.getElementById(a.canvas_container_id);c="ADVANCED";f=d;g=n;z=b;t=p;q=G;l=m};a.update_preloader=function(a){t.innerHTML=
a+"%";"SIMPLE"==c&&(f.style.width=a+"%");"ADVANCED"==c&&(f.style.width=a/z+"%",g.style.width=100-a+"%");"ROTATION"==c&&(n.style.transform="rotate("+a+"deg)");100==a&&(b?(d.css_animate(l,"opacity",1,0,1500,null,null,function(){l.parentNode.removeChild(l)}),d.css_animate(q,"opacity",1,0,1E3,null,null,function(){q.parentNode.removeChild(q)})):(q.parentNode.removeChild(q),l&&l.parentNode.removeChild(l)))}};b4w.module.storage=function(a,p){function d(a){q=a;if(!f){try{f=window.localStorage;try{f.tmp=null,delete f.tmp}catch(b){c.warn("localStorage quota is limited. Disabling localStorage"),f=null}}catch(d){c.warn("Applying chrome localStorage bug workaround"),f=null}f||(c.warn("localStorage is not available, initializing temporary storage"),f={})}}function b(){return f[q]?JSON.parse(f[q]):{}}var c=p("__print"),q="",f=null;a.init=d;a.set=function(a,c){var d=b();d[a]=String(c);f[q]=JSON.stringify(d)};a.cleanup=
function(){delete f[q]};a.get=function(a){var c=b();return c[a]?c[a]:""};a.debug=function(){c.log(b())};d("b4w")};b4w.module.screenshooter=function(a,p){var d=p("main");a.shot=function(){d.canvas_data_url(function(a){var c=window.document.createElement("a");document.body.appendChild(c);c.style.display="none";c.href=a;c.download="screenshot.png";c.click();document.body.removeChild(c)})}};
